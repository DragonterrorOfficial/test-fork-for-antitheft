!function(){var h;function Q(n,t){var e=function(){return e.method.apply(e.scope,arguments)};return e.scope=n,e.method=t,e}window.js=js={_Boot:{}},window.zpp_nape=zpp_nape={shape:{},constraint:{},geom:{},phys:{},dynamics:{},callbacks:{},util:{},space:{}},window.sandbox=sandbox={},window.nape=nape={shape:{},constraint:{},geom:{},phys:{},dynamics:{},callbacks:{},space:{},util:{}};var x=function(){};x.__name__=["Reflect"],x.field=function(n,t){try{return n[t]}catch(n){return null}},x.fields=function(n){var t=[];if(null!=n){var e=Object.prototype.hasOwnProperty;for(var i in n)"__id__"!=i&&"hx__closures__"!=i&&e.call(n,i)&&t.push(i)}return t},x.copy=function(n){for(var t={},e=0,i=x.fields(n);e<i.length;){var p=i[e];++e,t[p]=x.field(n,p)}return t},x.prototype.__class__=x;var i=function(){};i.__name__=["Std"],i.string=function(n){return zn.__string_rec(n,"")},i.prototype.__class__=i;var n=function(){};n.__name__=["StringTools"],n.hex=function(n,t){for(var e="";e="0123456789ABCDEF".charAt(15&n)+e,0<(n>>>=4););if(null!=t)for(;e.length<t;)e="0"+e;return e},n.prototype.__class__=n;var p=js._Boot.HaxeError=function(n){Error.call(this),this.val=n,this.message=String(n),Error.captureStackTrace&&Error.captureStackTrace(this,p)};p.__name__=["js","_Boot","HaxeError"],p.__super__=Error,p.prototype=Object.create(Error.prototype),p.wrap=function(n){return n instanceof Error?n:new p(n)},p.prototype.val=null,p.prototype.__class__=p;var zn=js.Boot=function(){};zn.__name__=["js","Boot"],zn.getClass=function(n){if(n instanceof Array&&null==n.__enum__)return Array;var t=n.__class__;if(null!=t)return t;var e=zn.__nativeClassName(n);return null!=e?zn.__resolveNativeClass(e):null},zn.__string_rec=function(n,t){if(null==n)return"null";if(5<=t.length)return"<...>";var e,i=typeof n;switch("function"==i&&(n.__name__||n.__ename__)&&(i="object"),i){case"function":return"<function>";case"object":if(n instanceof Array){if(n.__enum__){if(2==n.length)return n[0];var p=n[0]+"(";t+="\t";for(var l=2,r=n.length;l<r;){var o=l++;p+=2!=o?","+zn.__string_rec(n[o],t):zn.__string_rec(n[o],t)}return p+")"}var a="[";t+="\t";for(var s=0,_=n.length;s<_;){var h=s++;a+=(0<h?",":"")+zn.__string_rec(n[h],t)}return a+="]"}try{e=n.toString}catch(n){return"???"}if(null!=e&&e!=Object.toString&&"function"==typeof e){var u=n.toString();if("[object Object]"!=u)return u}var x=null,d="{\n";t+="\t";var y=null!=n.hasOwnProperty;for(var x in n)y&&!n.hasOwnProperty(x)||"prototype"!=x&&"__class__"!=x&&"__super__"!=x&&"__interfaces__"!=x&&"__properties__"!=x&&(2!=d.length&&(d+=", \n"),d+=t+x+" : "+zn.__string_rec(n[x],t));return d+="\n"+(t=t.substring(1))+"}";case"string":return n;default:return String(n)}},zn.__interfLoop=function(n,t){if(null==n)return!1;if(n==t)return!0;var e=n.__interfaces__;if(null!=e)for(var i=0,p=e.length;i<p;){var l=e[i++];if(l==t||zn.__interfLoop(l,t))return!0}return zn.__interfLoop(n.__super__,t)},zn.__instanceof=function(n,t){if(null==t)return!1;switch(t){case Array:return n instanceof Array&&null==n.__enum__;case $i:return"boolean"==typeof n;case Xi:return!0;case Hi:return"number"==typeof n;case Ji:return"number"==typeof n&&(0|n)===n;case String:return"string"==typeof n;default:if(null==n)return!1;if("function"==typeof t){if(n instanceof t)return!0;if(zn.__interfLoop(zn.getClass(n),t))return!0}else if("object"==typeof t&&zn.__isNativeObj(t)&&n instanceof t)return!0;return t==Qi&&null!=n.__name__?!0:t==np&&null!=n.__ename__||n.__enum__==t}},zn.__nativeClassName=function(n){var t=zn.__toStr.call(n).slice(8,-1);return"Object"==t||"Function"==t||"Math"==t||"JSON"==t?null:t},zn.__isNativeObj=function(n){return null!=zn.__nativeClassName(n)},zn.__resolveNativeClass=function(n){return $global[n]},zn.prototype.__class__=zn;var co=nape.Config=function(){};co.__name__=["nape","Config"],co.prototype.__class__=co;var t=nape.callbacks.Callback=function(){this.zpp_inner=null};t.__name__=["nape","callbacks","Callback"],t.prototype.zpp_inner=null,t.prototype.get_event=function(){return Vn.events[this.zpp_inner.event]},t.prototype.get_listener=function(){return this.zpp_inner.listener.outer},t.prototype.toString=function(){return""},Object.defineProperty(t.prototype,"event",{get:t.prototype.get_event}),Object.defineProperty(t.prototype,"listener",{get:t.prototype.get_listener}),t.prototype.__class__=t;var e=nape.callbacks.BodyCallback=function(){t.call(this)};e.__name__=["nape","callbacks","BodyCallback"],e.__super__=t,e.prototype=Object.create(t.prototype),e.prototype.get_body=function(){return this.zpp_inner.body.outer},e.prototype.toString=function(){var n="Cb:"+["WAKE","SLEEP"][this.zpp_inner.event-2];return n+=":"+this.zpp_inner.body.outer.toString(),n+=" : listener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(e.prototype,"body",{get:e.prototype.get_body}),e.prototype.__class__=e;var u=nape.callbacks.Listener=function(){this.zpp_inner=null};u.__name__=["nape","callbacks","Listener"],u.prototype.zpp_inner=null,u.prototype.get_type=function(){return Vn.types[this.zpp_inner.type]},u.prototype.get_event=function(){return Vn.events[this.zpp_inner.event]},u.prototype.set_event=function(n){var t;return Vn.events[this.zpp_inner.event]!=n&&(null==Ll.CbEvent_BEGIN&&(Ll.internal=!0,Ll.CbEvent_BEGIN=new d,Ll.internal=!1),t=n==Ll.CbEvent_BEGIN?0:(null==Ll.CbEvent_ONGOING&&(Ll.internal=!0,Ll.CbEvent_ONGOING=new d,Ll.internal=!1),n==Ll.CbEvent_ONGOING?6:(null==Ll.CbEvent_END&&(Ll.internal=!0,Ll.CbEvent_END=new d,Ll.internal=!1),n==Ll.CbEvent_END?1:(null==Ll.CbEvent_SLEEP&&(Ll.internal=!0,Ll.CbEvent_SLEEP=new d,Ll.internal=!1),n==Ll.CbEvent_SLEEP?3:(null==Ll.CbEvent_WAKE&&(Ll.internal=!0,Ll.CbEvent_WAKE=new d,Ll.internal=!1),n==Ll.CbEvent_WAKE?2:(null==Ll.CbEvent_PRE&&(Ll.internal=!0,Ll.CbEvent_PRE=new d,Ll.internal=!1),n==Ll.CbEvent_PRE?5:4))))),this.zpp_inner.swapEvent(t)),Vn.events[this.zpp_inner.event]},u.prototype.get_precedence=function(){return this.zpp_inner.precedence},u.prototype.set_precedence=function(n){return this.zpp_inner.precedence!=n&&(this.zpp_inner.precedence=n,this.zpp_inner.invalidate_precedence()),this.zpp_inner.precedence},u.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},u.prototype.set_space=function(n){var t;return(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(this),null!=n?(t=n.zpp_inner.wrap_listeners).zpp_inner.reverse_flag?t.push(this):t.unshift(this):this.zpp_inner.space=null),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},u.prototype.toString=function(){var n=["BEGIN","END","WAKE","SLEEP","BREAK","PRE","ONGOING"][this.zpp_inner.event];if(0==this.zpp_inner.type)return"BodyListener{"+n+"::"+i.string(this.zpp_inner.body.outer_zn.zpp_inner_zn.options.outer)+"}";if(1==this.zpp_inner.type)return"ConstraintListener{"+n+"::"+i.string(this.zpp_inner.constraint.outer_zn.zpp_inner_zn.options.outer)+"}";var t,e=this.zpp_inner.interaction;switch(e.itype){case 1:t="COLLISION";break;case 2:t="SENSOR";break;case 4:t="FLUID";break;default:t="ALL"}return(2==this.zpp_inner.type?"InteractionListener{"+n+"#"+t+"::"+i.string(e.outer_zni.zpp_inner_zn.options1.outer)+":"+i.string(e.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+t+"::"+i.string(e.outer_znp.zpp_inner_zn.options1.outer)+":"+i.string(e.outer_znp.zpp_inner_zn.options2.outer)+"}")+" precedence="+this.zpp_inner.precedence},Object.defineProperty(u.prototype,"type",{get:u.prototype.get_type}),Object.defineProperty(u.prototype,"event",{get:u.prototype.get_event,set:u.prototype.set_event}),Object.defineProperty(u.prototype,"precedence",{get:u.prototype.get_precedence,set:u.prototype.set_precedence}),Object.defineProperty(u.prototype,"space",{get:u.prototype.get_space,set:u.prototype.set_space}),u.prototype.__class__=u;var l=nape.callbacks.BodyListener=function(n,t,e,i){null==i&&(i=0),this.zpp_inner_zn=null,u.call(this);var p=-1;null==Ll.CbEvent_WAKE&&(Ll.internal=!0,Ll.CbEvent_WAKE=new d,Ll.internal=!1),n==Ll.CbEvent_WAKE?p=2:(null==Ll.CbEvent_SLEEP&&(Ll.internal=!0,Ll.CbEvent_SLEEP=new d,Ll.internal=!1),n==Ll.CbEvent_SLEEP&&(p=3)),this.zpp_inner_zn=new Dn(Zn.argument(t),p,e),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner.precedence=i};l.__name__=["nape","callbacks","BodyListener"],l.__super__=u,l.prototype=Object.create(u.prototype),l.prototype.zpp_inner_zn=null,l.prototype.get_options=function(){return this.zpp_inner_zn.options.outer},l.prototype.set_options=function(n){return this.zpp_inner_zn.options.set(n.zpp_inner),this.zpp_inner_zn.options.outer},l.prototype.get_handler=function(){return this.zpp_inner_zn.handler},l.prototype.set_handler=function(n){return this.zpp_inner_zn.handler=n,this.zpp_inner_zn.handler},Object.defineProperty(l.prototype,"options",{get:l.prototype.get_options,set:l.prototype.set_options}),Object.defineProperty(l.prototype,"handler",{get:l.prototype.get_handler,set:l.prototype.set_handler}),l.prototype.__class__=l;var d=nape.callbacks.CbEvent=function(){};d.__name__=["nape","callbacks","CbEvent"],d.BEGIN=null,d.get_BEGIN=function(){return null==Ll.CbEvent_BEGIN&&(Ll.internal=!0,Ll.CbEvent_BEGIN=new d,Ll.internal=!1),Ll.CbEvent_BEGIN},d.ONGOING=null,d.get_ONGOING=function(){return null==Ll.CbEvent_ONGOING&&(Ll.internal=!0,Ll.CbEvent_ONGOING=new d,Ll.internal=!1),Ll.CbEvent_ONGOING},d.END=null,d.get_END=function(){return null==Ll.CbEvent_END&&(Ll.internal=!0,Ll.CbEvent_END=new d,Ll.internal=!1),Ll.CbEvent_END},d.WAKE=null,d.get_WAKE=function(){return null==Ll.CbEvent_WAKE&&(Ll.internal=!0,Ll.CbEvent_WAKE=new d,Ll.internal=!1),Ll.CbEvent_WAKE},d.SLEEP=null,d.get_SLEEP=function(){return null==Ll.CbEvent_SLEEP&&(Ll.internal=!0,Ll.CbEvent_SLEEP=new d,Ll.internal=!1),Ll.CbEvent_SLEEP},d.BREAK=null,d.get_BREAK=function(){return null==Ll.CbEvent_BREAK&&(Ll.internal=!0,Ll.CbEvent_BREAK=new d,Ll.internal=!1),Ll.CbEvent_BREAK},d.PRE=null,d.get_PRE=function(){return null==Ll.CbEvent_PRE&&(Ll.internal=!0,Ll.CbEvent_PRE=new d,Ll.internal=!1),Ll.CbEvent_PRE},d.prototype.toString=function(){return null==Ll.CbEvent_PRE&&(Ll.internal=!0,Ll.CbEvent_PRE=new d,Ll.internal=!1),this==Ll.CbEvent_PRE?"PRE":(null==Ll.CbEvent_BEGIN&&(Ll.internal=!0,Ll.CbEvent_BEGIN=new d,Ll.internal=!1),this==Ll.CbEvent_BEGIN?"BEGIN":(null==Ll.CbEvent_ONGOING&&(Ll.internal=!0,Ll.CbEvent_ONGOING=new d,Ll.internal=!1),this==Ll.CbEvent_ONGOING?"ONGOING":(null==Ll.CbEvent_END&&(Ll.internal=!0,Ll.CbEvent_END=new d,Ll.internal=!1),this==Ll.CbEvent_END?"END":(null==Ll.CbEvent_WAKE&&(Ll.internal=!0,Ll.CbEvent_WAKE=new d,Ll.internal=!1),this==Ll.CbEvent_WAKE?"WAKE":(null==Ll.CbEvent_SLEEP&&(Ll.internal=!0,Ll.CbEvent_SLEEP=new d,Ll.internal=!1),this==Ll.CbEvent_SLEEP?"SLEEP":(null==Ll.CbEvent_BREAK&&(Ll.internal=!0,Ll.CbEvent_BREAK=new d,Ll.internal=!1),this==Ll.CbEvent_BREAK?"BREAK":""))))))},Object.defineProperty(d,"BEGIN",{get:d.get_BEGIN}),Object.defineProperty(d,"ONGOING",{get:d.get_ONGOING}),Object.defineProperty(d,"END",{get:d.get_END}),Object.defineProperty(d,"WAKE",{get:d.get_WAKE}),Object.defineProperty(d,"SLEEP",{get:d.get_SLEEP}),Object.defineProperty(d,"BREAK",{get:d.get_BREAK}),Object.defineProperty(d,"PRE",{get:d.get_PRE}),d.prototype.__class__=d;var s=nape.callbacks.CbType=function(){this.zpp_inner=null,this.zpp_inner=new Ln,this.zpp_inner.outer=this};s.__name__=["nape","callbacks","CbType"],s.ANY_BODY=null,s.get_ANY_BODY=function(){return Ln.ANY_BODY},s.ANY_CONSTRAINT=null,s.get_ANY_CONSTRAINT=function(){return Ln.ANY_CONSTRAINT},s.ANY_SHAPE=null,s.get_ANY_SHAPE=function(){return Ln.ANY_SHAPE},s.ANY_COMPOUND=null,s.get_ANY_COMPOUND=function(){return Ln.ANY_COMPOUND},s.prototype.zpp_inner=null,s.prototype.get_id=function(){return this.zpp_inner.id},s.prototype.including=function(n){return new v(this).including(n)},s.prototype.excluding=function(n){return new v(this).excluding(n)},s.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},s.prototype.get_interactors=function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=ki.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},s.prototype.get_constraints=function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=ci.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},s.prototype.toString=function(){return this==Ln.ANY_BODY?"ANY_BODY":this==Ln.ANY_SHAPE?"ANY_SHAPE":this==Ln.ANY_COMPOUND?"ANY_COMPOUND":this==Ln.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},Object.defineProperty(s,"ANY_BODY",{get:s.get_ANY_BODY}),Object.defineProperty(s,"ANY_CONSTRAINT",{get:s.get_ANY_CONSTRAINT}),Object.defineProperty(s,"ANY_SHAPE",{get:s.get_ANY_SHAPE}),Object.defineProperty(s,"ANY_COMPOUND",{get:s.get_ANY_COMPOUND}),Object.defineProperty(s.prototype,"id",{get:s.prototype.get_id}),Object.defineProperty(s.prototype,"userData",{get:s.prototype.get_userData}),Object.defineProperty(s.prototype,"interactors",{get:s.prototype.get_interactors}),Object.defineProperty(s.prototype,"constraints",{get:s.prototype.get_constraints}),s.prototype.__class__=s;var qn=nape.callbacks.CbTypeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};qn.__name__=["nape","callbacks","CbTypeIterator"],qn.get=function(n){var t,e,i=null==qn.zpp_pool?(Si.internal=!0,t=new qn,Si.internal=!1,t):(e=qn.zpp_pool,qn.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},qn.prototype.zpp_inner=null,qn.prototype.zpp_i=null,qn.prototype.zpp_critical=null,qn.prototype.zpp_next=null,qn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=qn.zpp_pool,(qn.zpp_pool=this).zpp_inner=null,!1)},qn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},qn.prototype.__class__=qn;var _=nape.callbacks.CbTypeList=function(){this.zpp_inner=null,this.zpp_inner=new Si,this.zpp_inner.outer=this};_.__name__=["nape","callbacks","CbTypeList"],_.fromArray=function(n){for(var t=new _,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},_.prototype.zpp_inner=null,_.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},_.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},_.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},_.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},_.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},_.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:t.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},_.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},_.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},_.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},_.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},_.prototype.empty=function(){return null==this.zpp_inner.inner.head},_.prototype.iterator=function(){return this.zpp_inner.valmod(),qn.get(this)},_.prototype.copy=function(n){null==n&&(n=!1);var t=new _;this.zpp_inner.valmod();for(var e=qn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=qn.zpp_pool,(qn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},_.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=qn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=qn.zpp_pool,(qn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},_.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=qn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=qn.zpp_pool,(qn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},_.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=qn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=qn.zpp_pool,(qn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=qn.zpp_pool,(qn.zpp_pool=t).zpp_inner=null;break}}return this},_.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(_.prototype,"length",{get:_.prototype.get_length}),_.prototype.__class__=_;var r=nape.callbacks.ConstraintCallback=function(){t.call(this)};r.__name__=["nape","callbacks","ConstraintCallback"],r.__super__=t,r.prototype=Object.create(t.prototype),r.prototype.get_constraint=function(){return this.zpp_inner.constraint.outer},r.prototype.toString=function(){var n="Cb:"+["WAKE","SLEEP","BREAK"][this.zpp_inner.event-2];return n+=":"+this.zpp_inner.constraint.outer.toString(),n+=" : listener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(r.prototype,"constraint",{get:r.prototype.get_constraint}),r.prototype.__class__=r;var o=nape.callbacks.ConstraintListener=function(n,t,e,i){null==i&&(i=0),this.zpp_inner_zn=null,u.call(this);var p=-1;null==Ll.CbEvent_WAKE&&(Ll.internal=!0,Ll.CbEvent_WAKE=new d,Ll.internal=!1),n==Ll.CbEvent_WAKE?p=2:(null==Ll.CbEvent_SLEEP&&(Ll.internal=!0,Ll.CbEvent_SLEEP=new d,Ll.internal=!1),n==Ll.CbEvent_SLEEP?p=3:(null==Ll.CbEvent_BREAK&&(Ll.internal=!0,Ll.CbEvent_BREAK=new d,Ll.internal=!1),n==Ll.CbEvent_BREAK&&(p=4))),this.zpp_inner_zn=new Fn(Zn.argument(t),p,e),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner.precedence=i};o.__name__=["nape","callbacks","ConstraintListener"],o.__super__=u,o.prototype=Object.create(u.prototype),o.prototype.zpp_inner_zn=null,o.prototype.get_options=function(){return this.zpp_inner_zn.options.outer},o.prototype.set_options=function(n){return this.zpp_inner_zn.options.set(n.zpp_inner),this.zpp_inner_zn.options.outer},o.prototype.get_handler=function(){return this.zpp_inner_zn.handler},o.prototype.set_handler=function(n){return this.zpp_inner_zn.handler=n,this.zpp_inner_zn.handler},Object.defineProperty(o.prototype,"options",{get:o.prototype.get_options,set:o.prototype.set_options}),Object.defineProperty(o.prototype,"handler",{get:o.prototype.get_handler,set:o.prototype.set_handler}),o.prototype.__class__=o;var a=nape.callbacks.InteractionCallback=function(){t.call(this)};a.__name__=["nape","callbacks","InteractionCallback"],a.__super__=t,a.prototype=Object.create(t.prototype),a.prototype.get_int1=function(){return this.zpp_inner.int1.outer_i},a.prototype.get_int2=function(){return this.zpp_inner.int2.outer_i},a.prototype.get_arbiters=function(){return this.zpp_inner.wrap_arbiters},a.prototype.toString=function(){var n="Cb:"+["BEGIN","END","","","","","ONGOING"][this.zpp_inner.event];return n+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString(),n+=" : "+this.zpp_inner.wrap_arbiters.toString(),n+=" : listener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(a.prototype,"int1",{get:a.prototype.get_int1}),Object.defineProperty(a.prototype,"int2",{get:a.prototype.get_int2}),Object.defineProperty(a.prototype,"arbiters",{get:a.prototype.get_arbiters}),a.prototype.__class__=a;var y=nape.callbacks.InteractionListener=function(n,t,e,i,p,l){null==l&&(l=0),this.zpp_inner_zn=null,u.call(this);var r=-1;null==Ll.CbEvent_BEGIN&&(Ll.internal=!0,Ll.CbEvent_BEGIN=new d,Ll.internal=!1),n==Ll.CbEvent_BEGIN?r=0:(null==Ll.CbEvent_END&&(Ll.internal=!0,Ll.CbEvent_END=new d,Ll.internal=!1),n==Ll.CbEvent_END?r=1:(null==Ll.CbEvent_ONGOING&&(Ll.internal=!0,Ll.CbEvent_ONGOING=new d,Ll.internal=!1),n==Ll.CbEvent_ONGOING&&(r=6))),this.zpp_inner_zn=new le(Zn.argument(e),Zn.argument(i),r,2),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_zni=this).zpp_inner.precedence=l,this.zpp_inner_zn.handleri=p;var o,a=this.zpp_inner_zn.itype,s=1==a?(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),Ll.InteractionType_COLLISION):2==a?(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),Ll.InteractionType_SENSOR):4==a?(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),Ll.InteractionType_FLUID):7==a?(null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1),Ll.InteractionType_ANY):null;s!=t&&(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),o=t==Ll.InteractionType_COLLISION?1:(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),t==Ll.InteractionType_SENSOR?2:(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),t==Ll.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=o);var _=this.zpp_inner_zn.itype;1==_?null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1):2==_?null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1):4==_?null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1):7==_&&null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1)};y.__name__=["nape","callbacks","InteractionListener"],y.__super__=u,y.prototype=Object.create(u.prototype),y.prototype.zpp_inner_zn=null,y.prototype.get_options1=function(){return this.zpp_inner_zn.options1.outer},y.prototype.set_options1=function(n){return this.zpp_inner_zn.options1.set(n.zpp_inner),this.zpp_inner_zn.options1.outer},y.prototype.get_options2=function(){return this.zpp_inner_zn.options2.outer},y.prototype.set_options2=function(n){return this.zpp_inner_zn.options2.set(n.zpp_inner),this.zpp_inner_zn.options2.outer},y.prototype.get_interactionType=function(){var n=this.zpp_inner_zn.itype;return 1==n?(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),Ll.InteractionType_COLLISION):2==n?(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),Ll.InteractionType_SENSOR):4==n?(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),Ll.InteractionType_FLUID):7==n?(null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1),Ll.InteractionType_ANY):null},y.prototype.set_interactionType=function(n){var t,e=this.zpp_inner_zn.itype,i=1==e?(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),Ll.InteractionType_COLLISION):2==e?(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),Ll.InteractionType_SENSOR):4==e?(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),Ll.InteractionType_FLUID):7==e?(null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1),Ll.InteractionType_ANY):null;i!=n&&(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),t=n==Ll.InteractionType_COLLISION?1:(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),n==Ll.InteractionType_SENSOR?2:(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),n==Ll.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=t);var p=this.zpp_inner_zn.itype;return 1==p?(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),Ll.InteractionType_COLLISION):2==p?(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),Ll.InteractionType_SENSOR):4==p?(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),Ll.InteractionType_FLUID):7==p?(null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1),Ll.InteractionType_ANY):null},y.prototype.get_handler=function(){return this.zpp_inner_zn.handleri},y.prototype.set_handler=function(n){return this.zpp_inner_zn.handleri=n,this.zpp_inner_zn.handleri},y.prototype.get_allowSleepingCallbacks=function(){return this.zpp_inner_zn.allowSleepingCallbacks},y.prototype.set_allowSleepingCallbacks=function(n){return this.zpp_inner_zn.allowSleepingCallbacks=n,this.zpp_inner_zn.allowSleepingCallbacks},Object.defineProperty(y.prototype,"options1",{get:y.prototype.get_options1,set:y.prototype.set_options1}),Object.defineProperty(y.prototype,"options2",{get:y.prototype.get_options2,set:y.prototype.set_options2}),Object.defineProperty(y.prototype,"interactionType",{get:y.prototype.get_interactionType,set:y.prototype.set_interactionType}),Object.defineProperty(y.prototype,"handler",{get:y.prototype.get_handler,set:y.prototype.set_handler}),Object.defineProperty(y.prototype,"allowSleepingCallbacks",{get:y.prototype.get_allowSleepingCallbacks,set:y.prototype.set_allowSleepingCallbacks}),y.prototype.__class__=y;var g=nape.callbacks.InteractionType=function(){};g.__name__=["nape","callbacks","InteractionType"],g.COLLISION=null,g.get_COLLISION=function(){return null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),Ll.InteractionType_COLLISION},g.SENSOR=null,g.get_SENSOR=function(){return null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),Ll.InteractionType_SENSOR},g.FLUID=null,g.get_FLUID=function(){return null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),Ll.InteractionType_FLUID},g.ANY=null,g.get_ANY=function(){return null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1),Ll.InteractionType_ANY},g.prototype.toString=function(){return null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),this==Ll.InteractionType_COLLISION?"COLLISION":(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),this==Ll.InteractionType_SENSOR?"SENSOR":(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),this==Ll.InteractionType_FLUID?"FLUID":(null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1),this==Ll.InteractionType_ANY?"ANY":"")))},Object.defineProperty(g,"COLLISION",{get:g.get_COLLISION}),Object.defineProperty(g,"SENSOR",{get:g.get_SENSOR}),Object.defineProperty(g,"FLUID",{get:g.get_FLUID}),Object.defineProperty(g,"ANY",{get:g.get_ANY}),g.prototype.__class__=g;var Un=nape.callbacks.ListenerIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Un.__name__=["nape","callbacks","ListenerIterator"],Un.get=function(n){var t,e,i=null==Un.zpp_pool?(Pi.internal=!0,t=new Un,Pi.internal=!1,t):(e=Un.zpp_pool,Un.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},Un.prototype.zpp_inner=null,Un.prototype.zpp_i=null,Un.prototype.zpp_critical=null,Un.prototype.zpp_next=null,Un.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Un.zpp_pool,(Un.zpp_pool=this).zpp_inner=null,!1)},Un.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Un.prototype.__class__=Un;var z=nape.callbacks.ListenerList=function(){this.zpp_inner=null,this.zpp_inner=new Pi,this.zpp_inner.outer=this};z.__name__=["nape","callbacks","ListenerList"],z.fromArray=function(n){for(var t=new z,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},z.prototype.zpp_inner=null,z.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},z.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},z.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},z.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},z.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},z.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:t.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},z.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},z.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},z.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},z.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},z.prototype.empty=function(){return null==this.zpp_inner.inner.head},z.prototype.iterator=function(){return this.zpp_inner.valmod(),Un.get(this)},z.prototype.copy=function(n){null==n&&(n=!1);var t=new z;this.zpp_inner.valmod();for(var e=Un.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Un.zpp_pool,(Un.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},z.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Un.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=Un.zpp_pool,(Un.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},z.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Un.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Un.zpp_pool,(Un.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},z.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Un.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=Un.zpp_pool,(Un.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Un.zpp_pool,(Un.zpp_pool=t).zpp_inner=null;break}}return this},z.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(z.prototype,"length",{get:z.prototype.get_length}),z.prototype.__class__=z;var c=nape.callbacks.ListenerType=function(){};c.__name__=["nape","callbacks","ListenerType"],c.BODY=null,c.get_BODY=function(){return null==Ll.ListenerType_BODY&&(Ll.internal=!0,Ll.ListenerType_BODY=new c,Ll.internal=!1),Ll.ListenerType_BODY},c.CONSTRAINT=null,c.get_CONSTRAINT=function(){return null==Ll.ListenerType_CONSTRAINT&&(Ll.internal=!0,Ll.ListenerType_CONSTRAINT=new c,Ll.internal=!1),Ll.ListenerType_CONSTRAINT},c.INTERACTION=null,c.get_INTERACTION=function(){return null==Ll.ListenerType_INTERACTION&&(Ll.internal=!0,Ll.ListenerType_INTERACTION=new c,Ll.internal=!1),Ll.ListenerType_INTERACTION},c.PRE=null,c.get_PRE=function(){return null==Ll.ListenerType_PRE&&(Ll.internal=!0,Ll.ListenerType_PRE=new c,Ll.internal=!1),Ll.ListenerType_PRE},c.prototype.toString=function(){return null==Ll.ListenerType_BODY&&(Ll.internal=!0,Ll.ListenerType_BODY=new c,Ll.internal=!1),this==Ll.ListenerType_BODY?"BODY":(null==Ll.ListenerType_CONSTRAINT&&(Ll.internal=!0,Ll.ListenerType_CONSTRAINT=new c,Ll.internal=!1),this==Ll.ListenerType_CONSTRAINT?"CONSTRAINT":(null==Ll.ListenerType_INTERACTION&&(Ll.internal=!0,Ll.ListenerType_INTERACTION=new c,Ll.internal=!1),this==Ll.ListenerType_INTERACTION?"INTERACTION":(null==Ll.ListenerType_PRE&&(Ll.internal=!0,Ll.ListenerType_PRE=new c,Ll.internal=!1),this==Ll.ListenerType_PRE?"PRE":"")))},Object.defineProperty(c,"BODY",{get:c.get_BODY}),Object.defineProperty(c,"CONSTRAINT",{get:c.get_CONSTRAINT}),Object.defineProperty(c,"INTERACTION",{get:c.get_INTERACTION}),Object.defineProperty(c,"PRE",{get:c.get_PRE}),c.prototype.__class__=c;var v=nape.callbacks.OptionType=function(n,t){this.zpp_inner=null,this.zpp_inner=new Zn,this.zpp_inner.outer=this,null!=n&&this.including(n),null!=t&&this.excluding(t)};v.__name__=["nape","callbacks","OptionType"],v.prototype.zpp_inner=null,v.prototype.get_includes=function(){return null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes(),this.zpp_inner.wrap_includes},v.prototype.get_excludes=function(){return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),this.zpp_inner.wrap_excludes},v.prototype.including=function(n){return this.zpp_inner.append(this.zpp_inner.includes,n),this},v.prototype.excluding=function(n){return this.zpp_inner.append(this.zpp_inner.excludes,n),this},v.prototype.toString=function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();var n=this.zpp_inner.wrap_includes.toString();return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),"@{"+n+" excluding "+this.zpp_inner.wrap_excludes.toString()+"}"},Object.defineProperty(v.prototype,"includes",{get:v.prototype.get_includes}),Object.defineProperty(v.prototype,"excludes",{get:v.prototype.get_excludes}),v.prototype.__class__=v;var m=nape.callbacks.PreCallback=function(){t.call(this)};m.__name__=["nape","callbacks","PreCallback"],m.__super__=t,m.prototype=Object.create(t.prototype),m.prototype.get_arbiter=function(){return this.zpp_inner.pre_arbiter.wrapper()},m.prototype.get_int1=function(){return this.zpp_inner.int1.outer_i},m.prototype.get_int2=function(){return this.zpp_inner.int2.outer_i},m.prototype.get_swapped=function(){return this.zpp_inner.pre_swapped},m.prototype.toString=function(){var n="Cb:PRE::"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString();return n+=" : "+this.zpp_inner.pre_arbiter.wrapper().toString(),n+=" : listnener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(m.prototype,"arbiter",{get:m.prototype.get_arbiter}),Object.defineProperty(m.prototype,"int1",{get:m.prototype.get_int1}),Object.defineProperty(m.prototype,"int2",{get:m.prototype.get_int2}),Object.defineProperty(m.prototype,"swapped",{get:m.prototype.get_swapped}),m.prototype.__class__=m;var Il=nape.callbacks.PreFlag=function(){};Il.__name__=["nape","callbacks","PreFlag"],Il.ACCEPT=null,Il.get_ACCEPT=function(){return null==Ll.PreFlag_ACCEPT&&(Ll.internal=!0,Ll.PreFlag_ACCEPT=new Il,Ll.internal=!1),Ll.PreFlag_ACCEPT},Il.IGNORE=null,Il.get_IGNORE=function(){return null==Ll.PreFlag_IGNORE&&(Ll.internal=!0,Ll.PreFlag_IGNORE=new Il,Ll.internal=!1),Ll.PreFlag_IGNORE},Il.ACCEPT_ONCE=null,Il.get_ACCEPT_ONCE=function(){return null==Ll.PreFlag_ACCEPT_ONCE&&(Ll.internal=!0,Ll.PreFlag_ACCEPT_ONCE=new Il,Ll.internal=!1),Ll.PreFlag_ACCEPT_ONCE},Il.IGNORE_ONCE=null,Il.get_IGNORE_ONCE=function(){return null==Ll.PreFlag_IGNORE_ONCE&&(Ll.internal=!0,Ll.PreFlag_IGNORE_ONCE=new Il,Ll.internal=!1),Ll.PreFlag_IGNORE_ONCE},Il.prototype.toString=function(){return null==Ll.PreFlag_ACCEPT&&(Ll.internal=!0,Ll.PreFlag_ACCEPT=new Il,Ll.internal=!1),this==Ll.PreFlag_ACCEPT?"ACCEPT":(null==Ll.PreFlag_IGNORE&&(Ll.internal=!0,Ll.PreFlag_IGNORE=new Il,Ll.internal=!1),this==Ll.PreFlag_IGNORE?"IGNORE":(null==Ll.PreFlag_ACCEPT_ONCE&&(Ll.internal=!0,Ll.PreFlag_ACCEPT_ONCE=new Il,Ll.internal=!1),this==Ll.PreFlag_ACCEPT_ONCE?"ACCEPT_ONCE":(null==Ll.PreFlag_IGNORE_ONCE&&(Ll.internal=!0,Ll.PreFlag_IGNORE_ONCE=new Il,Ll.internal=!1),this==Ll.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")))},Object.defineProperty(Il,"ACCEPT",{get:Il.get_ACCEPT}),Object.defineProperty(Il,"IGNORE",{get:Il.get_IGNORE}),Object.defineProperty(Il,"ACCEPT_ONCE",{get:Il.get_ACCEPT_ONCE}),Object.defineProperty(Il,"IGNORE_ONCE",{get:Il.get_IGNORE_ONCE}),Il.prototype.__class__=Il;var f=nape.callbacks.PreListener=function(n,t,e,i,p,l){null==l&&(l=!1),null==p&&(p=0),this.zpp_inner_zn=null,u.call(this),this.zpp_inner_zn=new le(Zn.argument(t),Zn.argument(e),5,3),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_znp=this).zpp_inner.precedence=p,this.zpp_inner_zn.pure=l,this.zpp_inner_zn.handlerp=i;var r,o=this.zpp_inner_zn.itype,a=1==o?(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),Ll.InteractionType_COLLISION):2==o?(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),Ll.InteractionType_SENSOR):4==o?(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),Ll.InteractionType_FLUID):7==o?(null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1),Ll.InteractionType_ANY):null;a!=n&&(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),r=n==Ll.InteractionType_COLLISION?1:(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),n==Ll.InteractionType_SENSOR?2:(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),n==Ll.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=r);var s=this.zpp_inner_zn.itype;1==s?null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1):2==s?null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1):4==s?null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1):7==s&&null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1)};f.__name__=["nape","callbacks","PreListener"],f.__super__=u,f.prototype=Object.create(u.prototype),f.prototype.zpp_inner_zn=null,f.prototype.get_options1=function(){return this.zpp_inner_zn.options1.outer},f.prototype.set_options1=function(n){return this.zpp_inner_zn.options1.set(n.zpp_inner),this.zpp_inner_zn.options1.outer},f.prototype.get_options2=function(){return this.zpp_inner_zn.options2.outer},f.prototype.set_options2=function(n){return this.zpp_inner_zn.options2.set(n.zpp_inner),this.zpp_inner_zn.options2.outer},f.prototype.get_handler=function(){return this.zpp_inner_zn.handlerp},f.prototype.set_handler=function(n){return this.zpp_inner_zn.handlerp=n,this.zpp_inner_zn.wake(),this.zpp_inner_zn.handlerp},f.prototype.get_pure=function(){return this.zpp_inner_zn.pure},f.prototype.set_pure=function(n){return n||this.zpp_inner_zn.wake(),this.zpp_inner_zn.pure=n,this.zpp_inner_zn.pure},f.prototype.get_interactionType=function(){var n=this.zpp_inner_zn.itype;return 1==n?(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),Ll.InteractionType_COLLISION):2==n?(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),Ll.InteractionType_SENSOR):4==n?(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),Ll.InteractionType_FLUID):7==n?(null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1),Ll.InteractionType_ANY):null},f.prototype.set_interactionType=function(n){var t,e=this.zpp_inner_zn.itype,i=1==e?(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),Ll.InteractionType_COLLISION):2==e?(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),Ll.InteractionType_SENSOR):4==e?(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),Ll.InteractionType_FLUID):7==e?(null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1),Ll.InteractionType_ANY):null;i!=n&&(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),t=n==Ll.InteractionType_COLLISION?1:(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),n==Ll.InteractionType_SENSOR?2:(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),n==Ll.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=t);var p=this.zpp_inner_zn.itype;return 1==p?(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),Ll.InteractionType_COLLISION):2==p?(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),Ll.InteractionType_SENSOR):4==p?(null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),Ll.InteractionType_FLUID):7==p?(null==Ll.InteractionType_ANY&&(Ll.internal=!0,Ll.InteractionType_ANY=new g,Ll.internal=!1),Ll.InteractionType_ANY):null},Object.defineProperty(f.prototype,"options1",{get:f.prototype.get_options1,set:f.prototype.set_options1}),Object.defineProperty(f.prototype,"options2",{get:f.prototype.get_options2,set:f.prototype.set_options2}),Object.defineProperty(f.prototype,"handler",{get:f.prototype.get_handler,set:f.prototype.set_handler}),Object.defineProperty(f.prototype,"pure",{get:f.prototype.get_pure,set:f.prototype.set_pure}),Object.defineProperty(f.prototype,"interactionType",{get:f.prototype.get_interactionType,set:f.prototype.set_interactionType}),f.prototype.__class__=f;var H=nape.constraint.Constraint=function(){this.debugDraw=!0,this.zpp_inner.insert_cbtype(Ln.ANY_CONSTRAINT.zpp_inner)};H.__name__=["nape","constraint","Constraint"],H.prototype.zpp_inner=null,H.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},H.prototype.debugDraw=null,H.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},H.prototype.set_compound=function(n){var t;return(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(this),null!=n&&((t=n.zpp_inner.wrap_constraints).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},H.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},H.prototype.set_space=function(n){var t;return(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(this),null!=n?(t=n.zpp_inner.wrap_constraints).zpp_inner.reverse_flag?t.push(this):t.unshift(this):this.zpp_inner.space=null),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},H.prototype.get_isSleeping=function(){return this.zpp_inner.component.sleeping},H.prototype.get_active=function(){return this.zpp_inner.active},H.prototype.set_active=function(n){return this.zpp_inner.active!=n&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),n?(this.zpp_inner.active=n,this.zpp_inner.activate(),null!=this.zpp_inner.space&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.sleeping=!0),this.zpp_inner.space.wake_constraint(this.zpp_inner,!0))):(null!=this.zpp_inner.space&&(this.zpp_inner.wake(),this.zpp_inner.space.live_constraints.remove(this.zpp_inner)),this.zpp_inner.active=n,this.zpp_inner.deactivate())),this.zpp_inner.active},H.prototype.get_ignore=function(){return this.zpp_inner.ignore},H.prototype.set_ignore=function(n){return this.zpp_inner.ignore!=n&&(this.zpp_inner.ignore=n,this.zpp_inner.wake()),this.zpp_inner.ignore},H.prototype.get_stiff=function(){return this.zpp_inner.stiff},H.prototype.set_stiff=function(n){return this.zpp_inner.stiff!=n&&(this.zpp_inner.stiff=n,this.zpp_inner.wake()),this.zpp_inner.stiff},H.prototype.get_frequency=function(){return this.zpp_inner.frequency},H.prototype.set_frequency=function(n){return this.zpp_inner.frequency!=n&&(this.zpp_inner.frequency=n,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.frequency},H.prototype.get_damping=function(){return this.zpp_inner.damping},H.prototype.set_damping=function(n){return this.zpp_inner.damping!=n&&(this.zpp_inner.damping=n,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.damping},H.prototype.get_maxForce=function(){return this.zpp_inner.maxForce},H.prototype.set_maxForce=function(n){return this.zpp_inner.maxForce!=n&&(this.zpp_inner.maxForce=n,this.zpp_inner.wake()),this.zpp_inner.maxForce},H.prototype.get_maxError=function(){return this.zpp_inner.maxError},H.prototype.set_maxError=function(n){return this.zpp_inner.maxError!=n&&(this.zpp_inner.maxError=n,this.zpp_inner.wake()),this.zpp_inner.maxError},H.prototype.get_breakUnderForce=function(){return this.zpp_inner.breakUnderForce},H.prototype.set_breakUnderForce=function(n){return this.zpp_inner.breakUnderForce!=n&&(this.zpp_inner.breakUnderForce=n,this.zpp_inner.wake()),this.zpp_inner.breakUnderForce},H.prototype.get_breakUnderError=function(){return this.zpp_inner.breakUnderError},H.prototype.set_breakUnderError=function(n){return this.zpp_inner.breakUnderError!=n&&(this.zpp_inner.breakUnderError=n,this.zpp_inner.wake()),this.zpp_inner.breakUnderError},H.prototype.get_removeOnBreak=function(){return this.zpp_inner.removeOnBreak},H.prototype.set_removeOnBreak=function(n){return this.zpp_inner.removeOnBreak=n,this.zpp_inner.removeOnBreak},H.prototype.impulse=function(){return null},H.prototype.bodyImpulse=function(n){return null},H.prototype.visitBodies=function(n){},H.prototype.get_cbTypes=function(){return null==this.zpp_inner.wrap_cbTypes&&this.zpp_inner.setupcbTypes(),this.zpp_inner.wrap_cbTypes},H.prototype.toString=function(){return"{Constraint}"},H.prototype.copy=function(){return this.zpp_inner.copy()},Object.defineProperty(H.prototype,"userData",{get:H.prototype.get_userData}),Object.defineProperty(H.prototype,"compound",{get:H.prototype.get_compound,set:H.prototype.set_compound}),Object.defineProperty(H.prototype,"space",{get:H.prototype.get_space,set:H.prototype.set_space}),Object.defineProperty(H.prototype,"isSleeping",{get:H.prototype.get_isSleeping}),Object.defineProperty(H.prototype,"active",{get:H.prototype.get_active,set:H.prototype.set_active}),Object.defineProperty(H.prototype,"ignore",{get:H.prototype.get_ignore,set:H.prototype.set_ignore}),Object.defineProperty(H.prototype,"stiff",{get:H.prototype.get_stiff,set:H.prototype.set_stiff}),Object.defineProperty(H.prototype,"frequency",{get:H.prototype.get_frequency,set:H.prototype.set_frequency}),Object.defineProperty(H.prototype,"damping",{get:H.prototype.get_damping,set:H.prototype.set_damping}),Object.defineProperty(H.prototype,"maxForce",{get:H.prototype.get_maxForce,set:H.prototype.set_maxForce}),Object.defineProperty(H.prototype,"maxError",{get:H.prototype.get_maxError,set:H.prototype.set_maxError}),Object.defineProperty(H.prototype,"breakUnderForce",{get:H.prototype.get_breakUnderForce,set:H.prototype.set_breakUnderForce}),Object.defineProperty(H.prototype,"breakUnderError",{get:H.prototype.get_breakUnderError,set:H.prototype.set_breakUnderError}),Object.defineProperty(H.prototype,"removeOnBreak",{get:H.prototype.get_removeOnBreak,set:H.prototype.set_removeOnBreak}),Object.defineProperty(H.prototype,"cbTypes",{get:H.prototype.get_cbTypes}),H.prototype.__class__=H;var b=nape.constraint.AngleJoint=function(n,t,e,i,p){null==p&&(p=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Gn,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,H.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==n?null:n.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var r=null==t?null:t.zpp_inner;r!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b1!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake())),this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=e&&(this.zpp_inner_zn.jointMin=e,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=i&&(this.zpp_inner_zn.jointMax=i,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=p&&(this.zpp_inner_zn.ratio=p,this.zpp_inner.wake())};b.__name__=["nape","constraint","AngleJoint"],b.__super__=H,b.prototype=Object.create(H.prototype),b.prototype.zpp_inner_zn=null,b.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},b.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},b.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},b.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},b.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},b.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},b.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},b.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},b.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},b.prototype.set_ratio=function(n){return this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},b.prototype.isSlack=function(){var n,t=this.zpp_inner_zn,e=t.ratio*t.b2.rot-t.b1.rot;return t.equal?(n=!1,t.scale=1):n=e<t.jointMin?!(t.scale=-1):e>t.jointMax?(e-=t.jointMax,!(t.scale=1)):!(e=t.scale=0),n},b.prototype.impulse=function(){var n=new K(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},b.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):X.get(0,0,0)},b.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(b.prototype,"body1",{get:b.prototype.get_body1,set:b.prototype.set_body1}),Object.defineProperty(b.prototype,"body2",{get:b.prototype.get_body2,set:b.prototype.set_body2}),Object.defineProperty(b.prototype,"jointMin",{get:b.prototype.get_jointMin,set:b.prototype.set_jointMin}),Object.defineProperty(b.prototype,"jointMax",{get:b.prototype.get_jointMax,set:b.prototype.set_jointMax}),Object.defineProperty(b.prototype,"ratio",{get:b.prototype.get_ratio,set:b.prototype.set_ratio}),b.prototype.__class__=b;var Kn=nape.constraint.ConstraintIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Kn.__name__=["nape","constraint","ConstraintIterator"],Kn.get=function(n){var t,e,i=null==Kn.zpp_pool?(ci.internal=!0,t=new Kn,ci.internal=!1,t):(e=Kn.zpp_pool,Kn.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},Kn.prototype.zpp_inner=null,Kn.prototype.zpp_i=null,Kn.prototype.zpp_critical=null,Kn.prototype.zpp_next=null,Kn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=this).zpp_inner=null,!1)},Kn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Kn.prototype.__class__=Kn;var w=nape.constraint.ConstraintList=function(){this.zpp_inner=null,this.zpp_inner=new ci,this.zpp_inner.outer=this};w.__name__=["nape","constraint","ConstraintList"],w.fromArray=function(n){for(var t=new w,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},w.prototype.zpp_inner=null,w.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},w.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},w.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},w.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},w.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},w.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:t.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},w.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},w.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},w.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},w.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},w.prototype.empty=function(){return null==this.zpp_inner.inner.head},w.prototype.iterator=function(){return this.zpp_inner.valmod(),Kn.get(this)},w.prototype.copy=function(n){null==n&&(n=!1);var t=new w;this.zpp_inner.valmod();for(var e=Kn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},w.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Kn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},w.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Kn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},w.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Kn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=t).zpp_inner=null;break}}return this},w.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(w.prototype,"length",{get:w.prototype.get_length}),w.prototype.__class__=w;var M=nape.constraint.DistanceJoint=function(n,t,e,i,p,l){this.zpp_inner_zn=null,this.zpp_inner_zn=new rt,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,H.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var r=null==n?null:n.zpp_inner;r!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b2!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var o=null==t?null:t.zpp_inner;o!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=o,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=o&&this.zpp_inner_zn.b1!=o&&null!=o&&o.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=o&&o.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var a=this.zpp_inner_zn.wrap_a1,s=e.zpp_inner;null!=s._validate&&s._validate();var _=e.zpp_inner.x,h=e.zpp_inner;null!=h._validate&&h._validate();var u,x,d,y=e.zpp_inner.y,z=a.zpp_inner;null!=z._validate&&z._validate(),a.zpp_inner.x==_&&(null!=(u=a.zpp_inner)._validate&&u._validate(),a.zpp_inner.y==y)||(a.zpp_inner.x=_,a.zpp_inner.y=y,null!=(x=a.zpp_inner)._invalidate&&x._invalidate(x)),e.zpp_inner.weak&&(d=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Ri.poolVec2,Ri.poolVec2=e,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=mo.zpp_pool,mo.zpp_pool=d),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var c=this.zpp_inner_zn.wrap_a2,v=i.zpp_inner;null!=v._validate&&v._validate();var m=i.zpp_inner.x,f=i.zpp_inner;null!=f._validate&&f._validate();var b,g,w,M=i.zpp_inner.y,C=c.zpp_inner;null!=C._validate&&C._validate(),c.zpp_inner.x==m&&(null!=(b=c.zpp_inner)._validate&&b._validate(),c.zpp_inner.y==M)||(c.zpp_inner.x=m,c.zpp_inner.y=M,null!=(g=c.zpp_inner)._invalidate&&g._invalidate(g)),i.zpp_inner.weak&&(w=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Ri.poolVec2,Ri.poolVec2=i,null!=w.outer&&(w.outer.zpp_inner=null,w.outer=null),w._isimmutable=null,w._validate=null,w._invalidate=null,w.next=mo.zpp_pool,mo.zpp_pool=w),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=p&&(this.zpp_inner_zn.jointMin=p,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=l&&(this.zpp_inner_zn.jointMax=l,this.zpp_inner.wake())};M.__name__=["nape","constraint","DistanceJoint"],M.__super__=H,M.prototype=Object.create(H.prototype),M.prototype.zpp_inner_zn=null,M.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},M.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},M.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},M.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},M.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},M.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var t=this.zpp_inner_zn.wrap_a1,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},M.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},M.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},M.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},M.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},M.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},M.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},M.prototype.isSlack=function(){return this.zpp_inner_zn.slack},M.prototype.impulse=function(){var n=new K(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},M.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):X.get()},M.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(M.prototype,"body1",{get:M.prototype.get_body1,set:M.prototype.set_body1}),Object.defineProperty(M.prototype,"body2",{get:M.prototype.get_body2,set:M.prototype.set_body2}),Object.defineProperty(M.prototype,"anchor1",{get:M.prototype.get_anchor1,set:M.prototype.set_anchor1}),Object.defineProperty(M.prototype,"anchor2",{get:M.prototype.get_anchor2,set:M.prototype.set_anchor2}),Object.defineProperty(M.prototype,"jointMin",{get:M.prototype.get_jointMin,set:M.prototype.set_jointMin}),Object.defineProperty(M.prototype,"jointMax",{get:M.prototype.get_jointMax,set:M.prototype.set_jointMax}),M.prototype.__class__=M;var C=nape.constraint.LineJoint=function(n,t,e,i,p,l,r){this.zpp_inner_zn=null,this.zpp_inner_zn=new _t,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,H.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var o=null==n?null:n.zpp_inner;o!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=o,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=o&&this.zpp_inner_zn.b2!=o&&null!=o&&o.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=o&&o.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var a=null==t?null:t.zpp_inner;a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var s=this.zpp_inner_zn.wrap_a1,_=e.zpp_inner;null!=_._validate&&_._validate();var h=e.zpp_inner.x,u=e.zpp_inner;null!=u._validate&&u._validate();var x,d,y,z=e.zpp_inner.y,c=s.zpp_inner;null!=c._validate&&c._validate(),s.zpp_inner.x==h&&(null!=(x=s.zpp_inner)._validate&&x._validate(),s.zpp_inner.y==z)||(s.zpp_inner.x=h,s.zpp_inner.y=z,null!=(d=s.zpp_inner)._invalidate&&d._invalidate(d)),e.zpp_inner.weak&&(y=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Ri.poolVec2,Ri.poolVec2=e,null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=mo.zpp_pool,mo.zpp_pool=y),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var v=this.zpp_inner_zn.wrap_a2,m=i.zpp_inner;null!=m._validate&&m._validate();var f=i.zpp_inner.x,b=i.zpp_inner;null!=b._validate&&b._validate();var g,w,M,C=i.zpp_inner.y,k=v.zpp_inner;null!=k._validate&&k._validate(),v.zpp_inner.x==f&&(null!=(g=v.zpp_inner)._validate&&g._validate(),v.zpp_inner.y==C)||(v.zpp_inner.x=f,v.zpp_inner.y=C,null!=(w=v.zpp_inner)._invalidate&&w._invalidate(w)),i.zpp_inner.weak&&(M=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Ri.poolVec2,Ri.poolVec2=i,null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M._isimmutable=null,M._validate=null,M._invalidate=null,M.next=mo.zpp_pool,mo.zpp_pool=M),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var O=this.zpp_inner_zn.wrap_n,P=p.zpp_inner;null!=P._validate&&P._validate();var S=p.zpp_inner.x,A=p.zpp_inner;null!=A._validate&&A._validate();var j,E,I,T=p.zpp_inner.y,N=O.zpp_inner;null!=N._validate&&N._validate(),O.zpp_inner.x==S&&(null!=(j=O.zpp_inner)._validate&&j._validate(),O.zpp_inner.y==T)||(O.zpp_inner.x=S,O.zpp_inner.y=T,null!=(E=O.zpp_inner)._invalidate&&E._invalidate(E)),p.zpp_inner.weak&&(I=p.zpp_inner,p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Ri.poolVec2,Ri.poolVec2=p,null!=I.outer&&(I.outer.zpp_inner=null,I.outer=null),I._isimmutable=null,I._validate=null,I._invalidate=null,I.next=mo.zpp_pool,mo.zpp_pool=I),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=l&&(this.zpp_inner_zn.jointMin=l,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=r&&(this.zpp_inner_zn.jointMax=r,this.zpp_inner.wake())};C.__name__=["nape","constraint","LineJoint"],C.__super__=H,C.prototype=Object.create(H.prototype),C.prototype.zpp_inner_zn=null,C.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},C.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},C.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},C.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},C.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},C.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var t=this.zpp_inner_zn.wrap_a1,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},C.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},C.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},C.prototype.get_direction=function(){return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},C.prototype.set_direction=function(n){null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var t=this.zpp_inner_zn.wrap_n,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},C.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},C.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},C.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},C.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},C.prototype.impulse=function(){var n=new K(2,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n},C.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):X.get()},C.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(C.prototype,"body1",{get:C.prototype.get_body1,set:C.prototype.set_body1}),Object.defineProperty(C.prototype,"body2",{get:C.prototype.get_body2,set:C.prototype.set_body2}),Object.defineProperty(C.prototype,"anchor1",{get:C.prototype.get_anchor1,set:C.prototype.set_anchor1}),Object.defineProperty(C.prototype,"anchor2",{get:C.prototype.get_anchor2,set:C.prototype.set_anchor2}),Object.defineProperty(C.prototype,"direction",{get:C.prototype.get_direction,set:C.prototype.set_direction}),Object.defineProperty(C.prototype,"jointMin",{get:C.prototype.get_jointMin,set:C.prototype.set_jointMin}),Object.defineProperty(C.prototype,"jointMax",{get:C.prototype.get_jointMax,set:C.prototype.set_jointMax}),C.prototype.__class__=C;var k=nape.constraint.MotorJoint=function(n,t,e,i){null==i&&(i=1),null==e&&(e=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new ht,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,H.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var p=null==n?null:n.zpp_inner;p!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b2!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var l=null==t?null:t.zpp_inner;l!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b1!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=e&&(this.zpp_inner_zn.rate=e,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=i&&(this.zpp_inner_zn.ratio=i,this.zpp_inner.wake())};k.__name__=["nape","constraint","MotorJoint"],k.__super__=H,k.prototype=Object.create(H.prototype),k.prototype.zpp_inner_zn=null,k.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},k.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},k.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},k.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},k.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},k.prototype.set_ratio=function(n){return this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},k.prototype.get_rate=function(){return this.zpp_inner_zn.rate},k.prototype.set_rate=function(n){return this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=n&&(this.zpp_inner_zn.rate=n,this.zpp_inner.wake()),this.zpp_inner_zn.rate},k.prototype.impulse=function(){var n=new K(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},k.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):X.get()},k.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(k.prototype,"body1",{get:k.prototype.get_body1,set:k.prototype.set_body1}),Object.defineProperty(k.prototype,"body2",{get:k.prototype.get_body2,set:k.prototype.set_body2}),Object.defineProperty(k.prototype,"ratio",{get:k.prototype.get_ratio,set:k.prototype.set_ratio}),Object.defineProperty(k.prototype,"rate",{get:k.prototype.get_rate,set:k.prototype.set_rate}),k.prototype.__class__=k;var O=nape.constraint.PivotJoint=function(n,t,e,i){this.zpp_inner_zn=null,this.zpp_inner_zn=new ut,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,H.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var p=null==n?null:n.zpp_inner;p!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b2!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var l=null==t?null:t.zpp_inner;l!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b1!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var r=this.zpp_inner_zn.wrap_a1,o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x,s=e.zpp_inner;null!=s._validate&&s._validate();var _,h,u,x=e.zpp_inner.y,d=r.zpp_inner;null!=d._validate&&d._validate(),r.zpp_inner.x==a&&(null!=(_=r.zpp_inner)._validate&&_._validate(),r.zpp_inner.y==x)||(r.zpp_inner.x=a,r.zpp_inner.y=x,null!=(h=r.zpp_inner)._invalidate&&h._invalidate(h)),e.zpp_inner.weak&&(u=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Ri.poolVec2,Ri.poolVec2=e,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=mo.zpp_pool,mo.zpp_pool=u),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var y=this.zpp_inner_zn.wrap_a2,z=i.zpp_inner;null!=z._validate&&z._validate();var c=i.zpp_inner.x,v=i.zpp_inner;null!=v._validate&&v._validate();var m,f,b,g=i.zpp_inner.y,w=y.zpp_inner;null!=w._validate&&w._validate(),y.zpp_inner.x==c&&(null!=(m=y.zpp_inner)._validate&&m._validate(),y.zpp_inner.y==g)||(y.zpp_inner.x=c,y.zpp_inner.y=g,null!=(f=y.zpp_inner)._invalidate&&f._invalidate(f)),i.zpp_inner.weak&&(b=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Ri.poolVec2,Ri.poolVec2=i,null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=mo.zpp_pool,mo.zpp_pool=b),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2()};O.__name__=["nape","constraint","PivotJoint"],O.__super__=H,O.prototype=Object.create(H.prototype),O.prototype.zpp_inner_zn=null,O.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},O.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},O.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},O.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},O.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},O.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var t=this.zpp_inner_zn.wrap_a1,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},O.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},O.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},O.prototype.impulse=function(){var n=new K(2,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n},O.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):X.get()},O.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(O.prototype,"body1",{get:O.prototype.get_body1,set:O.prototype.set_body1}),Object.defineProperty(O.prototype,"body2",{get:O.prototype.get_body2,set:O.prototype.set_body2}),Object.defineProperty(O.prototype,"anchor1",{get:O.prototype.get_anchor1,set:O.prototype.set_anchor1}),Object.defineProperty(O.prototype,"anchor2",{get:O.prototype.get_anchor2,set:O.prototype.set_anchor2}),O.prototype.__class__=O;var P=nape.constraint.PulleyJoint=function(n,t,e,i,p,l,r,o,a,s,_){null==_&&(_=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new xt,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,H.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var h=null==n?null:n.zpp_inner;h!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=h,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=h&&this.zpp_inner_zn.b2!=h&&this.zpp_inner_zn.b3!=h&&this.zpp_inner_zn.b4!=h&&null!=h&&h.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=h&&h.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var u=null==t?null:t.zpp_inner;u!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=u,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=u&&this.zpp_inner_zn.b1!=u&&this.zpp_inner_zn.b3!=u&&this.zpp_inner_zn.b4!=u&&null!=u&&u.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=u&&u.wake())),this.zpp_inner.immutable_midstep("Constraint::body3");var x=null==e?null:e.zpp_inner;x!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=x,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=x&&this.zpp_inner_zn.b1!=x&&this.zpp_inner_zn.b2!=x&&this.zpp_inner_zn.b4!=x&&null!=x&&x.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=x&&x.wake())),this.zpp_inner.immutable_midstep("Constraint::body4");var d=null==i?null:i.zpp_inner;d!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=d,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=d&&this.zpp_inner_zn.b1!=d&&this.zpp_inner_zn.b2!=d&&this.zpp_inner_zn.b3!=d&&null!=d&&d.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=d&&d.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var y=this.zpp_inner_zn.wrap_a1,z=p.zpp_inner;null!=z._validate&&z._validate();var c=p.zpp_inner.x,v=p.zpp_inner;null!=v._validate&&v._validate();var m,f,b,g=p.zpp_inner.y,w=y.zpp_inner;null!=w._validate&&w._validate(),y.zpp_inner.x==c&&(null!=(m=y.zpp_inner)._validate&&m._validate(),y.zpp_inner.y==g)||(y.zpp_inner.x=c,y.zpp_inner.y=g,null!=(f=y.zpp_inner)._invalidate&&f._invalidate(f)),p.zpp_inner.weak&&(b=p.zpp_inner,p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Ri.poolVec2,Ri.poolVec2=p,null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=mo.zpp_pool,mo.zpp_pool=b),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var M=this.zpp_inner_zn.wrap_a2,C=l.zpp_inner;null!=C._validate&&C._validate();var k=l.zpp_inner.x,O=l.zpp_inner;null!=O._validate&&O._validate();var P,S,A,j=l.zpp_inner.y,E=M.zpp_inner;null!=E._validate&&E._validate(),M.zpp_inner.x==k&&(null!=(P=M.zpp_inner)._validate&&P._validate(),M.zpp_inner.y==j)||(M.zpp_inner.x=k,M.zpp_inner.y=j,null!=(S=M.zpp_inner)._invalidate&&S._invalidate(S)),l.zpp_inner.weak&&(A=l.zpp_inner,l.zpp_inner.outer=null,l.zpp_inner=null,l.zpp_pool=Ri.poolVec2,Ri.poolVec2=l,null!=A.outer&&(A.outer.zpp_inner=null,A.outer=null),A._isimmutable=null,A._validate=null,A._invalidate=null,A.next=mo.zpp_pool,mo.zpp_pool=A),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var I=this.zpp_inner_zn.wrap_a3,T=r.zpp_inner;null!=T._validate&&T._validate();var N=r.zpp_inner.x,L=r.zpp_inner;null!=L._validate&&L._validate();var V,D,F,R=r.zpp_inner.y,Z=I.zpp_inner;null!=Z._validate&&Z._validate(),I.zpp_inner.x==N&&(null!=(V=I.zpp_inner)._validate&&V._validate(),I.zpp_inner.y==R)||(I.zpp_inner.x=N,I.zpp_inner.y=R,null!=(D=I.zpp_inner)._invalidate&&D._invalidate(D)),r.zpp_inner.weak&&(F=r.zpp_inner,r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Ri.poolVec2,Ri.poolVec2=r,null!=F.outer&&(F.outer.zpp_inner=null,F.outer=null),F._isimmutable=null,F._validate=null,F._invalidate=null,F.next=mo.zpp_pool,mo.zpp_pool=F),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var B=this.zpp_inner_zn.wrap_a4,G=o.zpp_inner;null!=G._validate&&G._validate();var q=o.zpp_inner.x,U=o.zpp_inner;null!=U._validate&&U._validate();var K,W,Y,J=o.zpp_inner.y,X=B.zpp_inner;null!=X._validate&&X._validate(),B.zpp_inner.x==q&&(null!=(K=B.zpp_inner)._validate&&K._validate(),B.zpp_inner.y==J)||(B.zpp_inner.x=q,B.zpp_inner.y=J,null!=(W=B.zpp_inner)._invalidate&&W._invalidate(W)),o.zpp_inner.weak&&(Y=o.zpp_inner,o.zpp_inner.outer=null,o.zpp_inner=null,o.zpp_pool=Ri.poolVec2,Ri.poolVec2=o,null!=Y.outer&&(Y.outer.zpp_inner=null,Y.outer=null),Y._isimmutable=null,Y._validate=null,Y._invalidate=null,Y.next=mo.zpp_pool,mo.zpp_pool=Y),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=_&&(this.zpp_inner_zn.ratio=_,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=a&&(this.zpp_inner_zn.jointMin=a,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=s&&(this.zpp_inner_zn.jointMax=s,this.zpp_inner.wake())};P.__name__=["nape","constraint","PulleyJoint"],P.__super__=H,P.prototype=Object.create(H.prototype),P.prototype.zpp_inner_zn=null,P.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},P.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b3!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},P.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},P.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b3!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},P.prototype.get_body3=function(){return null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},P.prototype.set_body3=function(n){this.zpp_inner.immutable_midstep("Constraint::body3");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},P.prototype.get_body4=function(){return null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},P.prototype.set_body4=function(n){this.zpp_inner.immutable_midstep("Constraint::body4");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b3!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},P.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},P.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var t=this.zpp_inner_zn.wrap_a1,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},P.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},P.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},P.prototype.get_anchor3=function(){return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},P.prototype.set_anchor3=function(n){null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var t=this.zpp_inner_zn.wrap_a3,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},P.prototype.get_anchor4=function(){return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},P.prototype.set_anchor4=function(n){null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var t=this.zpp_inner_zn.wrap_a4,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},P.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},P.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},P.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},P.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},P.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},P.prototype.set_ratio=function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},P.prototype.isSlack=function(){return this.zpp_inner_zn.slack},P.prototype.impulse=function(){var n=new K(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},P.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):X.get()},P.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer),null!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&n(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer),null!=(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&n(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)},Object.defineProperty(P.prototype,"body1",{get:P.prototype.get_body1,set:P.prototype.set_body1}),Object.defineProperty(P.prototype,"body2",{get:P.prototype.get_body2,set:P.prototype.set_body2}),Object.defineProperty(P.prototype,"body3",{get:P.prototype.get_body3,set:P.prototype.set_body3}),Object.defineProperty(P.prototype,"body4",{get:P.prototype.get_body4,set:P.prototype.set_body4}),Object.defineProperty(P.prototype,"anchor1",{get:P.prototype.get_anchor1,set:P.prototype.set_anchor1}),Object.defineProperty(P.prototype,"anchor2",{get:P.prototype.get_anchor2,set:P.prototype.set_anchor2}),Object.defineProperty(P.prototype,"anchor3",{get:P.prototype.get_anchor3,set:P.prototype.set_anchor3}),Object.defineProperty(P.prototype,"anchor4",{get:P.prototype.get_anchor4,set:P.prototype.set_anchor4}),Object.defineProperty(P.prototype,"jointMin",{get:P.prototype.get_jointMin,set:P.prototype.set_jointMin}),Object.defineProperty(P.prototype,"jointMax",{get:P.prototype.get_jointMax,set:P.prototype.set_jointMax}),Object.defineProperty(P.prototype,"ratio",{get:P.prototype.get_ratio,set:P.prototype.set_ratio}),P.prototype.__class__=P;var S=nape.constraint.UserConstraint=function(n,t){null==t&&(t=!1),this.zpp_inner_zn=null,this.zpp_inner_zn=new dt(n,t),this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,H.call(this)};S.__name__=["nape","constraint","UserConstraint"],S.__super__=H,S.prototype=Object.create(H.prototype),S.prototype.zpp_inner_zn=null,S.prototype.__bindVec2=function(){var n=new at;return n.zpp_inner._inuse=!0,n.zpp_inner._invalidate=Q(h=this.zpp_inner_zn,h.bindVec2_invalidate),n},S.prototype.__copy=function(){return null},S.prototype.__broken=function(){},S.prototype.__validate=function(){},S.prototype.__draw=function(n){},S.prototype.__prepare=function(){},S.prototype.__position=function(n){},S.prototype.__velocity=function(n){},S.prototype.__eff_mass=function(n){},S.prototype.__clamp=function(n){},S.prototype.__impulse=function(n,t,e){},S.prototype.impulse=function(){for(var n=new K(this.zpp_inner_zn.dim,1),t=0,e=this.zpp_inner_zn.dim;t<e;){var i=t++;n.zpp_inner.x[i*n.zpp_inner.n]=this.zpp_inner_zn.jAcc[i]}return n},S.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):X.get()},S.prototype.visitBodies=function(n){for(var t=0,e=this.zpp_inner_zn.bodies.length;t<e;){var i=this.zpp_inner_zn.bodies[t];if(null!=i.body){for(var p=!1,l=t+1;l<e;)if(this.zpp_inner_zn.bodies[l++].body==i.body){p=!0;break}p||n(i.body.outer)}++t}},S.prototype.__invalidate=function(){this.zpp_inner.immutable_midstep("UserConstraint::invalidate()"),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner.wake()},S.prototype.__registerBody=function(n,t){return this.zpp_inner.immutable_midstep("UserConstraint::registerBody(..)"),n!=t&&(null!=n&&(this.zpp_inner_zn.remBody(n.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&n.zpp_inner.wake()),null!=t&&this.zpp_inner_zn.addBody(t.zpp_inner),this.zpp_inner.wake(),null!=t&&t.zpp_inner.wake()),t},S.prototype.__class__=S;var A=nape.constraint.WeldJoint=function(n,t,e,i,p){null==p&&(p=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new zt,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,H.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==n?null:n.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var r=null==t?null:t.zpp_inner;r!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b1!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var o=this.zpp_inner_zn.wrap_a1,a=e.zpp_inner;null!=a._validate&&a._validate();var s=e.zpp_inner.x,_=e.zpp_inner;null!=_._validate&&_._validate();var h,u,x,d=e.zpp_inner.y,y=o.zpp_inner;null!=y._validate&&y._validate(),o.zpp_inner.x==s&&(null!=(h=o.zpp_inner)._validate&&h._validate(),o.zpp_inner.y==d)||(o.zpp_inner.x=s,o.zpp_inner.y=d,null!=(u=o.zpp_inner)._invalidate&&u._invalidate(u)),e.zpp_inner.weak&&(x=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Ri.poolVec2,Ri.poolVec2=e,null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=mo.zpp_pool,mo.zpp_pool=x),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var z=this.zpp_inner_zn.wrap_a2,c=i.zpp_inner;null!=c._validate&&c._validate();var v=i.zpp_inner.x,m=i.zpp_inner;null!=m._validate&&m._validate();var f,b,g,w=i.zpp_inner.y,M=z.zpp_inner;null!=M._validate&&M._validate(),z.zpp_inner.x==v&&(null!=(f=z.zpp_inner)._validate&&f._validate(),z.zpp_inner.y==w)||(z.zpp_inner.x=v,z.zpp_inner.y=w,null!=(b=z.zpp_inner)._invalidate&&b._invalidate(b)),i.zpp_inner.weak&&(g=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Ri.poolVec2,Ri.poolVec2=i,null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=mo.zpp_pool,mo.zpp_pool=g),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=p&&(this.zpp_inner_zn.phase=p,this.zpp_inner.wake())};A.__name__=["nape","constraint","WeldJoint"],A.__super__=H,A.prototype=Object.create(H.prototype),A.prototype.zpp_inner_zn=null,A.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},A.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},A.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},A.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==n?null:n.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},A.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},A.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var t=this.zpp_inner_zn.wrap_a1,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},A.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},A.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},A.prototype.get_phase=function(){return this.zpp_inner_zn.phase},A.prototype.set_phase=function(n){return this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=n&&(this.zpp_inner_zn.phase=n,this.zpp_inner.wake()),this.zpp_inner_zn.phase},A.prototype.impulse=function(){var n=new K(3,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccz,n},A.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):X.get()},A.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(A.prototype,"body1",{get:A.prototype.get_body1,set:A.prototype.set_body1}),Object.defineProperty(A.prototype,"body2",{get:A.prototype.get_body2,set:A.prototype.set_body2}),Object.defineProperty(A.prototype,"anchor1",{get:A.prototype.get_anchor1,set:A.prototype.set_anchor1}),Object.defineProperty(A.prototype,"anchor2",{get:A.prototype.get_anchor2,set:A.prototype.set_anchor2}),Object.defineProperty(A.prototype,"phase",{get:A.prototype.get_phase,set:A.prototype.set_phase}),A.prototype.__class__=A;var j=nape.dynamics.Arbiter=function(){this.zpp_inner=null};j.__name__=["nape","dynamics","Arbiter"],j.prototype.zpp_inner=null,j.prototype.get_isSleeping=function(){return this.zpp_inner.sleeping},j.prototype.get_type=function(){return ri.types[this.zpp_inner.type]},j.prototype.isCollisionArbiter=function(){return this.zpp_inner.type==ri.COL},j.prototype.isFluidArbiter=function(){return this.zpp_inner.type==ri.FLUID},j.prototype.isSensorArbiter=function(){return this.zpp_inner.type==ri.SENSOR},j.prototype.get_collisionArbiter=function(){return this.zpp_inner.type==ri.COL?this.zpp_inner.colarb.outer_zn:null},j.prototype.get_fluidArbiter=function(){return this.zpp_inner.type==ri.FLUID?this.zpp_inner.fluidarb.outer_zn:null},j.prototype.get_shape1=function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer},j.prototype.get_shape2=function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer},j.prototype.get_body1=function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer},j.prototype.get_body2=function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer},j.prototype.get_state=function(){var n=this.zpp_inner.immState;return 5==n?(null==Ll.PreFlag_ACCEPT&&(Ll.internal=!0,Ll.PreFlag_ACCEPT=new Il,Ll.internal=!1),Ll.PreFlag_ACCEPT):1==n?(null==Ll.PreFlag_ACCEPT_ONCE&&(Ll.internal=!0,Ll.PreFlag_ACCEPT_ONCE=new Il,Ll.internal=!1),Ll.PreFlag_ACCEPT_ONCE):6==n?(null==Ll.PreFlag_IGNORE&&(Ll.internal=!0,Ll.PreFlag_IGNORE=new Il,Ll.internal=!1),Ll.PreFlag_IGNORE):(null==Ll.PreFlag_IGNORE_ONCE&&(Ll.internal=!0,Ll.PreFlag_IGNORE_ONCE=new Il,Ll.internal=!1),Ll.PreFlag_IGNORE_ONCE)},j.prototype.totalImpulse=function(n,t){return null==t&&(t=!1),X.get(0,0,0)},j.prototype.toString=function(){var n=this.zpp_inner.type==ri.COL?"CollisionArbiter":this.zpp_inner.type==ri.FLUID?"FluidArbiter":"SensorArbiter";if(this.zpp_inner.cleared)return n+"(object-pooled)";var t=n+"("+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).toString()+"|"+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).toString()+")"+(this.zpp_inner.type==ri.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"")+"<-",e=this.zpp_inner.immState,i=5==e?(null==Ll.PreFlag_ACCEPT&&(Ll.internal=!0,Ll.PreFlag_ACCEPT=new Il,Ll.internal=!1),Ll.PreFlag_ACCEPT):1==e?(null==Ll.PreFlag_ACCEPT_ONCE&&(Ll.internal=!0,Ll.PreFlag_ACCEPT_ONCE=new Il,Ll.internal=!1),Ll.PreFlag_ACCEPT_ONCE):6==e?(null==Ll.PreFlag_IGNORE&&(Ll.internal=!0,Ll.PreFlag_IGNORE=new Il,Ll.internal=!1),Ll.PreFlag_IGNORE):(null==Ll.PreFlag_IGNORE_ONCE&&(Ll.internal=!0,Ll.PreFlag_IGNORE_ONCE=new Il,Ll.internal=!1),Ll.PreFlag_IGNORE_ONCE);return t+i.toString()},Object.defineProperty(j.prototype,"isSleeping",{get:j.prototype.get_isSleeping}),Object.defineProperty(j.prototype,"type",{get:j.prototype.get_type}),Object.defineProperty(j.prototype,"collisionArbiter",{get:j.prototype.get_collisionArbiter}),Object.defineProperty(j.prototype,"fluidArbiter",{get:j.prototype.get_fluidArbiter}),Object.defineProperty(j.prototype,"shape1",{get:j.prototype.get_shape1}),Object.defineProperty(j.prototype,"shape2",{get:j.prototype.get_shape2}),Object.defineProperty(j.prototype,"body1",{get:j.prototype.get_body1}),Object.defineProperty(j.prototype,"body2",{get:j.prototype.get_body2}),Object.defineProperty(j.prototype,"state",{get:j.prototype.get_state}),j.prototype.__class__=j;var Wn=nape.dynamics.ArbiterIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Wn.__name__=["nape","dynamics","ArbiterIterator"],Wn.get=function(n){var t,e,i=null==Wn.zpp_pool?(Vi.internal=!0,t=new Wn,Vi.internal=!1,t):(e=Wn.zpp_pool,Wn.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},Wn.prototype.zpp_inner=null,Wn.prototype.zpp_i=null,Wn.prototype.zpp_critical=null,Wn.prototype.zpp_next=null,Wn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=this).zpp_inner=null,!1)},Wn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Wn.prototype.__class__=Wn;var E=nape.dynamics.ArbiterList=function(){this.zpp_inner=null,this.zpp_inner=new Vi,this.zpp_inner.outer=this};E.__name__=["nape","dynamics","ArbiterList"],E.fromArray=function(n){for(var t=new E,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},E.prototype.zpp_inner=null,E.prototype.get_length=function(){return this.zpp_gl()},E.prototype.zpp_gl=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.head;null!=n;)n.elt.active&&this.zpp_inner.user_length++,n=n.next}return this.zpp_inner.user_length},E.prototype.zpp_vm=function(){this.zpp_inner.valmod()},E.prototype.has=function(n){return this.zpp_vm(),this.zpp_inner.inner.has(n.zpp_inner)},E.prototype.at=function(n){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.head;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;for(;this.zpp_inner.at_index!=n;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},E.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},E.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},E.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),e=(i=null==(t=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head.elt:t.next.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.wrapper()},E.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),t=(i=null==(n=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head.elt:n.next.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.wrapper()},E.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},E.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_vm(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},E.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},E.prototype.empty=function(){return 0==this.zpp_gl()},E.prototype.iterator=function(){return this.zpp_vm(),Wn.get(this)},E.prototype.copy=function(n){null==n&&(n=!1);for(var t=new E,e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);t.push(n?null:p)}return t},E.prototype.merge=function(n){for(var t=n.iterator();;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var i=t.zpp_inner.at(t.zpp_i++);this.has(i)||this.add(i)}},E.prototype.toString=function(){for(var n="[",t=!0,e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==p?"NULL":p.toString(),t=!1}return n+"]"},E.prototype.foreach=function(n){for(var t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=t).zpp_inner=null;break}}return this},E.prototype.filter=function(n){for(var t=0;t<this.zpp_gl();){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(E.prototype,"length",{get:E.prototype.get_length}),E.prototype.__class__=E;var I=nape.dynamics.ArbiterType=function(){};I.__name__=["nape","dynamics","ArbiterType"],I.COLLISION=null,I.get_COLLISION=function(){return null==Ll.ArbiterType_COLLISION&&(Ll.internal=!0,Ll.ArbiterType_COLLISION=new I,Ll.internal=!1),Ll.ArbiterType_COLLISION},I.SENSOR=null,I.get_SENSOR=function(){return null==Ll.ArbiterType_SENSOR&&(Ll.internal=!0,Ll.ArbiterType_SENSOR=new I,Ll.internal=!1),Ll.ArbiterType_SENSOR},I.FLUID=null,I.get_FLUID=function(){return null==Ll.ArbiterType_FLUID&&(Ll.internal=!0,Ll.ArbiterType_FLUID=new I,Ll.internal=!1),Ll.ArbiterType_FLUID},I.prototype.toString=function(){return null==Ll.ArbiterType_COLLISION&&(Ll.internal=!0,Ll.ArbiterType_COLLISION=new I,Ll.internal=!1),this==Ll.ArbiterType_COLLISION?"COLLISION":(null==Ll.ArbiterType_SENSOR&&(Ll.internal=!0,Ll.ArbiterType_SENSOR=new I,Ll.internal=!1),this==Ll.ArbiterType_SENSOR?"SENSOR":(null==Ll.ArbiterType_FLUID&&(Ll.internal=!0,Ll.ArbiterType_FLUID=new I,Ll.internal=!1),this==Ll.ArbiterType_FLUID?"FLUID":""))},Object.defineProperty(I,"COLLISION",{get:I.get_COLLISION}),Object.defineProperty(I,"SENSOR",{get:I.get_SENSOR}),Object.defineProperty(I,"FLUID",{get:I.get_FLUID}),I.prototype.__class__=I;var T=nape.dynamics.CollisionArbiter=function(){j.call(this)};T.__name__=["nape","dynamics","CollisionArbiter"],T.__super__=j,T.prototype=Object.create(j.prototype),T.prototype.get_contacts=function(){return null==this.zpp_inner.colarb.wrap_contacts&&this.zpp_inner.colarb.setupcontacts(),this.zpp_inner.colarb.wrap_contacts},T.prototype.get_normal=function(){return null==this.zpp_inner.colarb.wrap_normal&&this.zpp_inner.colarb.getnormal(),this.zpp_inner.colarb.wrap_normal},T.prototype.get_radius=function(){return this.zpp_inner.colarb.radius},T.prototype.get_referenceEdge1=function(){var n=this.zpp_inner.colarb.__ref_edge1;return null==n||1==(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).zpp_inner.type&&(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).zpp_inner==n.polygon||(n=this.zpp_inner.colarb.__ref_edge2),null==n?null:n.wrapper()},T.prototype.get_referenceEdge2=function(){var n=this.zpp_inner.colarb.__ref_edge1;return null==n||1==(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).zpp_inner.type&&(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).zpp_inner==n.polygon||(n=this.zpp_inner.colarb.__ref_edge2),null==n?null:n.wrapper()},T.prototype.firstVertex=function(){return null!=this.zpp_inner.colarb.__ref_edge1!=(null!=this.zpp_inner.colarb.__ref_edge2)&&-1==this.zpp_inner.colarb.__ref_vertex},T.prototype.secondVertex=function(){return null!=this.zpp_inner.colarb.__ref_edge1!=(null!=this.zpp_inner.colarb.__ref_edge2)&&1==this.zpp_inner.colarb.__ref_vertex},T.prototype.normalImpulse=function(n,t){null==t&&(t=!1);var e,i,p,l,r,o,a,s,_=0,h=0,u=0,x=this.zpp_inner.colarb;return t&&!x.oc1.fresh||(null!=(i=(e=x.oc1.wrapper().normalImpulse(n)).zpp_inner)._validate&&i._validate(),_+=e.zpp_inner.x,null!=(p=e.zpp_inner)._validate&&p._validate(),h+=e.zpp_inner.y,null!=(l=e.zpp_inner)._validate&&l._validate(),u+=e.zpp_inner.z,e.dispose()),x.hc2&&(t&&!x.oc2.fresh||(null!=(o=(r=x.oc2.wrapper().normalImpulse(n)).zpp_inner)._validate&&o._validate(),_+=r.zpp_inner.x,null!=(a=r.zpp_inner)._validate&&a._validate(),h+=r.zpp_inner.y,null!=(s=r.zpp_inner)._validate&&s._validate(),u+=r.zpp_inner.z,r.dispose())),X.get(_,h,u)},T.prototype.tangentImpulse=function(n,t){null==t&&(t=!1);var e,i,p,l,r,o,a,s,_=0,h=0,u=0,x=this.zpp_inner.colarb;return t&&!x.oc1.fresh||(null!=(i=(e=x.oc1.wrapper().tangentImpulse(n)).zpp_inner)._validate&&i._validate(),_+=e.zpp_inner.x,null!=(p=e.zpp_inner)._validate&&p._validate(),h+=e.zpp_inner.y,null!=(l=e.zpp_inner)._validate&&l._validate(),u+=e.zpp_inner.z,e.dispose()),x.hc2&&(t&&!x.oc2.fresh||(null!=(o=(r=x.oc2.wrapper().tangentImpulse(n)).zpp_inner)._validate&&o._validate(),_+=r.zpp_inner.x,null!=(a=r.zpp_inner)._validate&&a._validate(),h+=r.zpp_inner.y,null!=(s=r.zpp_inner)._validate&&s._validate(),u+=r.zpp_inner.z,r.dispose())),X.get(_,h,u)},T.prototype.totalImpulse=function(n,t){null==t&&(t=!1);var e,i,p,l,r,o,a,s,_=0,h=0,u=0,x=this.zpp_inner.colarb;return t&&!x.oc1.fresh||(null!=(i=(e=x.oc1.wrapper().totalImpulse(n)).zpp_inner)._validate&&i._validate(),_+=e.zpp_inner.x,null!=(p=e.zpp_inner)._validate&&p._validate(),h+=e.zpp_inner.y,null!=(l=e.zpp_inner)._validate&&l._validate(),u+=e.zpp_inner.z,e.dispose()),x.hc2&&(t&&!x.oc2.fresh||(null!=(o=(r=x.oc2.wrapper().totalImpulse(n)).zpp_inner)._validate&&o._validate(),_+=r.zpp_inner.x,null!=(a=r.zpp_inner)._validate&&a._validate(),h+=r.zpp_inner.y,null!=(s=r.zpp_inner)._validate&&s._validate(),u+=r.zpp_inner.z,r.dispose())),X.get(_,h,u)},T.prototype.rollingImpulse=function(n,t){null==t&&(t=!1);var e=this.zpp_inner.colarb;return!t||e.oc1.fresh?e.oc1.wrapper().rollingImpulse(n):0},T.prototype.get_elasticity=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),1<n.restitution&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.restitution},T.prototype.set_elasticity=function(n){var t=this.zpp_inner.colarb;t.restitution=n,t.userdef_restitution=!0;var e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),1<e.restitution&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.restitution},T.prototype.get_dynamicFriction=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),1<n.restitution&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.dyn_fric},T.prototype.set_dynamicFriction=function(n){var t=this.zpp_inner.colarb;t.dyn_fric=n,t.userdef_dyn_fric=!0;var e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),1<e.restitution&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.dyn_fric},T.prototype.get_staticFriction=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),1<n.restitution&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.stat_fric},T.prototype.set_staticFriction=function(n){var t=this.zpp_inner.colarb;t.stat_fric=n,t.userdef_stat_fric=!0;var e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),1<e.restitution&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.stat_fric},T.prototype.get_rollingFriction=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),1<n.restitution&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.rfric},T.prototype.set_rollingFriction=function(n){var t=this.zpp_inner.colarb;t.rfric=n,t.userdef_rfric=!0;var e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),1<e.restitution&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.rfric},Object.defineProperty(T.prototype,"contacts",{get:T.prototype.get_contacts}),Object.defineProperty(T.prototype,"normal",{get:T.prototype.get_normal}),Object.defineProperty(T.prototype,"radius",{get:T.prototype.get_radius}),Object.defineProperty(T.prototype,"referenceEdge1",{get:T.prototype.get_referenceEdge1}),Object.defineProperty(T.prototype,"referenceEdge2",{get:T.prototype.get_referenceEdge2}),Object.defineProperty(T.prototype,"elasticity",{get:T.prototype.get_elasticity,set:T.prototype.set_elasticity}),Object.defineProperty(T.prototype,"dynamicFriction",{get:T.prototype.get_dynamicFriction,set:T.prototype.set_dynamicFriction}),Object.defineProperty(T.prototype,"staticFriction",{get:T.prototype.get_staticFriction,set:T.prototype.set_staticFriction}),Object.defineProperty(T.prototype,"rollingFriction",{get:T.prototype.get_rollingFriction,set:T.prototype.set_rollingFriction}),T.prototype.__class__=T;var N=nape.dynamics.Contact=function(){this.zpp_inner=null};N.__name__=["nape","dynamics","Contact"],N.prototype.zpp_inner=null,N.prototype.get_arbiter=function(){if(null==this.zpp_inner.arbiter)return null;var n=this.zpp_inner.arbiter.outer;return n.zpp_inner.type==ri.COL?n.zpp_inner.colarb.outer_zn:null},N.prototype.get_penetration=function(){return-this.zpp_inner.dist},N.prototype.get_position=function(){return null==this.zpp_inner.wrap_position&&this.zpp_inner.getposition(),this.zpp_inner.wrap_position},N.prototype.get_fresh=function(){return this.zpp_inner.fresh},N.prototype.normalImpulse=function(n){var t=this.zpp_inner.arbiter.colarb,e=this.zpp_inner.inner,i=e.jnAcc;return null==n?X.get(t.nx*i,t.ny*i):n==t.b1.outer?X.get(t.nx*-i,t.ny*-i,-(t.ny*e.r1x-t.nx*e.r1y)*i):X.get(t.nx*i,t.ny*i,(t.ny*e.r2x-t.nx*e.r2y)*i)},N.prototype.tangentImpulse=function(n){var t=this.zpp_inner.arbiter.colarb,e=this.zpp_inner.inner,i=e.jtAcc;return null==n?X.get(-t.ny*i,t.nx*i):n==t.b1.outer?X.get(t.ny*i,-t.nx*i,-(e.r1x*t.nx+e.r1y*t.ny)*i):X.get(-t.ny*i,t.nx*i,(e.r2x*t.nx+e.r2y*t.ny)*i)},N.prototype.rollingImpulse=function(n){var t=this.zpp_inner.arbiter.colarb,e=this.zpp_inner.arbiter.colarb.jrAcc;return null!=n&&n==t.b1.outer?-e:e},N.prototype.totalImpulse=function(n){var t=this.zpp_inner.arbiter.colarb,e=this.zpp_inner.inner,i=e.jnAcc,p=e.jtAcc,l=t.jrAcc;if(null==n)return X.get(t.nx*i-t.ny*p,t.ny*i+t.nx*p,l);var r=t.nx*i-t.ny*p,o=t.ny*i+t.nx*p;return n==t.b1.outer?X.get(-r,-o,-(o*e.r1x-r*e.r1y)-l):X.get(r,o,o*e.r2x-r*e.r2y+l)},N.prototype.get_friction=function(){return this.zpp_inner.inner.friction},N.prototype.toString=function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},Object.defineProperty(N.prototype,"arbiter",{get:N.prototype.get_arbiter}),Object.defineProperty(N.prototype,"penetration",{get:N.prototype.get_penetration}),Object.defineProperty(N.prototype,"position",{get:N.prototype.get_position}),Object.defineProperty(N.prototype,"fresh",{get:N.prototype.get_fresh}),Object.defineProperty(N.prototype,"friction",{get:N.prototype.get_friction}),N.prototype.__class__=N;var Yn=nape.dynamics.ContactIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Yn.__name__=["nape","dynamics","ContactIterator"],Yn.get=function(n){var t,e,i=null==Yn.zpp_pool?(Di.internal=!0,t=new Yn,Di.internal=!1,t):(e=Yn.zpp_pool,Yn.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},Yn.prototype.zpp_inner=null,Yn.prototype.zpp_i=null,Yn.prototype.zpp_critical=null,Yn.prototype.zpp_next=null,Yn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;if(n.zpp_inner.valmod(),n.zpp_inner.zip_length){n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=0;for(var t=n.zpp_inner.inner.next;null!=t;){t.active&&t.arbiter.active&&n.zpp_inner.user_length++,t=t.next}}var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=this).zpp_inner=null,!1)},Yn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Yn.prototype.__class__=Yn;var L=nape.dynamics.ContactList=function(){this.zpp_inner=null,this.zpp_inner=new Di,this.zpp_inner.outer=this};L.__name__=["nape","dynamics","ContactList"],L.fromArray=function(n){for(var t=new L,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},L.prototype.zpp_inner=null,L.prototype.get_length=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){n.active&&n.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}return this.zpp_inner.user_length},L.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},L.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;){t.active&&t.arbiter.active&&this.zpp_inner.user_length++,t=t.next}}n=this.zpp_inner.user_length-1-n}if(n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.next;;){var e=this.zpp_inner.at_ite;if(e.active&&e.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=n;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var i=this.zpp_inner.at_ite;if(i.active&&i.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.wrapper()},L.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){i.active&&i.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(0==this.zpp_inner.user_length)t=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var p=this.zpp_inner.inner.next;null!=p;){p.active&&p.arbiter.active&&this.zpp_inner.user_length++,p=p.next}}t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},L.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){i.active&&i.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(0==this.zpp_inner.user_length)t=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var p=this.zpp_inner.inner.next;null!=p;){p.active&&p.arbiter.active&&this.zpp_inner.user_length++,p=p.next}}t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},L.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;if(this.zpp_inner.reverse_flag){var e=(t=this.zpp_inner.inner.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){i.active&&i.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(1==this.zpp_inner.user_length)n=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var p=this.zpp_inner.inner.next;null!=p;){p.active&&p.arbiter.active&&this.zpp_inner.user_length++,p=p.next}}n=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)}var l=(t=null==n?this.zpp_inner.inner.next:n.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)}return this.zpp_inner.invalidate(),t.wrapper()},L.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;if(this.zpp_inner.reverse_flag){if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;){e.active&&e.arbiter.active&&this.zpp_inner.user_length++,e=e.next}}if(1==this.zpp_inner.user_length)n=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){i.active&&i.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}n=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)}var p=(t=null==n?this.zpp_inner.inner.next:n.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(p),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)}else{var l=(t=this.zpp_inner.inner.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),t.wrapper()},L.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},L.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.next;null!=e;){if(e==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},L.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){n.active&&n.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}if(0==this.zpp_inner.user_length)break;this.pop()}else for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;){t.active&&t.arbiter.active&&this.zpp_inner.user_length++,t=t.next}}if(0==this.zpp_inner.user_length)break;this.shift()}},L.prototype.empty=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){n.active&&n.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}return 0==this.zpp_inner.user_length},L.prototype.iterator=function(){return this.zpp_inner.valmod(),Yn.get(this)},L.prototype.copy=function(n){null==n&&(n=!1);var t=new L;this.zpp_inner.valmod();for(var e=Yn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var p=i.zpp_inner.inner.next;null!=p;){p.active&&p.arbiter.active&&i.zpp_inner.user_length++,p=p.next}}var l=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<l||(e.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);t.push(n?null:r)}return t},L.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Yn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;if(e.zpp_inner.valmod(),e.zpp_inner.zip_length){e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=0;for(var i=e.zpp_inner.inner.next;null!=i;){i.active&&i.arbiter.active&&e.zpp_inner.user_length++,i=i.next}}var p=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<p||(t.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var l=t.zpp_inner.at(t.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},L.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Yn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var p=i.zpp_inner.inner.next;null!=p;){p.active&&p.arbiter.active&&i.zpp_inner.user_length++,p=p.next}}var l=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<l||(e.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==r?"NULL":r.toString(),t=!1}return n+"]"},L.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Yn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;if(e.zpp_inner.valmod(),e.zpp_inner.zip_length){e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=0;for(var i=e.zpp_inner.inner.next;null!=i;){i.active&&i.arbiter.active&&e.zpp_inner.user_length++,i=i.next}}var p=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<p||(t.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=t).zpp_inner=null;break}}return this},L.prototype.filter=function(n){for(var t=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;){e.active&&e.arbiter.active&&this.zpp_inner.user_length++,e=e.next}}if(!(t<this.zpp_inner.user_length))break;var i=this.at(t);try{n(i)?++t:this.remove(i)}catch(n){break}}return this},Object.defineProperty(L.prototype,"length",{get:L.prototype.get_length}),L.prototype.__class__=L;var V=nape.dynamics.FluidArbiter=function(){j.call(this)};V.__name__=["nape","dynamics","FluidArbiter"],V.__super__=j,V.prototype=Object.create(j.prototype),V.prototype.get_position=function(){return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},V.prototype.set_position=function(n){null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition();var t=this.zpp_inner.fluidarb.wrap_position,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},V.prototype.get_overlap=function(){return this.zpp_inner.fluidarb.overlap},V.prototype.set_overlap=function(n){return this.zpp_inner.fluidarb.overlap=n,this.zpp_inner.fluidarb.overlap},V.prototype.buoyancyImpulse=function(n){var t=this.zpp_inner.fluidarb;return null==n?X.get(t.buoyx,t.buoyy,0):n.zpp_inner==this.zpp_inner.b2?X.get(t.buoyx,t.buoyy,t.buoyy*t.r2x-t.buoyx*t.r2y):X.get(-t.buoyx,-t.buoyy,-(t.buoyy*t.r1x-t.buoyx*t.r1y))},V.prototype.dragImpulse=function(n){var t=this.zpp_inner.fluidarb,e=null==n||n.zpp_inner==this.zpp_inner.b2?1:-1;return X.get(t.dampx*e,t.dampy*e,t.adamp*e)},V.prototype.totalImpulse=function(n,t){null==t&&(t=!1);var e=this.buoyancyImpulse(n),i=this.dragImpulse(n),p=i.zpp_inner;null!=p._validate&&p._validate();var l=i.zpp_inner.x,r=e.zpp_inner;null!=r._validate&&r._validate(),i.zpp_inner.x=l+e.zpp_inner.x;var o=i.zpp_inner;null!=o._validate&&o._validate();var a=i.zpp_inner;null!=a._validate&&a._validate();var s=i.zpp_inner.y,_=e.zpp_inner;null!=_._validate&&_._validate(),i.zpp_inner.y=s+e.zpp_inner.y;var h=i.zpp_inner;null!=h._validate&&h._validate();var u=i.zpp_inner;null!=u._validate&&u._validate();var x=i.zpp_inner.z,d=e.zpp_inner;null!=d._validate&&d._validate(),i.zpp_inner.z=x+e.zpp_inner.z;var y=i.zpp_inner;return null!=y._validate&&y._validate(),e.dispose(),i},Object.defineProperty(V.prototype,"position",{get:V.prototype.get_position,set:V.prototype.set_position}),Object.defineProperty(V.prototype,"overlap",{get:V.prototype.get_overlap,set:V.prototype.set_overlap}),V.prototype.__class__=V;var D=nape.dynamics.InteractionFilter=function(n,t,e,i,p,l){null==l&&(l=-1),null==p&&(p=1),null==i&&(i=-1),null==e&&(e=1),null==t&&(t=-1),null==n&&(n=1),(this.zpp_inner=null)==vt.zpp_pool?this.zpp_inner=new vt:(this.zpp_inner=vt.zpp_pool,vt.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),(this.zpp_inner.outer=this).zpp_inner.collisionGroup!=n&&(this.zpp_inner.collisionGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask!=t&&(this.zpp_inner.collisionMask=t,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup!=e&&(this.zpp_inner.sensorGroup=e,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask!=i&&(this.zpp_inner.sensorMask=i,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup!=p&&(this.zpp_inner.fluidGroup=p,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask!=l&&(this.zpp_inner.fluidMask=l,this.zpp_inner.invalidate())};D.__name__=["nape","dynamics","InteractionFilter"],D.prototype.zpp_inner=null,D.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},D.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=Ni.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},D.prototype.get_collisionGroup=function(){return this.zpp_inner.collisionGroup},D.prototype.set_collisionGroup=function(n){return this.zpp_inner.collisionGroup!=n&&(this.zpp_inner.collisionGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionGroup},D.prototype.get_collisionMask=function(){return this.zpp_inner.collisionMask},D.prototype.set_collisionMask=function(n){return this.zpp_inner.collisionMask!=n&&(this.zpp_inner.collisionMask=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask},D.prototype.get_sensorGroup=function(){return this.zpp_inner.sensorGroup},D.prototype.set_sensorGroup=function(n){return this.zpp_inner.sensorGroup!=n&&(this.zpp_inner.sensorGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup},D.prototype.get_sensorMask=function(){return this.zpp_inner.sensorMask},D.prototype.set_sensorMask=function(n){return this.zpp_inner.sensorMask!=n&&(this.zpp_inner.sensorMask=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask},D.prototype.get_fluidGroup=function(){return this.zpp_inner.fluidGroup},D.prototype.set_fluidGroup=function(n){return this.zpp_inner.fluidGroup!=n&&(this.zpp_inner.fluidGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup},D.prototype.get_fluidMask=function(){return this.zpp_inner.fluidMask},D.prototype.set_fluidMask=function(n){return this.zpp_inner.fluidMask!=n&&(this.zpp_inner.fluidMask=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask},D.prototype.shouldCollide=function(n){var t=this.zpp_inner,e=n.zpp_inner;return 0!=(t.collisionMask&e.collisionGroup)&&0!=(e.collisionMask&t.collisionGroup)},D.prototype.shouldSense=function(n){var t=this.zpp_inner,e=n.zpp_inner;return 0!=(t.sensorMask&e.sensorGroup)&&0!=(e.sensorMask&t.sensorGroup)},D.prototype.shouldFlow=function(n){var t=this.zpp_inner,e=n.zpp_inner;return 0!=(t.fluidMask&e.fluidGroup)&&0!=(e.fluidMask&t.fluidGroup)},D.prototype.copy=function(){return new D(this.zpp_inner.collisionGroup,this.zpp_inner.collisionMask,this.zpp_inner.sensorGroup,this.zpp_inner.sensorMask,this.zpp_inner.fluidGroup,this.zpp_inner.fluidMask)},D.prototype.toString=function(){return"{ collision: "+n.hex(this.zpp_inner.collisionGroup,8)+"~"+n.hex(this.zpp_inner.collisionMask,8)+" sensor: "+n.hex(this.zpp_inner.sensorGroup,8)+"~"+n.hex(this.zpp_inner.sensorMask,8)+" fluid: "+n.hex(this.zpp_inner.fluidGroup,8)+"~"+n.hex(this.zpp_inner.fluidMask,8)+" }"},Object.defineProperty(D.prototype,"userData",{get:D.prototype.get_userData}),Object.defineProperty(D.prototype,"shapes",{get:D.prototype.get_shapes}),Object.defineProperty(D.prototype,"collisionGroup",{get:D.prototype.get_collisionGroup,set:D.prototype.set_collisionGroup}),Object.defineProperty(D.prototype,"collisionMask",{get:D.prototype.get_collisionMask,set:D.prototype.set_collisionMask}),Object.defineProperty(D.prototype,"sensorGroup",{get:D.prototype.get_sensorGroup,set:D.prototype.set_sensorGroup}),Object.defineProperty(D.prototype,"sensorMask",{get:D.prototype.get_sensorMask,set:D.prototype.set_sensorMask}),Object.defineProperty(D.prototype,"fluidGroup",{get:D.prototype.get_fluidGroup,set:D.prototype.set_fluidGroup}),Object.defineProperty(D.prototype,"fluidMask",{get:D.prototype.get_fluidMask,set:D.prototype.set_fluidMask}),D.prototype.__class__=D;var F=nape.dynamics.InteractionGroup=function(n){null==n&&(n=!1),this.zpp_inner=null,this.zpp_inner=new mt,(this.zpp_inner.outer=this).zpp_inner.ignore!=n&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=n)};F.__name__=["nape","dynamics","InteractionGroup"],F.prototype.zpp_inner=null,F.prototype.get_group=function(){return null==this.zpp_inner.group?null:this.zpp_inner.group.outer},F.prototype.set_group=function(n){return this.zpp_inner.setGroup(null==n?null:n.zpp_inner),null==this.zpp_inner.group?null:this.zpp_inner.group.outer},F.prototype.get_ignore=function(){return this.zpp_inner.ignore},F.prototype.set_ignore=function(n){return this.zpp_inner.ignore!=n&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=n),this.zpp_inner.ignore},F.prototype.get_interactors=function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=ki.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},F.prototype.get_groups=function(){return null==this.zpp_inner.wrap_groups&&(this.zpp_inner.wrap_groups=Li.get(this.zpp_inner.groups,!0)),this.zpp_inner.wrap_groups},F.prototype.toString=function(){var n="InteractionGroup";return this.zpp_inner.ignore&&(n="InteractionGroup:ignore"),n},Object.defineProperty(F.prototype,"group",{get:F.prototype.get_group,set:F.prototype.set_group}),Object.defineProperty(F.prototype,"ignore",{get:F.prototype.get_ignore,set:F.prototype.set_ignore}),Object.defineProperty(F.prototype,"interactors",{get:F.prototype.get_interactors}),Object.defineProperty(F.prototype,"groups",{get:F.prototype.get_groups}),F.prototype.__class__=F;var Jn=nape.dynamics.InteractionGroupIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Jn.__name__=["nape","dynamics","InteractionGroupIterator"],Jn.get=function(n){var t,e,i=null==Jn.zpp_pool?(Li.internal=!0,t=new Jn,Li.internal=!1,t):(e=Jn.zpp_pool,Jn.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},Jn.prototype.zpp_inner=null,Jn.prototype.zpp_i=null,Jn.prototype.zpp_critical=null,Jn.prototype.zpp_next=null,Jn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=this).zpp_inner=null,!1)},Jn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Jn.prototype.__class__=Jn;var R=nape.dynamics.InteractionGroupList=function(){this.zpp_inner=null,this.zpp_inner=new Li,this.zpp_inner.outer=this};R.__name__=["nape","dynamics","InteractionGroupList"],R.fromArray=function(n){for(var t=new R,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},R.prototype.zpp_inner=null,R.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},R.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},R.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},R.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},R.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},R.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:t.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},R.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},R.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},R.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},R.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},R.prototype.empty=function(){return null==this.zpp_inner.inner.head},R.prototype.iterator=function(){return this.zpp_inner.valmod(),Jn.get(this)},R.prototype.copy=function(n){null==n&&(n=!1);var t=new R;this.zpp_inner.valmod();for(var e=Jn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},R.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Jn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},R.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Jn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},R.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Jn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=t).zpp_inner=null;break}}return this},R.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(R.prototype,"length",{get:R.prototype.get_length}),R.prototype.__class__=R;var Z=nape.geom.AABB=function(n,t,e,i){var p;null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),null==n&&(n=0),(this.zpp_inner=null)==Al.zpp_pool?p=new Al:(p=Al.zpp_pool,Al.zpp_pool=p.next,p.next=null),p.minx=n,p.miny=t,p.maxx=n+e,p.maxy=t+i,this.zpp_inner=p,this.zpp_inner.outer=this};Z.__name__=["nape","geom","AABB"],Z.prototype.zpp_inner=null,Z.prototype.copy=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t,e=this.zpp_inner,i=e.minx,p=e.miny,l=e.maxx,r=e.maxy;return null==Al.zpp_pool?t=new Al:(t=Al.zpp_pool,Al.zpp_pool=t.next,t.next=null),t.minx=i,t.miny=p,t.maxx=l,t.maxy=r,t.wrapper()},Z.prototype.get_min=function(){return this.zpp_inner.getmin()},Z.prototype.set_min=function(n){var t=this.zpp_inner.getmin(),e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),this.zpp_inner.getmin()},Z.prototype.get_max=function(){return this.zpp_inner.getmax()},Z.prototype.set_max=function(n){var t=this.zpp_inner.getmax(),e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),this.zpp_inner.getmax()},Z.prototype.get_x=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.minx},Z.prototype.set_x=function(n){var t,e=this.zpp_inner;null!=e._validate&&e._validate(),this.zpp_inner.minx!=n&&(this.zpp_inner.maxx+=n-this.zpp_inner.minx,this.zpp_inner.minx=n,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(t));var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.minx},Z.prototype.get_y=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.miny},Z.prototype.set_y=function(n){var t,e=this.zpp_inner;null!=e._validate&&e._validate(),this.zpp_inner.miny!=n&&(this.zpp_inner.maxy+=n-this.zpp_inner.miny,this.zpp_inner.miny=n,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(t));var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.miny},Z.prototype.get_width=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner;return t.maxx-t.minx},Z.prototype.set_width=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e,i,p=this.zpp_inner;p.maxx-p.minx!=n&&(null!=(e=this.zpp_inner)._validate&&e._validate(),this.zpp_inner.maxx=this.zpp_inner.minx+n,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(i));var l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner;return r.maxx-r.minx},Z.prototype.get_height=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner;return t.maxy-t.miny},Z.prototype.set_height=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e,i,p=this.zpp_inner;p.maxy-p.miny!=n&&(null!=(e=this.zpp_inner)._validate&&e._validate(),this.zpp_inner.maxy=this.zpp_inner.miny+n,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(i));var l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner;return r.maxy-r.miny},Z.prototype.toString=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.toString()},Object.defineProperty(Z.prototype,"min",{get:Z.prototype.get_min,set:Z.prototype.set_min}),Object.defineProperty(Z.prototype,"max",{get:Z.prototype.get_max,set:Z.prototype.set_max}),Object.defineProperty(Z.prototype,"x",{get:Z.prototype.get_x,set:Z.prototype.set_x}),Object.defineProperty(Z.prototype,"y",{get:Z.prototype.get_y,set:Z.prototype.set_y}),Object.defineProperty(Z.prototype,"width",{get:Z.prototype.get_width,set:Z.prototype.set_width}),Object.defineProperty(Z.prototype,"height",{get:Z.prototype.get_height,set:Z.prototype.set_height}),Z.prototype.__class__=Z;var B=nape.geom.ConvexResult=function(){this.zpp_inner=null};B.__name__=["nape","geom","ConvexResult"],B.prototype.zpp_inner=null,B.prototype.get_normal=function(){return this.zpp_inner.normal},B.prototype.get_position=function(){return this.zpp_inner.position},B.prototype.get_toi=function(){return this.zpp_inner.toiDistance},B.prototype.get_shape=function(){return this.zpp_inner.shape},B.prototype.dispose=function(){this.zpp_inner.free()},B.prototype.toString=function(){return"{ shape: "+i.string(this.zpp_inner.shape)+" toi: "+this.zpp_inner.toiDistance+" }"},Object.defineProperty(B.prototype,"normal",{get:B.prototype.get_normal}),Object.defineProperty(B.prototype,"position",{get:B.prototype.get_position}),Object.defineProperty(B.prototype,"toi",{get:B.prototype.get_toi}),Object.defineProperty(B.prototype,"shape",{get:B.prototype.get_shape}),B.prototype.__class__=B;var Xn=nape.geom.ConvexResultIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Xn.__name__=["nape","geom","ConvexResultIterator"],Xn.get=function(n){var t,e,i=null==Xn.zpp_pool?(Ii.internal=!0,t=new Xn,Ii.internal=!1,t):(e=Xn.zpp_pool,Xn.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},Xn.prototype.zpp_inner=null,Xn.prototype.zpp_i=null,Xn.prototype.zpp_critical=null,Xn.prototype.zpp_next=null,Xn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=this).zpp_inner=null,!1)},Xn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Xn.prototype.__class__=Xn;var ot=nape.geom.ConvexResultList=function(){this.zpp_inner=null,this.zpp_inner=new Ii,this.zpp_inner.outer=this};ot.__name__=["nape","geom","ConvexResultList"],ot.fromArray=function(n){for(var t=new ot,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},ot.prototype.zpp_inner=null,ot.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},ot.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n)},ot.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},ot.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},ot.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)):this.zpp_inner.inner.add(n),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},ot.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;return this.zpp_inner.reverse_flag?(t=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),t},ot.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(t=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),t},ot.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},ot.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n),this.zpp_inner.invalidate()),t},ot.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},ot.prototype.empty=function(){return null==this.zpp_inner.inner.head},ot.prototype.iterator=function(){return this.zpp_inner.valmod(),Xn.get(this)},ot.prototype.copy=function(n){null==n&&(n=!1);var t=new ot;this.zpp_inner.valmod();for(var e=Xn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},ot.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Xn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},ot.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Xn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},ot.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Xn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=t).zpp_inner=null;break}}return this},ot.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(ot.prototype,"length",{get:ot.prototype.get_length}),ot.prototype.__class__=ot;var G=nape.geom.Geom=function(){};G.__name__=["nape","geom","Geom"],G.distanceBody=function(n,t,e,i){for(var p=n.zpp_inner.shapes.head;null!=p;)Mt.validateShape(p.elt),p=p.next;for(var l=t.zpp_inner.shapes.head;null!=l;)Mt.validateShape(l.elt),l=l.next;return Ut.distanceBody(n.zpp_inner,t.zpp_inner,e.zpp_inner,i.zpp_inner)},G.distance=function(n,t,e,i){var p;Mt.validateShape(n.zpp_inner),Mt.validateShape(t.zpp_inner),null==mo.zpp_pool?p=new mo:(p=mo.zpp_pool,mo.zpp_pool=p.next,p.next=null),p.weak=!1;var l=n.zpp_inner,r=t.zpp_inner,o=e.zpp_inner,a=i.zpp_inner;if(0==l.type&&0==r.type){var s,_,h,u=l.circle,x=r.circle,d=0,y=0,d=x.worldCOMx-u.worldCOMx,y=x.worldCOMy-u.worldCOMy,z=Math.sqrt(d*d+y*y),c=z-(u.radius+x.radius);c<1e100&&(0==z?(d=1,y=0):(d*=s=1/z,y*=s),_=u.radius,o.x=u.worldCOMx+d*_,o.y=u.worldCOMy+y*_,h=-x.radius,a.x=x.worldCOMx+d*h,a.y=x.worldCOMy+y*h,p.x=d,p.y=y),ht=c}else{var v,m,f=!1;if(0==l.type&&1==r.type&&(v=l,l=r,r=v,m=o,o=a,a=m,f=!0),1==l.type&&0==r.type){for(var b,g,w,M,C,k,O,P,S,A,j,E,I,T,N,L=l.polygon,V=r.circle,D=-1e100,F=null,R=L.edges.head;null!=R;){var Z=R.elt,B=Z.gnormx*V.worldCOMx+Z.gnormy*V.worldCOMy-Z.gprojection-V.radius;if(1e100<B){D=B;break}0<B?D<B&&(D=B,F=Z):D<0&&D<B&&(D=B,F=Z),R=R.next}D<1e100&&(b=F.gp0,g=F.gp1,(w=V.worldCOMy*F.gnormx-V.worldCOMx*F.gnormy)<=b.y*F.gnormx-b.x*F.gnormy?(C=M=0,M=V.worldCOMx-b.x,C=V.worldCOMy-b.y,(D=(k=Math.sqrt(M*M+C*C))-V.radius)<1e100&&(0==k?(M=1,C=0):(M*=O=1/k,C*=O),o.x=b.x+0*M,o.y=b.y+0*C,P=-V.radius,a.x=V.worldCOMx+M*P,a.y=V.worldCOMy+C*P,p.x=M,p.y=C)):w>=g.y*F.gnormx-g.x*F.gnormy?(A=S=0,S=V.worldCOMx-g.x,A=V.worldCOMy-g.y,(D=(j=Math.sqrt(S*S+A*A))-V.radius)<1e100&&(0==j?(S=1,A=0):(S*=E=1/j,A*=E),o.x=g.x+0*S,o.y=g.y+0*A,I=-V.radius,a.x=V.worldCOMx+S*I,a.y=V.worldCOMy+A*I,p.x=S,p.y=A)):(T=-V.radius,a.x=V.worldCOMx+F.gnormx*T,a.y=V.worldCOMy+F.gnormy*T,N=-D,o.x=a.x+F.gnormx*N,o.y=a.y+F.gnormy*N,p.x=F.gnormx,p.y=F.gnormy)),f&&(p.x=-p.x,p.y=-p.y),ht=D}else{for(var G=l.polygon,q=r.polygon,U=-1e100,K=null,W=null,Y=0,J=G.edges.head;null!=J;){for(var X=J.elt,H=1e100,$=q.gverts.next;null!=$;){var Q=X.gnormx*$.x+X.gnormy*$.y;Q<H&&(H=Q),$=$.next}if(1e100<(H-=X.gprojection)){U=H;break}0<H?U<H&&(U=H,K=X,Y=1):U<0&&U<H&&(U=H,K=X,Y=1),J=J.next}if(U<1e100){for(var nn,tn,en,pn=q.edges.head;null!=pn;){for(var ln=pn.elt,rn=1e100,on=G.gverts.next;null!=on;){var an=ln.gnormx*on.x+ln.gnormy*on.y;an<rn&&(rn=an),on=on.next}if(1e100<(rn-=ln.gprojection)){U=rn;break}0<rn?U<rn&&(U=rn,W=ln,Y=2):U<0&&U<rn&&(U=rn,W=ln,Y=2),pn=pn.next}if(U<1e100){1==Y?(nn=q,tn=K):(nn=G,tn=W,en=o,o=a,a=en,f=!f);for(var sn,_n,hn,un,xn,dn,yn,zn,cn,vn,mn,fn,bn,gn,wn,Mn,Cn,kn,On,Pn,Sn,An,jn,En,In,Tn,Nn,Ln,Vn,Dn,Fn,Rn,Zn,Bn,Gn,qn,Un,Kn,Wn,Yn,Jn,Xn,Hn,$n,Qn,nt,tt,et,it,pt,lt,rt,ot,at,st,_t,ht,ut=null,xt=1e100,dt=nn.edges.head;null!=dt;){var yt=dt.elt,zt=tn.gnormx*yt.gnormx+tn.gnormy*yt.gnormy;zt<xt&&(xt=zt,ut=yt),dt=dt.next}f?(p.x=-tn.gnormx,p.y=-tn.gnormy):(p.x=tn.gnormx,p.y=tn.gnormy),ht=0<=U?(sn=tn.gp0,_n=tn.gp1,hn=ut.gp0,un=ut.gp1,zn=yn=dn=xn=0,cn=1/((xn=_n.x-sn.x)*xn+(dn=_n.y-sn.y)*dn),vn=1/((yn=un.x-hn.x)*yn+(zn=un.y-hn.y)*zn),(mn=-(xn*(sn.x-hn.x)+dn*(sn.y-hn.y))*cn)<0?mn=0:1<mn&&(mn=1),(fn=-(xn*(sn.x-un.x)+dn*(sn.y-un.y))*cn)<0?fn=0:1<fn&&(fn=1),(bn=-(yn*(hn.x-sn.x)+zn*(hn.y-sn.y))*vn)<0?bn=0:1<bn&&(bn=1),(gn=-(yn*(hn.x-_n.x)+zn*(hn.y-_n.y))*vn)<0?gn=0:1<gn&&(gn=1),Mn=wn=0,wn=sn.x+xn*mn,Mn=sn.y+dn*mn,kn=Cn=0,Cn=sn.x+xn*fn,kn=sn.y+dn*fn,Pn=On=0,On=hn.x+yn*bn,Pn=hn.y+zn*bn,An=Sn=0,Sn=hn.x+yn*gn,An=hn.y+zn*gn,qn=Gn=Zn=Rn=Dn=Vn=Nn=Tn=En=jn=0,Un=null,(In=(jn=wn-hn.x)*jn+(En=Mn-hn.y)*En)<(Ln=(Tn=Cn-un.x)*Tn+(Nn=kn-un.y)*Nn)?(Gn=wn,qn=Mn,Un=hn):(Gn=Cn,qn=kn,Un=un,In=Ln),Wn=Kn=0,Yn=null,(Fn=(Vn=On-sn.x)*Vn+(Dn=Pn-sn.y)*Dn)<(Bn=(Rn=Sn-_n.x)*Rn+(Zn=An-_n.y)*Zn)?(Kn=On,Wn=Pn,Yn=sn):(Kn=Sn,Wn=An,Yn=_n,Fn=Bn),0!=(U=In<Fn?(o.x=Gn,o.y=qn,a.x=Un.x,a.y=Un.y,Math.sqrt(In)):(a.x=Kn,a.y=Wn,o.x=Yn.x,o.y=Yn.y,Math.sqrt(Fn)))&&(p.x=a.x-o.x,p.y=a.y-o.y,Jn=1/U,p.x*=Jn,p.y*=Jn,f&&(p.x=-p.x,p.y=-p.y)),U):(Hn=Xn=0,Xn=ut.gp0.x,Hn=ut.gp0.y,tt=nt=Qn=$n=0,nt=($n=ut.gp1.x)-Xn,tt=(Qn=ut.gp1.y)-Hn,et=tn.gnormy*Xn-tn.gnormx*Hn,pt=1/((it=tn.gnormy*$n-tn.gnormx*Qn)-et),(lt=(-tn.tp1-et)*pt)>co.epsilon&&(Xn+=nt*lt,Hn+=tt*lt),(rt=(-tn.tp0-it)*pt)<-co.epsilon&&($n+=nt*rt,Qn+=tt*rt),(ot=Xn*tn.gnormx+Hn*tn.gnormy-tn.gprojection)<(at=$n*tn.gnormx+Qn*tn.gnormy-tn.gprojection)?(a.x=Xn,a.y=Hn,st=-ot,o.x=a.x+tn.gnormx*st,o.y=a.y+tn.gnormy*st,ot):(a.x=$n,a.y=Qn,_t=-at,o.x=a.x+tn.gnormx*_t,o.y=a.y+tn.gnormy*_t,at))}else ht=1e100}else ht=1e100}}var ct=p;return null!=ct.outer&&(ct.outer.zpp_inner=null,ct.outer=null),ct._isimmutable=null,ct._validate=null,ct._invalidate=null,ct.next=mo.zpp_pool,mo.zpp_pool=ct,ht},G.intersectsBody=function(n,t){for(var e=n.zpp_inner.shapes.head;null!=e;)Mt.validateShape(e.elt),e=e.next;for(var i=t.zpp_inner.shapes.head;null!=i;)Mt.validateShape(i.elt),i=i.next;var p=n.zpp_inner.aabb,l=t.zpp_inner.aabb;if(l.miny<=p.maxy&&p.miny<=l.maxy&&l.minx<=p.maxx&&p.minx<=l.maxx){for(var r=n.zpp_inner.shapes.head;null!=r;){for(var o=r.elt,a=t.zpp_inner.shapes.head;null!=a;){if(vo.testCollide_safe(o,a.elt))return!0;a=a.next}r=r.next}return!1}return!1},G.intersects=function(n,t){Mt.validateShape(n.zpp_inner),Mt.validateShape(t.zpp_inner);var e=n.zpp_inner.aabb,i=t.zpp_inner.aabb;return i.miny<=e.maxy&&e.miny<=i.maxy&&i.minx<=e.maxx&&e.minx<=i.maxx&&vo.testCollide_safe(n.zpp_inner,t.zpp_inner)},G.contains=function(n,t){return Mt.validateShape(n.zpp_inner),Mt.validateShape(t.zpp_inner),vo.containTest(n.zpp_inner,t.zpp_inner)},G.prototype.__class__=G;var mi=nape.geom.GeomPoly=function(n){if(this.zpp_inner=null,this.zpp_pool=null,this.zpp_inner=new Ct(this),null!=n){if(n instanceof Array&&null==n.__enum__)for(var t=n,e=0;e<t.length;){var i=t[e];++e;var p=i,l=p.zpp_inner;null!=l._validate&&l._validate();var r=p.zpp_inner.x,o=p.zpp_inner;null!=o._validate&&o._validate();var a,s=p.zpp_inner.y;null==xp.zpp_pool?a=new xp:(a=xp.zpp_pool,xp.zpp_pool=a.next,a.next=null),a.forced=!1,a.x=r,a.y=s;var _=a;null==this.zpp_inner.vertices?this.zpp_inner.vertices=_.prev=_.next=_:(_.prev=this.zpp_inner.vertices,_.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=_,this.zpp_inner.vertices.next=_),this.zpp_inner.vertices=_}else if(zn.__instanceof(n,cn))for(var h=n.iterator();;){h.zpp_inner.zpp_inner.valmod();var u=h.zpp_inner.zpp_gl();if(h.zpp_critical=!0,!(h.zpp_i<u||(h.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=h).zpp_inner=null,!1)))break;h.zpp_critical=!1;var x=h.zpp_inner.at(h.zpp_i++),d=x.zpp_inner;null!=d._validate&&d._validate();var y=x.zpp_inner.x,z=x.zpp_inner;null!=z._validate&&z._validate();var c,v=x.zpp_inner.y;null==xp.zpp_pool?c=new xp:(c=xp.zpp_pool,xp.zpp_pool=c.next,c.next=null),c.forced=!1,c.x=y,c.y=v;var m=c;null==this.zpp_inner.vertices?this.zpp_inner.vertices=m.prev=m.next=m:(m.prev=this.zpp_inner.vertices,m.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=m,this.zpp_inner.vertices.next=m),this.zpp_inner.vertices=m}else if(zn.__instanceof(n,mi)){var f=n.zpp_inner.vertices;if(null!=f)for(var b=f;;){var g,w,M,C,k,O=b.x,P=b.y;null==Ri.poolVec2?g=new at:(g=Ri.poolVec2,Ri.poolVec2=g.zpp_pool,g.zpp_pool=null),null==g.zpp_inner?(null==mo.zpp_pool?w=new mo:(w=mo.zpp_pool,mo.zpp_pool=w.next,w.next=null),w.weak=!1,w._immutable=!1,w.x=O,w.y=P,g.zpp_inner=w,g.zpp_inner.outer=g):(null!=(M=g.zpp_inner)._validate&&M._validate(),g.zpp_inner.x==O&&(null!=(C=g.zpp_inner)._validate&&C._validate(),g.zpp_inner.y==P)||(g.zpp_inner.x=O,g.zpp_inner.y=P,null!=(k=g.zpp_inner)._invalidate&&k._invalidate(k))),g.zpp_inner.weak=!1;var S=g,b=b.next,A=S.zpp_inner;null!=A._validate&&A._validate();var j=S.zpp_inner.x,E=S.zpp_inner;null!=E._validate&&E._validate();var I,T=S.zpp_inner.y;null==xp.zpp_pool?I=new xp:(I=xp.zpp_pool,xp.zpp_pool=I.next,I.next=null),I.forced=!1,I.x=j,I.y=T;var N=I;null==this.zpp_inner.vertices?this.zpp_inner.vertices=N.prev=N.next=N:(N.prev=this.zpp_inner.vertices,N.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=N,this.zpp_inner.vertices.next=N),this.zpp_inner.vertices=N;var L=S.zpp_inner;S.zpp_inner.outer=null,S.zpp_inner=null;var V=S;V.zpp_pool=Ri.poolVec2,Ri.poolVec2=V;var D=L;if(null!=D.outer&&(D.outer.zpp_inner=null,D.outer=null),D._isimmutable=null,D._validate=null,D._invalidate=null,D.next=mo.zpp_pool,mo.zpp_pool=D,b==f)break}}if(this.skipForward(1),n instanceof Array&&null==n.__enum__)for(var F=n,R=0;R<F.length;){var Z,B,G,q=F[R],U=!!q.zpp_inner.weak&&(Z=q.zpp_inner,q.zpp_inner.outer=null,q.zpp_inner=null,(B=q).zpp_pool=Ri.poolVec2,Ri.poolVec2=B,null!=(G=Z).outer&&(G.outer.zpp_inner=null,G.outer=null),G._isimmutable=null,G._validate=null,G._invalidate=null,G.next=mo.zpp_pool,mo.zpp_pool=G,!0);U?F.splice(R,1):++R}else if(zn.__instanceof(n,cn)){var K=n;null!=K.zpp_inner._validate&&K.zpp_inner._validate();for(var W=K.zpp_inner.inner,Y=null,J=W.head;null!=J;){var X,H,$,Q,nn=J.elt;nn.outer.zpp_inner.weak?(J=W.erase(Y),nn.outer.zpp_inner.weak&&(H=(X=nn.outer).zpp_inner,X.zpp_inner.outer=null,X.zpp_inner=null,($=X).zpp_pool=Ri.poolVec2,Ri.poolVec2=$,null!=(Q=H).outer&&(Q.outer.zpp_inner=null,Q.outer=null),Q._isimmutable=null,Q._validate=null,Q._invalidate=null,Q.next=mo.zpp_pool,mo.zpp_pool=Q)):J=(Y=J).next}}}};mi.__name__=["nape","geom","GeomPoly"],mi.get=function(n){var t;if(null==Ri.poolGeomPoly?t=new mi:(t=Ri.poolGeomPoly,Ri.poolGeomPoly=t.zpp_pool,t.zpp_pool=null),null!=n){if(n instanceof Array&&null==n.__enum__)for(var e=n,i=0;i<e.length;){var p=e[i];++i;var l=p,r=l.zpp_inner;null!=r._validate&&r._validate();var o=l.zpp_inner.x,a=l.zpp_inner;null!=a._validate&&a._validate();var s,_=l.zpp_inner.y;null==xp.zpp_pool?s=new xp:(s=xp.zpp_pool,xp.zpp_pool=s.next,s.next=null),s.forced=!1,s.x=o,s.y=_;var h=s;null==t.zpp_inner.vertices?t.zpp_inner.vertices=h.prev=h.next=h:(h.prev=t.zpp_inner.vertices,h.next=t.zpp_inner.vertices.next,t.zpp_inner.vertices.next.prev=h,t.zpp_inner.vertices.next=h),t.zpp_inner.vertices=h}else if(zn.__instanceof(n,cn))for(var u=n.iterator();;){u.zpp_inner.zpp_inner.valmod();var x=u.zpp_inner.zpp_gl();if(u.zpp_critical=!0,!(u.zpp_i<x||(u.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=u).zpp_inner=null,!1)))break;u.zpp_critical=!1;var d=u.zpp_inner.at(u.zpp_i++),y=d.zpp_inner;null!=y._validate&&y._validate();var z=d.zpp_inner.x,c=d.zpp_inner;null!=c._validate&&c._validate();var v,m=d.zpp_inner.y;null==xp.zpp_pool?v=new xp:(v=xp.zpp_pool,xp.zpp_pool=v.next,v.next=null),v.forced=!1,v.x=z,v.y=m;var f=v;null==t.zpp_inner.vertices?t.zpp_inner.vertices=f.prev=f.next=f:(f.prev=t.zpp_inner.vertices,f.next=t.zpp_inner.vertices.next,t.zpp_inner.vertices.next.prev=f,t.zpp_inner.vertices.next=f),t.zpp_inner.vertices=f}else if(zn.__instanceof(n,mi)){var b=n.zpp_inner.vertices;if(null!=b)for(var g=b;;){var w,M,C,k,O,P=g.x,S=g.y;null==Ri.poolVec2?w=new at:(w=Ri.poolVec2,Ri.poolVec2=w.zpp_pool,w.zpp_pool=null),null==w.zpp_inner?(null==mo.zpp_pool?M=new mo:(M=mo.zpp_pool,mo.zpp_pool=M.next,M.next=null),M.weak=!1,M._immutable=!1,M.x=P,M.y=S,w.zpp_inner=M,w.zpp_inner.outer=w):(null!=(C=w.zpp_inner)._validate&&C._validate(),w.zpp_inner.x==P&&(null!=(k=w.zpp_inner)._validate&&k._validate(),w.zpp_inner.y==S)||(w.zpp_inner.x=P,w.zpp_inner.y=S,null!=(O=w.zpp_inner)._invalidate&&O._invalidate(O))),w.zpp_inner.weak=!1;var A=w,g=g.next,j=A.zpp_inner;null!=j._validate&&j._validate();var E=A.zpp_inner.x,I=A.zpp_inner;null!=I._validate&&I._validate();var T,N=A.zpp_inner.y;null==xp.zpp_pool?T=new xp:(T=xp.zpp_pool,xp.zpp_pool=T.next,T.next=null),T.forced=!1,T.x=E,T.y=N;var L=T;null==t.zpp_inner.vertices?t.zpp_inner.vertices=L.prev=L.next=L:(L.prev=t.zpp_inner.vertices,L.next=t.zpp_inner.vertices.next,t.zpp_inner.vertices.next.prev=L,t.zpp_inner.vertices.next=L),t.zpp_inner.vertices=L;var V=A.zpp_inner;A.zpp_inner.outer=null,A.zpp_inner=null;var D=A;D.zpp_pool=Ri.poolVec2,Ri.poolVec2=D;var F=V;if(null!=F.outer&&(F.outer.zpp_inner=null,F.outer=null),F._isimmutable=null,F._validate=null,F._invalidate=null,F.next=mo.zpp_pool,mo.zpp_pool=F,g==b)break}}if(t.skipForward(1),n instanceof Array&&null==n.__enum__)for(var R=n,Z=0;Z<R.length;){var B,G,q,U=R[Z],K=!!U.zpp_inner.weak&&(B=U.zpp_inner,U.zpp_inner.outer=null,U.zpp_inner=null,(G=U).zpp_pool=Ri.poolVec2,Ri.poolVec2=G,null!=(q=B).outer&&(q.outer.zpp_inner=null,q.outer=null),q._isimmutable=null,q._validate=null,q._invalidate=null,q.next=mo.zpp_pool,mo.zpp_pool=q,!0);K?R.splice(Z,1):++Z}else if(zn.__instanceof(n,cn)){var W=n;null!=W.zpp_inner._validate&&W.zpp_inner._validate();for(var Y=W.zpp_inner.inner,J=null,X=Y.head;null!=X;){var H,$,Q,nn,tn=X.elt;tn.outer.zpp_inner.weak?(X=Y.erase(J),tn.outer.zpp_inner.weak&&($=(H=tn.outer).zpp_inner,H.zpp_inner.outer=null,H.zpp_inner=null,(Q=H).zpp_pool=Ri.poolVec2,Ri.poolVec2=Q,null!=(nn=$).outer&&(nn.outer.zpp_inner=null,nn.outer=null),nn._isimmutable=null,nn._validate=null,nn._invalidate=null,nn.next=mo.zpp_pool,mo.zpp_pool=nn)):X=(J=X).next}}}return t},mi.prototype.zpp_pool=null,mi.prototype.zpp_inner=null,mi.prototype.empty=function(){return null==this.zpp_inner.vertices},mi.prototype.size=function(){var n=0,t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;++n,(i=i.next)!=e;);return n},mi.prototype.iterator=function(){return kt.get(this.zpp_inner.vertices,!0)},mi.prototype.forwardIterator=function(){return kt.get(this.zpp_inner.vertices,!0)},mi.prototype.backwardsIterator=function(){return kt.get(this.zpp_inner.vertices,!1)},mi.prototype.current=function(){var n,t,e,i,p,l,r,o=this.zpp_inner.vertices;return null==o.wrap&&(n=o.x,t=o.y,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,o.wrap=e,o.wrap.zpp_inner._inuse=!0,o.wrap.zpp_inner._invalidate=Q(o,o.modwrap),o.wrap.zpp_inner._validate=Q(o,o.getwrap)),o.wrap},mi.prototype.push=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p,l=n.zpp_inner.y;null==xp.zpp_pool?p=new xp:(p=xp.zpp_pool,xp.zpp_pool=p.next,p.next=null),p.forced=!1,p.x=e,p.y=l;var r,o=p;return null==this.zpp_inner.vertices?this.zpp_inner.vertices=o.prev=o.next=o:(o.prev=this.zpp_inner.vertices,o.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=o,this.zpp_inner.vertices.next=o),this.zpp_inner.vertices=o,n.zpp_inner.weak&&(r=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=mo.zpp_pool,mo.zpp_pool=r),this},mi.prototype.pop=function(){var n,t,e,i=this.zpp_inner.vertices,p=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null:(n=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n);return this.zpp_inner.vertices=p,null!=i.wrap&&(i.wrap.zpp_inner._inuse=!1,e=(t=i.wrap).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=mo.zpp_pool,mo.zpp_pool=e,i.wrap=null),i.prev=i.next=null,i.next=xp.zpp_pool,xp.zpp_pool=i,this},mi.prototype.unshift=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p,l=n.zpp_inner.y;null==xp.zpp_pool?p=new xp:(p=xp.zpp_pool,xp.zpp_pool=p.next,p.next=null),p.forced=!1,p.x=e,p.y=l;var r,o=p;return null==this.zpp_inner.vertices?this.zpp_inner.vertices=o.prev=o.next=o:(o.next=this.zpp_inner.vertices,o.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=o,this.zpp_inner.vertices.prev=o),this.zpp_inner.vertices=o,n.zpp_inner.weak&&(r=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=mo.zpp_pool,mo.zpp_pool=r),this},mi.prototype.shift=function(){var n,t,e,i=this.zpp_inner.vertices,p=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?(this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null):(n=this.zpp_inner.vertices.next,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n);return this.zpp_inner.vertices=p,null!=i.wrap&&(i.wrap.zpp_inner._inuse=!1,e=(t=i.wrap).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=mo.zpp_pool,mo.zpp_pool=e,i.wrap=null),i.prev=i.next=null,i.next=xp.zpp_pool,xp.zpp_pool=i,this},mi.prototype.skipForward=function(n){if(null!=this.zpp_inner.vertices)if(0<n)for(;0<n--;)this.zpp_inner.vertices=this.zpp_inner.vertices.next;else if(n<0)for(;n++<0;)this.zpp_inner.vertices=this.zpp_inner.vertices.prev;return this},mi.prototype.skipBackwards=function(n){return this.skipForward(-n)},mi.prototype.erase=function(n){for(;0!=n&&null!=this.zpp_inner.vertices;){var t,e,i,p,l,r,o=this.zpp_inner.vertices;0<n?(e=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?(this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null):(t=this.zpp_inner.vertices.next,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,t),this.zpp_inner.vertices=e,--n):n<0&&(p=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null:(i=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,i),this.zpp_inner.vertices=p,++n),null!=o.wrap&&(o.wrap.zpp_inner._inuse=!1,r=(l=o.wrap).zpp_inner,l.zpp_inner.outer=null,l.zpp_inner=null,l.zpp_pool=Ri.poolVec2,Ri.poolVec2=l,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=mo.zpp_pool,mo.zpp_pool=r,o.wrap=null),o.prev=o.next=null,o.next=xp.zpp_pool,xp.zpp_pool=o}return this},mi.prototype.clear=function(){for(;null!=this.zpp_inner.vertices;){var n,t,e,i=this.zpp_inner.vertices,p=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?(this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null):(n=this.zpp_inner.vertices.next,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n);this.zpp_inner.vertices=p,null!=i.wrap&&(i.wrap.zpp_inner._inuse=!1,e=(t=i.wrap).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=mo.zpp_pool,mo.zpp_pool=e,i.wrap=null),i.prev=i.next=null,i.next=xp.zpp_pool,xp.zpp_pool=i}return this},mi.prototype.copy=function(){var n=mi.get(),t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;;){var p,l=i.x,r=i.y;null==xp.zpp_pool?p=new xp:(p=xp.zpp_pool,xp.zpp_pool=p.next,p.next=null),p.forced=!1,p.x=l,p.y=r;var o=p;if(null==n.zpp_inner.vertices?n.zpp_inner.vertices=o.prev=o.next=o:(o.prev=n.zpp_inner.vertices,o.next=n.zpp_inner.vertices.next,n.zpp_inner.vertices.next.prev=o,n.zpp_inner.vertices.next=o),n.zpp_inner.vertices=o,(i=i.next)==e)break}return n.skipForward(1)},mi.prototype.dispose=function(){this.clear();this.zpp_pool=Ri.poolGeomPoly,Ri.poolGeomPoly=this},mi.prototype.toString=function(){var n="GeomPoly[",t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;;){if(i!=this.zpp_inner.vertices&&(n+=","),n+="{"+i.x+","+i.y+"}",(i=i.next)==e)break}return n+"]"},mi.prototype.area=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return 0;var n=0,t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;;){if(n+=i.x*(i.next.y-i.prev.y),(i=i.next)==e)break}var p=.5*n;return p<0?-p:p},mi.prototype.winding=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return null==Ll.Winding_UNDEFINED&&(Ll.internal=!0,Ll.Winding_UNDEFINED=new $,Ll.internal=!1),Ll.Winding_UNDEFINED;var n=0,t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;;){if(n+=i.x*(i.next.y-i.prev.y),(i=i.next)==e)break}var p=.5*n;return 0<p?(null==Ll.Winding_CLOCKWISE&&(Ll.internal=!0,Ll.Winding_CLOCKWISE=new $,Ll.internal=!1),Ll.Winding_CLOCKWISE):0==p?(null==Ll.Winding_UNDEFINED&&(Ll.internal=!0,Ll.Winding_UNDEFINED=new $,Ll.internal=!1),Ll.Winding_UNDEFINED):(null==Ll.Winding_ANTICLOCKWISE&&(Ll.internal=!0,Ll.Winding_ANTICLOCKWISE=new $,Ll.internal=!1),Ll.Winding_ANTICLOCKWISE)},mi.prototype.contains=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.y,l=!1,r=this.zpp_inner.vertices,o=this.zpp_inner.vertices;if(null!=r)for(var a=r;;){var s=a.prev;if((a.y<p&&s.y>=p||s.y<p&&a.y>=p)&&(a.x<=e||s.x<=e)&&a.x+(p-a.y)/(s.y-a.y)*(s.x-a.x)<e&&(l=!l),(a=a.next)==o)break}var _,h=l;return n.zpp_inner.weak&&(_=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=mo.zpp_pool,mo.zpp_pool=_),h},mi.prototype.isClockwise=function(){var n=this.winding();return null==Ll.Winding_CLOCKWISE&&(Ll.internal=!0,Ll.Winding_CLOCKWISE=new $,Ll.internal=!1),n==Ll.Winding_CLOCKWISE},mi.prototype.isConvex=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return!0;var n=!1,t=!1,e=!0,i=this.zpp_inner.vertices,p=this.zpp_inner.vertices;if(null!=i)for(var l=i;;){var r=l.prev,o=l.next,a=o.x-l.x,s=o.y-l.y,_=l.x-r.x,h=(l.y-r.y)*a-_*s;if(0<h?t=!0:h<0&&(n=!0),t&&n){e=!1;break}if((l=l.next)==p)break}return e},mi.prototype.isSimple=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||Dt.isSimple(this.zpp_inner.vertices)},mi.prototype.isMonotone=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||At.isMonotone(this.zpp_inner.vertices)},mi.prototype.isDegenerate=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||this.area()<co.epsilon},mi.prototype.simplify=function(n){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return this.copy();var t=Zt.simplify(this.zpp_inner.vertices,n),e=mi.get();return e.zpp_inner.vertices=t,e},mi.prototype.simpleDecomposition=function(n){null==Et.sharedGVList&&(Et.sharedGVList=new Ce);for(var t=Dt.decompose(this.zpp_inner.vertices,Et.sharedGVList),e=null==n?new fi:n;null!=t.head;){var i=t.pop_unsafe(),p=mi.get();p.zpp_inner.vertices=i,e.zpp_inner.reverse_flag?e.push(p):e.unshift(p)}return e},mi.prototype.monotoneDecomposition=function(n){null==At.sharedPPoly&&(At.sharedPPoly=new Et);var t=At.decompose(this.zpp_inner.vertices,At.sharedPPoly);null==Et.sharedGVList&&(Et.sharedGVList=new Ce);for(var e=t.extract(Et.sharedGVList),i=null==n?new fi:n;null!=e.head;){var p=e.pop_unsafe(),l=mi.get();l.zpp_inner.vertices=p,i.zpp_inner.reverse_flag?i.push(l):i.unshift(l)}return i},mi.prototype.convexDecomposition=function(n,t){null==n&&(n=!1),null==At.sharedPPoly&&(At.sharedPPoly=new Et);var e=At.decompose(this.zpp_inner.vertices,At.sharedPPoly);null==Et.sharedPPList&&(Et.sharedPPList=new Me);for(var i=e.extract_partitions(Et.sharedPPList),p=null==t?new fi:t;null!=i.head;){var l=i.pop_unsafe();Gt.triangulate(l),n&&Gt.optimise(l),gt.optimise(l),null==Et.sharedGVList&&(Et.sharedGVList=new Ce);var r=l.extract(Et.sharedGVList);for(l.next=Et.zpp_pool,Et.zpp_pool=l;null!=r.head;){var o=r.pop_unsafe(),a=mi.get();a.zpp_inner.vertices=o,p.zpp_inner.reverse_flag?p.push(a):p.unshift(a)}}return p},mi.prototype.triangularDecomposition=function(n,t){null==n&&(n=!1),null==At.sharedPPoly&&(At.sharedPPoly=new Et);var e=At.decompose(this.zpp_inner.vertices,At.sharedPPoly);null==Et.sharedPPList&&(Et.sharedPPList=new Me);for(var i=e.extract_partitions(Et.sharedPPList),p=null==t?new fi:t;null!=i.head;){var l=i.pop_unsafe();Gt.triangulate(l),n&&Gt.optimise(l),null==Et.sharedGVList&&(Et.sharedGVList=new Ce);var r=l.extract(Et.sharedGVList);for(l.next=Et.zpp_pool,Et.zpp_pool=l;null!=r.head;){var o=r.pop_unsafe(),a=mi.get();a.zpp_inner.vertices=o,p.zpp_inner.reverse_flag?p.push(a):p.unshift(a)}}return p},mi.prototype.inflate=function(n){var t=mi.get(),e=this.winding();null==Ll.Winding_CLOCKWISE&&(Ll.internal=!0,Ll.Winding_CLOCKWISE=new $,Ll.internal=!1),e==Ll.Winding_CLOCKWISE&&(n=-n);var i=this.zpp_inner.vertices,p=this.zpp_inner.vertices;if(null!=i)for(var l=i;;){var r=l,o=r.prev,a=r.next,s=r.x-o.x,_=r.y-o.y,h=a.x-r.x,u=a.y-r.y,x=s,d=_,y=1/Math.sqrt(x*x+d*d),z=x*=y;x=-(d*=y),d=z,x*=n,d*=n,M=h,C=u;var c,v,m,f,b,g=1/Math.sqrt(M*M+C*C),w=M*=g,M=-(C*=g),C=w,k=u*((M*=n)-x)-h*((C*=n)-d),O=0==k?0:k/(u*s-h*_),P=r.x+x,S=r.y+d;if(P+=s*O,S+=_*O,null==Ri.poolVec2?c=new at:(c=Ri.poolVec2,Ri.poolVec2=c.zpp_pool,c.zpp_pool=null),null==c.zpp_inner?(null==mo.zpp_pool?v=new mo:(v=mo.zpp_pool,mo.zpp_pool=v.next,v.next=null),v.weak=!1,v._immutable=!1,v.x=P,v.y=S,c.zpp_inner=v,c.zpp_inner.outer=c):(null!=(m=c.zpp_inner)._validate&&m._validate(),c.zpp_inner.x==P&&(null!=(f=c.zpp_inner)._validate&&f._validate(),c.zpp_inner.y==S)||(c.zpp_inner.x=P,c.zpp_inner.y=S,null!=(b=c.zpp_inner)._invalidate&&b._invalidate(b))),c.zpp_inner.weak=!1,t.push(c),(l=l.next)==p)break}return t.skipForward(1)},mi.prototype.cut=function(n,t,e,i,p){null==i&&(i=!1),null==e&&(e=!1);var l,r,o=wi.run(this.zpp_inner.vertices,n,t,e,i,p);return n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=mo.zpp_pool,mo.zpp_pool=l),t.zpp_inner.weak&&(r=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=mo.zpp_pool,mo.zpp_pool=r),o},mi.prototype.transform=function(n){var t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;;){var p=i,l=n.zpp_inner.a*p.x+n.zpp_inner.b*p.y+n.zpp_inner.tx;if(p.y=n.zpp_inner.c*p.x+n.zpp_inner.d*p.y+n.zpp_inner.ty,p.x=l,(i=i.next)==e)break}return this},mi.prototype.bounds=function(){var n=1e100,t=1e100,e=-1e100,i=-1e100,p=this.zpp_inner.vertices,l=this.zpp_inner.vertices;if(null!=p)for(var r=p;;){if(r.x<n&&(n=r.x),r.y<t&&(t=r.y),r.x>e&&(e=r.x),r.y>i&&(i=r.y),(r=r.next)==l)break}return new Z(n,t,e-n,i-t)},mi.prototype.top=function(){var n,t,e,i,p,l,r,o=this.zpp_inner.vertices,a=this.zpp_inner.vertices.next,s=this.zpp_inner.vertices;if(null!=a)for(var _=a;;){if(_.y<o.y&&(o=_),(_=_.next)==s)break}return null==o.wrap&&(n=o.x,t=o.y,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,o.wrap=e,o.wrap.zpp_inner._inuse=!0,o.wrap.zpp_inner._invalidate=Q(o,o.modwrap),o.wrap.zpp_inner._validate=Q(o,o.getwrap)),o.wrap},mi.prototype.bottom=function(){var n,t,e,i,p,l,r,o=this.zpp_inner.vertices,a=this.zpp_inner.vertices.next,s=this.zpp_inner.vertices;if(null!=a)for(var _=a;;){if(_.y>o.y&&(o=_),(_=_.next)==s)break}return null==o.wrap&&(n=o.x,t=o.y,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,o.wrap=e,o.wrap.zpp_inner._inuse=!0,o.wrap.zpp_inner._invalidate=Q(o,o.modwrap),o.wrap.zpp_inner._validate=Q(o,o.getwrap)),o.wrap},mi.prototype.left=function(){var n,t,e,i,p,l,r,o=this.zpp_inner.vertices,a=this.zpp_inner.vertices.next,s=this.zpp_inner.vertices;if(null!=a)for(var _=a;;){if(_.x<o.x&&(o=_),(_=_.next)==s)break}return null==o.wrap&&(n=o.x,t=o.y,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,o.wrap=e,o.wrap.zpp_inner._inuse=!0,o.wrap.zpp_inner._invalidate=Q(o,o.modwrap),o.wrap.zpp_inner._validate=Q(o,o.getwrap)),o.wrap},mi.prototype.right=function(){var n,t,e,i,p,l,r,o=this.zpp_inner.vertices,a=this.zpp_inner.vertices.next,s=this.zpp_inner.vertices;if(null!=a)for(var _=a;;){if(_.x>o.x&&(o=_),(_=_.next)==s)break}return null==o.wrap&&(n=o.x,t=o.y,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,o.wrap=e,o.wrap.zpp_inner._inuse=!0,o.wrap.zpp_inner._invalidate=Q(o,o.modwrap),o.wrap.zpp_inner._validate=Q(o,o.getwrap)),o.wrap},mi.prototype.__class__=mi;var Hn=nape.geom.GeomPolyIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Hn.__name__=["nape","geom","GeomPolyIterator"],Hn.get=function(n){var t,e,i=null==Hn.zpp_pool?(ji.internal=!0,t=new Hn,ji.internal=!1,t):(e=Hn.zpp_pool,Hn.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},Hn.prototype.zpp_inner=null,Hn.prototype.zpp_i=null,Hn.prototype.zpp_critical=null,Hn.prototype.zpp_next=null,Hn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=this).zpp_inner=null,!1)},Hn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Hn.prototype.__class__=Hn;var fi=nape.geom.GeomPolyList=function(){this.zpp_inner=null,this.zpp_inner=new ji,this.zpp_inner.outer=this};fi.__name__=["nape","geom","GeomPolyList"],fi.fromArray=function(n){for(var t=new fi,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},fi.prototype.zpp_inner=null,fi.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},fi.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},fi.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},fi.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},fi.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},fi.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:t.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},fi.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},fi.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},fi.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},fi.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},fi.prototype.empty=function(){return null==this.zpp_inner.inner.head},fi.prototype.iterator=function(){return this.zpp_inner.valmod(),Hn.get(this)},fi.prototype.copy=function(n){null==n&&(n=!1);var t=new fi;this.zpp_inner.valmod();for(var e=Hn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},fi.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Hn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},fi.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Hn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},fi.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Hn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=t).zpp_inner=null;break}}return this},fi.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(fi.prototype,"length",{get:fi.prototype.get_length}),fi.prototype.__class__=fi;var q=nape.geom.GeomVertexIterator=function(){};q.__name__=["nape","geom","GeomVertexIterator"],q.prototype.zpp_inner=null,q.prototype.hasNext=function(){var n,t=this.zpp_inner.ptr!=this.zpp_inner.start||this.zpp_inner.first;return this.zpp_inner.first=!1,t||((n=this.zpp_inner).outer.zpp_inner=null,n.ptr=n.start=null,n.next=kt.zpp_pool,kt.zpp_pool=n),t},q.prototype.next=function(){var n,t,e,i,p,l,r,o=this.zpp_inner.ptr;null==o.wrap&&(n=o.x,t=o.y,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,o.wrap=e,o.wrap.zpp_inner._inuse=!0,o.wrap.zpp_inner._invalidate=Q(o,o.modwrap),o.wrap.zpp_inner._validate=Q(o,o.getwrap));var a=o.wrap;return this.zpp_inner.ptr=this.zpp_inner.forward?this.zpp_inner.ptr.next:this.zpp_inner.ptr.prev,a},q.prototype.__class__=q;var U=nape.geom.MarchingSquares=function(){};U.__name__=["nape","geom","MarchingSquares"],U.run=function(n,t,e,i,p,l,r){null==l&&(l=!0),null==i&&(i=2);var o,a,s=null!=r?r:new fi;if(null==p){var _=t.zpp_inner;null!=_._validate&&_._validate();var h=t.zpp_inner.minx,u=t.zpp_inner;null!=u._validate&&u._validate();var x=t.zpp_inner.miny,d=t.zpp_inner.getmax(),y=d.zpp_inner;null!=y._validate&&y._validate();var z=d.zpp_inner.x,c=t.zpp_inner.getmax(),v=c.zpp_inner;null!=v._validate&&v._validate(),yp.run(n,h,x,z,c.zpp_inner.y,e,i,l,s)}else{var m=t.zpp_inner;null!=m._validate&&m._validate();var f=t.zpp_inner,b=f.maxx-f.minx,g=p.zpp_inner;null!=g._validate&&g._validate();var w=b/p.zpp_inner.x,M=t.zpp_inner;null!=M._validate&&M._validate();var C=t.zpp_inner,k=C.maxy-C.miny,O=p.zpp_inner;null!=O._validate&&O._validate();var P=k/p.zpp_inner.y,S=0|w,A=0|P;S!=w&&++S,A!=P&&++A;for(var j=0,E=S;j<E;){var I=j++,T=t.zpp_inner;null!=T._validate&&T._validate();var N=t.zpp_inner.minx,L=p.zpp_inner;null!=L._validate&&L._validate();for(var V,D,F,R=N+p.zpp_inner.x*I,Z=I==S-1?(null!=(D=(V=t.zpp_inner.getmax()).zpp_inner)._validate&&D._validate(),V.zpp_inner.x):(null!=(F=p.zpp_inner)._validate&&F._validate(),R+p.zpp_inner.x),B=0,G=A;B<G;){var q=B++,U=t.zpp_inner;null!=U._validate&&U._validate();var K=t.zpp_inner.miny,W=p.zpp_inner;null!=W._validate&&W._validate();var Y,J,X,H=K+p.zpp_inner.y*q,$=q==A-1?(null!=(J=(Y=t.zpp_inner.getmax()).zpp_inner)._validate&&J._validate(),Y.zpp_inner.y):(null!=(X=p.zpp_inner)._validate&&X._validate(),H+p.zpp_inner.y);yp.run(n,R,H,Z,$,e,i,l,s)}}}return e.zpp_inner.weak&&(o=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Ri.poolVec2,Ri.poolVec2=e,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null!=p&&p.zpp_inner.weak&&(a=p.zpp_inner,p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Ri.poolVec2,Ri.poolVec2=p,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=mo.zpp_pool,mo.zpp_pool=a),s},U.prototype.__class__=U;var pn=nape.geom.Mat23=function(n,t,e,i,p,l){null==l&&(l=0),null==p&&(p=0),null==i&&(i=1),null==e&&(e=0),null==t&&(t=0),null==n&&(n=1),this.zpp_inner=null,this.zpp_inner=Pt.get(),(this.zpp_inner.outer=this).zpp_inner.a=n;var r=this.zpp_inner;null!=r._invalidate&&r._invalidate(),this.zpp_inner.b=t;var o=this.zpp_inner;null!=o._invalidate&&o._invalidate(),this.zpp_inner.tx=p;var a=this.zpp_inner;null!=a._invalidate&&a._invalidate(),this.zpp_inner.c=e;var s=this.zpp_inner;null!=s._invalidate&&s._invalidate(),this.zpp_inner.d=i;var _=this.zpp_inner;null!=_._invalidate&&_._invalidate(),this.zpp_inner.ty=l;var h=this.zpp_inner;null!=h._invalidate&&h._invalidate()};pn.__name__=["nape","geom","Mat23"],pn.rotation=function(n){var t=Math.cos(n),e=Math.sin(n);return new pn(t,-e,e,t,0,0)},pn.translation=function(n,t){return new pn(1,0,0,1,n,t)},pn.scale=function(n,t){return new pn(n,0,0,t,0,0)},pn.prototype.zpp_inner=null,pn.prototype.get_a=function(){return this.zpp_inner.a},pn.prototype.set_a=function(n){this.zpp_inner.a=n;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.a},pn.prototype.get_b=function(){return this.zpp_inner.b},pn.prototype.set_b=function(n){this.zpp_inner.b=n;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.b},pn.prototype.get_c=function(){return this.zpp_inner.c},pn.prototype.set_c=function(n){this.zpp_inner.c=n;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.c},pn.prototype.get_d=function(){return this.zpp_inner.d},pn.prototype.set_d=function(n){this.zpp_inner.d=n;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.d},pn.prototype.get_tx=function(){return this.zpp_inner.tx},pn.prototype.set_tx=function(n){this.zpp_inner.tx=n;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.tx},pn.prototype.get_ty=function(){return this.zpp_inner.ty},pn.prototype.set_ty=function(n){this.zpp_inner.ty=n;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.ty},pn.prototype.copy=function(){return new pn(this.zpp_inner.a,this.zpp_inner.b,this.zpp_inner.c,this.zpp_inner.d,this.zpp_inner.tx,this.zpp_inner.ty)},pn.prototype.set=function(n){var t=n.zpp_inner;this.zpp_inner.setas(t.a,t.b,t.c,t.d,t.tx,t.ty);var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this},pn.prototype.setAs=function(n,t,e,i,p,l){null==l&&(l=0),null==p&&(p=0),null==i&&(i=1),null==e&&(e=0),null==t&&(t=0),null==n&&(n=1),this.zpp_inner.setas(n,t,e,i,p,l);var r=this.zpp_inner;return null!=r._invalidate&&r._invalidate(),this},pn.prototype.reset=function(){return this.setAs()},pn.prototype.get_determinant=function(){return this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c},pn.prototype.singular=function(){var n=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d,t=this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c;return t<0&&(t=-t),n>co.illConditionedThreshold*t},pn.prototype.inverse=function(){var n=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);return new pn(this.zpp_inner.d*n,-this.zpp_inner.b*n,-this.zpp_inner.c*n,this.zpp_inner.a*n,(this.zpp_inner.b*this.zpp_inner.ty-this.zpp_inner.d*this.zpp_inner.tx)*n,(this.zpp_inner.c*this.zpp_inner.tx-this.zpp_inner.a*this.zpp_inner.ty)*n)},pn.prototype.transpose=function(){return new pn(this.zpp_inner.a,this.zpp_inner.c,this.zpp_inner.b,this.zpp_inner.d,-this.zpp_inner.a*this.zpp_inner.tx-this.zpp_inner.c*this.zpp_inner.ty,-this.zpp_inner.b*this.zpp_inner.tx-this.zpp_inner.d*this.zpp_inner.ty)},pn.prototype.concat=function(n){return new pn(n.zpp_inner.a*this.zpp_inner.a+n.zpp_inner.b*this.zpp_inner.c,n.zpp_inner.a*this.zpp_inner.b+n.zpp_inner.b*this.zpp_inner.d,n.zpp_inner.c*this.zpp_inner.a+n.zpp_inner.d*this.zpp_inner.c,n.zpp_inner.c*this.zpp_inner.b+n.zpp_inner.d*this.zpp_inner.d,n.zpp_inner.a*this.zpp_inner.tx+n.zpp_inner.b*this.zpp_inner.ty+n.zpp_inner.tx,n.zpp_inner.c*this.zpp_inner.tx+n.zpp_inner.d*this.zpp_inner.ty+n.zpp_inner.ty)},pn.prototype.transform=function(n,t,e){var i,p,l,r,o,a,s,_,h,u,x,d,y,z,c,v,m,f,b,g,w,M,C,k,O,P,S,A;return null==e&&(e=!1),null==t&&(t=!1),i=t?(null!=(p=n.zpp_inner)._validate&&p._validate(),l=n.zpp_inner.x*this.zpp_inner.a,null!=(r=n.zpp_inner)._validate&&r._validate(),o=l+n.zpp_inner.y*this.zpp_inner.b,null!=(a=n.zpp_inner)._validate&&a._validate(),s=n.zpp_inner.x*this.zpp_inner.c,null!=(_=n.zpp_inner)._validate&&_._validate(),h=s+n.zpp_inner.y*this.zpp_inner.d,null==Ri.poolVec2?u=new at:(u=Ri.poolVec2,Ri.poolVec2=u.zpp_pool,u.zpp_pool=null),null==u.zpp_inner?(null==mo.zpp_pool?x=new mo:(x=mo.zpp_pool,mo.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=o,x.y=h,u.zpp_inner=x,u.zpp_inner.outer=u):(null!=(d=u.zpp_inner)._validate&&d._validate(),u.zpp_inner.x==o&&(null!=(y=u.zpp_inner)._validate&&y._validate(),u.zpp_inner.y==h)||(u.zpp_inner.x=o,u.zpp_inner.y=h,null!=(z=u.zpp_inner)._invalidate&&z._invalidate(z))),u.zpp_inner.weak=e,u):(null!=(c=n.zpp_inner)._validate&&c._validate(),v=n.zpp_inner.x*this.zpp_inner.a,null!=(m=n.zpp_inner)._validate&&m._validate(),f=v+n.zpp_inner.y*this.zpp_inner.b+this.zpp_inner.tx,null!=(b=n.zpp_inner)._validate&&b._validate(),g=n.zpp_inner.x*this.zpp_inner.c,null!=(w=n.zpp_inner)._validate&&w._validate(),M=g+n.zpp_inner.y*this.zpp_inner.d+this.zpp_inner.ty,null==Ri.poolVec2?C=new at:(C=Ri.poolVec2,Ri.poolVec2=C.zpp_pool,C.zpp_pool=null),null==C.zpp_inner?(null==mo.zpp_pool?k=new mo:(k=mo.zpp_pool,mo.zpp_pool=k.next,k.next=null),k.weak=!1,k._immutable=!1,k.x=f,k.y=M,C.zpp_inner=k,C.zpp_inner.outer=C):(null!=(O=C.zpp_inner)._validate&&O._validate(),C.zpp_inner.x==f&&(null!=(P=C.zpp_inner)._validate&&P._validate(),C.zpp_inner.y==M)||(C.zpp_inner.x=f,C.zpp_inner.y=M,null!=(S=C.zpp_inner)._invalidate&&S._invalidate(S))),C.zpp_inner.weak=e,C),n.zpp_inner.weak&&(A=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=A.outer&&(A.outer.zpp_inner=null,A.outer=null),A._isimmutable=null,A._validate=null,A._invalidate=null,A.next=mo.zpp_pool,mo.zpp_pool=A),i},pn.prototype.inverseTransform=function(n,t,e){null==e&&(e=!1),null==t&&(t=!1);var i,p,l,r,o,a,s,_,h,u,x,d,y,z,c,v,m,f,b,g,w,M,C,k,O,P=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c),S=t?(null!=(i=n.zpp_inner)._validate&&i._validate(),p=n.zpp_inner.x*this.zpp_inner.d,null!=(l=n.zpp_inner)._validate&&l._validate(),r=(p-n.zpp_inner.y*this.zpp_inner.b)*P,null!=(o=n.zpp_inner)._validate&&o._validate(),a=n.zpp_inner.y*this.zpp_inner.a,null!=(s=n.zpp_inner)._validate&&s._validate(),_=(a-n.zpp_inner.x*this.zpp_inner.c)*P,null==Ri.poolVec2?h=new at:(h=Ri.poolVec2,Ri.poolVec2=h.zpp_pool,h.zpp_pool=null),null==h.zpp_inner?(null==mo.zpp_pool?u=new mo:(u=mo.zpp_pool,mo.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=r,u.y=_,h.zpp_inner=u,h.zpp_inner.outer=h):(null!=(x=h.zpp_inner)._validate&&x._validate(),h.zpp_inner.x==r&&(null!=(d=h.zpp_inner)._validate&&d._validate(),h.zpp_inner.y==_)||(h.zpp_inner.x=r,h.zpp_inner.y=_,null!=(y=h.zpp_inner)._invalidate&&y._invalidate(y))),h.zpp_inner.weak=e,h):(null!=(z=n.zpp_inner)._validate&&z._validate(),c=n.zpp_inner.x-this.zpp_inner.tx,null!=(v=n.zpp_inner)._validate&&v._validate(),m=n.zpp_inner.y-this.zpp_inner.ty,f=(c*this.zpp_inner.d-m*this.zpp_inner.b)*P,b=(m*this.zpp_inner.a-c*this.zpp_inner.c)*P,null==Ri.poolVec2?g=new at:(g=Ri.poolVec2,Ri.poolVec2=g.zpp_pool,g.zpp_pool=null),null==g.zpp_inner?(null==mo.zpp_pool?w=new mo:(w=mo.zpp_pool,mo.zpp_pool=w.next,w.next=null),w.weak=!1,w._immutable=!1,w.x=f,w.y=b,g.zpp_inner=w,g.zpp_inner.outer=g):(null!=(M=g.zpp_inner)._validate&&M._validate(),g.zpp_inner.x==f&&(null!=(C=g.zpp_inner)._validate&&C._validate(),g.zpp_inner.y==b)||(g.zpp_inner.x=f,g.zpp_inner.y=b,null!=(k=g.zpp_inner)._invalidate&&k._invalidate(k))),g.zpp_inner.weak=e,g);return n.zpp_inner.weak&&(O=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=O.outer&&(O.outer.zpp_inner=null,O.outer=null),O._isimmutable=null,O._validate=null,O._invalidate=null,O.next=mo.zpp_pool,mo.zpp_pool=O),S},pn.prototype.toString=function(){return"{ a: "+this.zpp_inner.a+" b: "+this.zpp_inner.b+" c: "+this.zpp_inner.c+" d: "+this.zpp_inner.d+" tx: "+this.zpp_inner.tx+" ty: "+this.zpp_inner.ty+" }"},pn.prototype.equiorthogonal=function(){if(this.singular())return!1;var n=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(n*n<co.epsilon){var t=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-this.zpp_inner.c*this.zpp_inner.c-this.zpp_inner.d*this.zpp_inner.d;return t*t<co.epsilon}return!1},pn.prototype.orthogonal=function(){var n=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(n*n<co.epsilon){var t=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-1,e=this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d-1;return t*t<co.epsilon&&e*e<co.epsilon}return!1},pn.prototype.equiorthogonalise=function(){var n,t,e,i,p,l,r,o,a,s,_,h,u,x,d,y,z;return this.equiorthogonal()||(t=(n=((t=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c))+(e=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d)))/2)/t,e=n/e,this.zpp_inner.a=this.zpp_inner.a*t,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(),this.zpp_inner.c=this.zpp_inner.c*t,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(),this.zpp_inner.b=this.zpp_inner.b*e,null!=(l=this.zpp_inner)._invalidate&&l._invalidate(),this.zpp_inner.d=this.zpp_inner.d*e,null!=(r=this.zpp_inner)._invalidate&&r._invalidate(),o=.25*Math.PI-.5*Math.acos((this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d)/(n*n)),0<this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c&&(o=-o),a=Math.sin(o),s=Math.cos(o),_=this.zpp_inner.a*s-this.zpp_inner.c*a,h=this.zpp_inner.b*s+this.zpp_inner.d*a,this.zpp_inner.c=this.zpp_inner.c*s+this.zpp_inner.a*a,null!=(u=this.zpp_inner)._invalidate&&u._invalidate(),this.zpp_inner.a=_,null!=(x=this.zpp_inner)._invalidate&&x._invalidate(),this.zpp_inner.d=this.zpp_inner.d*s-this.zpp_inner.b*a,null!=(d=this.zpp_inner)._invalidate&&d._invalidate(),this.zpp_inner.b=h,null!=(y=this.zpp_inner)._invalidate&&y._invalidate(),null!=(z=this.zpp_inner)._invalidate&&z._invalidate()),this},pn.prototype.orthogonalise=function(){var n,t,e,i,p,l,r,o,a,s,_,h,u,x,d,y;return this.orthogonal()||(n=1/(n=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c)),t=1/(t=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d)),this.zpp_inner.a=this.zpp_inner.a*n,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(),this.zpp_inner.c=this.zpp_inner.c*n,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(),this.zpp_inner.b=this.zpp_inner.b*t,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(),this.zpp_inner.d=this.zpp_inner.d*t,null!=(l=this.zpp_inner)._invalidate&&l._invalidate(),r=.25*Math.PI-.5*Math.acos(this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d),0<this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c&&(r=-r),o=Math.sin(r),a=Math.cos(r),s=this.zpp_inner.a*a-this.zpp_inner.c*o,_=this.zpp_inner.b*a+this.zpp_inner.d*o,this.zpp_inner.c=this.zpp_inner.c*a+this.zpp_inner.a*o,null!=(h=this.zpp_inner)._invalidate&&h._invalidate(),this.zpp_inner.a=s,null!=(u=this.zpp_inner)._invalidate&&u._invalidate(),this.zpp_inner.d=this.zpp_inner.d*a-this.zpp_inner.b*o,null!=(x=this.zpp_inner)._invalidate&&x._invalidate(),this.zpp_inner.b=_,null!=(d=this.zpp_inner)._invalidate&&d._invalidate(),null!=(y=this.zpp_inner)._invalidate&&y._invalidate()),this},Object.defineProperty(pn.prototype,"a",{get:pn.prototype.get_a,set:pn.prototype.set_a}),Object.defineProperty(pn.prototype,"b",{get:pn.prototype.get_b,set:pn.prototype.set_b}),Object.defineProperty(pn.prototype,"c",{get:pn.prototype.get_c,set:pn.prototype.set_c}),Object.defineProperty(pn.prototype,"d",{get:pn.prototype.get_d,set:pn.prototype.set_d}),Object.defineProperty(pn.prototype,"tx",{get:pn.prototype.get_tx,set:pn.prototype.set_tx}),Object.defineProperty(pn.prototype,"ty",{get:pn.prototype.get_ty,set:pn.prototype.set_ty}),Object.defineProperty(pn.prototype,"determinant",{get:pn.prototype.get_determinant}),pn.prototype.__class__=pn;var K=nape.geom.MatMN=function(n,t){this.zpp_inner=null,this.zpp_inner=new St(n,t),this.zpp_inner.outer=this};K.__name__=["nape","geom","MatMN"],K.prototype.zpp_inner=null,K.prototype.get_rows=function(){return this.zpp_inner.m},K.prototype.get_cols=function(){return this.zpp_inner.n},K.prototype.x=function(n,t){return this.zpp_inner.x[n*this.zpp_inner.n+t]},K.prototype.setx=function(n,t,e){return this.zpp_inner.x[n*this.zpp_inner.n+t]=e},K.prototype.toString=function(){for(var n="{ ",t=!0,e=0,i=this.zpp_inner.m;e<i;){var p=e++;t||(n+="; "),t=!1;for(var l=0,r=this.zpp_inner.n;l<r;)n+=this.zpp_inner.x[p*this.zpp_inner.n+l++]+" "}return n+="}"},K.prototype.transpose=function(){for(var n=new K(this.zpp_inner.n,this.zpp_inner.m),t=0,e=this.zpp_inner.m;t<e;)for(var i=t++,p=0,l=this.zpp_inner.n;p<l;){var r=p++;n.zpp_inner.x[r*n.zpp_inner.n+i]=this.zpp_inner.x[i*this.zpp_inner.n+r]}return n},K.prototype.mul=function(n){for(var t=new K(this.zpp_inner.m,n.zpp_inner.n),e=0,i=this.zpp_inner.m;e<i;)for(var p=e++,l=0,r=n.zpp_inner.n;l<r;){for(var o=l++,a=0,s=0,_=this.zpp_inner.n;s<_;){var h=s++;a+=this.zpp_inner.x[p*this.zpp_inner.n+h]*n.zpp_inner.x[h*n.zpp_inner.n+o]}t.zpp_inner.x[p*t.zpp_inner.n+o]=a}return t},Object.defineProperty(K.prototype,"rows",{get:K.prototype.get_rows}),Object.defineProperty(K.prototype,"cols",{get:K.prototype.get_cols}),K.prototype.__class__=K;var W=nape.geom.Ray=function(n,t){this.zpp_inner=null,this.zpp_inner=new It;var e=this.zpp_inner.origin,i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r,o,a,s=n.zpp_inner.y,_=e.zpp_inner;null!=_._validate&&_._validate(),e.zpp_inner.x==p&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==s)||(e.zpp_inner.x=p,e.zpp_inner.y=s,null!=(o=e.zpp_inner)._invalidate&&o._invalidate(o)),n.zpp_inner.weak&&(a=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=mo.zpp_pool,mo.zpp_pool=a);var h=this.zpp_inner.direction,u=t.zpp_inner;null!=u._validate&&u._validate();var x=t.zpp_inner.x,d=t.zpp_inner;null!=d._validate&&d._validate();var y,z,c,v=t.zpp_inner.y,m=h.zpp_inner;null!=m._validate&&m._validate(),h.zpp_inner.x==x&&(null!=(y=h.zpp_inner)._validate&&y._validate(),h.zpp_inner.y==v)||(h.zpp_inner.x=x,h.zpp_inner.y=v,null!=(z=h.zpp_inner)._invalidate&&z._invalidate(z)),t.zpp_inner.weak&&(c=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=mo.zpp_pool,mo.zpp_pool=c),this.zpp_inner.zip_dir=!0,this.zpp_inner.maxdist=1/0};W.__name__=["nape","geom","Ray"],W.fromSegment=function(n,t){var e=new W(n,t.sub(n,!0)),i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.y,o=t.zpp_inner;null!=o._validate&&o._validate();var a=t.zpp_inner.x,s=t.zpp_inner;null!=s._validate&&s._validate();var _,h,u=p-a,x=r-t.zpp_inner.y;return e.zpp_inner.maxdist=Math.sqrt(u*u+x*x),n.zpp_inner.weak&&(_=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=mo.zpp_pool,mo.zpp_pool=_),t.zpp_inner.weak&&(h=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=mo.zpp_pool,mo.zpp_pool=h),e},W.prototype.zpp_inner=null,W.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},W.prototype.get_origin=function(){return this.zpp_inner.origin},W.prototype.set_origin=function(n){var t=this.zpp_inner.origin,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),this.zpp_inner.origin},W.prototype.get_direction=function(){return this.zpp_inner.direction},W.prototype.set_direction=function(n){var t=this.zpp_inner.direction,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),this.zpp_inner.zip_dir=!0,this.zpp_inner.direction},W.prototype.get_maxDistance=function(){return this.zpp_inner.maxdist},W.prototype.set_maxDistance=function(n){return this.zpp_inner.maxdist=n,this.zpp_inner.maxdist},W.prototype.aabb=function(){return this.zpp_inner.rayAABB().wrapper()},W.prototype.at=function(n,t){null==t&&(t=!1),this.zpp_inner.validate_dir();var e=this.zpp_inner.origin,i=e.zpp_inner;null!=i._validate&&i._validate();var p=e.zpp_inner.x+n*this.zpp_inner.dirx,l=this.zpp_inner.origin,r=l.zpp_inner;null!=r._validate&&r._validate();var o,a,s,_,h,u=l.zpp_inner.y+n*this.zpp_inner.diry;return null==Ri.poolVec2?o=new at:(o=Ri.poolVec2,Ri.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner?(null==mo.zpp_pool?a=new mo:(a=mo.zpp_pool,mo.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=p,a.y=u,o.zpp_inner=a,o.zpp_inner.outer=o):(null!=(s=o.zpp_inner)._validate&&s._validate(),o.zpp_inner.x==p&&(null!=(_=o.zpp_inner)._validate&&_._validate(),o.zpp_inner.y==u)||(o.zpp_inner.x=p,o.zpp_inner.y=u,null!=(h=o.zpp_inner)._invalidate&&h._invalidate(h))),o.zpp_inner.weak=t,o},W.prototype.copy=function(){var n=new W(this.zpp_inner.origin,this.zpp_inner.direction);return n.zpp_inner.maxdist=this.zpp_inner.maxdist,n},Object.defineProperty(W.prototype,"userData",{get:W.prototype.get_userData}),Object.defineProperty(W.prototype,"origin",{get:W.prototype.get_origin,set:W.prototype.set_origin}),Object.defineProperty(W.prototype,"direction",{get:W.prototype.get_direction,set:W.prototype.set_direction}),Object.defineProperty(W.prototype,"maxDistance",{get:W.prototype.get_maxDistance,set:W.prototype.set_maxDistance}),W.prototype.__class__=W;var Y=nape.geom.RayResult=function(){this.zpp_inner=null};Y.__name__=["nape","geom","RayResult"],Y.prototype.zpp_inner=null,Y.prototype.get_normal=function(){return this.zpp_inner.normal},Y.prototype.get_distance=function(){return this.zpp_inner.toiDistance},Y.prototype.get_inner=function(){return this.zpp_inner.inner},Y.prototype.get_shape=function(){return this.zpp_inner.shape},Y.prototype.dispose=function(){this.zpp_inner.free()},Y.prototype.toString=function(){return"{ shape: "+i.string(this.zpp_inner.shape)+" distance: "+this.zpp_inner.toiDistance+" ?inner: "+i.string(this.zpp_inner.inner)+" }"},Object.defineProperty(Y.prototype,"normal",{get:Y.prototype.get_normal}),Object.defineProperty(Y.prototype,"distance",{get:Y.prototype.get_distance}),Object.defineProperty(Y.prototype,"inner",{get:Y.prototype.get_inner}),Object.defineProperty(Y.prototype,"shape",{get:Y.prototype.get_shape}),Y.prototype.__class__=Y;var $n=nape.geom.RayResultIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};$n.__name__=["nape","geom","RayResultIterator"],$n.get=function(n){var t,e,i=null==$n.zpp_pool?(Ei.internal=!0,t=new $n,Ei.internal=!1,t):(e=$n.zpp_pool,$n.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},$n.prototype.zpp_inner=null,$n.prototype.zpp_i=null,$n.prototype.zpp_critical=null,$n.prototype.zpp_next=null,$n.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=$n.zpp_pool,($n.zpp_pool=this).zpp_inner=null,!1)},$n.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},$n.prototype.__class__=$n;var J=nape.geom.RayResultList=function(){this.zpp_inner=null,this.zpp_inner=new Ei,this.zpp_inner.outer=this};J.__name__=["nape","geom","RayResultList"],J.fromArray=function(n){for(var t=new J,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},J.prototype.zpp_inner=null,J.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},J.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n)},J.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},J.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},J.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)):this.zpp_inner.inner.add(n),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},J.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;return this.zpp_inner.reverse_flag?(t=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),t},J.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(t=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),t},J.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},J.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n),this.zpp_inner.invalidate()),t},J.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},J.prototype.empty=function(){return null==this.zpp_inner.inner.head},J.prototype.iterator=function(){return this.zpp_inner.valmod(),$n.get(this)},J.prototype.copy=function(n){null==n&&(n=!1);var t=new J;this.zpp_inner.valmod();for(var e=$n.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=$n.zpp_pool,($n.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},J.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=$n.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=$n.zpp_pool,($n.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},J.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=$n.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=$n.zpp_pool,($n.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},J.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=$n.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=$n.zpp_pool,($n.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=$n.zpp_pool,($n.zpp_pool=t).zpp_inner=null;break}}return this},J.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(J.prototype,"length",{get:J.prototype.get_length}),J.prototype.__class__=J;var at=nape.geom.Vec2=function(n,t){var e;null==t&&(t=0),null==n&&(n=0),this.zpp_pool=null,(this.zpp_inner=null)==mo.zpp_pool?e=new mo:(e=mo.zpp_pool,mo.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=t,this.zpp_inner=e,this.zpp_inner.outer=this};at.__name__=["nape","geom","Vec2"],at.weak=function(n,t){var e,i,p,l,r;return null==t&&(t=0),null==n&&(n=0),null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!0,e},at.get=function(n,t,e){var i,p,l,r,o;return null==e&&(e=!1),null==t&&(t=0),null==n&&(n=0),null==Ri.poolVec2?i=new at:(i=Ri.poolVec2,Ri.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner?(null==mo.zpp_pool?p=new mo:(p=mo.zpp_pool,mo.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t,i.zpp_inner=p,i.zpp_inner.outer=i):(null!=(l=i.zpp_inner)._validate&&l._validate(),i.zpp_inner.x==n&&(null!=(r=i.zpp_inner)._validate&&r._validate(),i.zpp_inner.y==t)||(i.zpp_inner.x=n,i.zpp_inner.y=t,null!=(o=i.zpp_inner)._invalidate&&o._invalidate(o))),i.zpp_inner.weak=e,i},at.fromPolar=function(n,t,e){null==e&&(e=!1);var i,p,l,r,o,a=n*Math.cos(t),s=n*Math.sin(t);return null==Ri.poolVec2?i=new at:(i=Ri.poolVec2,Ri.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner?(null==mo.zpp_pool?p=new mo:(p=mo.zpp_pool,mo.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=a,p.y=s,i.zpp_inner=p,i.zpp_inner.outer=i):(null!=(l=i.zpp_inner)._validate&&l._validate(),i.zpp_inner.x==a&&(null!=(r=i.zpp_inner)._validate&&r._validate(),i.zpp_inner.y==s)||(i.zpp_inner.x=a,i.zpp_inner.y=s,null!=(o=i.zpp_inner)._invalidate&&o._invalidate(o))),i.zpp_inner.weak=e,i},at.dsq=function(n,t){var e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l=n.zpp_inner.y,r=t.zpp_inner;null!=r._validate&&r._validate();var o=t.zpp_inner.x,a=t.zpp_inner;null!=a._validate&&a._validate();var s,_,h=0,u=0,x=(h=i-o)*h+(u=l-t.zpp_inner.y)*u;return n.zpp_inner.weak&&(s=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=mo.zpp_pool,mo.zpp_pool=s),t.zpp_inner.weak&&(_=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=mo.zpp_pool,mo.zpp_pool=_),x},at.distance=function(n,t){var e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l=n.zpp_inner.y,r=t.zpp_inner;null!=r._validate&&r._validate();var o=t.zpp_inner.x,a=t.zpp_inner;null!=a._validate&&a._validate();var s,_,h=i-o,u=l-t.zpp_inner.y,x=Math.sqrt(h*h+u*u);return n.zpp_inner.weak&&(s=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=mo.zpp_pool,mo.zpp_pool=s),t.zpp_inner.weak&&(_=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=mo.zpp_pool,mo.zpp_pool=_),x},at.prototype.zpp_inner=null,at.prototype.zpp_pool=null,at.prototype.dispose=function(){var n=this.zpp_inner;this.zpp_inner.outer=null,this.zpp_inner=null;this.zpp_pool=Ri.poolVec2,Ri.poolVec2=this,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=mo.zpp_pool,mo.zpp_pool=n},at.prototype.copy=function(n){null==n&&(n=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p,l,r,o,a,s=this.zpp_inner.y;return null==Ri.poolVec2?p=new at:(p=Ri.poolVec2,Ri.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==mo.zpp_pool?l=new mo:(l=mo.zpp_pool,mo.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=s,p.zpp_inner=l,p.zpp_inner.outer=p):(null!=(r=p.zpp_inner)._validate&&r._validate(),p.zpp_inner.x==e&&(null!=(o=p.zpp_inner)._validate&&o._validate(),p.zpp_inner.y==s)||(p.zpp_inner.x=e,p.zpp_inner.y=s,null!=(a=p.zpp_inner)._invalidate&&a._invalidate(a))),p.zpp_inner.weak=n,p},at.prototype.get_x=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},at.prototype.set_x=function(n){var t,e=this.zpp_inner;null!=e._validate&&e._validate(),this.zpp_inner.x!=n&&(this.zpp_inner.x=n,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(t));var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.x},at.prototype.get_y=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},at.prototype.set_y=function(n){var t,e=this.zpp_inner;null!=e._validate&&e._validate(),this.zpp_inner.y!=n&&(this.zpp_inner.y=n,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(t));var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.y},at.prototype.get_length=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();var i=t*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;return null!=r._validate&&r._validate(),Math.sqrt(i+l*this.zpp_inner.y)},at.prototype.set_length=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=this.zpp_inner;null!=o._validate&&o._validate();var a=n/Math.sqrt(p+r*this.zpp_inner.y),s=this,_=s.zpp_inner;null!=_._validate&&_._validate();var h,u=s.zpp_inner.x*a,x=s.zpp_inner;null!=x._validate&&x._validate(),s.zpp_inner.x!=u&&(s.zpp_inner.x=u,null!=(h=s.zpp_inner)._invalidate&&h._invalidate(h));var d=s.zpp_inner;null!=d._validate&&d._validate();var y=this,z=y.zpp_inner;null!=z._validate&&z._validate();var c,v=y.zpp_inner.y*a,m=y.zpp_inner;null!=m._validate&&m._validate(),y.zpp_inner.y!=v&&(y.zpp_inner.y=v,null!=(c=y.zpp_inner)._invalidate&&c._invalidate(c));var f=y.zpp_inner;null!=f._validate&&f._validate();var b=this.zpp_inner;null!=b._invalidate&&b._invalidate(b);var g=this.zpp_inner;null!=g._validate&&g._validate();var w=this.zpp_inner.x,M=this.zpp_inner;null!=M._validate&&M._validate();var C=w*this.zpp_inner.x,k=this.zpp_inner;null!=k._validate&&k._validate();var O=this.zpp_inner.y,P=this.zpp_inner;return null!=P._validate&&P._validate(),Math.sqrt(C+O*this.zpp_inner.y)},at.prototype.lsq=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();var i=t*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;return null!=r._validate&&r._validate(),i+l*this.zpp_inner.y},at.prototype.set=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p,l,r=n.zpp_inner.y,o=this.zpp_inner;null!=o._validate&&o._validate(),this.zpp_inner.x==e&&(null!=(p=this.zpp_inner)._validate&&p._validate(),this.zpp_inner.y==r)||(this.zpp_inner.x=e,this.zpp_inner.y=r,null!=(l=this.zpp_inner)._invalidate&&l._invalidate(l));var a;return n.zpp_inner.weak&&(a=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=mo.zpp_pool,mo.zpp_pool=a),this},at.prototype.setxy=function(n,t){var e,i,p=this.zpp_inner;return null!=p._validate&&p._validate(),this.zpp_inner.x==n&&(null!=(e=this.zpp_inner)._validate&&e._validate(),this.zpp_inner.y==t)||(this.zpp_inner.x=n,this.zpp_inner.y=t,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(i)),this},at.prototype.get_angle=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t,e=this.zpp_inner.x,i=this.zpp_inner;if(null!=i._validate&&i._validate(),e==this.zpp_inner.y&&(null!=(t=this.zpp_inner)._validate&&t._validate(),0==this.zpp_inner.x))return 0;var p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;return null!=r._validate&&r._validate(),Math.atan2(l,this.zpp_inner.x)},at.prototype.set_angle=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=this.zpp_inner;null!=o._validate&&o._validate();var a,s,_=Math.sqrt(p+r*this.zpp_inner.y),h=_*Math.cos(n),u=_*Math.sin(n),x=this.zpp_inner;null!=x._validate&&x._validate(),this.zpp_inner.x==h&&(null!=(a=this.zpp_inner)._validate&&a._validate(),this.zpp_inner.y==u)||(this.zpp_inner.x=h,this.zpp_inner.y=u,null!=(s=this.zpp_inner)._invalidate&&s._invalidate(s));var d=this.zpp_inner;null!=d._validate&&d._validate();var y,z=this.zpp_inner.x,c=this.zpp_inner;if(null!=c._validate&&c._validate(),z==this.zpp_inner.y&&(null!=(y=this.zpp_inner)._validate&&y._validate(),0==this.zpp_inner.x))return 0;var v=this.zpp_inner;null!=v._validate&&v._validate();var m=this.zpp_inner.y,f=this.zpp_inner;return null!=f._validate&&f._validate(),Math.atan2(m,this.zpp_inner.x)},at.prototype.rotate=function(n){var t,e,i,p;return n%(2*Math.PI)!=0&&(t=Math.sin(n),i=(e=Math.cos(n))*this.zpp_inner.x-t*this.zpp_inner.y,this.zpp_inner.y=this.zpp_inner.x*t+this.zpp_inner.y*e,this.zpp_inner.x=i,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(p)),this},at.prototype.reflect=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a,s,_=this.zpp_inner.y;null==Ri.poolVec2?l=new at:(l=Ri.poolVec2,Ri.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner?(null==mo.zpp_pool?r=new mo:(r=mo.zpp_pool,mo.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=_,l.zpp_inner=r,l.zpp_inner.outer=l):(null!=(o=l.zpp_inner)._validate&&o._validate(),l.zpp_inner.x==i&&(null!=(a=l.zpp_inner)._validate&&a._validate(),l.zpp_inner.y==_)||(l.zpp_inner.x=i,l.zpp_inner.y=_,null!=(s=l.zpp_inner)._invalidate&&s._invalidate(s))),l.zpp_inner.weak=!0;var h,u=l.normalise(),x=n.sub(u.muleq(2*u.dot(n)),t);return n.zpp_inner.weak&&(h=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=mo.zpp_pool,mo.zpp_pool=h),x},at.prototype.normalise=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();var i=t*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;null!=r._validate&&r._validate();var o=1/Math.sqrt(i+l*this.zpp_inner.y),a=this,s=a.zpp_inner;null!=s._validate&&s._validate();var _,h=a.zpp_inner.x*o,u=a.zpp_inner;null!=u._validate&&u._validate(),a.zpp_inner.x!=h&&(a.zpp_inner.x=h,null!=(_=a.zpp_inner)._invalidate&&_._invalidate(_));var x=a.zpp_inner;null!=x._validate&&x._validate();var d=this,y=d.zpp_inner;null!=y._validate&&y._validate();var z,c=d.zpp_inner.y*o,v=d.zpp_inner;null!=v._validate&&v._validate(),d.zpp_inner.y!=c&&(d.zpp_inner.y=c,null!=(z=d.zpp_inner)._invalidate&&z._invalidate(z));var m=d.zpp_inner;null!=m._validate&&m._validate();var f=this.zpp_inner;return null!=f._invalidate&&f._invalidate(f),this},at.prototype.unit=function(n){null==n&&(n=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=this.zpp_inner;null!=o._validate&&o._validate();var a=1/Math.sqrt(p+r*this.zpp_inner.y),s=this.zpp_inner;null!=s._validate&&s._validate();var _=this.zpp_inner.x*a,h=this.zpp_inner;null!=h._validate&&h._validate();var u,x,d,y,z,c=this.zpp_inner.y*a;return null==Ri.poolVec2?u=new at:(u=Ri.poolVec2,Ri.poolVec2=u.zpp_pool,u.zpp_pool=null),null==u.zpp_inner?(null==mo.zpp_pool?x=new mo:(x=mo.zpp_pool,mo.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=_,x.y=c,u.zpp_inner=x,u.zpp_inner.outer=u):(null!=(d=u.zpp_inner)._validate&&d._validate(),u.zpp_inner.x==_&&(null!=(y=u.zpp_inner)._validate&&y._validate(),u.zpp_inner.y==c)||(u.zpp_inner.x=_,u.zpp_inner.y=c,null!=(z=u.zpp_inner)._invalidate&&z._invalidate(z))),u.zpp_inner.weak=n,u},at.prototype.add=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l=i+n.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.y,a=n.zpp_inner;null!=a._validate&&a._validate();var s,_,h,u,x,d=o+n.zpp_inner.y;null==Ri.poolVec2?s=new at:(s=Ri.poolVec2,Ri.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner?(null==mo.zpp_pool?_=new mo:(_=mo.zpp_pool,mo.zpp_pool=_.next,_.next=null),_.weak=!1,_._immutable=!1,_.x=l,_.y=d,s.zpp_inner=_,s.zpp_inner.outer=s):(null!=(h=s.zpp_inner)._validate&&h._validate(),s.zpp_inner.x==l&&(null!=(u=s.zpp_inner)._validate&&u._validate(),s.zpp_inner.y==d)||(s.zpp_inner.x=l,s.zpp_inner.y=d,null!=(x=s.zpp_inner)._invalidate&&x._invalidate(x))),s.zpp_inner.weak=t;var y,z=s;return n.zpp_inner.weak&&(y=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=mo.zpp_pool,mo.zpp_pool=y),z},at.prototype.addMul=function(n,t,e){null==e&&(e=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var p=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=p+n.zpp_inner.x*t,o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate();var _,h,u,x,d,y=a+n.zpp_inner.y*t;null==Ri.poolVec2?_=new at:(_=Ri.poolVec2,Ri.poolVec2=_.zpp_pool,_.zpp_pool=null),null==_.zpp_inner?(null==mo.zpp_pool?h=new mo:(h=mo.zpp_pool,mo.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=r,h.y=y,_.zpp_inner=h,_.zpp_inner.outer=_):(null!=(u=_.zpp_inner)._validate&&u._validate(),_.zpp_inner.x==r&&(null!=(x=_.zpp_inner)._validate&&x._validate(),_.zpp_inner.y==y)||(_.zpp_inner.x=r,_.zpp_inner.y=y,null!=(d=_.zpp_inner)._invalidate&&d._invalidate(d))),_.zpp_inner.weak=e;var z,c=_;return n.zpp_inner.weak&&(z=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=mo.zpp_pool,mo.zpp_pool=z),c},at.prototype.sub=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l=i-n.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.y,a=n.zpp_inner;null!=a._validate&&a._validate();var s,_,h,u,x,d=o-n.zpp_inner.y;null==Ri.poolVec2?s=new at:(s=Ri.poolVec2,Ri.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner?(null==mo.zpp_pool?_=new mo:(_=mo.zpp_pool,mo.zpp_pool=_.next,_.next=null),_.weak=!1,_._immutable=!1,_.x=l,_.y=d,s.zpp_inner=_,s.zpp_inner.outer=s):(null!=(h=s.zpp_inner)._validate&&h._validate(),s.zpp_inner.x==l&&(null!=(u=s.zpp_inner)._validate&&u._validate(),s.zpp_inner.y==d)||(s.zpp_inner.x=l,s.zpp_inner.y=d,null!=(x=s.zpp_inner)._invalidate&&x._invalidate(x))),s.zpp_inner.weak=t;var y,z=s;return n.zpp_inner.weak&&(y=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=mo.zpp_pool,mo.zpp_pool=y),z},at.prototype.mul=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x*n,p=this.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a,s,_=this.zpp_inner.y*n;return null==Ri.poolVec2?l=new at:(l=Ri.poolVec2,Ri.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner?(null==mo.zpp_pool?r=new mo:(r=mo.zpp_pool,mo.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=_,l.zpp_inner=r,l.zpp_inner.outer=l):(null!=(o=l.zpp_inner)._validate&&o._validate(),l.zpp_inner.x==i&&(null!=(a=l.zpp_inner)._validate&&a._validate(),l.zpp_inner.y==_)||(l.zpp_inner.x=i,l.zpp_inner.y=_,null!=(s=l.zpp_inner)._invalidate&&s._invalidate(s))),l.zpp_inner.weak=t,l},at.prototype.addeq=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=e+n.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=n.zpp_inner;null!=o._validate&&o._validate();var a,s,_,h=r+n.zpp_inner.y,u=this.zpp_inner;return null!=u._validate&&u._validate(),this.zpp_inner.x==p&&(null!=(a=this.zpp_inner)._validate&&a._validate(),this.zpp_inner.y==h)||(this.zpp_inner.x=p,this.zpp_inner.y=h,null!=(s=this.zpp_inner)._invalidate&&s._invalidate(s)),n.zpp_inner.weak&&(_=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=mo.zpp_pool,mo.zpp_pool=_),this},at.prototype.subeq=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=e-n.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=n.zpp_inner;null!=o._validate&&o._validate();var a,s,_,h=r-n.zpp_inner.y,u=this.zpp_inner;return null!=u._validate&&u._validate(),this.zpp_inner.x==p&&(null!=(a=this.zpp_inner)._validate&&a._validate(),this.zpp_inner.y==h)||(this.zpp_inner.x=p,this.zpp_inner.y=h,null!=(s=this.zpp_inner)._invalidate&&s._invalidate(s)),n.zpp_inner.weak&&(_=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=mo.zpp_pool,mo.zpp_pool=_),this},at.prototype.muleq=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x*n,i=this.zpp_inner;null!=i._validate&&i._validate();var p,l,r=this.zpp_inner.y*n,o=this.zpp_inner;return null!=o._validate&&o._validate(),this.zpp_inner.x==e&&(null!=(p=this.zpp_inner)._validate&&p._validate(),this.zpp_inner.y==r)||(this.zpp_inner.x=e,this.zpp_inner.y=r,null!=(l=this.zpp_inner)._invalidate&&l._invalidate(l)),this},at.prototype.dot=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=e*n.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=n.zpp_inner;null!=o._validate&&o._validate();var a,s=p+r*n.zpp_inner.y;return n.zpp_inner.weak&&(a=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=mo.zpp_pool,mo.zpp_pool=a),s},at.prototype.cross=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();var p=e*this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,o=this.zpp_inner;null!=o._validate&&o._validate();var a,s=p-r*this.zpp_inner.y;return n.zpp_inner.weak&&(a=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=mo.zpp_pool,mo.zpp_pool=a),s},at.prototype.perp=function(n){null==n&&(n=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var e=-this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();var p,l,r,o,a,s=this.zpp_inner.x;return null==Ri.poolVec2?p=new at:(p=Ri.poolVec2,Ri.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==mo.zpp_pool?l=new mo:(l=mo.zpp_pool,mo.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=s,p.zpp_inner=l,p.zpp_inner.outer=p):(null!=(r=p.zpp_inner)._validate&&r._validate(),p.zpp_inner.x==e&&(null!=(o=p.zpp_inner)._validate&&o._validate(),p.zpp_inner.y==s)||(p.zpp_inner.x=e,p.zpp_inner.y=s,null!=(a=p.zpp_inner)._invalidate&&a._invalidate(a))),p.zpp_inner.weak=n,p},at.prototype.toString=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.toString()},Object.defineProperty(at.prototype,"x",{get:at.prototype.get_x,set:at.prototype.set_x}),Object.defineProperty(at.prototype,"y",{get:at.prototype.get_y,set:at.prototype.set_y}),Object.defineProperty(at.prototype,"length",{get:at.prototype.get_length,set:at.prototype.set_length}),Object.defineProperty(at.prototype,"angle",{get:at.prototype.get_angle,set:at.prototype.set_angle}),at.prototype.__class__=at;var Qn=nape.geom.Vec2Iterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Qn.__name__=["nape","geom","Vec2Iterator"],Qn.get=function(n){var t,e,i=null==Qn.zpp_pool?(Ai.internal=!0,t=new Qn,Ai.internal=!1,t):(e=Qn.zpp_pool,Qn.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},Qn.prototype.zpp_inner=null,Qn.prototype.zpp_i=null,Qn.prototype.zpp_critical=null,Qn.prototype.zpp_next=null,Qn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=this).zpp_inner=null,!1)},Qn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Qn.prototype.__class__=Qn;var cn=nape.geom.Vec2List=function(){this.zpp_inner=null,this.zpp_inner=new Ai,this.zpp_inner.outer=this};cn.__name__=["nape","geom","Vec2List"],cn.fromArray=function(n){for(var t=new cn,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},cn.prototype.zpp_inner=null,cn.prototype.get_length=function(){return this.zpp_gl()},cn.prototype.zpp_gl=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},cn.prototype.zpp_vm=function(){this.zpp_inner.valmod()},cn.prototype.has=function(n){return this.zpp_vm(),this.zpp_inner.inner.has(n.zpp_inner)},cn.prototype.at=function(n){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;var t,e=this.zpp_inner.at_ite.elt;return null==e.outer&&(e.outer=new at,null!=(t=e.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=mo.zpp_pool,mo.zpp_pool=t,e.outer.zpp_inner=e),e.outer},cn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},cn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},cn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e,i,p,l,r=null;return this.zpp_inner.reverse_flag?(null==(r=this.zpp_inner.inner.head.elt).outer&&(r.outer=new at,null!=(n=r.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=mo.zpp_pool,mo.zpp_pool=n,r.outer.zpp_inner=r),t=r.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),null==(r=null==(e=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head.elt:e.next.elt).outer&&(r.outer=new at,null!=(i=r.outer.zpp_inner).outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=mo.zpp_pool,mo.zpp_pool=i,r.outer.zpp_inner=r),p=r.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(p),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)),this.zpp_inner.invalidate(),null==r.outer&&(r.outer=new at,null!=(l=r.outer.zpp_inner).outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=mo.zpp_pool,mo.zpp_pool=l,r.outer.zpp_inner=r),r.outer},cn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e,i,p,l,r=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),null==(r=null==(n=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head.elt:n.next.elt).outer&&(r.outer=new at,null!=(t=r.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=mo.zpp_pool,mo.zpp_pool=t,r.outer.zpp_inner=r),e=r.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(null==(r=this.zpp_inner.inner.head.elt).outer&&(r.outer=new at,null!=(i=r.outer.zpp_inner).outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=mo.zpp_pool,mo.zpp_pool=i,r.outer.zpp_inner=r),p=r.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(p),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),null==r.outer&&(r.outer=new at,null!=(l=r.outer.zpp_inner).outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=mo.zpp_pool,mo.zpp_pool=l,r.outer.zpp_inner=r),r.outer},cn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},cn.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_vm(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},cn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},cn.prototype.empty=function(){return 0==this.zpp_gl()},cn.prototype.iterator=function(){return this.zpp_vm(),Qn.get(this)},cn.prototype.copy=function(n){null==n&&(n=!1);for(var t=new cn,e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var p,l,r,o,a,s,_,h,u,x=e.zpp_inner.at(e.zpp_i++),d=n?(null!=(p=x.zpp_inner)._validate&&p._validate(),l=x.zpp_inner.x,null!=(r=x.zpp_inner)._validate&&r._validate(),o=x.zpp_inner.y,null==Ri.poolVec2?a=new at:(a=Ri.poolVec2,Ri.poolVec2=a.zpp_pool,a.zpp_pool=null),null==a.zpp_inner?(null==mo.zpp_pool?s=new mo:(s=mo.zpp_pool,mo.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=l,s.y=o,a.zpp_inner=s,a.zpp_inner.outer=a):(null!=(_=a.zpp_inner)._validate&&_._validate(),a.zpp_inner.x==l&&(null!=(h=a.zpp_inner)._validate&&h._validate(),a.zpp_inner.y==o)||(a.zpp_inner.x=l,a.zpp_inner.y=o,null!=(u=a.zpp_inner)._invalidate&&u._invalidate(u))),a.zpp_inner.weak=!1,a):x;t.push(d)}return t},cn.prototype.merge=function(n){for(var t=n.iterator();;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var i=t.zpp_inner.at(t.zpp_i++);this.has(i)||this.add(i)}},cn.prototype.toString=function(){for(var n="[",t=!0,e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==p?"NULL":p.toString(),t=!1}return n+"]"},cn.prototype.foreach=function(n){for(var t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=t).zpp_inner=null;break}}return this},cn.prototype.filter=function(n){for(var t=0;t<this.zpp_gl();){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(cn.prototype,"length",{get:cn.prototype.get_length}),cn.prototype.__class__=cn;var X=nape.geom.Vec3=function(n,t,e){null==e&&(e=0),null==t&&(t=0),null==n&&(n=0),this.zpp_pool=null,this.zpp_inner=null,this.zpp_inner=new Kt,(this.zpp_inner.outer=this).zpp_inner.x=n;var i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.y=t;var p=this.zpp_inner;null!=p._validate&&p._validate(),this.zpp_inner.z=e;var l=this.zpp_inner;null!=l._validate&&l._validate()};X.__name__=["nape","geom","Vec3"],X.get=function(n,t,e){var i;return null==e&&(e=0),null==t&&(t=0),null==n&&(n=0),null==Ri.poolVec3?i=new X:(i=Ri.poolVec3,Ri.poolVec3=i.zpp_pool,i.zpp_pool=null),i.setxyz(n,t,e),i.zpp_inner.immutable=!1,i.zpp_inner._validate=null,i},X.prototype.zpp_inner=null,X.prototype.zpp_pool=null,X.prototype.get_x=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},X.prototype.set_x=function(n){this.zpp_inner.x=n;var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.x},X.prototype.get_y=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},X.prototype.set_y=function(n){this.zpp_inner.y=n;var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.y},X.prototype.get_z=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.z},X.prototype.set_z=function(n){this.zpp_inner.z=n;var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.z},X.prototype.dispose=function(){this.zpp_pool=Ri.poolVec3,Ri.poolVec3=this},X.prototype.get_length=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();var i=t*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;null!=r._validate&&r._validate();var o=i+l*this.zpp_inner.y,a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.z,_=this.zpp_inner;return null!=_._validate&&_._validate(),Math.sqrt(o+s*this.zpp_inner.z)},X.prototype.set_length=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=this.zpp_inner;null!=o._validate&&o._validate();var a=p+r*this.zpp_inner.y,s=this.zpp_inner;null!=s._validate&&s._validate();var _=this.zpp_inner.z,h=this.zpp_inner;null!=h._validate&&h._validate();var u=n/Math.sqrt(a+_*this.zpp_inner.z),x=this.zpp_inner;null!=x._validate&&x._validate(),this.zpp_inner.x=this.zpp_inner.x*u;var d=this.zpp_inner;null!=d._validate&&d._validate();var y=this.zpp_inner;null!=y._validate&&y._validate(),this.zpp_inner.y=this.zpp_inner.y*u;var z=this.zpp_inner;null!=z._validate&&z._validate();var c=this.zpp_inner;null!=c._validate&&c._validate(),this.zpp_inner.z=this.zpp_inner.z*u;var v=this.zpp_inner;null!=v._validate&&v._validate();var m=this.zpp_inner;null!=m._validate&&m._validate();var f=this.zpp_inner.x,b=this.zpp_inner;null!=b._validate&&b._validate();var g=f*this.zpp_inner.x,w=this.zpp_inner;null!=w._validate&&w._validate();var M=this.zpp_inner.y,C=this.zpp_inner;null!=C._validate&&C._validate();var k=g+M*this.zpp_inner.y,O=this.zpp_inner;null!=O._validate&&O._validate();var P=this.zpp_inner.z,S=this.zpp_inner;return null!=S._validate&&S._validate(),Math.sqrt(k+P*this.zpp_inner.z)},X.prototype.lsq=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();var i=t*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;null!=r._validate&&r._validate();var o=i+l*this.zpp_inner.y,a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.z,_=this.zpp_inner;return null!=_._validate&&_._validate(),o+s*this.zpp_inner.z},X.prototype.set=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.y,l=n.zpp_inner;return null!=l._validate&&l._validate(),this.setxyz(e,p,n.zpp_inner.z)},X.prototype.setxyz=function(n,t,e){this.zpp_inner.x=n;var i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.y=t;var p=this.zpp_inner;null!=p._validate&&p._validate(),this.zpp_inner.z=e;var l=this.zpp_inner;return null!=l._validate&&l._validate(),this},X.prototype.xy=function(n){null==n&&(n=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p,l,r,o,a,s=this.zpp_inner.y;return null==Ri.poolVec2?p=new at:(p=Ri.poolVec2,Ri.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==mo.zpp_pool?l=new mo:(l=mo.zpp_pool,mo.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=s,p.zpp_inner=l,p.zpp_inner.outer=p):(null!=(r=p.zpp_inner)._validate&&r._validate(),p.zpp_inner.x==e&&(null!=(o=p.zpp_inner)._validate&&o._validate(),p.zpp_inner.y==s)||(p.zpp_inner.x=e,p.zpp_inner.y=s,null!=(a=p.zpp_inner)._invalidate&&a._invalidate(a))),p.zpp_inner.weak=n,p},X.prototype.toString=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t="{ x: "+this.zpp_inner.x+" y: ",e=this.zpp_inner;null!=e._validate&&e._validate();var i=t+this.zpp_inner.y+" z: ",p=this.zpp_inner;return null!=p._validate&&p._validate(),i+this.zpp_inner.z+" }"},Object.defineProperty(X.prototype,"x",{get:X.prototype.get_x,set:X.prototype.set_x}),Object.defineProperty(X.prototype,"y",{get:X.prototype.get_y,set:X.prototype.set_y}),Object.defineProperty(X.prototype,"z",{get:X.prototype.get_z,set:X.prototype.set_z}),Object.defineProperty(X.prototype,"length",{get:X.prototype.get_length,set:X.prototype.set_length}),X.prototype.__class__=X;var $=nape.geom.Winding=function(){};$.__name__=["nape","geom","Winding"],$.UNDEFINED=null,$.get_UNDEFINED=function(){return null==Ll.Winding_UNDEFINED&&(Ll.internal=!0,Ll.Winding_UNDEFINED=new $,Ll.internal=!1),Ll.Winding_UNDEFINED},$.CLOCKWISE=null,$.get_CLOCKWISE=function(){return null==Ll.Winding_CLOCKWISE&&(Ll.internal=!0,Ll.Winding_CLOCKWISE=new $,Ll.internal=!1),Ll.Winding_CLOCKWISE},$.ANTICLOCKWISE=null,$.get_ANTICLOCKWISE=function(){return null==Ll.Winding_ANTICLOCKWISE&&(Ll.internal=!0,Ll.Winding_ANTICLOCKWISE=new $,Ll.internal=!1),Ll.Winding_ANTICLOCKWISE},$.prototype.toString=function(){return null==Ll.Winding_UNDEFINED&&(Ll.internal=!0,Ll.Winding_UNDEFINED=new $,Ll.internal=!1),this==Ll.Winding_UNDEFINED?"UNDEFINED":(null==Ll.Winding_CLOCKWISE&&(Ll.internal=!0,Ll.Winding_CLOCKWISE=new $,Ll.internal=!1),this==Ll.Winding_CLOCKWISE?"CLOCKWISE":(null==Ll.Winding_ANTICLOCKWISE&&(Ll.internal=!0,Ll.Winding_ANTICLOCKWISE=new $,Ll.internal=!1),this==Ll.Winding_ANTICLOCKWISE?"ANTICLOCKWISE":""))},Object.defineProperty($,"UNDEFINED",{get:$.get_UNDEFINED}),Object.defineProperty($,"CLOCKWISE",{get:$.get_CLOCKWISE}),Object.defineProperty($,"ANTICLOCKWISE",{get:$.get_ANTICLOCKWISE}),$.prototype.__class__=$;var nn=nape.phys.Interactor=function(){this.zpp_inner_i=null};nn.__name__=["nape","phys","Interactor"],nn.prototype.zpp_inner_i=null,nn.prototype.get_id=function(){return this.zpp_inner_i.id},nn.prototype.get_userData=function(){return null==this.zpp_inner_i.userData&&(this.zpp_inner_i.userData={}),this.zpp_inner_i.userData},nn.prototype.isShape=function(){return null!=this.zpp_inner_i.ishape},nn.prototype.isBody=function(){return null!=this.zpp_inner_i.ibody},nn.prototype.isCompound=function(){return null!=this.zpp_inner_i.icompound},nn.prototype.get_castShape=function(){return null!=this.zpp_inner_i.ishape?this.zpp_inner_i.ishape.outer:null},nn.prototype.get_castBody=function(){return null!=this.zpp_inner_i.ibody?this.zpp_inner_i.ibody.outer:null},nn.prototype.get_castCompound=function(){return null!=this.zpp_inner_i.icompound?this.zpp_inner_i.icompound.outer:null},nn.prototype.get_group=function(){return null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},nn.prototype.set_group=function(n){return this.zpp_inner_i.immutable_midstep("Interactor::group"),this.zpp_inner_i.setGroup(null==n?null:n.zpp_inner),null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},nn.prototype.get_cbTypes=function(){return null==this.zpp_inner_i.wrap_cbTypes&&this.zpp_inner_i.setupcbTypes(),this.zpp_inner_i.wrap_cbTypes},nn.prototype.toString=function(){return""},Object.defineProperty(nn.prototype,"id",{get:nn.prototype.get_id}),Object.defineProperty(nn.prototype,"userData",{get:nn.prototype.get_userData}),Object.defineProperty(nn.prototype,"castShape",{get:nn.prototype.get_castShape}),Object.defineProperty(nn.prototype,"castBody",{get:nn.prototype.get_castBody}),Object.defineProperty(nn.prototype,"castCompound",{get:nn.prototype.get_castCompound}),Object.defineProperty(nn.prototype,"group",{get:nn.prototype.get_group,set:nn.prototype.set_group}),Object.defineProperty(nn.prototype,"cbTypes",{get:nn.prototype.get_cbTypes}),nn.prototype.__class__=nn;var ln=nape.phys.Body=function(n,t){var e,i,p,l,r;this.debugDraw=!0,this.zpp_inner=null,nn.call(this),this.zpp_inner=new Yt,((this.zpp_inner.outer=this).zpp_inner.outer_i=this).zpp_inner_i=this.zpp_inner,null!=t?(null!=(e=t.zpp_inner)._validate&&e._validate(),this.zpp_inner.posx=t.zpp_inner.x,null!=(i=t.zpp_inner)._validate&&i._validate(),this.zpp_inner.posy=t.zpp_inner.y):(this.zpp_inner.posx=0,this.zpp_inner.posy=0),p=null==n?(null==Ll.BodyType_DYNAMIC&&(Ll.internal=!0,Ll.BodyType_DYNAMIC=new rn,Ll.internal=!1),Ll.BodyType_DYNAMIC):n,this.zpp_inner.immutable_midstep("Body::type"),Yt.types[this.zpp_inner.type]!=p&&(null==Ll.BodyType_DYNAMIC&&(Ll.internal=!0,Ll.BodyType_DYNAMIC=new rn,Ll.internal=!1),1==(l=p==Ll.BodyType_DYNAMIC?2:(null==Ll.BodyType_KINEMATIC&&(Ll.internal=!0,Ll.BodyType_KINEMATIC=new rn,Ll.internal=!1),p==Ll.BodyType_KINEMATIC?3:1))&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,l):this.zpp_inner.type=l),null!=t&&t.zpp_inner.weak&&(r=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=mo.zpp_pool,mo.zpp_pool=r),this.zpp_inner_i.insert_cbtype(Ln.ANY_BODY.zpp_inner)};ln.__name__=["nape","phys","Body"],ln.__super__=nn,ln.prototype=Object.create(nn.prototype),ln.prototype.zpp_inner=null,ln.prototype.debugDraw=null,ln.prototype.get_type=function(){return Yt.types[this.zpp_inner.type]},ln.prototype.set_type=function(n){var t;return this.zpp_inner.immutable_midstep("Body::type"),Yt.types[this.zpp_inner.type]!=n&&(null==Ll.BodyType_DYNAMIC&&(Ll.internal=!0,Ll.BodyType_DYNAMIC=new rn,Ll.internal=!1),1==(t=n==Ll.BodyType_DYNAMIC?2:(null==Ll.BodyType_KINEMATIC&&(Ll.internal=!0,Ll.BodyType_KINEMATIC=new rn,Ll.internal=!1),n==Ll.BodyType_KINEMATIC?3:1))&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,t):this.zpp_inner.type=t),Yt.types[this.zpp_inner.type]},ln.prototype.get_isBullet=function(){return this.zpp_inner.bulletEnabled},ln.prototype.set_isBullet=function(n){return this.zpp_inner.bulletEnabled=n,this.zpp_inner.bulletEnabled},ln.prototype.get_disableCCD=function(){return this.zpp_inner.disableCCD},ln.prototype.set_disableCCD=function(n){return this.zpp_inner.disableCCD=n,this.zpp_inner.disableCCD},ln.prototype.integrate=function(n){if(this.zpp_inner.immutable_midstep("Body::space"),0==n)return this;var t=this.zpp_inner;t.sweepTime=0,t.sweep_angvel=t.angvel;var e,i,p,l,r,o=n-t.sweepTime;0!=o&&(t.sweepTime=n,t.posx+=t.velx*o,t.posy+=t.vely*o,0!=t.angvel&&(e=t.sweep_angvel*o,t.rot+=e,1e-4<e*e?(t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)):(l=1-(i=e*e)*i/8,r=((p=1-.5*i)*t.axisx+e*t.axisy)*l,t.axisy=(p*t.axisy-e*t.axisx)*l,t.axisx=r)));for(var a=t.shapes.head;null!=a;){var s=a.elt;1==s.type&&(s.polygon.invalidate_gverts(),s.polygon.invalidate_gaxi()),s.invalidate_worldCOM(),a=a.next}t.zip_worldCOM=!0,t.zip_axis=!0;for(var _=t.shapes.head;null!=_;){var h=_.elt;1==h.type&&(h.polygon.invalidate_gverts(),h.polygon.invalidate_gaxi()),h.invalidate_worldCOM(),_=_.next}return t.zip_worldCOM=!0,t.sweepTime=0,this},ln.prototype.isStatic=function(){return 1==this.zpp_inner.type},ln.prototype.isDynamic=function(){return 2==this.zpp_inner.type},ln.prototype.isKinematic=function(){return 3==this.zpp_inner.type},ln.prototype.get_shapes=function(){return this.zpp_inner.wrap_shapes},ln.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},ln.prototype.set_compound=function(n){var t;return(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(this),null!=n&&((t=n.zpp_inner.wrap_bodies).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},ln.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},ln.prototype.set_space=function(n){var t;return this.zpp_inner.immutable_midstep("Body::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.component.woken=!1),null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(this),null!=n&&((t=n.zpp_inner.wrap_bodies).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},ln.prototype.get_arbiters=function(){return null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Vi.get(this.zpp_inner.arbiters,!0)),this.zpp_inner.wrap_arbiters},ln.prototype.get_isSleeping=function(){return this.zpp_inner.component.sleeping},ln.prototype.get_constraints=function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=ci.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},ln.prototype.copy=function(){return this.zpp_inner.copy()},ln.prototype.get_position=function(){return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},ln.prototype.set_position=function(n){null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var t=this.zpp_inner.wrap_pos,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},ln.prototype.get_velocity=function(){return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},ln.prototype.set_velocity=function(n){null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var t=this.zpp_inner.wrap_vel,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},ln.prototype.setVelocityFromTarget=function(n,t,e){var i=1/e;null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var p=this.zpp_inner.wrap_vel;null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var l=n.sub(this.zpp_inner.wrap_pos,!0).muleq(i),r=l.zpp_inner;null!=r._validate&&r._validate();var o=l.zpp_inner.x,a=l.zpp_inner;null!=a._validate&&a._validate();var s,_,h,u=l.zpp_inner.y,x=p.zpp_inner;null!=x._validate&&x._validate(),p.zpp_inner.x==o&&(null!=(s=p.zpp_inner)._validate&&s._validate(),p.zpp_inner.y==u)||(p.zpp_inner.x=o,p.zpp_inner.y=u,null!=(_=p.zpp_inner)._invalidate&&_._invalidate(_)),l.zpp_inner.weak&&(h=l.zpp_inner,l.zpp_inner.outer=null,l.zpp_inner=null,l.zpp_pool=Ri.poolVec2,Ri.poolVec2=l,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=mo.zpp_pool,mo.zpp_pool=h);var d,y=(t-this.zpp_inner.rot)*i;return this.zpp_inner.angvel!=y&&(this.zpp_inner.angvel=y,this.zpp_inner.wake()),n.zpp_inner.weak&&(d=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=mo.zpp_pool,mo.zpp_pool=d),this},ln.prototype.get_kinematicVel=function(){return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},ln.prototype.set_kinematicVel=function(n){null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel();var t=this.zpp_inner.wrap_kinvel,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},ln.prototype.get_surfaceVel=function(){return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},ln.prototype.set_surfaceVel=function(n){null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel();var t=this.zpp_inner.wrap_svel,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},ln.prototype.get_force=function(){return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},ln.prototype.set_force=function(n){null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce();var t=this.zpp_inner.wrap_force,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},ln.prototype.get_constraintVelocity=function(){return null==this.zpp_inner.wrapcvel&&this.zpp_inner.setup_cvel(),this.zpp_inner.wrapcvel},ln.prototype.get_rotation=function(){return this.zpp_inner.rot},ln.prototype.set_rotation=function(n){if(this.zpp_inner.immutable_midstep("Body::rotation"),this.zpp_inner.rot!=n){this.zpp_inner.rot=n;var t=this.zpp_inner;t.zip_axis=!0;for(var e=t.shapes.head;null!=e;){var i=e.elt;1==i.type&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),e=e.next}t.zip_worldCOM=!0,this.zpp_inner.wake()}return this.zpp_inner.rot},ln.prototype.get_angularVel=function(){return this.zpp_inner.angvel},ln.prototype.set_angularVel=function(n){return this.zpp_inner.angvel!=n&&(this.zpp_inner.angvel=n,this.zpp_inner.wake()),this.zpp_inner.angvel},ln.prototype.get_kinAngVel=function(){return this.zpp_inner.kinangvel},ln.prototype.set_kinAngVel=function(n){return this.zpp_inner.kinangvel!=n&&(this.zpp_inner.kinangvel=n,this.zpp_inner.wake()),this.zpp_inner.kinangvel},ln.prototype.get_torque=function(){return this.zpp_inner.torque},ln.prototype.set_torque=function(n){return this.zpp_inner.torque!=n&&(this.zpp_inner.torque=n,this.zpp_inner.wake()),this.zpp_inner.torque},ln.prototype.get_bounds=function(){return this.zpp_inner.aabb.wrapper()},ln.prototype.get_allowMovement=function(){return!this.zpp_inner.nomove},ln.prototype.set_allowMovement=function(n){return this.zpp_inner.immutable_midstep("Body::"+(null==n?"null":""+n)),!this.zpp_inner.nomove!=n&&(this.zpp_inner.nomove=!n,this.zpp_inner.invalidate_mass()),!this.zpp_inner.nomove},ln.prototype.get_allowRotation=function(){return!this.zpp_inner.norotate},ln.prototype.set_allowRotation=function(n){return this.zpp_inner.immutable_midstep("Body::"+(null==n?"null":""+n)),!this.zpp_inner.norotate!=n&&(this.zpp_inner.norotate=!n,this.zpp_inner.invalidate_inertia()),!this.zpp_inner.norotate},ln.prototype.get_massMode=function(){null==Ll.MassMode_DEFAULT&&(Ll.internal=!0,Ll.MassMode_DEFAULT=new un,Ll.internal=!1);var n=Ll.MassMode_DEFAULT;return null==Ll.MassMode_FIXED&&(Ll.internal=!0,Ll.MassMode_FIXED=new un,Ll.internal=!1),[n,Ll.MassMode_FIXED][this.zpp_inner.massMode]},ln.prototype.set_massMode=function(n){var t;this.zpp_inner.immutable_midstep("Body::massMode"),null==Ll.MassMode_DEFAULT&&(Ll.internal=!0,Ll.MassMode_DEFAULT=new un,Ll.internal=!1),t=n==Ll.MassMode_DEFAULT?0:1,this.zpp_inner.massMode=t,this.zpp_inner.invalidate_mass(),null==Ll.MassMode_DEFAULT&&(Ll.internal=!0,Ll.MassMode_DEFAULT=new un,Ll.internal=!1);var e=Ll.MassMode_DEFAULT;return null==Ll.MassMode_FIXED&&(Ll.internal=!0,Ll.MassMode_FIXED=new un,Ll.internal=!1),[e,Ll.MassMode_FIXED][this.zpp_inner.massMode]},ln.prototype.get_constraintMass=function(){return this.zpp_inner.world||this.zpp_inner.validate_mass(),this.zpp_inner.smass},ln.prototype.get_mass=function(){return this.zpp_inner.validate_mass(),this.zpp_inner.cmass},ln.prototype.set_mass=function(n){return this.zpp_inner.immutable_midstep("Body::mass"),this.zpp_inner.massMode=1,this.zpp_inner.cmass=n,this.zpp_inner.invalidate_mass(),this.zpp_inner.validate_mass(),this.zpp_inner.cmass},ln.prototype.get_gravMassMode=function(){null==Ll.GravMassMode_DEFAULT&&(Ll.internal=!0,Ll.GravMassMode_DEFAULT=new sn,Ll.internal=!1);var n=Ll.GravMassMode_DEFAULT;null==Ll.GravMassMode_FIXED&&(Ll.internal=!0,Ll.GravMassMode_FIXED=new sn,Ll.internal=!1);var t=Ll.GravMassMode_FIXED;return null==Ll.GravMassMode_SCALED&&(Ll.internal=!0,Ll.GravMassMode_SCALED=new sn,Ll.internal=!1),[n,t,Ll.GravMassMode_SCALED][this.zpp_inner.massMode]},ln.prototype.set_gravMassMode=function(n){var t;this.zpp_inner.immutable_midstep("Body::gravMassMode"),null==Ll.GravMassMode_SCALED&&(Ll.internal=!0,Ll.GravMassMode_SCALED=new sn,Ll.internal=!1),t=n==Ll.GravMassMode_SCALED?2:(null==Ll.GravMassMode_DEFAULT&&(Ll.internal=!0,Ll.GravMassMode_DEFAULT=new sn,Ll.internal=!1),n==Ll.GravMassMode_DEFAULT?0:1),this.zpp_inner.gravMassMode=t,this.zpp_inner.invalidate_gravMass(),null==Ll.GravMassMode_DEFAULT&&(Ll.internal=!0,Ll.GravMassMode_DEFAULT=new sn,Ll.internal=!1);var e=Ll.GravMassMode_DEFAULT;null==Ll.GravMassMode_FIXED&&(Ll.internal=!0,Ll.GravMassMode_FIXED=new sn,Ll.internal=!1);var i=Ll.GravMassMode_FIXED;return null==Ll.GravMassMode_SCALED&&(Ll.internal=!0,Ll.GravMassMode_SCALED=new sn,Ll.internal=!1),[e,i,Ll.GravMassMode_SCALED][this.zpp_inner.massMode]},ln.prototype.get_gravMass=function(){return this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},ln.prototype.set_gravMass=function(n){return this.zpp_inner.immutable_midstep("Body::gravMass"),this.zpp_inner.gravMassMode=1,this.zpp_inner.gravMass=n,this.zpp_inner.invalidate_gravMass(),this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},ln.prototype.get_gravMassScale=function(){return this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},ln.prototype.set_gravMassScale=function(n){return this.zpp_inner.immutable_midstep("Body::gravMassScale"),this.zpp_inner.gravMassMode=2,this.zpp_inner.gravMassScale=n,this.zpp_inner.invalidate_gravMassScale(),this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},ln.prototype.get_inertiaMode=function(){null==Ll.InertiaMode_DEFAULT&&(Ll.internal=!0,Ll.InertiaMode_DEFAULT=new _n,Ll.internal=!1);var n=Ll.InertiaMode_DEFAULT;return null==Ll.InertiaMode_FIXED&&(Ll.internal=!0,Ll.InertiaMode_FIXED=new _n,Ll.internal=!1),[n,Ll.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},ln.prototype.set_inertiaMode=function(n){var t;this.zpp_inner.immutable_midstep("Body::inertiaMode"),null==Ll.InertiaMode_FIXED&&(Ll.internal=!0,Ll.InertiaMode_FIXED=new _n,Ll.internal=!1),t=n==Ll.InertiaMode_FIXED?1:0,this.zpp_inner.inertiaMode=t,this.zpp_inner.invalidate_inertia(),null==Ll.InertiaMode_DEFAULT&&(Ll.internal=!0,Ll.InertiaMode_DEFAULT=new _n,Ll.internal=!1);var e=Ll.InertiaMode_DEFAULT;return null==Ll.InertiaMode_FIXED&&(Ll.internal=!0,Ll.InertiaMode_FIXED=new _n,Ll.internal=!1),[e,Ll.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},ln.prototype.get_constraintInertia=function(){return this.zpp_inner.world||this.zpp_inner.validate_inertia(),this.zpp_inner.sinertia},ln.prototype.get_inertia=function(){return this.zpp_inner.validate_inertia(),this.zpp_inner.cinertia},ln.prototype.set_inertia=function(n){return this.zpp_inner.immutable_midstep("Body::inertia"),this.zpp_inner.inertiaMode=1,this.zpp_inner.cinertia=n,this.zpp_inner.invalidate_inertia(),this.zpp_inner.validate_inertia(),this.zpp_inner.cinertia},ln.prototype.connectedBodies=function(n,t){return null==n&&(n=-1),this.zpp_inner.connectedBodies(n,t)},ln.prototype.interactingBodies=function(n,t,e){var i;return null==t&&(t=-1),i=null==n?ri.COL|ri.SENSOR|ri.FLUID:(null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),n==Ll.InteractionType_COLLISION?ri.COL:(null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),n==Ll.InteractionType_SENSOR?ri.SENSOR:ri.FLUID)),this.zpp_inner.interactingBodies(i,t,e)},ln.prototype.crushFactor=function(){var n,t,e,i,p,l=0;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),0==n.zpp_inner.x&&(null!=(i=n.zpp_inner)._validate&&i._validate(),0==n.zpp_inner.y)||(n.zpp_inner.x=0,n.zpp_inner.y=0,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1;var r=n;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Vi.get(this.zpp_inner.arbiters,!0));for(var o=this.zpp_inner.wrap_arbiters.iterator();;){o.zpp_inner.zpp_inner.valmod();var a=o.zpp_inner.zpp_gl();if(o.zpp_critical=!0,!(o.zpp_i<a||(o.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=o).zpp_inner=null,!1)))break;o.zpp_critical=!1;var s=o.zpp_inner.at(o.zpp_i++).totalImpulse(this),_=s.xy();r.addeq(_);var h=_.zpp_inner;null!=h._validate&&h._validate();var u=_.zpp_inner.x,x=_.zpp_inner;null!=x._validate&&x._validate();var d=u*_.zpp_inner.x,y=_.zpp_inner;null!=y._validate&&y._validate();var z=_.zpp_inner.y,c=_.zpp_inner;null!=c._validate&&c._validate(),l+=Math.sqrt(d+z*_.zpp_inner.y);var v=_.zpp_inner;_.zpp_inner.outer=null,_.zpp_inner=null,_.zpp_pool=Ri.poolVec2,Ri.poolVec2=_,null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=mo.zpp_pool,mo.zpp_pool=v,s.dispose()}null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=ci.get(this.zpp_inner.constraints,!0));var m=this.zpp_inner.wrap_constraints;m.zpp_inner.valmod();for(var f=Kn.get(m);;){f.zpp_inner.zpp_inner.valmod();var b=f.zpp_inner;b.zpp_inner.valmod(),b.zpp_inner.zip_length&&(b.zpp_inner.zip_length=!1,b.zpp_inner.user_length=b.zpp_inner.inner.length);var g=b.zpp_inner.user_length;if(f.zpp_critical=!0,!(f.zpp_i<g||(f.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=f).zpp_inner=null,!1)))break;f.zpp_critical=!1;var w=f.zpp_inner.at(f.zpp_i++).bodyImpulse(this),M=w.xy();r.addeq(M);var C=M.zpp_inner;null!=C._validate&&C._validate();var k=M.zpp_inner.x,O=M.zpp_inner;null!=O._validate&&O._validate();var P=k*M.zpp_inner.x,S=M.zpp_inner;null!=S._validate&&S._validate();var A=M.zpp_inner.y,j=M.zpp_inner;null!=j._validate&&j._validate(),l+=Math.sqrt(P+A*M.zpp_inner.y);var E=M.zpp_inner;M.zpp_inner.outer=null,M.zpp_inner=null,M.zpp_pool=Ri.poolVec2,Ri.poolVec2=M,null!=E.outer&&(E.outer.zpp_inner=null,E.outer=null),E._isimmutable=null,E._validate=null,E._invalidate=null,E.next=mo.zpp_pool,mo.zpp_pool=E,w.dispose()}var I=r.zpp_inner;null!=I._validate&&I._validate();var T=r.zpp_inner.x,N=r.zpp_inner;null!=N._validate&&N._validate();var L=T*r.zpp_inner.x,V=r.zpp_inner;null!=V._validate&&V._validate();var D=r.zpp_inner.y,F=r.zpp_inner;null!=F._validate&&F._validate();var R=l-Math.sqrt(L+D*r.zpp_inner.y);this.zpp_inner.validate_mass();var Z=R/(this.zpp_inner.cmass*(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.pre_dt),B=r.zpp_inner;return r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Ri.poolVec2,Ri.poolVec2=r,null!=B.outer&&(B.outer.zpp_inner=null,B.outer=null),B._isimmutable=null,B._validate=null,B._invalidate=null,B.next=mo.zpp_pool,mo.zpp_pool=B,Z},ln.prototype.localPointToWorld=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));var i,p,l=n.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.axisy*n.zpp_inner.x,o=n.zpp_inner;null!=o._validate&&o._validate(),i=r-this.zpp_inner.axisx*n.zpp_inner.y;var a=n.zpp_inner;null!=a._validate&&a._validate();var s,_=n.zpp_inner.x*this.zpp_inner.axisx,h=n.zpp_inner;null!=h._validate&&h._validate(),p=_+n.zpp_inner.y*this.zpp_inner.axisy,n.zpp_inner.weak&&(s=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=mo.zpp_pool,mo.zpp_pool=s);var u,x,d,y,z,c=i+this.zpp_inner.posx,v=p+this.zpp_inner.posy;return null==Ri.poolVec2?u=new at:(u=Ri.poolVec2,Ri.poolVec2=u.zpp_pool,u.zpp_pool=null),null==u.zpp_inner?(null==mo.zpp_pool?x=new mo:(x=mo.zpp_pool,mo.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=c,x.y=v,u.zpp_inner=x,u.zpp_inner.outer=u):(null!=(d=u.zpp_inner)._validate&&d._validate(),u.zpp_inner.x==c&&(null!=(y=u.zpp_inner)._validate&&y._validate(),u.zpp_inner.y==v)||(u.zpp_inner.x=c,u.zpp_inner.y=v,null!=(z=u.zpp_inner)._invalidate&&z._invalidate(z))),u.zpp_inner.weak=t,u},ln.prototype.worldPointToLocal=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));var i,p,l,r,o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.x-this.zpp_inner.posx;var a,s,_,h,u,x,d=n.zpp_inner;return null!=d._validate&&d._validate(),r=n.zpp_inner.y-this.zpp_inner.posy,i=l*this.zpp_inner.axisy+r*this.zpp_inner.axisx,p=r*this.zpp_inner.axisy-l*this.zpp_inner.axisx,n.zpp_inner.weak&&(a=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=mo.zpp_pool,mo.zpp_pool=a),null==Ri.poolVec2?s=new at:(s=Ri.poolVec2,Ri.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner?(null==mo.zpp_pool?_=new mo:(_=mo.zpp_pool,mo.zpp_pool=_.next,_.next=null),_.weak=!1,_._immutable=!1,_.x=i,_.y=p,s.zpp_inner=_,s.zpp_inner.outer=s):(null!=(h=s.zpp_inner)._validate&&h._validate(),s.zpp_inner.x==i&&(null!=(u=s.zpp_inner)._validate&&u._validate(),s.zpp_inner.y==p)||(s.zpp_inner.x=i,s.zpp_inner.y=p,null!=(x=s.zpp_inner)._invalidate&&x._invalidate(x))),s.zpp_inner.weak=t,s},ln.prototype.localVectorToWorld=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));var i,p,l=n.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.axisy*n.zpp_inner.x,o=n.zpp_inner;null!=o._validate&&o._validate(),i=r-this.zpp_inner.axisx*n.zpp_inner.y;var a=n.zpp_inner;null!=a._validate&&a._validate();var s,_,h,u,x,d,y=n.zpp_inner.x*this.zpp_inner.axisx,z=n.zpp_inner;return null!=z._validate&&z._validate(),p=y+n.zpp_inner.y*this.zpp_inner.axisy,n.zpp_inner.weak&&(s=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=mo.zpp_pool,mo.zpp_pool=s),null==Ri.poolVec2?_=new at:(_=Ri.poolVec2,Ri.poolVec2=_.zpp_pool,_.zpp_pool=null),null==_.zpp_inner?(null==mo.zpp_pool?h=new mo:(h=mo.zpp_pool,mo.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=i,h.y=p,_.zpp_inner=h,_.zpp_inner.outer=_):(null!=(u=_.zpp_inner)._validate&&u._validate(),_.zpp_inner.x==i&&(null!=(x=_.zpp_inner)._validate&&x._validate(),_.zpp_inner.y==p)||(_.zpp_inner.x=i,_.zpp_inner.y=p,null!=(d=_.zpp_inner)._invalidate&&d._invalidate(d))),_.zpp_inner.weak=t,_},ln.prototype.worldVectorToLocal=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));var i,p,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x*this.zpp_inner.axisy,o=n.zpp_inner;null!=o._validate&&o._validate(),i=r+n.zpp_inner.y*this.zpp_inner.axisx;var a=n.zpp_inner;null!=a._validate&&a._validate();var s,_,h,u,x,d,y=n.zpp_inner.y*this.zpp_inner.axisy,z=n.zpp_inner;return null!=z._validate&&z._validate(),p=y-n.zpp_inner.x*this.zpp_inner.axisx,n.zpp_inner.weak&&(s=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=mo.zpp_pool,mo.zpp_pool=s),null==Ri.poolVec2?_=new at:(_=Ri.poolVec2,Ri.poolVec2=_.zpp_pool,_.zpp_pool=null),null==_.zpp_inner?(null==mo.zpp_pool?h=new mo:(h=mo.zpp_pool,mo.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=i,h.y=p,_.zpp_inner=h,_.zpp_inner.outer=_):(null!=(u=_.zpp_inner)._validate&&u._validate(),_.zpp_inner.x==i&&(null!=(x=_.zpp_inner)._validate&&x._validate(),_.zpp_inner.y==p)||(_.zpp_inner.x=i,_.zpp_inner.y=p,null!=(d=_.zpp_inner)._invalidate&&d._invalidate(d))),_.zpp_inner.weak=t,_},ln.prototype.applyImpulse=function(n,t,e){var i,p;if(null==e&&(e=!1),e&&this.zpp_inner.component.sleeping)return n.zpp_inner.weak&&(i=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=mo.zpp_pool,mo.zpp_pool=i),null!=t&&t.zpp_inner.weak&&(p=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=mo.zpp_pool,mo.zpp_pool=p),this;this.zpp_inner.validate_mass();var l=this.zpp_inner.imass,r=n.zpp_inner;null!=r._validate&&r._validate(),this.zpp_inner.velx+=n.zpp_inner.x*l;var o,a,s,_,h,u,x,d,y,z=n.zpp_inner;return null!=z._validate&&z._validate(),this.zpp_inner.vely+=n.zpp_inner.y*l,null!=t&&(a=o=0,null!=(s=t.zpp_inner)._validate&&s._validate(),o=t.zpp_inner.x-this.zpp_inner.posx,null!=(_=t.zpp_inner)._validate&&_._validate(),a=t.zpp_inner.y-this.zpp_inner.posy,this.zpp_inner.validate_inertia(),null!=(h=n.zpp_inner)._validate&&h._validate(),u=n.zpp_inner.y*o,null!=(x=n.zpp_inner)._validate&&x._validate(),this.zpp_inner.angvel+=(u-n.zpp_inner.x*a)*this.zpp_inner.iinertia,t.zpp_inner.weak&&(d=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=mo.zpp_pool,mo.zpp_pool=d)),e||2==this.zpp_inner.type&&this.zpp_inner.wake(),n.zpp_inner.weak&&(y=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=mo.zpp_pool,mo.zpp_pool=y),this},ln.prototype.applyAngularImpulse=function(n,t){return null==t&&(t=!1),t&&this.zpp_inner.component.sleeping||(this.zpp_inner.validate_inertia(),this.zpp_inner.angvel+=n*this.zpp_inner.iinertia,t||2==this.zpp_inner.type&&this.zpp_inner.wake()),this},ln.prototype.translateShapes=function(n){this.zpp_inner.immutable_midstep("Body::translateShapes()");var t=n.zpp_inner.weak;n.zpp_inner.weak=!1;for(var e,i=this.zpp_inner.shapes.head;null!=i;)i.elt.outer.translate(n),i=i.next;return n.zpp_inner.weak=t,n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=mo.zpp_pool,mo.zpp_pool=e),this},ln.prototype.rotateShapes=function(n){this.zpp_inner.immutable_midstep("Body::rotateShapes()");for(var t=this.zpp_inner.shapes.head;null!=t;)t.elt.outer.rotate(n),t=t.next;return this},ln.prototype.scaleShapes=function(n,t){this.zpp_inner.immutable_midstep("Body::scaleShapes()");for(var e=this.zpp_inner.shapes.head;null!=e;)e.elt.outer.scale(n,t),e=e.next;return this},ln.prototype.transformShapes=function(n){this.zpp_inner.immutable_midstep("Body::transformShapes()");for(var t=this.zpp_inner.shapes.head;null!=t;)t.elt.outer.transform(n),t=t.next;return this},ln.prototype.align=function(){this.zpp_inner.immutable_midstep("Body::align()"),this.zpp_inner.validate_localCOM();var n,t,e,i,p,l=-this.zpp_inner.localCOMx,r=-this.zpp_inner.localCOMy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1;var o=n;this.translateShapes(o);var a,s,_=this.localVectorToWorld(o);null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos.subeq(_),this.zpp_inner.pre_posx<1/0&&(null!=(a=_.zpp_inner)._validate&&a._validate(),this.zpp_inner.pre_posx-=_.zpp_inner.x,null!=(s=_.zpp_inner)._validate&&s._validate(),this.zpp_inner.pre_posy-=_.zpp_inner.y);var h=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null,o.zpp_pool=Ri.poolVec2,Ri.poolVec2=o,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=mo.zpp_pool,mo.zpp_pool=h;var u=_.zpp_inner;return _.zpp_inner.outer=null,_.zpp_inner=null,_.zpp_pool=Ri.poolVec2,Ri.poolVec2=_,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=mo.zpp_pool,mo.zpp_pool=u,this},ln.prototype.rotate=function(n,t){var e=n.zpp_inner.weak;n.zpp_inner.weak=!1,null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var i=this.zpp_inner.wrap_pos.sub(n);i.rotate(t);var p=n.add(i,!0);null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var l=this.zpp_inner.wrap_pos,r=p.zpp_inner;null!=r._validate&&r._validate();var o=p.zpp_inner.x,a=p.zpp_inner;null!=a._validate&&a._validate();var s,_,h,u=p.zpp_inner.y,x=l.zpp_inner;null!=x._validate&&x._validate(),l.zpp_inner.x==o&&(null!=(s=l.zpp_inner)._validate&&s._validate(),l.zpp_inner.y==u)||(l.zpp_inner.x=o,l.zpp_inner.y=u,null!=(_=l.zpp_inner)._invalidate&&_._invalidate(_)),p.zpp_inner.weak&&(h=p.zpp_inner,p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Ri.poolVec2,Ri.poolVec2=p,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=mo.zpp_pool,mo.zpp_pool=h),null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var d=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Ri.poolVec2,Ri.poolVec2=i,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=mo.zpp_pool,mo.zpp_pool=d;var y,z=this,c=z.zpp_inner.rot+t;if(z.zpp_inner.immutable_midstep("Body::rotation"),z.zpp_inner.rot!=c){z.zpp_inner.rot=c;var v=z.zpp_inner;v.zip_axis=!0;for(var m=v.shapes.head;null!=m;){var f=m.elt;1==f.type&&(f.polygon.invalidate_gverts(),f.polygon.invalidate_gaxi()),f.invalidate_worldCOM(),m=m.next}v.zip_worldCOM=!0,z.zpp_inner.wake()}return n.zpp_inner.weak=e,n.zpp_inner.weak&&(y=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=mo.zpp_pool,mo.zpp_pool=y),this},ln.prototype.setShapeMaterials=function(n){this.zpp_inner.immutable_midstep("Body::setShapeMaterials()");for(var t=this.zpp_inner.shapes.head;null!=t;){var e=t.elt.outer;e.zpp_inner.immutable_midstep("Shape::material"),e.zpp_inner.setMaterial(n.zpp_inner),e.zpp_inner.material.wrapper(),t=t.next}return this},ln.prototype.setShapeFilters=function(n){this.zpp_inner.immutable_midstep("Body::setShapeFilters()");for(var t=this.zpp_inner.shapes.head;null!=t;){var e=t.elt.outer;e.zpp_inner.immutable_midstep("Shape::filter"),e.zpp_inner.setFilter(n.zpp_inner),e.zpp_inner.filter.wrapper(),t=t.next}return this},ln.prototype.setShapeFluidProperties=function(n){this.zpp_inner.immutable_midstep("Body::setShapeFluidProperties()");for(var t=this.zpp_inner.shapes.head;null!=t;){var e=t.elt.outer;e.zpp_inner.setFluid(n.zpp_inner),e.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==e.zpp_inner.fluidProperties&&e.zpp_inner.setFluid((new an).zpp_inner),e.zpp_inner.fluidProperties.wrapper(),t=t.next}return this},ln.prototype.get_localCOM=function(){var n,t,e,i,p,l,r;return null==this.zpp_inner.wrap_localCOM&&(n=this.zpp_inner.localCOMx,t=this.zpp_inner.localCOMy,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,this.zpp_inner.wrap_localCOM=e,this.zpp_inner.wrap_localCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_localCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_localCOM.zpp_inner._validate=Q(h=this.zpp_inner,h.getlocalCOM)),this.zpp_inner.wrap_localCOM},ln.prototype.get_worldCOM=function(){var n,t,e,i,p,l,r;return null==this.zpp_inner.wrap_worldCOM&&(n=this.zpp_inner.worldCOMx,t=this.zpp_inner.worldCOMy,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=e,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=Q(h=this.zpp_inner,h.getworldCOM)),this.zpp_inner.wrap_worldCOM},ln.prototype.normalImpulse=function(n,t){null==t&&(t=!1);var e=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Vi.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,!(l.zpp_i<r||(l.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1;var o,a,s,_,h,u=l.zpp_inner.at(l.zpp_i++).zpp_inner;u.type==ri.COL&&(null!=n&&u.b2!=n.zpp_inner&&u.b1!=n.zpp_inner||(null!=(s=(a=((o=u.wrapper()).zpp_inner.type==ri.COL?o.zpp_inner.colarb.outer_zn:null).normalImpulse(this,t)).zpp_inner)._validate&&s._validate(),e+=a.zpp_inner.x,null!=(_=a.zpp_inner)._validate&&_._validate(),i+=a.zpp_inner.y,null!=(h=a.zpp_inner)._validate&&h._validate(),p+=a.zpp_inner.z,a.dispose()))}return X.get(e,i,p)},ln.prototype.tangentImpulse=function(n,t){null==t&&(t=!1);var e=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Vi.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,!(l.zpp_i<r||(l.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1;var o,a,s,_,h,u=l.zpp_inner.at(l.zpp_i++).zpp_inner;u.type==ri.COL&&(null!=n&&u.b2!=n.zpp_inner&&u.b1!=n.zpp_inner||(null!=(s=(a=((o=u.wrapper()).zpp_inner.type==ri.COL?o.zpp_inner.colarb.outer_zn:null).tangentImpulse(this,t)).zpp_inner)._validate&&s._validate(),e+=a.zpp_inner.x,null!=(_=a.zpp_inner)._validate&&_._validate(),i+=a.zpp_inner.y,null!=(h=a.zpp_inner)._validate&&h._validate(),p+=a.zpp_inner.z,a.dispose()))}return X.get(e,i,p)},ln.prototype.totalContactsImpulse=function(n,t){null==t&&(t=!1);var e=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Vi.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,!(l.zpp_i<r||(l.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1;var o,a,s,_,h,u=l.zpp_inner.at(l.zpp_i++).zpp_inner;u.type==ri.COL&&(null!=n&&u.b2!=n.zpp_inner&&u.b1!=n.zpp_inner||(null!=(s=(a=((o=u.wrapper()).zpp_inner.type==ri.COL?o.zpp_inner.colarb.outer_zn:null).totalImpulse(this,t)).zpp_inner)._validate&&s._validate(),e+=a.zpp_inner.x,null!=(_=a.zpp_inner)._validate&&_._validate(),i+=a.zpp_inner.y,null!=(h=a.zpp_inner)._validate&&h._validate(),p+=a.zpp_inner.z,a.dispose()))}return X.get(e,i,p)},ln.prototype.rollingImpulse=function(n,t){null==t&&(t=!1);var e=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Vi.get(this.zpp_inner.arbiters,!0));for(var i=this.zpp_inner.wrap_arbiters.iterator();;){i.zpp_inner.zpp_inner.valmod();var p=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,!(i.zpp_i<p||(i.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;var l,r=i.zpp_inner.at(i.zpp_i++).zpp_inner;r.type==ri.COL&&(null!=n&&r.b2!=n.zpp_inner&&r.b1!=n.zpp_inner||(e+=((l=r.wrapper()).zpp_inner.type==ri.COL?l.zpp_inner.colarb.outer_zn:null).rollingImpulse(this,t)))}return e},ln.prototype.buoyancyImpulse=function(n){var t=0,e=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Vi.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner.zpp_gl();if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1;var r,o,a,s,_,h=p.zpp_inner.at(p.zpp_i++).zpp_inner;h.type==ri.FLUID&&(null!=n&&h.b2!=n.zpp_inner&&h.b1!=n.zpp_inner||(null!=(a=(o=((r=h.wrapper()).zpp_inner.type==ri.FLUID?r.zpp_inner.fluidarb.outer_zn:null).buoyancyImpulse(this)).zpp_inner)._validate&&a._validate(),t+=o.zpp_inner.x,null!=(s=o.zpp_inner)._validate&&s._validate(),e+=o.zpp_inner.y,null!=(_=o.zpp_inner)._validate&&_._validate(),i+=o.zpp_inner.z,o.dispose()))}return X.get(t,e,i)},ln.prototype.dragImpulse=function(n){var t=0,e=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Vi.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner.zpp_gl();if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1;var r,o,a,s,_,h=p.zpp_inner.at(p.zpp_i++).zpp_inner;h.type==ri.FLUID&&(null!=n&&h.b2!=n.zpp_inner&&h.b1!=n.zpp_inner||(null!=(a=(o=((r=h.wrapper()).zpp_inner.type==ri.FLUID?r.zpp_inner.fluidarb.outer_zn:null).dragImpulse(this)).zpp_inner)._validate&&a._validate(),t+=o.zpp_inner.x,null!=(s=o.zpp_inner)._validate&&s._validate(),e+=o.zpp_inner.y,null!=(_=o.zpp_inner)._validate&&_._validate(),i+=o.zpp_inner.z,o.dispose()))}return X.get(t,e,i)},ln.prototype.totalFluidImpulse=function(n){var t=0,e=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Vi.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner.zpp_gl();if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1;var r,o,a,s,_,h=p.zpp_inner.at(p.zpp_i++).zpp_inner;h.type==ri.FLUID&&(null!=n&&h.b2!=n.zpp_inner&&h.b1!=n.zpp_inner||(null!=(a=(o=((r=h.wrapper()).zpp_inner.type==ri.FLUID?r.zpp_inner.fluidarb.outer_zn:null).totalImpulse(this)).zpp_inner)._validate&&a._validate(),t+=o.zpp_inner.x,null!=(s=o.zpp_inner)._validate&&s._validate(),e+=o.zpp_inner.y,null!=(_=o.zpp_inner)._validate&&_._validate(),i+=o.zpp_inner.z,o.dispose()))}return X.get(t,e,i)},ln.prototype.constraintsImpulse=function(){for(var n=0,t=0,e=0,i=this.zpp_inner.constraints.head;null!=i;){var p=i.elt.outer.bodyImpulse(this),l=p.zpp_inner;null!=l._validate&&l._validate(),n+=p.zpp_inner.x;var r=p.zpp_inner;null!=r._validate&&r._validate(),t+=p.zpp_inner.y;var o=p.zpp_inner;null!=o._validate&&o._validate(),e+=p.zpp_inner.z,p.dispose(),i=i.next}return X.get(n,t,e)},ln.prototype.totalImpulse=function(n,t){null==t&&(t=!1);var e=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Vi.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,!(l.zpp_i<r||(l.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1;var o,a,s,_,h=l.zpp_inner.at(l.zpp_i++).zpp_inner;h.type!=ri.SENSOR&&(null!=n&&h.b2!=n.zpp_inner&&h.b1!=n.zpp_inner||(null!=(a=(o=h.wrapper().totalImpulse(this,t)).zpp_inner)._validate&&a._validate(),e+=o.zpp_inner.x,null!=(s=o.zpp_inner)._validate&&s._validate(),i+=o.zpp_inner.y,null!=(_=o.zpp_inner)._validate&&_._validate(),p+=o.zpp_inner.z,o.dispose()))}for(var u=this.zpp_inner.constraints.head;null!=u;){var x,d,y,z,c=u.elt;c.active&&(null!=(d=(x=c.outer.bodyImpulse(this)).zpp_inner)._validate&&d._validate(),e+=x.zpp_inner.x,null!=(y=x.zpp_inner)._validate&&y._validate(),i+=x.zpp_inner.y,null!=(z=x.zpp_inner)._validate&&z._validate(),p+=x.zpp_inner.z,x.dispose()),u=u.next}return X.get(e,i,p)},ln.prototype.contains=function(n){for(var t,e=n.zpp_inner.weak,i=n.zpp_inner.weak=!1,p=this.zpp_inner.shapes.head;null!=p;){if(p.elt.outer.contains(n)){i=!0;break}p=p.next}return n.zpp_inner.weak=e,n.zpp_inner.weak&&(t=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=mo.zpp_pool,mo.zpp_pool=t),i},ln.prototype.toString=function(){return(this.zpp_inner.world?"(space::world":"("+(2==this.zpp_inner.type?"dynamic":1==this.zpp_inner.type?"static":"kinematic"))+")#"+this.zpp_inner_i.id},Object.defineProperty(ln.prototype,"type",{get:ln.prototype.get_type,set:ln.prototype.set_type}),Object.defineProperty(ln.prototype,"isBullet",{get:ln.prototype.get_isBullet,set:ln.prototype.set_isBullet}),Object.defineProperty(ln.prototype,"disableCCD",{get:ln.prototype.get_disableCCD,set:ln.prototype.set_disableCCD}),Object.defineProperty(ln.prototype,"shapes",{get:ln.prototype.get_shapes}),Object.defineProperty(ln.prototype,"compound",{get:ln.prototype.get_compound,set:ln.prototype.set_compound}),Object.defineProperty(ln.prototype,"space",{get:ln.prototype.get_space,set:ln.prototype.set_space}),Object.defineProperty(ln.prototype,"arbiters",{get:ln.prototype.get_arbiters}),Object.defineProperty(ln.prototype,"isSleeping",{get:ln.prototype.get_isSleeping}),Object.defineProperty(ln.prototype,"constraints",{get:ln.prototype.get_constraints}),Object.defineProperty(ln.prototype,"position",{get:ln.prototype.get_position,set:ln.prototype.set_position}),Object.defineProperty(ln.prototype,"velocity",{get:ln.prototype.get_velocity,set:ln.prototype.set_velocity}),Object.defineProperty(ln.prototype,"kinematicVel",{get:ln.prototype.get_kinematicVel,set:ln.prototype.set_kinematicVel}),Object.defineProperty(ln.prototype,"surfaceVel",{get:ln.prototype.get_surfaceVel,set:ln.prototype.set_surfaceVel}),Object.defineProperty(ln.prototype,"force",{get:ln.prototype.get_force,set:ln.prototype.set_force}),Object.defineProperty(ln.prototype,"constraintVelocity",{get:ln.prototype.get_constraintVelocity}),Object.defineProperty(ln.prototype,"rotation",{get:ln.prototype.get_rotation,set:ln.prototype.set_rotation}),Object.defineProperty(ln.prototype,"angularVel",{get:ln.prototype.get_angularVel,set:ln.prototype.set_angularVel}),Object.defineProperty(ln.prototype,"kinAngVel",{get:ln.prototype.get_kinAngVel,set:ln.prototype.set_kinAngVel}),Object.defineProperty(ln.prototype,"torque",{get:ln.prototype.get_torque,set:ln.prototype.set_torque}),Object.defineProperty(ln.prototype,"bounds",{get:ln.prototype.get_bounds}),Object.defineProperty(ln.prototype,"allowMovement",{get:ln.prototype.get_allowMovement,set:ln.prototype.set_allowMovement}),Object.defineProperty(ln.prototype,"allowRotation",{get:ln.prototype.get_allowRotation,set:ln.prototype.set_allowRotation}),Object.defineProperty(ln.prototype,"massMode",{get:ln.prototype.get_massMode,set:ln.prototype.set_massMode}),Object.defineProperty(ln.prototype,"constraintMass",{get:ln.prototype.get_constraintMass}),Object.defineProperty(ln.prototype,"mass",{get:ln.prototype.get_mass,set:ln.prototype.set_mass}),Object.defineProperty(ln.prototype,"gravMassMode",{get:ln.prototype.get_gravMassMode,set:ln.prototype.set_gravMassMode}),Object.defineProperty(ln.prototype,"gravMass",{get:ln.prototype.get_gravMass,set:ln.prototype.set_gravMass}),Object.defineProperty(ln.prototype,"gravMassScale",{get:ln.prototype.get_gravMassScale,set:ln.prototype.set_gravMassScale}),Object.defineProperty(ln.prototype,"inertiaMode",{get:ln.prototype.get_inertiaMode,set:ln.prototype.set_inertiaMode}),Object.defineProperty(ln.prototype,"constraintInertia",{get:ln.prototype.get_constraintInertia}),Object.defineProperty(ln.prototype,"inertia",{get:ln.prototype.get_inertia,set:ln.prototype.set_inertia}),Object.defineProperty(ln.prototype,"localCOM",{get:ln.prototype.get_localCOM}),Object.defineProperty(ln.prototype,"worldCOM",{get:ln.prototype.get_worldCOM}),ln.prototype.__class__=ln;var nt=nape.phys.BodyIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};nt.__name__=["nape","phys","BodyIterator"],nt.get=function(n){var t,e,i=null==nt.zpp_pool?(vi.internal=!0,t=new nt,vi.internal=!1,t):(e=nt.zpp_pool,nt.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},nt.prototype.zpp_inner=null,nt.prototype.zpp_i=null,nt.prototype.zpp_critical=null,nt.prototype.zpp_next=null,nt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=nt.zpp_pool,(nt.zpp_pool=this).zpp_inner=null,!1)},nt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},nt.prototype.__class__=nt;var tn=nape.phys.BodyList=function(){this.zpp_inner=null,this.zpp_inner=new vi,this.zpp_inner.outer=this};tn.__name__=["nape","phys","BodyList"],tn.fromArray=function(n){for(var t=new tn,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},tn.prototype.zpp_inner=null,tn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},tn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},tn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},tn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},tn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},tn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:t.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},tn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},tn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},tn.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},tn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},tn.prototype.empty=function(){return null==this.zpp_inner.inner.head},tn.prototype.iterator=function(){return this.zpp_inner.valmod(),nt.get(this)},tn.prototype.copy=function(n){null==n&&(n=!1);var t=new tn;this.zpp_inner.valmod();for(var e=nt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=nt.zpp_pool,(nt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},tn.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=nt.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=nt.zpp_pool,(nt.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},tn.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=nt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=nt.zpp_pool,(nt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},tn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=nt.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=nt.zpp_pool,(nt.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=nt.zpp_pool,(nt.zpp_pool=t).zpp_inner=null;break}}return this},tn.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(tn.prototype,"length",{get:tn.prototype.get_length}),tn.prototype.__class__=tn;var rn=nape.phys.BodyType=function(){};rn.__name__=["nape","phys","BodyType"],rn.STATIC=null,rn.get_STATIC=function(){return null==Ll.BodyType_STATIC&&(Ll.internal=!0,Ll.BodyType_STATIC=new rn,Ll.internal=!1),Ll.BodyType_STATIC},rn.DYNAMIC=null,rn.get_DYNAMIC=function(){return null==Ll.BodyType_DYNAMIC&&(Ll.internal=!0,Ll.BodyType_DYNAMIC=new rn,Ll.internal=!1),Ll.BodyType_DYNAMIC},rn.KINEMATIC=null,rn.get_KINEMATIC=function(){return null==Ll.BodyType_KINEMATIC&&(Ll.internal=!0,Ll.BodyType_KINEMATIC=new rn,Ll.internal=!1),Ll.BodyType_KINEMATIC},rn.prototype.toString=function(){return null==Ll.BodyType_STATIC&&(Ll.internal=!0,Ll.BodyType_STATIC=new rn,Ll.internal=!1),this==Ll.BodyType_STATIC?"STATIC":(null==Ll.BodyType_DYNAMIC&&(Ll.internal=!0,Ll.BodyType_DYNAMIC=new rn,Ll.internal=!1),this==Ll.BodyType_DYNAMIC?"DYNAMIC":(null==Ll.BodyType_KINEMATIC&&(Ll.internal=!0,Ll.BodyType_KINEMATIC=new rn,Ll.internal=!1),this==Ll.BodyType_KINEMATIC?"KINEMATIC":""))},Object.defineProperty(rn,"STATIC",{get:rn.get_STATIC}),Object.defineProperty(rn,"DYNAMIC",{get:rn.get_DYNAMIC}),Object.defineProperty(rn,"KINEMATIC",{get:rn.get_KINEMATIC}),rn.prototype.__class__=rn;var en=nape.phys.Compound=function(){this.zpp_inner=null,nn.call(this),this.zpp_inner=new Jt,((this.zpp_inner.outer=this).zpp_inner.outer_i=this).zpp_inner_i=this.zpp_inner,this.zpp_inner.insert_cbtype(Ln.ANY_COMPOUND.zpp_inner)};en.__name__=["nape","phys","Compound"],en.__super__=nn,en.prototype=Object.create(nn.prototype),en.prototype.zpp_inner=null,en.prototype.get_bodies=function(){return this.zpp_inner.wrap_bodies},en.prototype.get_constraints=function(){return this.zpp_inner.wrap_constraints},en.prototype.get_compounds=function(){return this.zpp_inner.wrap_compounds},en.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},en.prototype.set_compound=function(n){var t;return this.zpp_inner.immutable_midstep("Compound::compound"),(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(this),null!=n&&((t=n.zpp_inner.wrap_compounds).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},en.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},en.prototype.set_space=function(n){var t;return this.zpp_inner.immutable_midstep("Compound::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_compounds.remove(this),null!=n&&((t=n.zpp_inner.wrap_compounds).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},en.prototype.toString=function(){return"Compound"+this.zpp_inner_i.id},en.prototype.copy=function(){return this.zpp_inner.copy()},en.prototype.breakApart=function(){this.zpp_inner.breakApart()},en.prototype.visitBodies=function(n){var t=this.zpp_inner.wrap_bodies;t.zpp_inner.valmod();for(var e=nt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=nt.zpp_pool,(nt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}var l=this.zpp_inner.wrap_compounds;l.zpp_inner.valmod();for(var r=tt.get(l);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a=o.zpp_inner.user_length;if(r.zpp_critical=!0,!(r.zpp_i<a||(r.zpp_next=tt.zpp_pool,(tt.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1,r.zpp_inner.at(r.zpp_i++).visitBodies(n)}},en.prototype.visitConstraints=function(n){var t=this.zpp_inner.wrap_constraints;t.zpp_inner.valmod();for(var e=Kn.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}var l=this.zpp_inner.wrap_compounds;l.zpp_inner.valmod();for(var r=tt.get(l);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a=o.zpp_inner.user_length;if(r.zpp_critical=!0,!(r.zpp_i<a||(r.zpp_next=tt.zpp_pool,(tt.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1,r.zpp_inner.at(r.zpp_i++).visitConstraints(n)}},en.prototype.visitCompounds=function(n){var t=this.zpp_inner.wrap_compounds;t.zpp_inner.valmod();for(var e=tt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=tt.zpp_pool,(tt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);n(l),l.visitCompounds(n)}},en.prototype.COM=function(n){var t,e,i,p,l;null==n&&(n=!1),null==Ri.poolVec2?t=new at:(t=Ri.poolVec2,Ri.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==mo.zpp_pool?e=new mo:(e=mo.zpp_pool,mo.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(i=t.zpp_inner)._validate&&i._validate(),0==t.zpp_inner.x&&(null!=(p=t.zpp_inner)._validate&&p._validate(),0==t.zpp_inner.y)||(t.zpp_inner.x=0,t.zpp_inner.y=0,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l))),t.zpp_inner.weak=n;var s=t,_=0;return this.visitBodies(function(n){var t,e,i,p,l,r,o,a;null!=n.zpp_inner.wrap_shapes.zpp_inner.inner.head&&(null==n.zpp_inner.wrap_worldCOM&&(t=n.zpp_inner.worldCOMx,e=n.zpp_inner.worldCOMy,null==Ri.poolVec2?i=new at:(i=Ri.poolVec2,Ri.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner?(null==mo.zpp_pool?p=new mo:(p=mo.zpp_pool,mo.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=e,i.zpp_inner=p,i.zpp_inner.outer=i):(null!=(l=i.zpp_inner)._validate&&l._validate(),i.zpp_inner.x==t&&(null!=(r=i.zpp_inner)._validate&&r._validate(),i.zpp_inner.y==e)||(i.zpp_inner.x=t,i.zpp_inner.y=e,null!=(o=i.zpp_inner)._invalidate&&o._invalidate(o))),i.zpp_inner.weak=!1,n.zpp_inner.wrap_worldCOM=i,n.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,n.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,n.zpp_inner.wrap_worldCOM.zpp_inner._validate=Q(h=n.zpp_inner,h.getworldCOM)),a=n.zpp_inner.wrap_worldCOM,n.zpp_inner.validate_mass(),s.addeq(a.mul(n.zpp_inner.cmass,!0)),n.zpp_inner.validate_mass(),_+=n.zpp_inner.cmass)}),s.muleq(1/_),s},en.prototype.translate=function(t){var n,e,i=t.zpp_inner.weak;return t.zpp_inner.weak=!1,this.visitBodies(function(n){null==n.zpp_inner.wrap_pos&&n.zpp_inner.setupPosition(),n.zpp_inner.wrap_pos.addeq(t)}),t.zpp_inner.weak=i,t.zpp_inner.weak&&(n=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,(e=t).zpp_pool=Ri.poolVec2,Ri.poolVec2=e,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=mo.zpp_pool,mo.zpp_pool=n),this},en.prototype.rotate=function(t,e){var n,i,p=t.zpp_inner.weak;return t.zpp_inner.weak=!1,this.visitBodies(function(n){n.rotate(t,e)}),t.zpp_inner.weak=p,t.zpp_inner.weak&&(n=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,(i=t).zpp_pool=Ri.poolVec2,Ri.poolVec2=i,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=mo.zpp_pool,mo.zpp_pool=n),this},Object.defineProperty(en.prototype,"bodies",{get:en.prototype.get_bodies}),Object.defineProperty(en.prototype,"constraints",{get:en.prototype.get_constraints}),Object.defineProperty(en.prototype,"compounds",{get:en.prototype.get_compounds}),Object.defineProperty(en.prototype,"compound",{get:en.prototype.get_compound,set:en.prototype.set_compound}),Object.defineProperty(en.prototype,"space",{get:en.prototype.get_space,set:en.prototype.set_space}),en.prototype.__class__=en;var tt=nape.phys.CompoundIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};tt.__name__=["nape","phys","CompoundIterator"],tt.get=function(n){var t,e,i=null==tt.zpp_pool?(Oi.internal=!0,t=new tt,Oi.internal=!1,t):(e=tt.zpp_pool,tt.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},tt.prototype.zpp_inner=null,tt.prototype.zpp_i=null,tt.prototype.zpp_critical=null,tt.prototype.zpp_next=null,tt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=tt.zpp_pool,(tt.zpp_pool=this).zpp_inner=null,!1)},tt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},tt.prototype.__class__=tt;var on=nape.phys.CompoundList=function(){this.zpp_inner=null,this.zpp_inner=new Oi,this.zpp_inner.outer=this};on.__name__=["nape","phys","CompoundList"],on.fromArray=function(n){for(var t=new on,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},on.prototype.zpp_inner=null,on.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},on.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},on.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},on.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},on.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},on.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:t.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},on.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},on.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},on.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},on.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},on.prototype.empty=function(){return null==this.zpp_inner.inner.head},on.prototype.iterator=function(){return this.zpp_inner.valmod(),tt.get(this)},on.prototype.copy=function(n){null==n&&(n=!1);var t=new on;this.zpp_inner.valmod();for(var e=tt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=tt.zpp_pool,(tt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},on.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=tt.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=tt.zpp_pool,(tt.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},on.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=tt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=tt.zpp_pool,(tt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},on.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=tt.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=tt.zpp_pool,(tt.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=tt.zpp_pool,(tt.zpp_pool=t).zpp_inner=null;break}}return this},on.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(on.prototype,"length",{get:on.prototype.get_length}),on.prototype.__class__=on;var an=nape.phys.FluidProperties=function(n,t){null==t&&(t=1),null==n&&(n=1),(this.zpp_inner=null)==Xt.zpp_pool?this.zpp_inner=new Xt:(this.zpp_inner=Xt.zpp_pool,Xt.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),n!=1e3*(this.zpp_inner.outer=this).zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate()),t!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=+t,this.zpp_inner.invalidate())};an.__name__=["nape","phys","FluidProperties"],an.prototype.zpp_inner=null,an.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},an.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=Ni.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},an.prototype.copy=function(){var n=new an(1e3*this.zpp_inner.density,this.zpp_inner.viscosity);null!=this.zpp_inner.userData&&(n.zpp_inner.userData=x.copy(this.zpp_inner.userData));var t,e,i,p,l,r,o,a,s,_,h,u=this.zpp_inner.wrap_gravity;return null==u?null!=n.zpp_inner.wrap_gravity&&(n.zpp_inner.wrap_gravity.zpp_inner._inuse=!1,e=(t=n.zpp_inner.wrap_gravity).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=mo.zpp_pool,mo.zpp_pool=e,n.zpp_inner.wrap_gravity=null):(null==n.zpp_inner.wrap_gravity&&n.zpp_inner.getgravity(),i=n.zpp_inner.wrap_gravity,null!=(p=u.zpp_inner)._validate&&p._validate(),l=u.zpp_inner.x,null!=(r=u.zpp_inner)._validate&&r._validate(),o=u.zpp_inner.y,null!=(a=i.zpp_inner)._validate&&a._validate(),i.zpp_inner.x==l&&(null!=(s=i.zpp_inner)._validate&&s._validate(),i.zpp_inner.y==o)||(i.zpp_inner.x=l,i.zpp_inner.y=o,null!=(_=i.zpp_inner)._invalidate&&_._invalidate(_)),u.zpp_inner.weak&&(h=u.zpp_inner,u.zpp_inner.outer=null,u.zpp_inner=null,u.zpp_pool=Ri.poolVec2,Ri.poolVec2=u,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=mo.zpp_pool,mo.zpp_pool=h)),n},an.prototype.get_density=function(){return 1e3*this.zpp_inner.density},an.prototype.set_density=function(n){return n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate()),1e3*this.zpp_inner.density},an.prototype.get_viscosity=function(){return this.zpp_inner.viscosity},an.prototype.set_viscosity=function(n){return n!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=+n,this.zpp_inner.invalidate()),this.zpp_inner.viscosity},an.prototype.get_gravity=function(){return this.zpp_inner.wrap_gravity},an.prototype.set_gravity=function(n){var t,e,i,p,l,r,o,a,s,_,h;return null==n?null!=this.zpp_inner.wrap_gravity&&(this.zpp_inner.wrap_gravity.zpp_inner._inuse=!1,e=(t=this.zpp_inner.wrap_gravity).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=mo.zpp_pool,mo.zpp_pool=e,this.zpp_inner.wrap_gravity=null):(null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),i=this.zpp_inner.wrap_gravity,null!=(p=n.zpp_inner)._validate&&p._validate(),l=n.zpp_inner.x,null!=(r=n.zpp_inner)._validate&&r._validate(),o=n.zpp_inner.y,null!=(a=i.zpp_inner)._validate&&a._validate(),i.zpp_inner.x==l&&(null!=(s=i.zpp_inner)._validate&&s._validate(),i.zpp_inner.y==o)||(i.zpp_inner.x=l,i.zpp_inner.y=o,null!=(_=i.zpp_inner)._invalidate&&_._invalidate(_)),n.zpp_inner.weak&&(h=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=mo.zpp_pool,mo.zpp_pool=h)),this.zpp_inner.wrap_gravity},an.prototype.toString=function(){return"{ density: "+1e3*this.zpp_inner.density+" viscosity: "+this.zpp_inner.viscosity+" gravity: "+i.string(this.zpp_inner.wrap_gravity)+" }"},Object.defineProperty(an.prototype,"userData",{get:an.prototype.get_userData}),Object.defineProperty(an.prototype,"shapes",{get:an.prototype.get_shapes}),Object.defineProperty(an.prototype,"density",{get:an.prototype.get_density,set:an.prototype.set_density}),Object.defineProperty(an.prototype,"viscosity",{get:an.prototype.get_viscosity,set:an.prototype.set_viscosity}),Object.defineProperty(an.prototype,"gravity",{get:an.prototype.get_gravity,set:an.prototype.set_gravity}),an.prototype.__class__=an;var sn=nape.phys.GravMassMode=function(){};sn.__name__=["nape","phys","GravMassMode"],sn.DEFAULT=null,sn.get_DEFAULT=function(){return null==Ll.GravMassMode_DEFAULT&&(Ll.internal=!0,Ll.GravMassMode_DEFAULT=new sn,Ll.internal=!1),Ll.GravMassMode_DEFAULT},sn.FIXED=null,sn.get_FIXED=function(){return null==Ll.GravMassMode_FIXED&&(Ll.internal=!0,Ll.GravMassMode_FIXED=new sn,Ll.internal=!1),Ll.GravMassMode_FIXED},sn.SCALED=null,sn.get_SCALED=function(){return null==Ll.GravMassMode_SCALED&&(Ll.internal=!0,Ll.GravMassMode_SCALED=new sn,Ll.internal=!1),Ll.GravMassMode_SCALED},sn.prototype.toString=function(){return null==Ll.GravMassMode_DEFAULT&&(Ll.internal=!0,Ll.GravMassMode_DEFAULT=new sn,Ll.internal=!1),this==Ll.GravMassMode_DEFAULT?"DEFAULT":(null==Ll.GravMassMode_FIXED&&(Ll.internal=!0,Ll.GravMassMode_FIXED=new sn,Ll.internal=!1),this==Ll.GravMassMode_FIXED?"FIXED":(null==Ll.GravMassMode_SCALED&&(Ll.internal=!0,Ll.GravMassMode_SCALED=new sn,Ll.internal=!1),this==Ll.GravMassMode_SCALED?"SCALED":""))},Object.defineProperty(sn,"DEFAULT",{get:sn.get_DEFAULT}),Object.defineProperty(sn,"FIXED",{get:sn.get_FIXED}),Object.defineProperty(sn,"SCALED",{get:sn.get_SCALED}),sn.prototype.__class__=sn;var _n=nape.phys.InertiaMode=function(){};_n.__name__=["nape","phys","InertiaMode"],_n.DEFAULT=null,_n.get_DEFAULT=function(){return null==Ll.InertiaMode_DEFAULT&&(Ll.internal=!0,Ll.InertiaMode_DEFAULT=new _n,Ll.internal=!1),Ll.InertiaMode_DEFAULT},_n.FIXED=null,_n.get_FIXED=function(){return null==Ll.InertiaMode_FIXED&&(Ll.internal=!0,Ll.InertiaMode_FIXED=new _n,Ll.internal=!1),Ll.InertiaMode_FIXED},_n.prototype.toString=function(){return null==Ll.InertiaMode_DEFAULT&&(Ll.internal=!0,Ll.InertiaMode_DEFAULT=new _n,Ll.internal=!1),this==Ll.InertiaMode_DEFAULT?"DEFAULT":(null==Ll.InertiaMode_FIXED&&(Ll.internal=!0,Ll.InertiaMode_FIXED=new _n,Ll.internal=!1),this==Ll.InertiaMode_FIXED?"FIXED":"")},Object.defineProperty(_n,"DEFAULT",{get:_n.get_DEFAULT}),Object.defineProperty(_n,"FIXED",{get:_n.get_FIXED}),_n.prototype.__class__=_n;var et=nape.phys.InteractorIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};et.__name__=["nape","phys","InteractorIterator"],et.get=function(n){var t,e,i=null==et.zpp_pool?(ki.internal=!0,t=new et,ki.internal=!1,t):(e=et.zpp_pool,et.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},et.prototype.zpp_inner=null,et.prototype.zpp_i=null,et.prototype.zpp_critical=null,et.prototype.zpp_next=null,et.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=et.zpp_pool,(et.zpp_pool=this).zpp_inner=null,!1)},et.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},et.prototype.__class__=et;var hn=nape.phys.InteractorList=function(){this.zpp_inner=null,this.zpp_inner=new ki,this.zpp_inner.outer=this};hn.__name__=["nape","phys","InteractorList"],hn.fromArray=function(n){for(var t=new hn,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},hn.prototype.zpp_inner=null,hn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},hn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner_i)},hn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer_i},hn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner_i):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner_i)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},hn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner_i)):this.zpp_inner.inner.add(n.zpp_inner_i),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},hn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:t.next.elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer_i},hn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer_i},hn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},hn.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner_i){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner_i),this.zpp_inner.invalidate()),t},hn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},hn.prototype.empty=function(){return null==this.zpp_inner.inner.head},hn.prototype.iterator=function(){return this.zpp_inner.valmod(),et.get(this)},hn.prototype.copy=function(n){null==n&&(n=!1);var t=new hn;this.zpp_inner.valmod();for(var e=et.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=et.zpp_pool,(et.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},hn.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=et.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=et.zpp_pool,(et.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},hn.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=et.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=et.zpp_pool,(et.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},hn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=et.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=et.zpp_pool,(et.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=et.zpp_pool,(et.zpp_pool=t).zpp_inner=null;break}}return this},hn.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(hn.prototype,"length",{get:hn.prototype.get_length}),hn.prototype.__class__=hn;var un=nape.phys.MassMode=function(){};un.__name__=["nape","phys","MassMode"],un.DEFAULT=null,un.get_DEFAULT=function(){return null==Ll.MassMode_DEFAULT&&(Ll.internal=!0,Ll.MassMode_DEFAULT=new un,Ll.internal=!1),Ll.MassMode_DEFAULT},un.FIXED=null,un.get_FIXED=function(){return null==Ll.MassMode_FIXED&&(Ll.internal=!0,Ll.MassMode_FIXED=new un,Ll.internal=!1),Ll.MassMode_FIXED},un.prototype.toString=function(){return null==Ll.MassMode_DEFAULT&&(Ll.internal=!0,Ll.MassMode_DEFAULT=new un,Ll.internal=!1),this==Ll.MassMode_DEFAULT?"DEFAULT":(null==Ll.MassMode_FIXED&&(Ll.internal=!0,Ll.MassMode_FIXED=new un,Ll.internal=!1),this==Ll.MassMode_FIXED?"FIXED":"")},Object.defineProperty(un,"DEFAULT",{get:un.get_DEFAULT}),Object.defineProperty(un,"FIXED",{get:un.get_FIXED}),un.prototype.__class__=un;var xn=nape.phys.Material=function(n,t,e,i,p){null==p&&(p=.001),null==i&&(i=1),null==e&&(e=2),null==t&&(t=1),null==n&&(n=0),(this.zpp_inner=null)==Ht.zpp_pool?this.zpp_inner=new Ht:(this.zpp_inner=Ht.zpp_pool,Ht.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),n!=(this.zpp_inner.outer=this).zpp_inner.elasticity&&(this.zpp_inner.elasticity=+n,this.zpp_inner.invalidate(Ht.WAKE|Ht.ARBITERS)),t!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=+t,this.zpp_inner.invalidate(Ht.WAKE|Ht.ANGDRAG|Ht.ARBITERS)),e!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=+e,this.zpp_inner.invalidate(Ht.WAKE|Ht.ARBITERS)),i!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=i/1e3,this.zpp_inner.invalidate(Ht.WAKE|Ht.PROPS)),p!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=+p,this.zpp_inner.invalidate(Ht.WAKE|Ht.ARBITERS))};xn.__name__=["nape","phys","Material"],xn.wood=function(){return new xn(.4,.2,.38,.7,.005)},xn.steel=function(){return new xn(.2,.57,.74,7.8,.001)},xn.ice=function(){return new xn(.3,.03,.1,.9,1e-4)},xn.rubber=function(){return new xn(.8,1,1.4,1.5,.01)},xn.glass=function(){return new xn(.4,.4,.94,2.6,.002)},xn.sand=function(){return new xn(-1,.45,.6,1.6,16)},xn.prototype.zpp_inner=null,xn.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},xn.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=Ni.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},xn.prototype.copy=function(){var n=new xn(this.zpp_inner.elasticity,this.zpp_inner.dynamicFriction,this.zpp_inner.staticFriction,1e3*this.zpp_inner.density,this.zpp_inner.rollingFriction);return null!=this.zpp_inner.userData&&(n.zpp_inner.userData=x.copy(this.zpp_inner.userData)),n},xn.prototype.get_elasticity=function(){return this.zpp_inner.elasticity},xn.prototype.set_elasticity=function(n){return n!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=+n,this.zpp_inner.invalidate(Ht.WAKE|Ht.ARBITERS)),this.zpp_inner.elasticity},xn.prototype.get_dynamicFriction=function(){return this.zpp_inner.dynamicFriction},xn.prototype.set_dynamicFriction=function(n){return n!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=+n,this.zpp_inner.invalidate(Ht.WAKE|Ht.ANGDRAG|Ht.ARBITERS)),this.zpp_inner.dynamicFriction},xn.prototype.get_staticFriction=function(){return this.zpp_inner.staticFriction},xn.prototype.set_staticFriction=function(n){return n!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=+n,this.zpp_inner.invalidate(Ht.WAKE|Ht.ARBITERS)),this.zpp_inner.staticFriction},xn.prototype.get_density=function(){return 1e3*this.zpp_inner.density},xn.prototype.set_density=function(n){return n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate(Ht.WAKE|Ht.PROPS)),1e3*this.zpp_inner.density},xn.prototype.get_rollingFriction=function(){return this.zpp_inner.rollingFriction},xn.prototype.set_rollingFriction=function(n){return n!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=+n,this.zpp_inner.invalidate(Ht.WAKE|Ht.ARBITERS)),this.zpp_inner.rollingFriction},xn.prototype.toString=function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1e3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},Object.defineProperty(xn.prototype,"userData",{get:xn.prototype.get_userData}),Object.defineProperty(xn.prototype,"shapes",{get:xn.prototype.get_shapes}),Object.defineProperty(xn.prototype,"elasticity",{get:xn.prototype.get_elasticity,set:xn.prototype.set_elasticity}),Object.defineProperty(xn.prototype,"dynamicFriction",{get:xn.prototype.get_dynamicFriction,set:xn.prototype.set_dynamicFriction}),Object.defineProperty(xn.prototype,"staticFriction",{get:xn.prototype.get_staticFriction,set:xn.prototype.set_staticFriction}),Object.defineProperty(xn.prototype,"density",{get:xn.prototype.get_density,set:xn.prototype.set_density}),Object.defineProperty(xn.prototype,"rollingFriction",{get:xn.prototype.get_rollingFriction,set:xn.prototype.set_rollingFriction}),xn.prototype.__class__=xn;var vn=nape.shape.Shape=function(){this.zpp_inner=null,nn.call(this)};vn.__name__=["nape","shape","Shape"],vn.__super__=nn,vn.prototype=Object.create(nn.prototype),vn.prototype.zpp_inner=null,vn.prototype.get_type=function(){return $t.types[this.zpp_inner.type]},vn.prototype.isCircle=function(){return 0==this.zpp_inner.type},vn.prototype.isPolygon=function(){return 1==this.zpp_inner.type},vn.prototype.get_body=function(){return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},vn.prototype.set_body=function(n){var t;return this.zpp_inner.immutable_midstep("Shape::body"),(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null)!=n&&(null!=this.zpp_inner.body&&(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null).zpp_inner.wrap_shapes.remove(this),null!=n&&((t=n.zpp_inner.wrap_shapes).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},vn.prototype.get_castCircle=function(){return 0==this.zpp_inner.type?this.zpp_inner.circle.outer_zn:null},vn.prototype.get_castPolygon=function(){return 1==this.zpp_inner.type?this.zpp_inner.polygon.outer_zn:null},vn.prototype.get_worldCOM=function(){var n,t,e,i,p,l,r;return null==this.zpp_inner.wrap_worldCOM&&(n=this.zpp_inner.worldCOMx,t=this.zpp_inner.worldCOMy,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=e,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=Q(h=this.zpp_inner,h.getworldCOM)),this.zpp_inner.wrap_worldCOM},vn.prototype.get_localCOM=function(){return null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM()),this.zpp_inner.wrap_localCOM},vn.prototype.set_localCOM=function(n){this.zpp_inner.immutable_midstep("Body::localCOM"),null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM());var t=this.zpp_inner.wrap_localCOM,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM()),this.zpp_inner.wrap_localCOM},vn.prototype.get_area=function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.area},vn.prototype.get_inertia=function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.inertia},vn.prototype.get_angDrag=function(){return this.zpp_inner.validate_angDrag(),this.zpp_inner.angDrag},vn.prototype.get_material=function(){return this.zpp_inner.material.wrapper()},vn.prototype.set_material=function(n){return this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(n.zpp_inner),this.zpp_inner.material.wrapper()},vn.prototype.get_filter=function(){return this.zpp_inner.filter.wrapper()},vn.prototype.set_filter=function(n){return this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(n.zpp_inner),this.zpp_inner.filter.wrapper()},vn.prototype.get_fluidProperties=function(){return this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new an).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},vn.prototype.set_fluidProperties=function(n){return this.zpp_inner.setFluid(n.zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new an).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},vn.prototype.get_fluidEnabled=function(){return this.zpp_inner.fluidEnabled},vn.prototype.set_fluidEnabled=function(n){return this.zpp_inner.immutable_midstep("Shape::fluidEnabled"),(this.zpp_inner.fluidEnabled=n)&&null==this.zpp_inner.fluidProperties&&(this.zpp_inner.setFluid((new an).zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new an).zpp_inner),this.zpp_inner.fluidProperties.wrapper()),this.zpp_inner.wake(),this.zpp_inner.fluidEnabled},vn.prototype.get_sensorEnabled=function(){return this.zpp_inner.sensorEnabled},vn.prototype.set_sensorEnabled=function(n){return this.zpp_inner.immutable_midstep("Shape::sensorEnabled"),this.zpp_inner.sensorEnabled=n,this.zpp_inner.wake(),this.zpp_inner.sensorEnabled},vn.prototype.get_bounds=function(){return this.zpp_inner.aabb.wrapper()},vn.prototype.translate=function(n){var t,e,i,p,l,r,o;return this.zpp_inner.immutable_midstep("Shape::translate()"),0<n.lsq()&&(0==this.zpp_inner.type?(null!=(t=n.zpp_inner)._validate&&t._validate(),e=n.zpp_inner.x,null!=(i=n.zpp_inner)._validate&&i._validate(),this.zpp_inner.circle.__translate(e,n.zpp_inner.y)):(null!=(p=n.zpp_inner)._validate&&p._validate(),l=n.zpp_inner.x,null!=(r=n.zpp_inner)._validate&&r._validate(),this.zpp_inner.polygon.__translate(l,n.zpp_inner.y))),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),this},vn.prototype.scale=function(n,t){var e;return this.zpp_inner.immutable_midstep("Shape::scale()"),0==this.zpp_inner.type?(e=n*n-t*t)*e<co.epsilon*co.epsilon&&this.zpp_inner.circle.__scale(n,t):this.zpp_inner.polygon.__scale(n,t),this},vn.prototype.rotate=function(n){var t,e;return this.zpp_inner.immutable_midstep("Shape::rotate()"),n%(2*Math.PI)!=0&&(t=Math.cos(n),e=Math.sin(n),0==this.zpp_inner.type?this.zpp_inner.circle.__rotate(e,t):this.zpp_inner.polygon.__rotate(e,t)),this},vn.prototype.transform=function(n){return this.zpp_inner.immutable_midstep("Shape::transform()"),0==this.zpp_inner.type?n.equiorthogonal()&&this.zpp_inner.circle.__transform(n):this.zpp_inner.polygon.__transform(n),this},vn.prototype.contains=function(n){Mt.validateShape(this.zpp_inner);var t=n.zpp_inner;null!=t._validate&&t._validate();var e,i=vo.shapeContains(this.zpp_inner,n.zpp_inner);return n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=mo.zpp_pool,mo.zpp_pool=e),i},vn.prototype.copy=function(){return this.zpp_inner.copy()},vn.prototype.toString=function(){return(0==this.zpp_inner.type?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},Object.defineProperty(vn.prototype,"type",{get:vn.prototype.get_type}),Object.defineProperty(vn.prototype,"body",{get:vn.prototype.get_body,set:vn.prototype.set_body}),Object.defineProperty(vn.prototype,"castCircle",{get:vn.prototype.get_castCircle}),Object.defineProperty(vn.prototype,"castPolygon",{get:vn.prototype.get_castPolygon}),Object.defineProperty(vn.prototype,"worldCOM",{get:vn.prototype.get_worldCOM}),Object.defineProperty(vn.prototype,"localCOM",{get:vn.prototype.get_localCOM,set:vn.prototype.set_localCOM}),Object.defineProperty(vn.prototype,"area",{get:vn.prototype.get_area}),Object.defineProperty(vn.prototype,"inertia",{get:vn.prototype.get_inertia}),Object.defineProperty(vn.prototype,"angDrag",{get:vn.prototype.get_angDrag}),Object.defineProperty(vn.prototype,"material",{get:vn.prototype.get_material,set:vn.prototype.set_material}),Object.defineProperty(vn.prototype,"filter",{get:vn.prototype.get_filter,set:vn.prototype.set_filter}),Object.defineProperty(vn.prototype,"fluidProperties",{get:vn.prototype.get_fluidProperties,set:vn.prototype.set_fluidProperties}),Object.defineProperty(vn.prototype,"fluidEnabled",{get:vn.prototype.get_fluidEnabled,set:vn.prototype.set_fluidEnabled}),Object.defineProperty(vn.prototype,"sensorEnabled",{get:vn.prototype.get_sensorEnabled,set:vn.prototype.set_sensorEnabled}),Object.defineProperty(vn.prototype,"bounds",{get:vn.prototype.get_bounds}),vn.prototype.__class__=vn;var dn=nape.shape.Circle=function(n,t,e,i){var p,l,r;this.zpp_inner_zn=null,vn.call(this),this.zpp_inner_zn=new Qt,((this.zpp_inner_zn.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,(this.zpp_inner_i.outer_i=this).zpp_inner.immutable_midstep("Circle::radius"),n!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=n,this.zpp_inner_zn.invalidate_radius()),null==t?(this.zpp_inner.localCOMx=0,this.zpp_inner.localCOMy=0):(null!=(p=t.zpp_inner)._validate&&p._validate(),this.zpp_inner.localCOMx=t.zpp_inner.x,null!=(l=t.zpp_inner)._validate&&l._validate(),this.zpp_inner.localCOMy=t.zpp_inner.y,t.zpp_inner.weak&&(r=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Ri.poolVec2,Ri.poolVec2=t,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=mo.zpp_pool,mo.zpp_pool=r)),null==e?null==Ht.zpp_pool?this.zpp_inner.material=new Ht:(this.zpp_inner.material=Ht.zpp_pool,Ht.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(e.zpp_inner),this.zpp_inner.material.wrapper()),null==i?null==vt.zpp_pool?this.zpp_inner.filter=new vt:(this.zpp_inner.filter=vt.zpp_pool,vt.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(i.zpp_inner),this.zpp_inner.filter.wrapper()),this.zpp_inner_i.insert_cbtype(Ln.ANY_SHAPE.zpp_inner)};dn.__name__=["nape","shape","Circle"],dn.__super__=vn,dn.prototype=Object.create(vn.prototype),dn.prototype.zpp_inner_zn=null,dn.prototype.get_radius=function(){return this.zpp_inner_zn.radius},dn.prototype.set_radius=function(n){return this.zpp_inner.immutable_midstep("Circle::radius"),n!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=n,this.zpp_inner_zn.invalidate_radius()),this.zpp_inner_zn.radius},Object.defineProperty(dn.prototype,"radius",{get:dn.prototype.get_radius,set:dn.prototype.set_radius}),dn.prototype.__class__=dn;var yn=nape.shape.Edge=function(){this.zpp_inner=null};yn.__name__=["nape","shape","Edge"],yn.prototype.zpp_inner=null,yn.prototype.get_polygon=function(){return this.zpp_inner.polygon.outer_zn},yn.prototype.get_localNormal=function(){return null==this.zpp_inner.wrap_lnorm&&this.zpp_inner.getlnorm(),this.zpp_inner.wrap_lnorm},yn.prototype.get_worldNormal=function(){return null==this.zpp_inner.wrap_gnorm&&this.zpp_inner.getgnorm(),this.zpp_inner.wrap_gnorm},yn.prototype.get_length=function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.length},yn.prototype.get_localProjection=function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.lprojection},yn.prototype.get_worldProjection=function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var t=n.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var e=n.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i,i=i.next;l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}for(var o=n.edges.head,a=s=n.gverts.next,s=s.next;null!=s;){var _=s,h=o.elt,o=o.next;h.gp0=a,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=_,s=s.next}var u=o.elt;u.gp0=a,u.gp1=n.gverts.next,u.gnormx=n.body.axisy*u.lnormx-n.body.axisx*u.lnormy,u.gnormy=u.lnormx*n.body.axisx+u.lnormy*n.body.axisy,u.gprojection=n.body.posx*u.gnormx+n.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}return this.zpp_inner.gprojection},yn.prototype.get_localVertex1=function(){this.zpp_inner.polygon.validate_laxi();var n,t=this.zpp_inner.lp0;return null==t.outer&&(t.outer=new at,null!=(n=t.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=mo.zpp_pool,mo.zpp_pool=n,t.outer.zpp_inner=t),t.outer},yn.prototype.get_localVertex2=function(){this.zpp_inner.polygon.validate_laxi();var n,t=this.zpp_inner.lp1;return null==t.outer&&(t.outer=new at,null!=(n=t.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=mo.zpp_pool,mo.zpp_pool=n,t.outer.zpp_inner=t),t.outer},yn.prototype.get_worldVertex1=function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var t=n.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var e=n.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i,i=i.next;l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}for(var o=n.edges.head,a=s=n.gverts.next,s=s.next;null!=s;){var _=s,h=o.elt,o=o.next;h.gp0=a,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=_,s=s.next}var u=o.elt;u.gp0=a,u.gp1=n.gverts.next,u.gnormx=n.body.axisy*u.lnormx-n.body.axisx*u.lnormy,u.gnormy=u.lnormx*n.body.axisx+u.lnormy*n.body.axisy,u.gprojection=n.body.posx*u.gnormx+n.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}var x,d=this.zpp_inner.gp0;return null==d.outer&&(d.outer=new at,null!=(x=d.outer.zpp_inner).outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=mo.zpp_pool,mo.zpp_pool=x,d.outer.zpp_inner=d),d.outer},yn.prototype.get_worldVertex2=function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var t=n.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var e=n.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i,i=i.next;l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}for(var o=n.edges.head,a=s=n.gverts.next,s=s.next;null!=s;){var _=s,h=o.elt,o=o.next;h.gp0=a,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=_,s=s.next}var u=o.elt;u.gp0=a,u.gp1=n.gverts.next,u.gnormx=n.body.axisy*u.lnormx-n.body.axisx*u.lnormy,u.gnormy=u.lnormx*n.body.axisx+u.lnormy*n.body.axisy,u.gprojection=n.body.posx*u.gnormx+n.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}var x,d=this.zpp_inner.gp1;return null==d.outer&&(d.outer=new at,null!=(x=d.outer.zpp_inner).outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=mo.zpp_pool,mo.zpp_pool=x,d.outer.zpp_inner=d),d.outer},yn.prototype.toString=function(){if(null==this.zpp_inner.polygon)return"Edge(object-pooled)";if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } }";var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var t=n.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var e=n.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i,i=i.next;l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}for(var o=n.edges.head,a=s=n.gverts.next,s=s.next;null!=s;){var _=s,h=o.elt,o=o.next;h.gp0=a,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=_,s=s.next}var u=o.elt;u.gp0=a,u.gp1=n.gverts.next,u.gnormx=n.body.axisy*u.lnormx-n.body.axisx*u.lnormy,u.gnormy=u.lnormx*n.body.axisx+u.lnormy*n.body.axisy,u.gprojection=n.body.posx*u.gnormx+n.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}return"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } worldNormal : { x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" } }"},Object.defineProperty(yn.prototype,"polygon",{get:yn.prototype.get_polygon}),Object.defineProperty(yn.prototype,"localNormal",{get:yn.prototype.get_localNormal}),Object.defineProperty(yn.prototype,"worldNormal",{get:yn.prototype.get_worldNormal}),Object.defineProperty(yn.prototype,"length",{get:yn.prototype.get_length}),Object.defineProperty(yn.prototype,"localProjection",{get:yn.prototype.get_localProjection}),Object.defineProperty(yn.prototype,"worldProjection",{get:yn.prototype.get_worldProjection}),Object.defineProperty(yn.prototype,"localVertex1",{get:yn.prototype.get_localVertex1}),Object.defineProperty(yn.prototype,"localVertex2",{get:yn.prototype.get_localVertex2}),Object.defineProperty(yn.prototype,"worldVertex1",{get:yn.prototype.get_worldVertex1}),Object.defineProperty(yn.prototype,"worldVertex2",{get:yn.prototype.get_worldVertex2}),yn.prototype.__class__=yn;var it=nape.shape.EdgeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};it.__name__=["nape","shape","EdgeIterator"],it.get=function(n){var t,e,i=null==it.zpp_pool?(Ti.internal=!0,t=new it,Ti.internal=!1,t):(e=it.zpp_pool,it.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},it.prototype.zpp_inner=null,it.prototype.zpp_i=null,it.prototype.zpp_critical=null,it.prototype.zpp_next=null,it.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=it.zpp_pool,(it.zpp_pool=this).zpp_inner=null,!1)},it.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},it.prototype.__class__=it;var mn=nape.shape.EdgeList=function(){this.zpp_inner=null,this.zpp_inner=new Ti,this.zpp_inner.outer=this};mn.__name__=["nape","shape","EdgeList"],mn.fromArray=function(n){for(var t=new mn,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},mn.prototype.zpp_inner=null,mn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},mn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},mn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n==this.zpp_inner.user_length-1||(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-2-n)),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},mn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},mn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},mn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:t.next.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.wrapper()},mn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.wrapper()},mn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},mn.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},mn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},mn.prototype.empty=function(){return null==this.zpp_inner.inner.head},mn.prototype.iterator=function(){return this.zpp_inner.valmod(),it.get(this)},mn.prototype.copy=function(n){null==n&&(n=!1);var t=new mn;this.zpp_inner.valmod();for(var e=it.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=it.zpp_pool,(it.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},mn.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=it.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=it.zpp_pool,(it.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},mn.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=it.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=it.zpp_pool,(it.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},mn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=it.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=it.zpp_pool,(it.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=it.zpp_pool,(it.zpp_pool=t).zpp_inner=null;break}}return this},mn.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(mn.prototype,"length",{get:mn.prototype.get_length}),mn.prototype.__class__=mn;var fn=nape.shape.Polygon=function(n,t,e){if(this.zpp_inner_zn=null,vn.call(this),this.zpp_inner_zn=new te,((this.zpp_inner_zn.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,n instanceof Array&&null==n.__enum__)for(var i=n,p=0;p<i.length;){var l=i[p];++p;var r=l;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var o=this.zpp_inner_zn.wrap_lverts,a=r.zpp_inner;null!=a._validate&&a._validate();var s=r.zpp_inner.x,_=r.zpp_inner;null!=_._validate&&_._validate();var h,u,x,d,y,z=r.zpp_inner.y;null==Ri.poolVec2?h=new at:(h=Ri.poolVec2,Ri.poolVec2=h.zpp_pool,h.zpp_pool=null),null==h.zpp_inner?(null==mo.zpp_pool?u=new mo:(u=mo.zpp_pool,mo.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=s,u.y=z,h.zpp_inner=u,h.zpp_inner.outer=h):(null!=(x=h.zpp_inner)._validate&&x._validate(),h.zpp_inner.x==s&&(null!=(d=h.zpp_inner)._validate&&d._validate(),h.zpp_inner.y==z)||(h.zpp_inner.x=s,h.zpp_inner.y=z,null!=(y=h.zpp_inner)._invalidate&&y._invalidate(y))),h.zpp_inner.weak=!1,o.push(h)}else if(zn.__instanceof(n,cn))for(var c=n.iterator();;){c.zpp_inner.zpp_inner.valmod();var v=c.zpp_inner.zpp_gl();if(c.zpp_critical=!0,!(c.zpp_i<v||(c.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=c).zpp_inner=null,!1)))break;c.zpp_critical=!1;var m=c.zpp_inner.at(c.zpp_i++);null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var f=this.zpp_inner_zn.wrap_lverts,b=m.zpp_inner;null!=b._validate&&b._validate();var g=m.zpp_inner.x,w=m.zpp_inner;null!=w._validate&&w._validate();var M,C,k,O,P,S=m.zpp_inner.y;null==Ri.poolVec2?M=new at:(M=Ri.poolVec2,Ri.poolVec2=M.zpp_pool,M.zpp_pool=null),null==M.zpp_inner?(null==mo.zpp_pool?C=new mo:(C=mo.zpp_pool,mo.zpp_pool=C.next,C.next=null),C.weak=!1,C._immutable=!1,C.x=g,C.y=S,M.zpp_inner=C,M.zpp_inner.outer=M):(null!=(k=M.zpp_inner)._validate&&k._validate(),M.zpp_inner.x==g&&(null!=(O=M.zpp_inner)._validate&&O._validate(),M.zpp_inner.y==S)||(M.zpp_inner.x=g,M.zpp_inner.y=S,null!=(P=M.zpp_inner)._invalidate&&P._invalidate(P))),M.zpp_inner.weak=!1,f.push(M)}else if(zn.__instanceof(n,mi)){var A=n.zpp_inner.vertices;if(null!=A)for(var j=A;;){var E,I,T,N,L,V=j.x,D=j.y;null==Ri.poolVec2?E=new at:(E=Ri.poolVec2,Ri.poolVec2=E.zpp_pool,E.zpp_pool=null),null==E.zpp_inner?(null==mo.zpp_pool?I=new mo:(I=mo.zpp_pool,mo.zpp_pool=I.next,I.next=null),I.weak=!1,I._immutable=!1,I.x=V,I.y=D,E.zpp_inner=I,E.zpp_inner.outer=E):(null!=(T=E.zpp_inner)._validate&&T._validate(),E.zpp_inner.x==V&&(null!=(N=E.zpp_inner)._validate&&N._validate(),E.zpp_inner.y==D)||(E.zpp_inner.x=V,E.zpp_inner.y=D,null!=(L=E.zpp_inner)._invalidate&&L._invalidate(L))),E.zpp_inner.weak=!1;var F=E,j=j.next;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var R=this.zpp_inner_zn.wrap_lverts,Z=F.zpp_inner;null!=Z._validate&&Z._validate();var B=F.zpp_inner.x,G=F.zpp_inner;null!=G._validate&&G._validate();var q,U,K,W,Y,J=F.zpp_inner.y;null==Ri.poolVec2?q=new at:(q=Ri.poolVec2,Ri.poolVec2=q.zpp_pool,q.zpp_pool=null),null==q.zpp_inner?(null==mo.zpp_pool?U=new mo:(U=mo.zpp_pool,mo.zpp_pool=U.next,U.next=null),U.weak=!1,U._immutable=!1,U.x=B,U.y=J,q.zpp_inner=U,q.zpp_inner.outer=q):(null!=(K=q.zpp_inner)._validate&&K._validate(),q.zpp_inner.x==B&&(null!=(W=q.zpp_inner)._validate&&W._validate(),q.zpp_inner.y==J)||(q.zpp_inner.x=B,q.zpp_inner.y=J,null!=(Y=q.zpp_inner)._invalidate&&Y._invalidate(Y))),q.zpp_inner.weak=!1,R.push(q);var X=F.zpp_inner;F.zpp_inner.outer=null,F.zpp_inner=null;var H=F;H.zpp_pool=Ri.poolVec2,Ri.poolVec2=H;var $=X;if(null!=$.outer&&($.outer.zpp_inner=null,$.outer=null),$._isimmutable=null,$._validate=null,$._invalidate=null,$.next=mo.zpp_pool,mo.zpp_pool=$,j==A)break}}if(n instanceof Array&&null==n.__enum__)for(var Q=n,nn=0;nn<Q.length;){var tn,en,pn,ln=Q[nn],rn=!!ln.zpp_inner.weak&&(tn=ln.zpp_inner,ln.zpp_inner.outer=null,ln.zpp_inner=null,(en=ln).zpp_pool=Ri.poolVec2,Ri.poolVec2=en,null!=(pn=tn).outer&&(pn.outer.zpp_inner=null,pn.outer=null),pn._isimmutable=null,pn._validate=null,pn._invalidate=null,pn.next=mo.zpp_pool,mo.zpp_pool=pn,!0);rn?Q.splice(nn,1):++nn}else if(zn.__instanceof(n,cn)){var on=n;null!=on.zpp_inner._validate&&on.zpp_inner._validate();for(var an=on.zpp_inner.inner,sn=null,_n=an.head;null!=_n;){var hn,un,xn,dn,yn=_n.elt;yn.outer.zpp_inner.weak?(_n=an.erase(sn),yn.outer.zpp_inner.weak&&(un=(hn=yn.outer).zpp_inner,hn.zpp_inner.outer=null,hn.zpp_inner=null,(xn=hn).zpp_pool=Ri.poolVec2,Ri.poolVec2=xn,null!=(dn=un).outer&&(dn.outer.zpp_inner=null,dn.outer=null),dn._isimmutable=null,dn._validate=null,dn._invalidate=null,dn.next=mo.zpp_pool,mo.zpp_pool=dn)):_n=(sn=_n).next}}null==t?null==Ht.zpp_pool?this.zpp_inner.material=new Ht:(this.zpp_inner.material=Ht.zpp_pool,Ht.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(t.zpp_inner),this.zpp_inner.material.wrapper()),null==e?null==vt.zpp_pool?this.zpp_inner.filter=new vt:(this.zpp_inner.filter=vt.zpp_pool,vt.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(e.zpp_inner),this.zpp_inner.filter.wrapper()),this.zpp_inner_i.insert_cbtype(Ln.ANY_SHAPE.zpp_inner)};fn.__name__=["nape","shape","Polygon"],fn.__super__=vn,fn.prototype=Object.create(vn.prototype),fn.rect=function(n,t,e,i,p){var l,r,o,a,s;null==p&&(p=!1),null==Ri.poolVec2?l=new at:(l=Ri.poolVec2,Ri.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner?(null==mo.zpp_pool?r=new mo:(r=mo.zpp_pool,mo.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=n,r.y=t,l.zpp_inner=r,l.zpp_inner.outer=l):(null!=(o=l.zpp_inner)._validate&&o._validate(),l.zpp_inner.x==n&&(null!=(a=l.zpp_inner)._validate&&a._validate(),l.zpp_inner.y==t)||(l.zpp_inner.x=n,l.zpp_inner.y=t,null!=(s=l.zpp_inner)._invalidate&&s._invalidate(s))),l.zpp_inner.weak=p;var _,h,u,x,d,y=l,z=n+e;null==Ri.poolVec2?_=new at:(_=Ri.poolVec2,Ri.poolVec2=_.zpp_pool,_.zpp_pool=null),null==_.zpp_inner?(null==mo.zpp_pool?h=new mo:(h=mo.zpp_pool,mo.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=z,h.y=t,_.zpp_inner=h,_.zpp_inner.outer=_):(null!=(u=_.zpp_inner)._validate&&u._validate(),_.zpp_inner.x==z&&(null!=(x=_.zpp_inner)._validate&&x._validate(),_.zpp_inner.y==t)||(_.zpp_inner.x=z,_.zpp_inner.y=t,null!=(d=_.zpp_inner)._invalidate&&d._invalidate(d))),_.zpp_inner.weak=p;var c,v,m,f,b,g=_,w=n+e,M=t+i;null==Ri.poolVec2?c=new at:(c=Ri.poolVec2,Ri.poolVec2=c.zpp_pool,c.zpp_pool=null),null==c.zpp_inner?(null==mo.zpp_pool?v=new mo:(v=mo.zpp_pool,mo.zpp_pool=v.next,v.next=null),v.weak=!1,v._immutable=!1,v.x=w,v.y=M,c.zpp_inner=v,c.zpp_inner.outer=c):(null!=(m=c.zpp_inner)._validate&&m._validate(),c.zpp_inner.x==w&&(null!=(f=c.zpp_inner)._validate&&f._validate(),c.zpp_inner.y==M)||(c.zpp_inner.x=w,c.zpp_inner.y=M,null!=(b=c.zpp_inner)._invalidate&&b._invalidate(b))),c.zpp_inner.weak=p;var C,k,O,P,S,A=c,j=t+i;return null==Ri.poolVec2?C=new at:(C=Ri.poolVec2,Ri.poolVec2=C.zpp_pool,C.zpp_pool=null),null==C.zpp_inner?(null==mo.zpp_pool?k=new mo:(k=mo.zpp_pool,mo.zpp_pool=k.next,k.next=null),k.weak=!1,k._immutable=!1,k.x=n,k.y=j,C.zpp_inner=k,C.zpp_inner.outer=C):(null!=(O=C.zpp_inner)._validate&&O._validate(),C.zpp_inner.x==n&&(null!=(P=C.zpp_inner)._validate&&P._validate(),C.zpp_inner.y==j)||(C.zpp_inner.x=n,C.zpp_inner.y=j,null!=(S=C.zpp_inner)._invalidate&&S._invalidate(S))),C.zpp_inner.weak=p,[y,g,A,C]},fn.box=function(n,t,e){return null==e&&(e=!1),fn.rect(-n/2,-t/2,n,t,e)},fn.regular=function(n,t,e,i,p){null==p&&(p=!1),null==i&&(i=0);for(var l=[],r=2*Math.PI/e,o=0;o<e;){var a,s,_,h,u,x=o++*r+i,d=Math.cos(x)*n,y=Math.sin(x)*t;null==Ri.poolVec2?a=new at:(a=Ri.poolVec2,Ri.poolVec2=a.zpp_pool,a.zpp_pool=null),null==a.zpp_inner?(null==mo.zpp_pool?s=new mo:(s=mo.zpp_pool,mo.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=d,s.y=y,a.zpp_inner=s,a.zpp_inner.outer=a):(null!=(_=a.zpp_inner)._validate&&_._validate(),a.zpp_inner.x==d&&(null!=(h=a.zpp_inner)._validate&&h._validate(),a.zpp_inner.y==y)||(a.zpp_inner.x=d,a.zpp_inner.y=y,null!=(u=a.zpp_inner)._invalidate&&u._invalidate(u))),a.zpp_inner.weak=p,l.push(a)}return l},fn.prototype.zpp_inner_zn=null,fn.prototype.get_localVerts=function(){return null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts(),this.zpp_inner_zn.wrap_lverts},fn.prototype.get_worldVerts=function(){return null==this.zpp_inner_zn.wrap_gverts&&this.zpp_inner_zn.getgverts(),this.zpp_inner_zn.wrap_gverts},fn.prototype.get_edges=function(){return null==this.zpp_inner_zn.wrap_edges&&this.zpp_inner_zn.getedges(),this.zpp_inner_zn.wrap_edges},fn.prototype.validity=function(){return this.zpp_inner_zn.valid()},Object.defineProperty(fn.prototype,"localVerts",{get:fn.prototype.get_localVerts}),Object.defineProperty(fn.prototype,"worldVerts",{get:fn.prototype.get_worldVerts}),Object.defineProperty(fn.prototype,"edges",{get:fn.prototype.get_edges}),fn.prototype.__class__=fn;var st=nape.shape.ShapeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};st.__name__=["nape","shape","ShapeIterator"],st.get=function(n){var t,e,i=null==st.zpp_pool?(Ni.internal=!0,t=new st,Ni.internal=!1,t):(e=st.zpp_pool,st.zpp_pool=e.zpp_next,e);return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},st.prototype.zpp_inner=null,st.prototype.zpp_i=null,st.prototype.zpp_critical=null,st.prototype.zpp_next=null,st.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var t=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=st.zpp_pool,(st.zpp_pool=this).zpp_inner=null,!1)},st.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},st.prototype.__class__=st;var bn=nape.shape.ShapeList=function(){this.zpp_inner=null,this.zpp_inner=new Ni,this.zpp_inner.outer=this};bn.__name__=["nape","shape","ShapeList"],bn.fromArray=function(n){for(var t=new bn,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},bn.prototype.zpp_inner=null,bn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},bn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},bn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},bn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},bn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},bn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(n=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:t.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},bn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head.elt:n.next.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},bn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},bn.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},bn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},bn.prototype.empty=function(){return null==this.zpp_inner.inner.head},bn.prototype.iterator=function(){return this.zpp_inner.valmod(),st.get(this)},bn.prototype.copy=function(n){null==n&&(n=!1);var t=new bn;this.zpp_inner.valmod();for(var e=st.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=st.zpp_pool,(st.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},bn.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=st.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=st.zpp_pool,(st.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;var p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},bn.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=st.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=st.zpp_pool,(st.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},bn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=st.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var i=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<i||(t.zpp_next=st.zpp_pool,(st.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=st.zpp_pool,(st.zpp_pool=t).zpp_inner=null;break}}return this},bn.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(bn.prototype,"length",{get:bn.prototype.get_length}),bn.prototype.__class__=bn;var gn=nape.shape.ShapeType=function(){};gn.__name__=["nape","shape","ShapeType"],gn.CIRCLE=null,gn.get_CIRCLE=function(){return null==Ll.ShapeType_CIRCLE&&(Ll.internal=!0,Ll.ShapeType_CIRCLE=new gn,Ll.internal=!1),Ll.ShapeType_CIRCLE},gn.POLYGON=null,gn.get_POLYGON=function(){return null==Ll.ShapeType_POLYGON&&(Ll.internal=!0,Ll.ShapeType_POLYGON=new gn,Ll.internal=!1),Ll.ShapeType_POLYGON},gn.prototype.toString=function(){return null==Ll.ShapeType_CIRCLE&&(Ll.internal=!0,Ll.ShapeType_CIRCLE=new gn,Ll.internal=!1),this==Ll.ShapeType_CIRCLE?"CIRCLE":(null==Ll.ShapeType_POLYGON&&(Ll.internal=!0,Ll.ShapeType_POLYGON=new gn,Ll.internal=!1),this==Ll.ShapeType_POLYGON?"POLYGON":"")},Object.defineProperty(gn,"CIRCLE",{get:gn.get_CIRCLE}),Object.defineProperty(gn,"POLYGON",{get:gn.get_POLYGON}),gn.prototype.__class__=gn;var wn=nape.shape.ValidationResult=function(){};wn.__name__=["nape","shape","ValidationResult"],wn.VALID=null,wn.get_VALID=function(){return null==Ll.ValidationResult_VALID&&(Ll.internal=!0,Ll.ValidationResult_VALID=new wn,Ll.internal=!1),Ll.ValidationResult_VALID},wn.DEGENERATE=null,wn.get_DEGENERATE=function(){return null==Ll.ValidationResult_DEGENERATE&&(Ll.internal=!0,Ll.ValidationResult_DEGENERATE=new wn,Ll.internal=!1),Ll.ValidationResult_DEGENERATE},wn.CONCAVE=null,wn.get_CONCAVE=function(){return null==Ll.ValidationResult_CONCAVE&&(Ll.internal=!0,Ll.ValidationResult_CONCAVE=new wn,Ll.internal=!1),Ll.ValidationResult_CONCAVE},wn.SELF_INTERSECTING=null,wn.get_SELF_INTERSECTING=function(){return null==Ll.ValidationResult_SELF_INTERSECTING&&(Ll.internal=!0,Ll.ValidationResult_SELF_INTERSECTING=new wn,Ll.internal=!1),Ll.ValidationResult_SELF_INTERSECTING},wn.prototype.toString=function(){return null==Ll.ValidationResult_VALID&&(Ll.internal=!0,Ll.ValidationResult_VALID=new wn,Ll.internal=!1),this==Ll.ValidationResult_VALID?"VALID":(null==Ll.ValidationResult_DEGENERATE&&(Ll.internal=!0,Ll.ValidationResult_DEGENERATE=new wn,Ll.internal=!1),this==Ll.ValidationResult_DEGENERATE?"DEGENERATE":(null==Ll.ValidationResult_CONCAVE&&(Ll.internal=!0,Ll.ValidationResult_CONCAVE=new wn,Ll.internal=!1),this==Ll.ValidationResult_CONCAVE?"CONCAVE":(null==Ll.ValidationResult_SELF_INTERSECTING&&(Ll.internal=!0,Ll.ValidationResult_SELF_INTERSECTING=new wn,Ll.internal=!1),this==Ll.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")))},Object.defineProperty(wn,"VALID",{get:wn.get_VALID}),Object.defineProperty(wn,"DEGENERATE",{get:wn.get_DEGENERATE}),Object.defineProperty(wn,"CONCAVE",{get:wn.get_CONCAVE}),Object.defineProperty(wn,"SELF_INTERSECTING",{get:wn.get_SELF_INTERSECTING}),wn.prototype.__class__=wn;var Mn=nape.space.Broadphase=function(){};Mn.__name__=["nape","space","Broadphase"],Mn.DYNAMIC_AABB_TREE=null,Mn.get_DYNAMIC_AABB_TREE=function(){return null==Ll.Broadphase_DYNAMIC_AABB_TREE&&(Ll.internal=!0,Ll.Broadphase_DYNAMIC_AABB_TREE=new Mn,Ll.internal=!1),Ll.Broadphase_DYNAMIC_AABB_TREE},Mn.SWEEP_AND_PRUNE=null,Mn.get_SWEEP_AND_PRUNE=function(){return null==Ll.Broadphase_SWEEP_AND_PRUNE&&(Ll.internal=!0,Ll.Broadphase_SWEEP_AND_PRUNE=new Mn,Ll.internal=!1),Ll.Broadphase_SWEEP_AND_PRUNE},Mn.prototype.toString=function(){return null==Ll.Broadphase_DYNAMIC_AABB_TREE&&(Ll.internal=!0,Ll.Broadphase_DYNAMIC_AABB_TREE=new Mn,Ll.internal=!1),this==Ll.Broadphase_DYNAMIC_AABB_TREE?"DYNAMIC_AABB_TREE":(null==Ll.Broadphase_SWEEP_AND_PRUNE&&(Ll.internal=!0,Ll.Broadphase_SWEEP_AND_PRUNE=new Mn,Ll.internal=!1),this==Ll.Broadphase_SWEEP_AND_PRUNE?"SWEEP_AND_PRUNE":"")},Object.defineProperty(Mn,"DYNAMIC_AABB_TREE",{get:Mn.get_DYNAMIC_AABB_TREE}),Object.defineProperty(Mn,"SWEEP_AND_PRUNE",{get:Mn.get_SWEEP_AND_PRUNE}),Mn.prototype.__class__=Mn;var Cn=nape.space.Space=function(n,t){var e;this.zpp_inner=null,this.zpp_inner=new ae(null==n?null:n.zpp_inner,t),this.zpp_inner.outer=this,null!=n&&n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=mo.zpp_pool,mo.zpp_pool=e)};Cn.__name__=["nape","space","Space"],Cn.prototype.zpp_inner=null,Cn.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Cn.prototype.get_gravity=function(){return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},Cn.prototype.set_gravity=function(n){null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var t=this.zpp_inner.wrap_gravity,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r,o,a=n.zpp_inner.y,s=t.zpp_inner;return null!=s._validate&&s._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o),null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},Cn.prototype.get_broadphase=function(){return this.zpp_inner.bphase.is_sweep?(null==Ll.Broadphase_SWEEP_AND_PRUNE&&(Ll.internal=!0,Ll.Broadphase_SWEEP_AND_PRUNE=new Mn,Ll.internal=!1),Ll.Broadphase_SWEEP_AND_PRUNE):(null==Ll.Broadphase_DYNAMIC_AABB_TREE&&(Ll.internal=!0,Ll.Broadphase_DYNAMIC_AABB_TREE=new Mn,Ll.internal=!1),Ll.Broadphase_DYNAMIC_AABB_TREE)},Cn.prototype.get_sortContacts=function(){return this.zpp_inner.sortcontacts},Cn.prototype.set_sortContacts=function(n){return this.zpp_inner.sortcontacts=n,this.zpp_inner.sortcontacts},Cn.prototype.get_worldAngularDrag=function(){return this.zpp_inner.global_ang_drag},Cn.prototype.set_worldAngularDrag=function(n){return this.zpp_inner.global_ang_drag=n,this.zpp_inner.global_ang_drag},Cn.prototype.get_worldLinearDrag=function(){return this.zpp_inner.global_lin_drag},Cn.prototype.set_worldLinearDrag=function(n){return this.zpp_inner.global_lin_drag=n,this.zpp_inner.global_lin_drag},Cn.prototype.get_compounds=function(){return this.zpp_inner.wrap_compounds},Cn.prototype.get_bodies=function(){return this.zpp_inner.wrap_bodies},Cn.prototype.get_liveBodies=function(){return this.zpp_inner.wrap_live},Cn.prototype.get_constraints=function(){return this.zpp_inner.wrap_constraints},Cn.prototype.get_liveConstraints=function(){return this.zpp_inner.wrap_livecon},Cn.prototype.visitBodies=function(n){var t=this.zpp_inner.wrap_bodies;t.zpp_inner.valmod();for(var e=nt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=nt.zpp_pool,(nt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}var l=this.zpp_inner.wrap_compounds;l.zpp_inner.valmod();for(var r=tt.get(l);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a=o.zpp_inner.user_length;if(r.zpp_critical=!0,!(r.zpp_i<a||(r.zpp_next=tt.zpp_pool,(tt.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1,r.zpp_inner.at(r.zpp_i++).visitBodies(n)}},Cn.prototype.visitConstraints=function(n){var t=this.zpp_inner.wrap_constraints;t.zpp_inner.valmod();for(var e=Kn.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}var l=this.zpp_inner.wrap_compounds;l.zpp_inner.valmod();for(var r=tt.get(l);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a=o.zpp_inner.user_length;if(r.zpp_critical=!0,!(r.zpp_i<a||(r.zpp_next=tt.zpp_pool,(tt.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1,r.zpp_inner.at(r.zpp_i++).visitConstraints(n)}},Cn.prototype.visitCompounds=function(n){var t=this.zpp_inner.wrap_compounds;t.zpp_inner.valmod();for(var e=tt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=tt.zpp_pool,(tt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);n(l),l.visitCompounds(n)}},Cn.prototype.get_world=function(){return this.zpp_inner.__static},Cn.prototype.get_arbiters=function(){var n;return null==this.zpp_inner.wrap_arbiters&&((n=new ft).space=this.zpp_inner,this.zpp_inner.wrap_arbiters=n),this.zpp_inner.wrap_arbiters},Cn.prototype.get_listeners=function(){return this.zpp_inner.wrap_listeners},Cn.prototype.clear=function(){this.zpp_inner.clear()},Cn.prototype.step=function(n,t,e){null==e&&(e=10),null==t&&(t=10),this.zpp_inner.step(n,t,e)},Cn.prototype.get_timeStamp=function(){return this.zpp_inner.stamp},Cn.prototype.get_elapsedTime=function(){return this.zpp_inner.time},Cn.prototype.interactionType=function(n,t){if(1==(null!=n.zpp_inner.body?n.zpp_inner.body.outer:null).zpp_inner.type&&1==(null!=t.zpp_inner.body?t.zpp_inner.body.outer:null).zpp_inner.type)return null;if((null!=n.zpp_inner.body?n.zpp_inner.body.outer:null)==(null!=t.zpp_inner.body?t.zpp_inner.body.outer:null))return null;for(var e,i,p,l,r,o,a,s=n.zpp_inner,_=t.zpp_inner,h=s.body,u=_.body,x=!1,d=h.constraints.head;null!=d;){var y=d.elt;if(y.ignore&&y.pair_exists(h.id,u.id)){x=!0;break}d=d.next}if(x)e=!1;else{for(var z=s;null!=z&&null==z.group;)z=null!=z.ishape?z.ishape.body:null!=z.icompound?z.icompound.compound:z.ibody.compound;var c,v=null==z?null:z.group;if(null==v)c=!1;else{for(var m=_;null!=m&&null==m.group;)m=null!=m.ishape?m.ishape.body:null!=m.icompound?m.icompound.compound:m.ibody.compound;var f=null==m?null:m.group;if(null==f)c=!1;else{for(var b=!1;null!=v&&null!=f;){if(v==f){b=v.ignore;break}v.depth<f.depth?f=f.group:v=v.group}c=b}}e=!c}switch(e?!(!s.sensorEnabled&&!_.sensorEnabled)&&(i=s.filter,p=_.filter,0!=(i.sensorMask&p.sensorGroup)&&0!=(p.sensorMask&i.sensorGroup))?2:!!(!(!s.fluidEnabled&&!_.fluidEnabled)&&(l=s.filter,r=_.filter,0!=(l.fluidMask&r.fluidGroup)&&0!=(r.fluidMask&l.fluidGroup)))&&!(0==h.imass&&0==u.imass&&0==h.iinertia&&0==u.iinertia)?0:(o=s.filter,a=_.filter,0!=(o.collisionMask&a.collisionGroup)&&0!=(a.collisionMask&o.collisionGroup)&&!(0==h.imass&&0==u.imass&&0==h.iinertia&&0==u.iinertia)?1:-1):-1){case 0:return null==Ll.InteractionType_FLUID&&(Ll.internal=!0,Ll.InteractionType_FLUID=new g,Ll.internal=!1),Ll.InteractionType_FLUID;case 1:return null==Ll.InteractionType_COLLISION&&(Ll.internal=!0,Ll.InteractionType_COLLISION=new g,Ll.internal=!1),Ll.InteractionType_COLLISION;case 2:return null==Ll.InteractionType_SENSOR&&(Ll.internal=!0,Ll.InteractionType_SENSOR=new g,Ll.internal=!1),Ll.InteractionType_SENSOR;default:return null}},Cn.prototype.shapesUnderPoint=function(n,t,e){var i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r,o=this.zpp_inner.shapesUnderPoint(p,n.zpp_inner.y,null==t?null:t.zpp_inner,e);return n.zpp_inner.weak&&(r=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=mo.zpp_pool,mo.zpp_pool=r),o},Cn.prototype.bodiesUnderPoint=function(n,t,e){var i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r,o=this.zpp_inner.bodiesUnderPoint(p,n.zpp_inner.y,null==t?null:t.zpp_inner,e);return n.zpp_inner.weak&&(r=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=mo.zpp_pool,mo.zpp_pool=r),o},Cn.prototype.shapesInAABB=function(n,t,e,i,p){return null==e&&(e=!0),null==t&&(t=!1),this.zpp_inner.shapesInAABB(n,e,t,null==i?null:i.zpp_inner,p)},Cn.prototype.bodiesInAABB=function(n,t,e,i,p){return null==e&&(e=!0),null==t&&(t=!1),this.zpp_inner.bodiesInAABB(n,e,t,null==i?null:i.zpp_inner,p)},Cn.prototype.shapesInCircle=function(n,t,e,i,p){null==e&&(e=!1);var l,r=this.zpp_inner.shapesInCircle(n,t,e,null==i?null:i.zpp_inner,p);return n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=mo.zpp_pool,mo.zpp_pool=l),r},Cn.prototype.bodiesInCircle=function(n,t,e,i,p){null==e&&(e=!1);var l,r=this.zpp_inner.bodiesInCircle(n,t,e,null==i?null:i.zpp_inner,p);return n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=mo.zpp_pool,mo.zpp_pool=l),r},Cn.prototype.shapesInShape=function(n,t,e,i){return null==t&&(t=!1),this.zpp_inner.shapesInShape(n.zpp_inner,t,null==e?null:e.zpp_inner,i)},Cn.prototype.bodiesInShape=function(n,t,e,i){return null==t&&(t=!1),this.zpp_inner.bodiesInShape(n.zpp_inner,t,null==e?null:e.zpp_inner,i)},Cn.prototype.shapesInBody=function(n,t,e){var i=null==e?new bn:e,p=n.zpp_inner.wrap_shapes;p.zpp_inner.valmod();for(var l=st.get(p);;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o=r.zpp_inner.user_length;if(l.zpp_critical=!0,!(l.zpp_i<o||(l.zpp_next=st.zpp_pool,(st.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1,this.shapesInShape(l.zpp_inner.at(l.zpp_i++),!1,t,i)}return i},Cn.prototype.bodiesInBody=function(n,t,e){var i=null==e?new tn:e,p=n.zpp_inner.wrap_shapes;p.zpp_inner.valmod();for(var l=st.get(p);;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o=r.zpp_inner.user_length;if(l.zpp_critical=!0,!(l.zpp_i<o||(l.zpp_next=st.zpp_pool,(st.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1,this.bodiesInShape(l.zpp_inner.at(l.zpp_i++),!1,t,i)}return i},Cn.prototype.convexCast=function(n,t,e,i){return null==e&&(e=!1),this.zpp_inner.convexCast(n.zpp_inner,t,i,e)},Cn.prototype.convexMultiCast=function(n,t,e,i,p){return null==e&&(e=!1),this.zpp_inner.convexMultiCast(n.zpp_inner,t,i,e,p)},Cn.prototype.rayCast=function(n,t,e){return null==t&&(t=!1),this.zpp_inner.rayCast(n,t,e)},Cn.prototype.rayMultiCast=function(n,t,e,i){return null==t&&(t=!1),this.zpp_inner.rayMultiCast(n,t,e,i)},Object.defineProperty(Cn.prototype,"userData",{get:Cn.prototype.get_userData}),Object.defineProperty(Cn.prototype,"gravity",{get:Cn.prototype.get_gravity,set:Cn.prototype.set_gravity}),Object.defineProperty(Cn.prototype,"broadphase",{get:Cn.prototype.get_broadphase}),Object.defineProperty(Cn.prototype,"sortContacts",{get:Cn.prototype.get_sortContacts,set:Cn.prototype.set_sortContacts}),Object.defineProperty(Cn.prototype,"worldAngularDrag",{get:Cn.prototype.get_worldAngularDrag,set:Cn.prototype.set_worldAngularDrag}),Object.defineProperty(Cn.prototype,"worldLinearDrag",{get:Cn.prototype.get_worldLinearDrag,set:Cn.prototype.set_worldLinearDrag}),Object.defineProperty(Cn.prototype,"compounds",{get:Cn.prototype.get_compounds}),Object.defineProperty(Cn.prototype,"bodies",{get:Cn.prototype.get_bodies}),Object.defineProperty(Cn.prototype,"liveBodies",{get:Cn.prototype.get_liveBodies}),Object.defineProperty(Cn.prototype,"constraints",{get:Cn.prototype.get_constraints}),Object.defineProperty(Cn.prototype,"liveConstraints",{get:Cn.prototype.get_liveConstraints}),Object.defineProperty(Cn.prototype,"world",{get:Cn.prototype.get_world}),Object.defineProperty(Cn.prototype,"arbiters",{get:Cn.prototype.get_arbiters}),Object.defineProperty(Cn.prototype,"listeners",{get:Cn.prototype.get_listeners}),Object.defineProperty(Cn.prototype,"timeStamp",{get:Cn.prototype.get_timeStamp}),Object.defineProperty(Cn.prototype,"elapsedTime",{get:Cn.prototype.get_elapsedTime}),Cn.prototype.__class__=Cn;var kn=nape.util.Debug=function(){};kn.__name__=["nape","util","Debug"],kn.version=function(){return"Nape 2.0.19"},kn.clearObjectPools=function(){for(;null!=Kn.zpp_pool;){var n=Kn.zpp_pool.zpp_next;Kn.zpp_pool.zpp_next=null,Kn.zpp_pool=n}for(;null!=et.zpp_pool;){var t=et.zpp_pool.zpp_next;et.zpp_pool.zpp_next=null,et.zpp_pool=t}for(;null!=nt.zpp_pool;){var e=nt.zpp_pool.zpp_next;nt.zpp_pool.zpp_next=null,nt.zpp_pool=e}for(;null!=tt.zpp_pool;){var i=tt.zpp_pool.zpp_next;tt.zpp_pool.zpp_next=null,tt.zpp_pool=i}for(;null!=Un.zpp_pool;){var p=Un.zpp_pool.zpp_next;Un.zpp_pool.zpp_next=null,Un.zpp_pool=p}for(;null!=qn.zpp_pool;){var l=qn.zpp_pool.zpp_next;qn.zpp_pool.zpp_next=null,qn.zpp_pool=l}for(;null!=Xn.zpp_pool;){var r=Xn.zpp_pool.zpp_next;Xn.zpp_pool.zpp_next=null,Xn.zpp_pool=r}for(;null!=Hn.zpp_pool;){var o=Hn.zpp_pool.zpp_next;Hn.zpp_pool.zpp_next=null,Hn.zpp_pool=o}for(;null!=Qn.zpp_pool;){var a=Qn.zpp_pool.zpp_next;Qn.zpp_pool.zpp_next=null,Qn.zpp_pool=a}for(;null!=$n.zpp_pool;){var s=$n.zpp_pool.zpp_next;$n.zpp_pool.zpp_next=null,$n.zpp_pool=s}for(;null!=st.zpp_pool;){var _=st.zpp_pool.zpp_next;st.zpp_pool.zpp_next=null,st.zpp_pool=_}for(;null!=it.zpp_pool;){var h=it.zpp_pool.zpp_next;it.zpp_pool.zpp_next=null,it.zpp_pool=h}for(;null!=Yn.zpp_pool;){var u=Yn.zpp_pool.zpp_next;Yn.zpp_pool.zpp_next=null,Yn.zpp_pool=u}for(;null!=Wn.zpp_pool;){var x=Wn.zpp_pool.zpp_next;Wn.zpp_pool.zpp_next=null,Wn.zpp_pool=x}for(;null!=Jn.zpp_pool;){var d=Jn.zpp_pool.zpp_next;Jn.zpp_pool.zpp_next=null,Jn.zpp_pool=d}for(;null!=Ze.zpp_pool;){var y=Ze.zpp_pool.next;Ze.zpp_pool.next=null,Ze.zpp_pool=y}for(;null!=Be.zpp_pool;){var z=Be.zpp_pool.next;Be.zpp_pool.next=null,Be.zpp_pool=z}for(;null!=Ht.zpp_pool;){var c=Ht.zpp_pool.next;Ht.zpp_pool.next=null,Ht.zpp_pool=c}for(;null!=Ge.zpp_pool;){var v=Ge.zpp_pool.next;Ge.zpp_pool.next=null,Ge.zpp_pool=v}for(;null!=Xt.zpp_pool;){var m=Xt.zpp_pool.next;Xt.zpp_pool.next=null,Xt.zpp_pool=m}for(;null!=qe.zpp_pool;){var f=qe.zpp_pool.next;qe.zpp_pool.next=null,qe.zpp_pool=f}for(;null!=Ue.zpp_pool;){var b=Ue.zpp_pool.next;Ue.zpp_pool.next=null,Ue.zpp_pool=b}for(;null!=Ke.zpp_pool;){var g=Ke.zpp_pool.next;Ke.zpp_pool.next=null,Ke.zpp_pool=g}for(;null!=Gl.zpp_pool;){var w=Gl.zpp_pool.next;Gl.zpp_pool.next=null,Gl.zpp_pool=w}for(;null!=Zi.zpp_pool;){var M=Zi.zpp_pool.next;Zi.zpp_pool.next=null,Zi.zpp_pool=M}for(;null!=Nl.zpp_pool;){var C=Nl.zpp_pool.next;Nl.zpp_pool.next=null,Nl.zpp_pool=C}for(;null!=ql.zpp_pool;){var k=ql.zpp_pool.next;ql.zpp_pool.next=null,ql.zpp_pool=k}for(;null!=We.zpp_pool;){var O=We.zpp_pool.next;We.zpp_pool.next=null,We.zpp_pool=O}for(;null!=Ul.zpp_pool;){var P=Ul.zpp_pool.next;Ul.zpp_pool.next=null,Ul.zpp_pool=P}for(;null!=Ye.zpp_pool;){var S=Ye.zpp_pool.next;Ye.zpp_pool.next=null,Ye.zpp_pool=S}for(;null!=pt.zpp_pool;){var A=pt.zpp_pool.next;pt.zpp_pool.next=null,pt.zpp_pool=A}for(;null!=Tl.zpp_pool;){var j=Tl.zpp_pool.next;Tl.zpp_pool.next=null,Tl.zpp_pool=j}for(;null!=Je.zpp_pool;){var E=Je.zpp_pool.next;Je.zpp_pool.next=null,Je.zpp_pool=E}for(;null!=Xe.zpp_pool;){var I=Xe.zpp_pool.next;Xe.zpp_pool.next=null,Xe.zpp_pool=I}for(;null!=xp.zpp_pool;){var T=xp.zpp_pool.next;xp.zpp_pool.next=null,xp.zpp_pool=T}for(;null!=kt.zpp_pool;){var N=kt.zpp_pool.next;kt.zpp_pool.next=null,kt.zpp_pool=N}for(;null!=Pt.zpp_pool;){var L=Pt.zpp_pool.next;Pt.zpp_pool.next=null,Pt.zpp_pool=L}for(;null!=Bi.zpp_pool;){var V=Bi.zpp_pool.next;Bi.zpp_pool.next=null,Bi.zpp_pool=V}for(;null!=bi.zpp_pool;){var D=bi.zpp_pool.next;bi.zpp_pool.next=null,bi.zpp_pool=D}for(;null!=gi.zpp_pool;){var F=gi.zpp_pool.next;gi.zpp_pool.next=null,gi.zpp_pool=F}for(;null!=He.zpp_pool;){var R=He.zpp_pool.next;He.zpp_pool.next=null,He.zpp_pool=R}for(;null!=$e.zpp_pool;){var Z=$e.zpp_pool.next;$e.zpp_pool.next=null,$e.zpp_pool=Z}for(;null!=mo.zpp_pool;){var B=mo.zpp_pool.next;mo.zpp_pool.next=null,mo.zpp_pool=B}for(;null!=Qe.zpp_pool;){var G=Qe.zpp_pool.next;Qe.zpp_pool.next=null,Qe.zpp_pool=G}for(;null!=jt.zpp_pool;){var q=jt.zpp_pool.next;jt.zpp_pool.next=null,jt.zpp_pool=q}for(;null!=Gi.zpp_pool;){var U=Gi.zpp_pool.next;Gi.zpp_pool.next=null,Gi.zpp_pool=U}for(;null!=Ft.zpp_pool;){var K=Ft.zpp_pool.next;Ft.zpp_pool.next=null,Ft.zpp_pool=K}for(;null!=Rt.zpp_pool;){var W=Rt.zpp_pool.next;Rt.zpp_pool.next=null,Rt.zpp_pool=W}for(;null!=Et.zpp_pool;){var Y=Et.zpp_pool.next;Et.zpp_pool.next=null,Et.zpp_pool=Y}for(;null!=ni.zpp_pool;){var J=ni.zpp_pool.next;ni.zpp_pool.next=null,ni.zpp_pool=J}for(;null!=ti.zpp_pool;){var X=ti.zpp_pool.next;ti.zpp_pool.next=null,ti.zpp_pool=X}for(;null!=Bt.zpp_pool;){var H=Bt.zpp_pool.next;Bt.zpp_pool.next=null,Bt.zpp_pool=H}for(;null!=qi.zpp_pool;){var $=qi.zpp_pool.next;qi.zpp_pool.next=null,qi.zpp_pool=$}for(;null!=ei.zpp_pool;){var Q=ei.zpp_pool.next;ei.zpp_pool.next=null,ei.zpp_pool=Q}for(;null!=Al.zpp_pool;){var nn=Al.zpp_pool.next;Al.zpp_pool.next=null,Al.zpp_pool=nn}for(;null!=Ui.zpp_pool;){var tn=Ui.zpp_pool.next;Ui.zpp_pool.next=null,Ui.zpp_pool=tn}for(;null!=Tt.zpp_pool;){var en=Tt.zpp_pool.next;Tt.zpp_pool.next=null,Tt.zpp_pool=en}for(;null!=Nt.zpp_pool;){var pn=Nt.zpp_pool.next;Nt.zpp_pool.next=null,Nt.zpp_pool=pn}for(;null!=Ki.zpp_pool;){var ln=Ki.zpp_pool.next;Ki.zpp_pool.next=null,Ki.zpp_pool=ln}for(;null!=Wi.zpp_pool;){var rn=Wi.zpp_pool.next;Wi.zpp_pool.next=null,Wi.zpp_pool=rn}for(;null!=Lt.zpp_pool;){var on=Lt.zpp_pool.next;Lt.zpp_pool.next=null,Lt.zpp_pool=on}for(;null!=de.zpp_pool;){var an=de.zpp_pool.next;de.zpp_pool.next=null,de.zpp_pool=an}for(;null!=qt.zpp_pool;){var sn=qt.zpp_pool.next;qt.zpp_pool.next=null,qt.zpp_pool=sn}for(;null!=ii.zpp_pool;){var _n=ii.zpp_pool.next;ii.zpp_pool.next=null,ii.zpp_pool=_n}for(;null!=pi.zpp_pool;){var hn=pi.zpp_pool.next;pi.zpp_pool.next=null,pi.zpp_pool=hn}for(;null!=Ot.zpp_pool;){var un=Ot.zpp_pool.next;Ot.zpp_pool.next=null,Ot.zpp_pool=un}for(;null!=dp.zpp_pool;){var xn=dp.zpp_pool.next;dp.zpp_pool.next=null,dp.zpp_pool=xn}for(;null!=li.zpp_pool;){var dn=li.zpp_pool.next;li.zpp_pool.next=null,li.zpp_pool=dn}for(;null!=ne.zpp_pool;){var yn=ne.zpp_pool.next;ne.zpp_pool.next=null,ne.zpp_pool=yn}for(;null!=ip.zpp_pool;){var zn=ip.zpp_pool.next;ip.zpp_pool.next=null,ip.zpp_pool=zn}for(;null!=oi.zpp_pool;){var cn=oi.zpp_pool.next;oi.zpp_pool.next=null,oi.zpp_pool=cn}for(;null!=se.zpp_pool;){var vn=se.zpp_pool.next;se.zpp_pool.next=null,se.zpp_pool=vn}for(;null!=jl.zpp_pool;){var mn=jl.zpp_pool.next;jl.zpp_pool.next=null,jl.zpp_pool=mn}for(;null!=ep.zpp_pool;){var fn=ep.zpp_pool.next;ep.zpp_pool.next=null,ep.zpp_pool=fn}for(;null!=ai.zpp_pool;){var bn=ai.zpp_pool.next;ai.zpp_pool.next=null,ai.zpp_pool=bn}for(;null!=Rl.zpp_pool;){var gn=Rl.zpp_pool.next;Rl.zpp_pool.next=null,Rl.zpp_pool=gn}for(;null!=si.zpp_pool;){var wn=si.zpp_pool.next;si.zpp_pool.next=null,si.zpp_pool=wn}for(;null!=pe.zpp_pool;){var Mn=pe.zpp_pool.next;pe.zpp_pool.next=null,pe.zpp_pool=Mn}for(;null!=re.zpp_pool;){var Cn=re.zpp_pool.next;re.zpp_pool.next=null,re.zpp_pool=Cn}for(;null!=Bl.zpp_pool;){var kn=Bl.zpp_pool.next;Bl.zpp_pool.next=null,Bl.zpp_pool=kn}for(;null!=Vl.zpp_pool;){var On=Vl.zpp_pool.next;Vl.zpp_pool.next=null,Vl.zpp_pool=On}for(;null!=Dl.zpp_pool;){var Pn=Dl.zpp_pool.next;Dl.zpp_pool.next=null,Dl.zpp_pool=Pn}for(;null!=Yi.zpp_pool;){var Sn=Yi.zpp_pool.next;Yi.zpp_pool.next=null,Yi.zpp_pool=Sn}for(;null!=Kl.zpp_pool;){var An=Kl.zpp_pool.next;Kl.zpp_pool.next=null,Kl.zpp_pool=An}for(;null!=Fl.zpp_pool;){var jn=Fl.zpp_pool.next;Fl.zpp_pool.next=null,Fl.zpp_pool=jn}for(;null!=Wl.zpp_pool;){var En=Wl.zpp_pool.next;Wl.zpp_pool.next=null,Wl.zpp_pool=En}for(;null!=_i.zpp_pool;){var In=_i.zpp_pool.next;_i.zpp_pool.next=null,_i.zpp_pool=In}for(;null!=Yl.zpp_pool;){var Tn=Yl.zpp_pool.next;Yl.zpp_pool.next=null,Yl.zpp_pool=Tn}for(;null!=hi.zpp_pool;){var Nn=hi.zpp_pool.next;hi.zpp_pool.next=null,hi.zpp_pool=Nn}for(;null!=ui.zpp_pool;){var Ln=ui.zpp_pool.next;ui.zpp_pool.next=null,ui.zpp_pool=Ln}for(;null!=vt.zpp_pool;){var Vn=vt.zpp_pool.next;vt.zpp_pool.next=null,vt.zpp_pool=Vn}for(;null!=xi.zpp_pool;){var Dn=xi.zpp_pool.next;xi.zpp_pool.next=null,xi.zpp_pool=Dn}for(;null!=di.zpp_pool;){var Fn=di.zpp_pool.next;di.zpp_pool.next=null,di.zpp_pool=Fn}for(;null!=yi.zpp_pool;){var Rn=yi.zpp_pool.next;yi.zpp_pool.next=null,yi.zpp_pool=Rn}for(;null!=Ri.poolGeomPoly;){var Zn=Ri.poolGeomPoly.zpp_pool;Ri.poolGeomPoly.zpp_pool=null,Ri.poolGeomPoly=Zn}for(;null!=Ri.poolVec2;){var Bn=Ri.poolVec2.zpp_pool;Ri.poolVec2.zpp_pool=null,Ri.poolVec2=Bn}for(;null!=Ri.poolVec3;){var Gn=Ri.poolVec3.zpp_pool;Ri.poolVec3.zpp_pool=null,Ri.poolVec3=Gn}},kn.prototype.__class__=kn;var On=sandbox.Main=function(){};On.__name__=["sandbox","Main"],On.main=function(){},On.prototype.__class__=On;var Pn=zpp_nape.ZPP_Const=function(){};Pn.__name__=["zpp_nape","ZPP_Const"],Pn.POSINF=function(){return 1/0},Pn.NEGINF=function(){return-1/0},Pn.prototype.__class__=Pn;var Sn=zpp_nape.ZPP_ID=function(){};Sn.__name__=["zpp_nape","ZPP_ID"],Sn.Constraint=function(){return Sn._Constraint++},Sn.Interactor=function(){return Sn._Interactor++},Sn.CbType=function(){return Sn._CbType++},Sn.CbSet=function(){return Sn._CbSet++},Sn.Listener=function(){return Sn._Listener++},Sn.ZPP_SimpleVert=function(){return Sn._ZPP_SimpleVert++},Sn.ZPP_SimpleSeg=function(){return Sn._ZPP_SimpleSeg++},Sn.Space=function(){return Sn._Space++},Sn.InteractionGroup=function(){return Sn._InteractionGroup++},Sn.prototype.__class__=Sn;var pt=zpp_nape.callbacks.ZPP_Callback=function(){this.constraint=null,this.body=null,this.pre_swapped=!1,this.pre_arbiter=null,this.wrap_arbiters=null,this.set=null,this.int2=null,this.int1=null,this.length=0,this.prev=null,this.next=null,this.index=0,this.space=null,this.listener=null,this.event=0,this.outer_int=null,this.outer_con=null,this.outer_body=null,this.length=0};pt.__name__=["zpp_nape","callbacks","ZPP_Callback"],pt.prototype.outer_body=null,pt.prototype.outer_con=null,pt.prototype.outer_int=null,pt.prototype.wrapper_body=function(){return null==this.outer_body&&(this.outer_body=new e,this.outer_body.zpp_inner=this),this.outer_body},pt.prototype.wrapper_con=function(){return null==this.outer_con&&(this.outer_con=new r,this.outer_con.zpp_inner=this),this.outer_con},pt.prototype.wrapper_int=function(){return null==this.outer_int&&(this.outer_int=new a,this.outer_int.zpp_inner=this),null==this.wrap_arbiters?this.wrap_arbiters=Vi.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null,this.outer_int},pt.prototype.event=null,pt.prototype.listener=null,pt.prototype.space=null,pt.prototype.index=null,pt.prototype.next=null,pt.prototype.prev=null,pt.prototype.length=null,pt.prototype.push=function(n){null!=this.prev?this.prev.next=n:this.next=n,n.prev=this.prev,n.next=null,this.prev=n,this.length++},pt.prototype.push_rev=function(n){null!=this.next?this.next.prev=n:this.prev=n,n.next=this.next,n.prev=null,this.next=n,this.length++},pt.prototype.pop=function(){var n=this.next;return this.next=n.next,null==this.next?this.prev=null:this.next.prev=null,this.length--,n},pt.prototype.pop_rev=function(){var n=this.prev;return this.prev=n.prev,null==this.prev?this.next=null:this.prev.next=null,this.length--,n},pt.prototype.empty=function(){return null==this.next},pt.prototype.clear=function(){for(;!this.empty();)this.pop()},pt.prototype.splice=function(n){var t=n.next;return null==n.prev?(this.next=n.next,null!=this.next?this.next.prev=null:this.prev=null):(n.prev.next=n.next,null!=n.next?n.next.prev=n.prev:this.prev=n.prev),this.length--,t},pt.prototype.rotateL=function(){this.push(this.pop())},pt.prototype.rotateR=function(){this.push_rev(this.pop_rev())},pt.prototype.cycleNext=function(n){return null==n.next?this.next:n.next},pt.prototype.cyclePrev=function(n){return null==n.prev?this.prev:n.prev},pt.prototype.at=function(n){for(var t=this.next;0!=n--;)t=t.next;return t},pt.prototype.rev_at=function(n){for(var t=this.prev;0!=n--;)t=t.prev;return t},pt.prototype.free=function(){this.int1=this.int2=null,this.body=null,this.constraint=null,(this.listener=null)!=this.wrap_arbiters&&(this.wrap_arbiters.zpp_inner.inner=null),this.set=null},pt.prototype.alloc=function(){},pt.prototype.int1=null,pt.prototype.int2=null,pt.prototype.set=null,pt.prototype.wrap_arbiters=null,pt.prototype.pre_arbiter=null,pt.prototype.pre_swapped=null,pt.prototype.genarbs=function(){null==this.wrap_arbiters?this.wrap_arbiters=Vi.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null},pt.prototype.body=null,pt.prototype.constraint=null,pt.prototype.__class__=pt;var Tl=zpp_nape.callbacks.ZPP_CbSet=function(){this.wrap_constraints=null,this.constraints=null,this.wrap_interactors=null,this.interactors=null,this.zip_conlisteners=!1,this.conlisteners=null,this.zip_bodylisteners=!1,this.bodylisteners=null,this.zip_listeners=!1,this.listeners=null,this.cbpairs=null,this.manager=null,this.id=0,this.next=null,this.count=0,this.cbTypes=null,this.cbTypes=new Rn,this.listeners=new An,this.zip_listeners=!0,this.bodylisteners=new jn,this.zip_bodylisteners=!0,this.conlisteners=new En,this.zip_conlisteners=!0,this.constraints=new In,this.interactors=new Tn,this.id=Sn.CbSet(),this.cbpairs=new be};Tl.__name__=["zpp_nape","callbacks","ZPP_CbSet"],Tl.setlt=function(n,t){for(var e=n.cbTypes.head,i=t.cbTypes.head;null!=e&&null!=i;){var p=e.elt,l=i.elt;if(p.id<l.id)return!0;if(l.id<p.id)return!1;e=e.next,i=i.next}return null!=i&&null==e},Tl.get=function(n){var t;null==Tl.zpp_pool?t=new Tl:(t=Tl.zpp_pool,Tl.zpp_pool=t.next,t.next=null);for(var e=null,i=n.head;null!=i;){var p=i.elt,e=t.cbTypes.insert(e,p);p.cbsets.add(t),i=i.next}return t},Tl.compatible=function(n,t,e){var i,p,l=n.options1,r=t.cbTypes;if(!(!l.nonemptyintersection(r,l.includes)||l.nonemptyintersection(r,l.excludes))&&(i=n.options2,p=e.cbTypes,!!i.nonemptyintersection(p,i.includes)&&!i.nonemptyintersection(p,i.excludes)))return!0;var o=n.options2,a=t.cbTypes;if(!o.nonemptyintersection(a,o.includes)||o.nonemptyintersection(a,o.excludes))return!1;var s=n.options1,_=e.cbTypes;return!!s.nonemptyintersection(_,s.includes)&&!s.nonemptyintersection(_,s.excludes)},Tl.empty_intersection=function(n,t){for(var e,i=null,p=(n.cbpairs.length<t.cbpairs.length?n.cbpairs:t.cbpairs).head;null!=p;){var l=p.elt;if(l.a==n&&l.b==t||l.a==t&&l.b==n){i=l;break}p=p.next}return null==i&&(null==Nl.zpp_pool?e=new Nl:(e=Nl.zpp_pool,Nl.zpp_pool=e.next,e.next=null),e.zip_listeners=!0,Tl.setlt(n,t)?(e.a=n,e.b=t):(e.a=t,e.b=n),i=e,n.cbpairs.add(i),t!=n&&t.cbpairs.add(i)),i.zip_listeners&&(i.zip_listeners=!1,i.__validate()),null==i.listeners.head},Tl.single_intersection=function(n,t,e){for(var i,p=null,l=(n.cbpairs.length<t.cbpairs.length?n.cbpairs:t.cbpairs).head;null!=l;){var r=l.elt;if(r.a==n&&r.b==t||r.a==t&&r.b==n){p=r;break}l=l.next}null==p&&(null==Nl.zpp_pool?i=new Nl:(i=Nl.zpp_pool,Nl.zpp_pool=i.next,i.next=null),i.zip_listeners=!0,Tl.setlt(n,t)?(i.a=n,i.b=t):(i.a=t,i.b=n),p=i,n.cbpairs.add(p),t!=n&&t.cbpairs.add(p)),p.zip_listeners&&(p.zip_listeners=!1,p.__validate());var o=p.listeners.head;return null!=o&&o.elt==e&&null==o.next},Tl.find_all=function(n,t,e,i){for(var p,l=null,r=(n.cbpairs.length<t.cbpairs.length?n.cbpairs:t.cbpairs).head;null!=r;){var o=r.elt;if(o.a==n&&o.b==t||o.a==t&&o.b==n){l=o;break}r=r.next}null==l&&(null==Nl.zpp_pool?p=new Nl:(p=Nl.zpp_pool,Nl.zpp_pool=p.next,p.next=null),p.zip_listeners=!0,Tl.setlt(n,t)?(p.a=n,p.b=t):(p.a=t,p.b=n),l=p,n.cbpairs.add(l),t!=n&&t.cbpairs.add(l)),l.zip_listeners&&(l.zip_listeners=!1,l.__validate());for(var a=l.listeners.head;null!=a;){var s=a.elt;s.event==e&&i(s),a=a.next}},Tl.prototype.cbTypes=null,Tl.prototype.count=null,Tl.prototype.next=null,Tl.prototype.id=null,Tl.prototype.manager=null,Tl.prototype.cbpairs=null,Tl.prototype.increment=function(){this.count++},Tl.prototype.decrement=function(){return 0==--this.count},Tl.prototype.invalidate_pairs=function(){for(var n=this.cbpairs.head;null!=n;)n.elt.zip_listeners=!0,n=n.next},Tl.prototype.listeners=null,Tl.prototype.zip_listeners=null,Tl.prototype.invalidate_listeners=function(){this.zip_listeners=!0,this.invalidate_pairs()},Tl.prototype.validate_listeners=function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners())},Tl.prototype.realvalidate_listeners=function(){this.listeners.clear();for(var n=this.cbTypes.head;null!=n;){for(var t=null,e=this.listeners.head,i=n.elt.listeners.head;null!=i;){var p,l,r,o,a=i.elt;null!=e&&e.elt==a?(i=i.next,e=(t=e).next):null==e||(p=e.elt,!(a.precedence<=p.precedence)||a.precedence==p.precedence&&a.id>p.id)?(a.space==this.manager.space&&(l=this.listeners,null==ql.zpp_pool?r=new ql:(r=ql.zpp_pool,ql.zpp_pool=r.next,r.next=null),r.elt=a,o=r,null==t?(o.next=l.head,l.head=o):(o.next=t.next,t.next=o),l.pushmod=l.modified=!0,l.length++,t=o),i=i.next):e=(t=e).next}n=n.next}},Tl.prototype.bodylisteners=null,Tl.prototype.zip_bodylisteners=null,Tl.prototype.invalidate_bodylisteners=function(){this.zip_bodylisteners=!0},Tl.prototype.validate_bodylisteners=function(){this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners())},Tl.prototype.realvalidate_bodylisteners=function(){this.bodylisteners.clear();for(var n=this.cbTypes.head;null!=n;){for(var t=null,e=this.bodylisteners.head,i=n.elt.bodylisteners.head;null!=i;){var p,l,r,o,a,s=i.elt;null!=e&&e.elt==s?(i=i.next,e=(t=e).next):null==e||(p=e.elt,!(s.precedence<=p.precedence)||s.precedence==p.precedence&&s.id>p.id)?(!(l=s.options).nonemptyintersection(this.cbTypes,l.excludes)&&s.space==this.manager.space&&(r=this.bodylisteners,null==Ye.zpp_pool?o=new Ye:(o=Ye.zpp_pool,Ye.zpp_pool=o.next,o.next=null),o.elt=s,a=o,null==t?(a.next=r.head,r.head=a):(a.next=t.next,t.next=a),r.pushmod=r.modified=!0,r.length++,t=a),i=i.next):e=(t=e).next}n=n.next}},Tl.prototype.conlisteners=null,Tl.prototype.zip_conlisteners=null,Tl.prototype.invalidate_conlisteners=function(){this.zip_conlisteners=!0},Tl.prototype.validate_conlisteners=function(){this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},Tl.prototype.realvalidate_conlisteners=function(){this.conlisteners.clear();for(var n=this.cbTypes.head;null!=n;){for(var t=null,e=this.conlisteners.head,i=n.elt.conlisteners.head;null!=i;){var p,l,r,o,a,s=i.elt;null!=e&&e.elt==s?(i=i.next,e=(t=e).next):null==e||(p=e.elt,!(s.precedence<=p.precedence)||s.precedence==p.precedence&&s.id>p.id)?(!(l=s.options).nonemptyintersection(this.cbTypes,l.excludes)&&s.space==this.manager.space&&(r=this.conlisteners,null==Xe.zpp_pool?o=new Xe:(o=Xe.zpp_pool,Xe.zpp_pool=o.next,o.next=null),o.elt=s,a=o,null==t?(a.next=r.head,r.head=a):(a.next=t.next,t.next=a),r.pushmod=r.modified=!0,r.length++,t=a),i=i.next):e=(t=e).next}n=n.next}},Tl.prototype.validate=function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners()),this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners()),this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},Tl.prototype.interactors=null,Tl.prototype.wrap_interactors=null,Tl.prototype.constraints=null,Tl.prototype.wrap_constraints=null,Tl.prototype.addConstraint=function(n){this.constraints.add(n)},Tl.prototype.addInteractor=function(n){this.interactors.add(n)},Tl.prototype.remConstraint=function(n){this.constraints.remove(n)},Tl.prototype.remInteractor=function(n){this.interactors.remove(n)},Tl.prototype.free=function(){for(this.listeners.clear(),this.zip_listeners=!0,this.bodylisteners.clear(),this.zip_bodylisteners=!0,this.conlisteners.clear(),this.zip_conlisteners=!0;null!=this.cbTypes.head;)this.cbTypes.pop_unsafe().cbsets.remove(this)},Tl.prototype.alloc=function(){},Tl.prototype.__class__=Tl;var Nl=zpp_nape.callbacks.ZPP_CbSetPair=function(){this.listeners=null,this.zip_listeners=!1,this.next=null,this.b=null,this.a=null,this.listeners=new An};Nl.__name__=["zpp_nape","callbacks","ZPP_CbSetPair"],Nl.get=function(n,t){var e;return null==Nl.zpp_pool?e=new Nl:(e=Nl.zpp_pool,Nl.zpp_pool=e.next,e.next=null),e.zip_listeners=!0,Tl.setlt(n,t)?(e.a=n,e.b=t):(e.a=t,e.b=n),e},Nl.setlt=function(n,t){return!!Tl.setlt(n.a,t.a)||n.a==t.a&&Tl.setlt(n.b,t.b)},Nl.prototype.a=null,Nl.prototype.b=null,Nl.prototype.next=null,Nl.prototype.free=function(){this.a=this.b=null,this.listeners.clear()},Nl.prototype.alloc=function(){this.zip_listeners=!0},Nl.prototype.compatible=function(n){var t,e,i=n.options1,p=this.a.cbTypes;if(!(!i.nonemptyintersection(p,i.includes)||i.nonemptyintersection(p,i.excludes))&&(t=n.options2,e=this.b.cbTypes,!!t.nonemptyintersection(e,t.includes)&&!t.nonemptyintersection(e,t.excludes)))return!0;var l=n.options2,r=this.a.cbTypes;if(!l.nonemptyintersection(r,l.includes)||l.nonemptyintersection(r,l.excludes))return!1;var o=n.options1,a=this.b.cbTypes;return!!o.nonemptyintersection(a,o.includes)&&!o.nonemptyintersection(a,o.excludes)},Nl.prototype.zip_listeners=null,Nl.prototype.listeners=null,Nl.prototype.invalidate=function(){this.zip_listeners=!0},Nl.prototype.validate=function(){this.zip_listeners&&(this.zip_listeners=!1,this.__validate())},Nl.prototype.__validate=function(){this.listeners.clear();for(var n=this.a.listeners.head,t=this.b.listeners.head;null!=n&&null!=t;){var e,i,p,l,r,o,a,s,_=n.elt,h=t.elt;_==h?(e=_.options1,i=this.a.cbTypes,(!!(!(!e.nonemptyintersection(i,e.includes)||e.nonemptyintersection(i,e.excludes))&&(p=_.options2,l=this.b.cbTypes,!!p.nonemptyintersection(l,p.includes)&&!p.nonemptyintersection(l,p.excludes)))||(r=_.options2,o=this.a.cbTypes,!(!r.nonemptyintersection(o,r.includes)||r.nonemptyintersection(o,r.excludes))&&(a=_.options1,s=this.b.cbTypes,!!a.nonemptyintersection(s,a.includes)&&!a.nonemptyintersection(s,a.excludes))))&&this.listeners.add(_),n=n.next,t=t.next):_.precedence>h.precedence||_.precedence==h.precedence&&_.id>h.id?n=n.next:t=t.next}},Nl.prototype.empty_intersection=function(){return null==this.listeners.head},Nl.prototype.single_intersection=function(n){var t=this.listeners.head;return null!=t&&t.elt==n&&null==t.next},Nl.prototype.forall=function(n,t){for(var e=this.listeners.head;null!=e;){var i=e.elt;i.event==n&&t(i),e=e.next}},Nl.prototype.__class__=Nl;var An=zpp_nape.util.ZNPList_ZPP_InteractionListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};An.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionListener"],An.prototype.head=null,An.prototype.begin=function(){return this.head},An.prototype.modified=null,An.prototype.pushmod=null,An.prototype.length=null,An.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},An.prototype.add=function(n){var t;null==ql.zpp_pool?t=new ql:(t=ql.zpp_pool,ql.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},An.prototype.inlined_add=function(n){var t;null==ql.zpp_pool?t=new ql:(t=ql.zpp_pool,ql.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},An.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},An.prototype.insert=function(n,t){var e;null==ql.zpp_pool?e=new ql:(e=ql.zpp_pool,ql.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},An.prototype.inlined_insert=function(n,t){var e;null==ql.zpp_pool?e=new ql:(e=ql.zpp_pool,ql.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},An.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ql.zpp_pool,ql.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},An.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ql.zpp_pool,ql.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},An.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},An.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},An.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ql.zpp_pool,ql.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},An.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},An.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ql.zpp_pool,ql.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},An.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ql.zpp_pool,ql.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},An.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ql.zpp_pool,ql.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},An.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ql.zpp_pool,ql.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},An.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},An.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ql.zpp_pool,ql.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},An.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ql.zpp_pool,ql.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},An.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},An.prototype.empty=function(){return null==this.head},An.prototype.size=function(){return this.length},An.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},An.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},An.prototype.front=function(){return this.head.elt},An.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},An.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},An.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},An.prototype.__class__=An;var jn=zpp_nape.util.ZNPList_ZPP_BodyListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};jn.__name__=["zpp_nape","util","ZNPList_ZPP_BodyListener"],jn.prototype.head=null,jn.prototype.begin=function(){return this.head},jn.prototype.modified=null,jn.prototype.pushmod=null,jn.prototype.length=null,jn.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},jn.prototype.add=function(n){var t;null==Ye.zpp_pool?t=new Ye:(t=Ye.zpp_pool,Ye.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},jn.prototype.inlined_add=function(n){var t;null==Ye.zpp_pool?t=new Ye:(t=Ye.zpp_pool,Ye.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},jn.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},jn.prototype.insert=function(n,t){var e;null==Ye.zpp_pool?e=new Ye:(e=Ye.zpp_pool,Ye.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},jn.prototype.inlined_insert=function(n,t){var e;null==Ye.zpp_pool?e=new Ye:(e=Ye.zpp_pool,Ye.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},jn.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ye.zpp_pool,Ye.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},jn.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ye.zpp_pool,Ye.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},jn.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},jn.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},jn.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ye.zpp_pool,Ye.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},jn.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},jn.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ye.zpp_pool,Ye.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},jn.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Ye.zpp_pool,Ye.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},jn.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ye.zpp_pool,Ye.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},jn.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ye.zpp_pool,Ye.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},jn.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},jn.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ye.zpp_pool,Ye.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},jn.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ye.zpp_pool,Ye.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},jn.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},jn.prototype.empty=function(){return null==this.head},jn.prototype.size=function(){return this.length},jn.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},jn.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},jn.prototype.front=function(){return this.head.elt},jn.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},jn.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},jn.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},jn.prototype.__class__=jn;var En=zpp_nape.util.ZNPList_ZPP_ConstraintListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};En.__name__=["zpp_nape","util","ZNPList_ZPP_ConstraintListener"],En.prototype.head=null,En.prototype.begin=function(){return this.head},En.prototype.modified=null,En.prototype.pushmod=null,En.prototype.length=null,En.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},En.prototype.add=function(n){var t;null==Xe.zpp_pool?t=new Xe:(t=Xe.zpp_pool,Xe.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},En.prototype.inlined_add=function(n){var t;null==Xe.zpp_pool?t=new Xe:(t=Xe.zpp_pool,Xe.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},En.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},En.prototype.insert=function(n,t){var e;null==Xe.zpp_pool?e=new Xe:(e=Xe.zpp_pool,Xe.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},En.prototype.inlined_insert=function(n,t){var e;null==Xe.zpp_pool?e=new Xe:(e=Xe.zpp_pool,Xe.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},En.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Xe.zpp_pool,Xe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},En.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Xe.zpp_pool,Xe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},En.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},En.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},En.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Xe.zpp_pool,Xe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},En.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},En.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Xe.zpp_pool,Xe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},En.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Xe.zpp_pool,Xe.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},En.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Xe.zpp_pool,Xe.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},En.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Xe.zpp_pool,Xe.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},En.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},En.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Xe.zpp_pool,Xe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},En.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Xe.zpp_pool,Xe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},En.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},En.prototype.empty=function(){return null==this.head},En.prototype.size=function(){return this.length},En.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},En.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},En.prototype.front=function(){return this.head.elt},En.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},En.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},En.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},En.prototype.__class__=En;var In=zpp_nape.util.ZNPList_ZPP_Constraint=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};In.__name__=["zpp_nape","util","ZNPList_ZPP_Constraint"],In.prototype.head=null,In.prototype.begin=function(){return this.head},In.prototype.modified=null,In.prototype.pushmod=null,In.prototype.length=null,In.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},In.prototype.add=function(n){var t;null==Ue.zpp_pool?t=new Ue:(t=Ue.zpp_pool,Ue.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},In.prototype.inlined_add=function(n){var t;null==Ue.zpp_pool?t=new Ue:(t=Ue.zpp_pool,Ue.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},In.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},In.prototype.insert=function(n,t){var e;null==Ue.zpp_pool?e=new Ue:(e=Ue.zpp_pool,Ue.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},In.prototype.inlined_insert=function(n,t){var e;null==Ue.zpp_pool?e=new Ue:(e=Ue.zpp_pool,Ue.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},In.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ue.zpp_pool,Ue.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},In.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ue.zpp_pool,Ue.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},In.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},In.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},In.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ue.zpp_pool,Ue.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},In.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},In.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ue.zpp_pool,Ue.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},In.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Ue.zpp_pool,Ue.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},In.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ue.zpp_pool,Ue.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},In.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ue.zpp_pool,Ue.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},In.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},In.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ue.zpp_pool,Ue.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},In.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ue.zpp_pool,Ue.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},In.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},In.prototype.empty=function(){return null==this.head},In.prototype.size=function(){return this.length},In.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},In.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},In.prototype.front=function(){return this.head.elt},In.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},In.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},In.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},In.prototype.__class__=In;var Tn=zpp_nape.util.ZNPList_ZPP_Interactor=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Tn.__name__=["zpp_nape","util","ZNPList_ZPP_Interactor"],Tn.prototype.head=null,Tn.prototype.begin=function(){return this.head},Tn.prototype.modified=null,Tn.prototype.pushmod=null,Tn.prototype.length=null,Tn.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Tn.prototype.add=function(n){var t;null==Ul.zpp_pool?t=new Ul:(t=Ul.zpp_pool,Ul.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Tn.prototype.inlined_add=function(n){var t;null==Ul.zpp_pool?t=new Ul:(t=Ul.zpp_pool,Ul.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Tn.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Tn.prototype.insert=function(n,t){var e;null==Ul.zpp_pool?e=new Ul:(e=Ul.zpp_pool,Ul.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Tn.prototype.inlined_insert=function(n,t){var e;null==Ul.zpp_pool?e=new Ul:(e=Ul.zpp_pool,Ul.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Tn.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ul.zpp_pool,Ul.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Tn.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ul.zpp_pool,Ul.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Tn.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Tn.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Tn.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ul.zpp_pool,Ul.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Tn.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Tn.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ul.zpp_pool,Ul.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Tn.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Ul.zpp_pool,Ul.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Tn.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ul.zpp_pool,Ul.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Tn.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ul.zpp_pool,Ul.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Tn.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Tn.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ul.zpp_pool,Ul.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Tn.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ul.zpp_pool,Ul.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Tn.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Tn.prototype.empty=function(){return null==this.head},Tn.prototype.size=function(){return this.length},Tn.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Tn.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Tn.prototype.front=function(){return this.head.elt},Tn.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Tn.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Tn.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Tn.prototype.__class__=Tn;var Nn=zpp_nape.util.ZNPList_ZPP_CbSet=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Nn.__name__=["zpp_nape","util","ZNPList_ZPP_CbSet"],Nn.prototype.head=null,Nn.prototype.begin=function(){return this.head},Nn.prototype.modified=null,Nn.prototype.pushmod=null,Nn.prototype.length=null,Nn.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Nn.prototype.add=function(n){var t;null==We.zpp_pool?t=new We:(t=We.zpp_pool,We.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Nn.prototype.inlined_add=function(n){var t;null==We.zpp_pool?t=new We:(t=We.zpp_pool,We.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Nn.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Nn.prototype.insert=function(n,t){var e;null==We.zpp_pool?e=new We:(e=We.zpp_pool,We.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Nn.prototype.inlined_insert=function(n,t){var e;null==We.zpp_pool?e=new We:(e=We.zpp_pool,We.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Nn.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=We.zpp_pool,We.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Nn.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=We.zpp_pool,We.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Nn.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Nn.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Nn.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=We.zpp_pool,We.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Nn.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Nn.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=We.zpp_pool,We.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Nn.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=We.zpp_pool,We.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Nn.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=We.zpp_pool,We.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Nn.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=We.zpp_pool,We.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Nn.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Nn.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=We.zpp_pool,We.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Nn.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=We.zpp_pool,We.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Nn.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Nn.prototype.empty=function(){return null==this.head},Nn.prototype.size=function(){return this.length},Nn.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Nn.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Nn.prototype.front=function(){return this.head.elt},Nn.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Nn.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Nn.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Nn.prototype.__class__=Nn;var Ln=zpp_nape.callbacks.ZPP_CbType=function(){this.conlisteners=null,this.bodylisteners=null,this.listeners=null,this.cbsets=null,this.id=0,this.userData=null,this.outer=null,this.id=Sn.CbType(),this.listeners=new An,this.bodylisteners=new jn,this.conlisteners=new En,this.constraints=new In,this.interactors=new Tn,this.cbsets=new Nn};Ln.__name__=["zpp_nape","callbacks","ZPP_CbType"],Ln.setlt=function(n,t){return n.id<t.id},Ln.prototype.outer=null,Ln.prototype.userData=null,Ln.prototype.id=null,Ln.prototype.cbsets=null,Ln.prototype.interactors=null,Ln.prototype.wrap_interactors=null,Ln.prototype.constraints=null,Ln.prototype.wrap_constraints=null,Ln.prototype.addConstraint=function(n){this.constraints.add(n)},Ln.prototype.addInteractor=function(n){this.interactors.add(n)},Ln.prototype.remConstraint=function(n){this.constraints.remove(n)},Ln.prototype.remInteractor=function(n){this.interactors.remove(n)},Ln.prototype.listeners=null,Ln.prototype.addint=function(n){for(var t=null,e=this.listeners.head;null!=e;){var i=e.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=(t=e).next}var p,l=this.listeners;null==ql.zpp_pool?p=new ql:(p=ql.zpp_pool,ql.zpp_pool=p.next,p.next=null),p.elt=n;var r=p;null==t?(r.next=l.head,l.head=r):(r.next=t.next,t.next=r),l.pushmod=l.modified=!0,l.length++;for(var o=this.cbsets.head;null!=o;){var a=o.elt;a.zip_listeners=!0,a.invalidate_pairs(),o=o.next}},Ln.prototype.removeint=function(n){this.listeners.remove(n);for(var t=this.cbsets.head;null!=t;){var e=t.elt;e.zip_listeners=!0,e.invalidate_pairs(),t=t.next}},Ln.prototype.invalidateint=function(){for(var n=this.cbsets.head;null!=n;){var t=n.elt;t.zip_listeners=!0,t.invalidate_pairs(),n=n.next}},Ln.prototype.bodylisteners=null,Ln.prototype.addbody=function(n){for(var t=null,e=this.bodylisteners.head;null!=e;){var i=e.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=(t=e).next}var p,l=this.bodylisteners;null==Ye.zpp_pool?p=new Ye:(p=Ye.zpp_pool,Ye.zpp_pool=p.next,p.next=null),p.elt=n;var r=p;null==t?(r.next=l.head,l.head=r):(r.next=t.next,t.next=r),l.pushmod=l.modified=!0,l.length++;for(var o=this.cbsets.head;null!=o;)o.elt.zip_bodylisteners=!0,o=o.next},Ln.prototype.removebody=function(n){this.bodylisteners.remove(n);for(var t=this.cbsets.head;null!=t;)t.elt.zip_bodylisteners=!0,t=t.next},Ln.prototype.invalidatebody=function(){for(var n=this.cbsets.head;null!=n;)n.elt.zip_bodylisteners=!0,n=n.next},Ln.prototype.conlisteners=null,Ln.prototype.addconstraint=function(n){for(var t=null,e=this.conlisteners.head;null!=e;){var i=e.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=(t=e).next}var p,l=this.conlisteners;null==Xe.zpp_pool?p=new Xe:(p=Xe.zpp_pool,Xe.zpp_pool=p.next,p.next=null),p.elt=n;var r=p;null==t?(r.next=l.head,l.head=r):(r.next=t.next,t.next=r),l.pushmod=l.modified=!0,l.length++;for(var o=this.cbsets.head;null!=o;)o.elt.zip_conlisteners=!0,o=o.next},Ln.prototype.removeconstraint=function(n){this.conlisteners.remove(n);for(var t=this.cbsets.head;null!=t;)t.elt.zip_conlisteners=!0,t=t.next},Ln.prototype.invalidateconstraint=function(){for(var n=this.cbsets.head;null!=n;)n.elt.zip_conlisteners=!0,n=n.next},Ln.prototype.__class__=Ln;var Ll=zpp_nape.util.ZPP_Flags=function(){};Ll.__name__=["zpp_nape","util","ZPP_Flags"],Ll.GravMassMode_DEFAULT=null,Ll.GravMassMode_FIXED=null,Ll.GravMassMode_SCALED=null,Ll.InertiaMode_DEFAULT=null,Ll.InertiaMode_FIXED=null,Ll.MassMode_DEFAULT=null,Ll.MassMode_FIXED=null,Ll.BodyType_STATIC=null,Ll.BodyType_DYNAMIC=null,Ll.BodyType_KINEMATIC=null,Ll.ListenerType_BODY=null,Ll.PreFlag_ACCEPT=null,Ll.ListenerType_CONSTRAINT=null,Ll.PreFlag_IGNORE=null,Ll.ListenerType_INTERACTION=null,Ll.PreFlag_ACCEPT_ONCE=null,Ll.ListenerType_PRE=null,Ll.PreFlag_IGNORE_ONCE=null,Ll.CbEvent_BEGIN=null,Ll.InteractionType_COLLISION=null,Ll.CbEvent_ONGOING=null,Ll.InteractionType_SENSOR=null,Ll.CbEvent_END=null,Ll.InteractionType_FLUID=null,Ll.CbEvent_WAKE=null,Ll.InteractionType_ANY=null,Ll.CbEvent_SLEEP=null,Ll.CbEvent_BREAK=null,Ll.CbEvent_PRE=null,Ll.Winding_UNDEFINED=null,Ll.Winding_CLOCKWISE=null,Ll.Winding_ANTICLOCKWISE=null,Ll.ValidationResult_VALID=null,Ll.ValidationResult_DEGENERATE=null,Ll.ValidationResult_CONCAVE=null,Ll.ValidationResult_SELF_INTERSECTING=null,Ll.ShapeType_CIRCLE=null,Ll.ShapeType_POLYGON=null,Ll.Broadphase_DYNAMIC_AABB_TREE=null,Ll.Broadphase_SWEEP_AND_PRUNE=null,Ll.ArbiterType_COLLISION=null,Ll.ArbiterType_SENSOR=null,Ll.ArbiterType_FLUID=null,Ll.prototype.__class__=Ll;var Vn=zpp_nape.callbacks.ZPP_Listener=function(){this.space=null,this.interaction=null,this.constraint=null,this.body=null,this.precedence=0,this.event=0,this.type=0,this.id=0,this.outer=null,this.id=Sn.Listener()};Vn.__name__=["zpp_nape","callbacks","ZPP_Listener"],Vn.setlt=function(n,t){return!(n.precedence<=t.precedence)||n.precedence==t.precedence&&n.id>t.id},Vn.prototype.outer=null,Vn.prototype.id=null,Vn.prototype.type=null,Vn.prototype.event=null,Vn.prototype.precedence=null,Vn.prototype.body=null,Vn.prototype.constraint=null,Vn.prototype.interaction=null,Vn.prototype.space=null,Vn.prototype.swapEvent=function(n){},Vn.prototype.invalidate_precedence=function(){},Vn.prototype.addedToSpace=function(){},Vn.prototype.removedFromSpace=function(){},Vn.prototype.__class__=Vn;var Dn=zpp_nape.callbacks.ZPP_BodyListener=function(n,t,e){this.handler=null,this.options=null,this.outer_zn=null,Vn.call(this),this.event=t,this.handler=e,(this.body=this).type=0,this.options=n.zpp_inner};Dn.__name__=["zpp_nape","callbacks","ZPP_BodyListener"],Dn.__super__=Vn,Dn.prototype=Object.create(Vn.prototype),Dn.prototype.outer_zn=null,Dn.prototype.options=null,Dn.prototype.handler=null,Dn.prototype.addedToSpace=function(){this.options.handler=Q(this,this.cbtype_change);for(var n=this.options.includes.head;null!=n;){for(var t=n.elt,e=null,i=t.bodylisteners.head;null!=i;){var p=i.elt;if(this.precedence>p.precedence||this.precedence==p.precedence&&this.id>p.id)break;i=(e=i).next}var l,r=t.bodylisteners;null==Ye.zpp_pool?l=new Ye:(l=Ye.zpp_pool,Ye.zpp_pool=l.next,l.next=null),l.elt=this;var o=l;null==e?(o.next=r.head,r.head=o):(o.next=e.next,e.next=o),r.pushmod=r.modified=!0,r.length++;for(var a=t.cbsets.head;null!=a;)a.elt.zip_bodylisteners=!0,a=a.next;n=n.next}},Dn.prototype.removedFromSpace=function(){for(var n=this.options.includes.head;null!=n;){var t=n.elt;t.bodylisteners.remove(this);for(var e=t.cbsets.head;null!=e;)e.elt.zip_bodylisteners=!0,e=e.next;n=n.next}this.options.handler=null},Dn.prototype.cbtype_change=function(n,t,e){this.removedFromSpace();var i=this.options;if(t)if(e){for(var p=null,l=i.includes.head;null!=l&&!(n.id<l.elt.id);)l=(p=l).next;var r,o=i.includes;null==Ze.zpp_pool?r=new Ze:(r=Ze.zpp_pool,Ze.zpp_pool=r.next,r.next=null),r.elt=n;var a=r;null==p?(a.next=o.head,o.head=a):(a.next=p.next,p.next=a),o.pushmod=o.modified=!0,o.length++}else i.includes.remove(n);else if(e){for(var s=null,_=i.excludes.head;null!=_&&!(n.id<_.elt.id);)_=(s=_).next;var h,u=i.excludes;null==Ze.zpp_pool?h=new Ze:(h=Ze.zpp_pool,Ze.zpp_pool=h.next,h.next=null),h.elt=n;var x=h;null==s?(x.next=u.head,u.head=x):(x.next=s.next,s.next=x),u.pushmod=u.modified=!0,u.length++}else i.excludes.remove(n);this.addedToSpace()},Dn.prototype.invalidate_precedence=function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},Dn.prototype.swapEvent=function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},Dn.prototype.__class__=Dn;var Fn=zpp_nape.callbacks.ZPP_ConstraintListener=function(n,t,e){this.handler=null,this.options=null,this.outer_zn=null,Vn.call(this),this.event=t,this.handler=e,(this.constraint=this).type=1,this.options=n.zpp_inner};Fn.__name__=["zpp_nape","callbacks","ZPP_ConstraintListener"],Fn.__super__=Vn,Fn.prototype=Object.create(Vn.prototype),Fn.prototype.outer_zn=null,Fn.prototype.options=null,Fn.prototype.handler=null,Fn.prototype.addedToSpace=function(){this.options.handler=Q(this,this.cbtype_change);for(var n=this.options.includes.head;null!=n;){for(var t=n.elt,e=null,i=t.conlisteners.head;null!=i;){var p=i.elt;if(this.precedence>p.precedence||this.precedence==p.precedence&&this.id>p.id)break;i=(e=i).next}var l,r=t.conlisteners;null==Xe.zpp_pool?l=new Xe:(l=Xe.zpp_pool,Xe.zpp_pool=l.next,l.next=null),l.elt=this;var o=l;null==e?(o.next=r.head,r.head=o):(o.next=e.next,e.next=o),r.pushmod=r.modified=!0,r.length++;for(var a=t.cbsets.head;null!=a;)a.elt.zip_conlisteners=!0,a=a.next;n=n.next}},Fn.prototype.removedFromSpace=function(){for(var n=this.options.includes.head;null!=n;){var t=n.elt;t.conlisteners.remove(this);for(var e=t.cbsets.head;null!=e;)e.elt.zip_conlisteners=!0,e=e.next;n=n.next}this.options.handler=null},Fn.prototype.cbtype_change=function(n,t,e){this.removedFromSpace();var i=this.options;if(t)if(e){for(var p=null,l=i.includes.head;null!=l&&!(n.id<l.elt.id);)l=(p=l).next;var r,o=i.includes;null==Ze.zpp_pool?r=new Ze:(r=Ze.zpp_pool,Ze.zpp_pool=r.next,r.next=null),r.elt=n;var a=r;null==p?(a.next=o.head,o.head=a):(a.next=p.next,p.next=a),o.pushmod=o.modified=!0,o.length++}else i.includes.remove(n);else if(e){for(var s=null,_=i.excludes.head;null!=_&&!(n.id<_.elt.id);)_=(s=_).next;var h,u=i.excludes;null==Ze.zpp_pool?h=new Ze:(h=Ze.zpp_pool,Ze.zpp_pool=h.next,h.next=null),h.elt=n;var x=h;null==s?(x.next=u.head,u.head=x):(x.next=s.next,s.next=x),u.pushmod=u.modified=!0,u.length++}else i.excludes.remove(n);this.addedToSpace()},Fn.prototype.invalidate_precedence=function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},Fn.prototype.swapEvent=function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},Fn.prototype.__class__=Fn;var Rn=zpp_nape.util.ZNPList_ZPP_CbType=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Rn.__name__=["zpp_nape","util","ZNPList_ZPP_CbType"],Rn.prototype.head=null,Rn.prototype.begin=function(){return this.head},Rn.prototype.modified=null,Rn.prototype.pushmod=null,Rn.prototype.length=null,Rn.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Rn.prototype.add=function(n){var t;null==Ze.zpp_pool?t=new Ze:(t=Ze.zpp_pool,Ze.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Rn.prototype.inlined_add=function(n){var t;null==Ze.zpp_pool?t=new Ze:(t=Ze.zpp_pool,Ze.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Rn.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Rn.prototype.insert=function(n,t){var e;null==Ze.zpp_pool?e=new Ze:(e=Ze.zpp_pool,Ze.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Rn.prototype.inlined_insert=function(n,t){var e;null==Ze.zpp_pool?e=new Ze:(e=Ze.zpp_pool,Ze.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Rn.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ze.zpp_pool,Ze.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Rn.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ze.zpp_pool,Ze.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Rn.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Rn.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Rn.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ze.zpp_pool,Ze.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Rn.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Rn.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ze.zpp_pool,Ze.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Rn.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Ze.zpp_pool,Ze.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Rn.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ze.zpp_pool,Ze.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Rn.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ze.zpp_pool,Ze.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Rn.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Rn.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ze.zpp_pool,Ze.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Rn.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ze.zpp_pool,Ze.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Rn.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Rn.prototype.empty=function(){return null==this.head},Rn.prototype.size=function(){return this.length},Rn.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Rn.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Rn.prototype.front=function(){return this.head.elt},Rn.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Rn.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Rn.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Rn.prototype.__class__=Rn;var le=zpp_nape.callbacks.ZPP_InteractionListener=function(n,t,e,i){this.handlerp=null,this.pure=!1,this.allowSleepingCallbacks=!1,this.handleri=null,this.options2=null,this.options1=null,this.itype=0,this.outer_znp=null,this.outer_zni=null,Vn.call(this),this.type=i,(this.interaction=this).event=e,this.options1=n.zpp_inner,this.options2=t.zpp_inner,this.allowSleepingCallbacks=!1};le.__name__=["zpp_nape","callbacks","ZPP_InteractionListener"],le.__super__=Vn,le.prototype=Object.create(Vn.prototype),le.prototype.outer_zni=null,le.prototype.outer_znp=null,le.prototype.itype=null,le.prototype.options1=null,le.prototype.options2=null,le.prototype.handleri=null,le.prototype.allowSleepingCallbacks=null,le.prototype.pure=null,le.prototype.handlerp=null,le.prototype.setInteractionType=function(n){this.itype=n},le.prototype.wake=function(){for(var n=this.options1.includes.head,t=this.options2.includes.head;null!=n&&null!=t;){var e=n.elt,i=t.elt;if(e==i){for(var p=e.interactors.head;null!=p;)p.elt.wake(),p=p.next;n=n.next,t=t.next}else if(e.id<i.id){for(var l=e.interactors.head;null!=l;)l.elt.wake(),l=l.next;n=n.next}else{for(var r=i.interactors.head;null!=r;)r.elt.wake(),r=r.next;t=t.next}}for(;null!=n;){for(var o=n.elt.interactors.head;null!=o;)o.elt.wake(),o=o.next;n=n.next}for(;null!=t;){for(var a=t.elt.interactors.head;null!=a;)a.elt.wake(),a=a.next;t=t.next}},le.prototype.CbSetset=function(n,t,e){for(var i=le.UCbSet,p=le.VCbSet,l=le.WCbSet,r=n.head,o=t.head;null!=r&&null!=o;){var a,s,_,h,u,x,d=r.elt,y=o.elt;d==y?(null==We.zpp_pool?a=new We:(a=We.zpp_pool,We.zpp_pool=a.next,a.next=null),a.elt=d,(s=a).next=l.head,l.head=s,l.modified=!0,l.length++,r=r.next,o=o.next):Tl.setlt(d,y)?(null==We.zpp_pool?_=new We:(_=We.zpp_pool,We.zpp_pool=_.next,_.next=null),_.elt=d,(h=_).next=i.head,i.head=h,i.modified=!0,i.length++,r=r.next):(null==We.zpp_pool?u=new We:(u=We.zpp_pool,We.zpp_pool=u.next,u.next=null),u.elt=y,(x=u).next=p.head,p.head=x,p.modified=!0,p.length++,o=o.next)}for(;null!=r;){var z,c=r.elt;null==We.zpp_pool?z=new We:(z=We.zpp_pool,We.zpp_pool=z.next,z.next=null),z.elt=c;var v=z;v.next=i.head,i.head=v,i.modified=!0,i.length++,r=r.next}for(;null!=o;){var m,f=o.elt;null==We.zpp_pool?m=new We:(m=We.zpp_pool,We.zpp_pool=m.next,m.next=null),m.elt=f;var b=m;b.next=p.head,p.head=b,p.modified=!0,p.length++,o=o.next}for(;null!=i.head;)for(var g=i.pop_unsafe(),w=t.head;null!=w;)e(g,w.elt),w=w.next;for(;null!=p.head;)for(var M=p.pop_unsafe(),C=l.head;null!=C;)e(M,C.elt),C=C.next;for(;null!=l.head;){var k=l.pop_unsafe();e(k,k);for(var O=l.head;null!=O;)e(k,O.elt),O=O.next}},le.prototype.CbTypeset=function(n,t,e){for(var i=le.UCbType,p=le.VCbType,l=le.WCbType,r=n.head,o=t.head;null!=r&&null!=o;){var a,s,_,h,u,x,d=r.elt,y=o.elt;d==y?(null==Ze.zpp_pool?a=new Ze:(a=Ze.zpp_pool,Ze.zpp_pool=a.next,a.next=null),a.elt=d,(s=a).next=l.head,l.head=s,l.modified=!0,l.length++,r=r.next,o=o.next):d.id<y.id?(null==Ze.zpp_pool?_=new Ze:(_=Ze.zpp_pool,Ze.zpp_pool=_.next,_.next=null),_.elt=d,(h=_).next=i.head,i.head=h,i.modified=!0,i.length++,r=r.next):(null==Ze.zpp_pool?u=new Ze:(u=Ze.zpp_pool,Ze.zpp_pool=u.next,u.next=null),u.elt=y,(x=u).next=p.head,p.head=x,p.modified=!0,p.length++,o=o.next)}for(;null!=r;){var z,c=r.elt;null==Ze.zpp_pool?z=new Ze:(z=Ze.zpp_pool,Ze.zpp_pool=z.next,z.next=null),z.elt=c;var v=z;v.next=i.head,i.head=v,i.modified=!0,i.length++,r=r.next}for(;null!=o;){var m,f=o.elt;null==Ze.zpp_pool?m=new Ze:(m=Ze.zpp_pool,Ze.zpp_pool=m.next,m.next=null),m.elt=f;var b=m;b.next=p.head,p.head=b,p.modified=!0,p.length++,o=o.next}for(;null!=i.head;)for(var g=i.pop_unsafe(),w=t.head;null!=w;)e(g,w.elt),w=w.next;for(;null!=p.head;)for(var M=p.pop_unsafe(),C=l.head;null!=C;)e(M,C.elt),C=C.next;for(;null!=l.head;){var k=l.pop_unsafe();e(k,k);for(var O=l.head;null!=O;)e(k,O.elt),O=O.next}},le.prototype.with_uniquesets=function(n){var t,e=this;null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.lt=Nl.setlt;for(var i=this.options2.includes,p=le.UCbType,l=le.VCbType,r=le.WCbType,o=this.options1.includes.head,a=i.head;null!=o&&null!=a;){var s,_,h,u,x,d,y=o.elt,z=a.elt;y==z?(null==Ze.zpp_pool?s=new Ze:(s=Ze.zpp_pool,Ze.zpp_pool=s.next,s.next=null),s.elt=y,(_=s).next=r.head,r.head=_,r.modified=!0,r.length++,o=o.next,a=a.next):y.id<z.id?(null==Ze.zpp_pool?h=new Ze:(h=Ze.zpp_pool,Ze.zpp_pool=h.next,h.next=null),h.elt=y,(u=h).next=p.head,p.head=u,p.modified=!0,p.length++,o=o.next):(null==Ze.zpp_pool?x=new Ze:(x=Ze.zpp_pool,Ze.zpp_pool=x.next,x.next=null),x.elt=z,(d=x).next=l.head,l.head=d,l.modified=!0,l.length++,a=a.next)}for(;null!=o;){var c,v=o.elt;null==Ze.zpp_pool?c=new Ze:(c=Ze.zpp_pool,Ze.zpp_pool=c.next,c.next=null),c.elt=v;var m=c;m.next=p.head,p.head=m,p.modified=!0,p.length++,o=o.next}for(;null!=a;){var f,b=a.elt;null==Ze.zpp_pool?f=new Ze:(f=Ze.zpp_pool,Ze.zpp_pool=f.next,f.next=null),f.elt=b;var g=f;g.next=l.head,l.head=g,l.modified=!0,l.length++,a=a.next}for(;null!=p.head;)for(var w=p.pop_unsafe(),M=i.head;null!=M;){for(var C=M.elt.cbsets,k=le.UCbSet,O=le.VCbSet,P=le.WCbSet,S=w.cbsets.head,A=C.head;null!=S&&null!=A;){var j,E,I,T,N,L,V=S.elt,D=A.elt;V==D?(null==We.zpp_pool?j=new We:(j=We.zpp_pool,We.zpp_pool=j.next,j.next=null),j.elt=V,(E=j).next=P.head,P.head=E,P.modified=!0,P.length++,S=S.next,A=A.next):Tl.setlt(V,D)?(null==We.zpp_pool?I=new We:(I=We.zpp_pool,We.zpp_pool=I.next,I.next=null),I.elt=V,(T=I).next=k.head,k.head=T,k.modified=!0,k.length++,S=S.next):(null==We.zpp_pool?N=new We:(N=We.zpp_pool,We.zpp_pool=N.next,N.next=null),N.elt=D,(L=N).next=O.head,O.head=L,O.modified=!0,O.length++,A=A.next)}for(;null!=S;){var F,R=S.elt;null==We.zpp_pool?F=new We:(F=We.zpp_pool,We.zpp_pool=F.next,F.next=null),F.elt=R;var Z=F;Z.next=k.head,k.head=Z,k.modified=!0,k.length++,S=S.next}for(;null!=A;){var B,G=A.elt;null==We.zpp_pool?B=new We:(B=We.zpp_pool,We.zpp_pool=B.next,B.next=null),B.elt=G;var q=B;q.next=O.head,O.head=q,O.modified=!0,O.length++,A=A.next}for(;null!=k.head;)for(var U=k.pop_unsafe(),K=C.head;null!=K;){var W,Y=K.elt;U.validate(),Y.validate(),Tl.single_intersection(U,Y,e)&&(null==Nl.zpp_pool?W=new Nl:(W=Nl.zpp_pool,Nl.zpp_pool=W.next,W.next=null),W.zip_listeners=!0,Tl.setlt(U,Y)?(W.a=U,W.b=Y):(W.a=Y,W.b=U),t.try_insert(W)),K=K.next}for(;null!=O.head;)for(var J=O.pop_unsafe(),X=P.head;null!=X;){var H,$=X.elt;J.validate(),$.validate(),Tl.single_intersection(J,$,e)&&(null==Nl.zpp_pool?H=new Nl:(H=Nl.zpp_pool,Nl.zpp_pool=H.next,H.next=null),H.zip_listeners=!0,Tl.setlt(J,$)?(H.a=J,H.b=$):(H.a=$,H.b=J),t.try_insert(H)),X=X.next}for(;null!=P.head;){var Q,nn=P.pop_unsafe();nn.validate(),nn.validate(),Tl.single_intersection(nn,nn,e)&&(null==Nl.zpp_pool?Q=new Nl:(Q=Nl.zpp_pool,Nl.zpp_pool=Q.next,Q.next=null),Q.zip_listeners=!0,Tl.setlt(nn,nn),Q.a=nn,Q.b=nn,t.try_insert(Q));for(var tn=P.head;null!=tn;){var en,pn=tn.elt;nn.validate(),pn.validate(),Tl.single_intersection(nn,pn,e)&&(null==Nl.zpp_pool?en=new Nl:(en=Nl.zpp_pool,Nl.zpp_pool=en.next,en.next=null),en.zip_listeners=!0,Tl.setlt(nn,pn)?(en.a=nn,en.b=pn):(en.a=pn,en.b=nn),t.try_insert(en)),tn=tn.next}}M=M.next}for(;null!=l.head;)for(var ln=l.pop_unsafe(),rn=r.head;null!=rn;){for(var on=rn.elt.cbsets,an=le.UCbSet,sn=le.VCbSet,_n=le.WCbSet,hn=ln.cbsets.head,un=on.head;null!=hn&&null!=un;){var xn,dn,yn,zn,cn,vn,mn=hn.elt,fn=un.elt;mn==fn?(null==We.zpp_pool?xn=new We:(xn=We.zpp_pool,We.zpp_pool=xn.next,xn.next=null),xn.elt=mn,(dn=xn).next=_n.head,_n.head=dn,_n.modified=!0,_n.length++,hn=hn.next,un=un.next):Tl.setlt(mn,fn)?(null==We.zpp_pool?yn=new We:(yn=We.zpp_pool,We.zpp_pool=yn.next,yn.next=null),yn.elt=mn,(zn=yn).next=an.head,an.head=zn,an.modified=!0,an.length++,hn=hn.next):(null==We.zpp_pool?cn=new We:(cn=We.zpp_pool,We.zpp_pool=cn.next,cn.next=null),cn.elt=fn,(vn=cn).next=sn.head,sn.head=vn,sn.modified=!0,sn.length++,un=un.next)}for(;null!=hn;){var bn,gn=hn.elt;null==We.zpp_pool?bn=new We:(bn=We.zpp_pool,We.zpp_pool=bn.next,bn.next=null),bn.elt=gn;var wn=bn;wn.next=an.head,an.head=wn,an.modified=!0,an.length++,hn=hn.next}for(;null!=un;){var Mn,Cn=un.elt;null==We.zpp_pool?Mn=new We:(Mn=We.zpp_pool,We.zpp_pool=Mn.next,Mn.next=null),Mn.elt=Cn;var kn=Mn;kn.next=sn.head,sn.head=kn,sn.modified=!0,sn.length++,un=un.next}for(;null!=an.head;)for(var On=an.pop_unsafe(),Pn=on.head;null!=Pn;){var Sn,An=Pn.elt;On.validate(),An.validate(),Tl.single_intersection(On,An,e)&&(null==Nl.zpp_pool?Sn=new Nl:(Sn=Nl.zpp_pool,Nl.zpp_pool=Sn.next,Sn.next=null),Sn.zip_listeners=!0,Tl.setlt(On,An)?(Sn.a=On,Sn.b=An):(Sn.a=An,Sn.b=On),t.try_insert(Sn)),Pn=Pn.next}for(;null!=sn.head;)for(var jn=sn.pop_unsafe(),En=_n.head;null!=En;){var In,Tn=En.elt;jn.validate(),Tn.validate(),Tl.single_intersection(jn,Tn,e)&&(null==Nl.zpp_pool?In=new Nl:(In=Nl.zpp_pool,Nl.zpp_pool=In.next,In.next=null),In.zip_listeners=!0,Tl.setlt(jn,Tn)?(In.a=jn,In.b=Tn):(In.a=Tn,In.b=jn),t.try_insert(In)),En=En.next}for(;null!=_n.head;){var Nn,Ln=_n.pop_unsafe();Ln.validate(),Ln.validate(),Tl.single_intersection(Ln,Ln,e)&&(null==Nl.zpp_pool?Nn=new Nl:(Nn=Nl.zpp_pool,Nl.zpp_pool=Nn.next,Nn.next=null),Nn.zip_listeners=!0,Tl.setlt(Ln,Ln),Nn.a=Ln,Nn.b=Ln,t.try_insert(Nn));for(var Vn=_n.head;null!=Vn;){var Dn,Fn=Vn.elt;Ln.validate(),Fn.validate(),Tl.single_intersection(Ln,Fn,e)&&(null==Nl.zpp_pool?Dn=new Nl:(Dn=Nl.zpp_pool,Nl.zpp_pool=Dn.next,Dn.next=null),Dn.zip_listeners=!0,Tl.setlt(Ln,Fn)?(Dn.a=Ln,Dn.b=Fn):(Dn.a=Fn,Dn.b=Ln),t.try_insert(Dn)),Vn=Vn.next}}rn=rn.next}for(;null!=r.head;){for(var Rn=r.pop_unsafe(),Zn=Rn.cbsets,Bn=le.UCbSet,Gn=le.VCbSet,qn=le.WCbSet,Un=Rn.cbsets.head,Kn=Zn.head;null!=Un&&null!=Kn;){var Wn,Yn,Jn,Xn,Hn,$n,Qn=Un.elt,nt=Kn.elt;Qn==nt?(null==We.zpp_pool?Wn=new We:(Wn=We.zpp_pool,We.zpp_pool=Wn.next,Wn.next=null),Wn.elt=Qn,(Yn=Wn).next=qn.head,qn.head=Yn,qn.modified=!0,qn.length++,Un=Un.next,Kn=Kn.next):Tl.setlt(Qn,nt)?(null==We.zpp_pool?Jn=new We:(Jn=We.zpp_pool,We.zpp_pool=Jn.next,Jn.next=null),Jn.elt=Qn,(Xn=Jn).next=Bn.head,Bn.head=Xn,Bn.modified=!0,Bn.length++,Un=Un.next):(null==We.zpp_pool?Hn=new We:(Hn=We.zpp_pool,We.zpp_pool=Hn.next,Hn.next=null),Hn.elt=nt,($n=Hn).next=Gn.head,Gn.head=$n,Gn.modified=!0,Gn.length++,Kn=Kn.next)}for(;null!=Un;){var tt,et=Un.elt;null==We.zpp_pool?tt=new We:(tt=We.zpp_pool,We.zpp_pool=tt.next,tt.next=null),tt.elt=et;var it=tt;it.next=Bn.head,Bn.head=it,Bn.modified=!0,Bn.length++,Un=Un.next}for(;null!=Kn;){var pt,lt=Kn.elt;null==We.zpp_pool?pt=new We:(pt=We.zpp_pool,We.zpp_pool=pt.next,pt.next=null),pt.elt=lt;var rt=pt;rt.next=Gn.head,Gn.head=rt,Gn.modified=!0,Gn.length++,Kn=Kn.next}for(;null!=Bn.head;)for(var ot=Bn.pop_unsafe(),at=Zn.head;null!=at;){var st,_t=at.elt;ot.validate(),_t.validate(),Tl.single_intersection(ot,_t,e)&&(null==Nl.zpp_pool?st=new Nl:(st=Nl.zpp_pool,Nl.zpp_pool=st.next,st.next=null),st.zip_listeners=!0,Tl.setlt(ot,_t)?(st.a=ot,st.b=_t):(st.a=_t,st.b=ot),t.try_insert(st)),at=at.next}for(;null!=Gn.head;)for(var ht=Gn.pop_unsafe(),ut=qn.head;null!=ut;){var xt,dt=ut.elt;ht.validate(),dt.validate(),Tl.single_intersection(ht,dt,e)&&(null==Nl.zpp_pool?xt=new Nl:(xt=Nl.zpp_pool,Nl.zpp_pool=xt.next,xt.next=null),xt.zip_listeners=!0,Tl.setlt(ht,dt)?(xt.a=ht,xt.b=dt):(xt.a=dt,xt.b=ht),t.try_insert(xt)),ut=ut.next}for(;null!=qn.head;){var yt,zt=qn.pop_unsafe();zt.validate(),zt.validate(),Tl.single_intersection(zt,zt,e)&&(null==Nl.zpp_pool?yt=new Nl:(yt=Nl.zpp_pool,Nl.zpp_pool=yt.next,yt.next=null),yt.zip_listeners=!0,Tl.setlt(zt,zt),yt.a=zt,yt.b=zt,t.try_insert(yt));for(var ct=qn.head;null!=ct;){var vt,mt=ct.elt;zt.validate(),mt.validate(),Tl.single_intersection(zt,mt,e)&&(null==Nl.zpp_pool?vt=new Nl:(vt=Nl.zpp_pool,Nl.zpp_pool=vt.next,vt.next=null),vt.zip_listeners=!0,Tl.setlt(zt,mt)?(vt.a=zt,vt.b=mt):(vt.a=mt,vt.b=zt),t.try_insert(vt)),ct=ct.next}}for(var ft=r.head;null!=ft;){for(var bt=ft.elt.cbsets,gt=le.UCbSet,wt=le.VCbSet,Mt=le.WCbSet,Ct=Rn.cbsets.head,kt=bt.head;null!=Ct&&null!=kt;){var Ot,Pt,St,At,jt,Et,It=Ct.elt,Tt=kt.elt;It==Tt?(null==We.zpp_pool?Ot=new We:(Ot=We.zpp_pool,We.zpp_pool=Ot.next,Ot.next=null),Ot.elt=It,(Pt=Ot).next=Mt.head,Mt.head=Pt,Mt.modified=!0,Mt.length++,Ct=Ct.next,kt=kt.next):Tl.setlt(It,Tt)?(null==We.zpp_pool?St=new We:(St=We.zpp_pool,We.zpp_pool=St.next,St.next=null),St.elt=It,(At=St).next=gt.head,gt.head=At,gt.modified=!0,gt.length++,Ct=Ct.next):(null==We.zpp_pool?jt=new We:(jt=We.zpp_pool,We.zpp_pool=jt.next,jt.next=null),jt.elt=Tt,(Et=jt).next=wt.head,wt.head=Et,wt.modified=!0,wt.length++,kt=kt.next)}for(;null!=Ct;){var Nt,Lt=Ct.elt;null==We.zpp_pool?Nt=new We:(Nt=We.zpp_pool,We.zpp_pool=Nt.next,Nt.next=null),Nt.elt=Lt;var Vt=Nt;Vt.next=gt.head,gt.head=Vt,gt.modified=!0,gt.length++,Ct=Ct.next}for(;null!=kt;){var Dt,Ft=kt.elt;null==We.zpp_pool?Dt=new We:(Dt=We.zpp_pool,We.zpp_pool=Dt.next,Dt.next=null),Dt.elt=Ft;var Rt=Dt;Rt.next=wt.head,wt.head=Rt,wt.modified=!0,wt.length++,kt=kt.next}for(;null!=gt.head;)for(var Zt=gt.pop_unsafe(),Bt=bt.head;null!=Bt;){var Gt,qt=Bt.elt;Zt.validate(),qt.validate(),Tl.single_intersection(Zt,qt,e)&&(null==Nl.zpp_pool?Gt=new Nl:(Gt=Nl.zpp_pool,Nl.zpp_pool=Gt.next,Gt.next=null),Gt.zip_listeners=!0,Tl.setlt(Zt,qt)?(Gt.a=Zt,Gt.b=qt):(Gt.a=qt,Gt.b=Zt),t.try_insert(Gt)),Bt=Bt.next}for(;null!=wt.head;)for(var Ut=wt.pop_unsafe(),Kt=Mt.head;null!=Kt;){var Wt,Yt=Kt.elt;Ut.validate(),Yt.validate(),Tl.single_intersection(Ut,Yt,e)&&(null==Nl.zpp_pool?Wt=new Nl:(Wt=Nl.zpp_pool,Nl.zpp_pool=Wt.next,Wt.next=null),Wt.zip_listeners=!0,Tl.setlt(Ut,Yt)?(Wt.a=Ut,Wt.b=Yt):(Wt.a=Yt,Wt.b=Ut),t.try_insert(Wt)),Kt=Kt.next}for(;null!=Mt.head;){var Jt,Xt=Mt.pop_unsafe();Xt.validate(),Xt.validate(),Tl.single_intersection(Xt,Xt,e)&&(null==Nl.zpp_pool?Jt=new Nl:(Jt=Nl.zpp_pool,Nl.zpp_pool=Jt.next,Jt.next=null),Jt.zip_listeners=!0,Tl.setlt(Xt,Xt),Jt.a=Xt,Jt.b=Xt,t.try_insert(Jt));for(var Ht=Mt.head;null!=Ht;){var $t,Qt=Ht.elt;Xt.validate(),Qt.validate(),Tl.single_intersection(Xt,Qt,e)&&(null==Nl.zpp_pool?$t=new Nl:($t=Nl.zpp_pool,Nl.zpp_pool=$t.next,$t.next=null),$t.zip_listeners=!0,Tl.setlt(Xt,Qt)?($t.a=Xt,$t.b=Qt):($t.a=Qt,$t.b=Xt),t.try_insert($t)),Ht=Ht.next}}ft=ft.next}}if(null!=t.parent){for(var ne,te,ee,ie=t.parent;null!=ie;){ie=null!=ie.prev?ie.prev:null!=ie.next?ie.next:(ne=ie.data,n?e.space.freshListenerType(ne.a,ne.b):e.space.nullListenerType(ne.a,ne.b),ne.a=ne.b=null,ne.listeners.clear(),ne.next=Nl.zpp_pool,Nl.zpp_pool=ne,null!=(te=ie.parent)&&(ie==te.prev?te.prev=null:te.next=null,ie.parent=null),(ee=ie).data=null,ee.lt=null,ee.swapped=null,ee.next=Bi.zpp_pool,Bi.zpp_pool=ee,te)}t.parent=null}var pe=t;pe.data=null,pe.lt=null,pe.swapped=null,pe.next=Bi.zpp_pool,Bi.zpp_pool=pe},le.prototype.with_union=function(n){for(var t=this.options1.includes.head,e=this.options2.includes.head;null!=t&&null!=e;){var i=t.elt,p=e.elt;i==p?(n(i),t=t.next,e=e.next):i.id<p.id?(n(i),t=t.next):(n(p),e=e.next)}for(;null!=t;)n(t.elt),t=t.next;for(;null!=e;)n(e.elt),e=e.next},le.prototype.addedToSpace=function(){for(var n=this,t=3==this.type,e=this.options1.includes.head,i=this.options2.includes.head;null!=e&&null!=i;){var p=e.elt,l=i.elt;if(p==l){for(var r=null,o=p.listeners.head;null!=o;){var a=o.elt;if(n.precedence>a.precedence||n.precedence==a.precedence&&n.id>a.id)break;o=(r=o).next}var s,_=p.listeners;null==ql.zpp_pool?s=new ql:(s=ql.zpp_pool,ql.zpp_pool=s.next,s.next=null),s.elt=n;var h=s;null==r?(h.next=_.head,_.head=h):(h.next=r.next,r.next=h),_.pushmod=_.modified=!0,_.length++;for(var u=p.cbsets.head;null!=u;){var x=u.elt;x.zip_listeners=!0,x.invalidate_pairs(),u=u.next}if(t)for(var d=p.interactors.head;null!=d;)d.elt.wake(),d=d.next;e=e.next,i=i.next}else if(p.id<l.id){for(var y=null,z=p.listeners.head;null!=z;){var c=z.elt;if(n.precedence>c.precedence||n.precedence==c.precedence&&n.id>c.id)break;z=(y=z).next}var v,m=p.listeners;null==ql.zpp_pool?v=new ql:(v=ql.zpp_pool,ql.zpp_pool=v.next,v.next=null),v.elt=n;var f=v;null==y?(f.next=m.head,m.head=f):(f.next=y.next,y.next=f),m.pushmod=m.modified=!0,m.length++;for(var b=p.cbsets.head;null!=b;){var g=b.elt;g.zip_listeners=!0,g.invalidate_pairs(),b=b.next}if(t)for(var w=p.interactors.head;null!=w;)w.elt.wake(),w=w.next;e=e.next}else{for(var M=null,C=l.listeners.head;null!=C;){var k=C.elt;if(n.precedence>k.precedence||n.precedence==k.precedence&&n.id>k.id)break;C=(M=C).next}var O,P=l.listeners;null==ql.zpp_pool?O=new ql:(O=ql.zpp_pool,ql.zpp_pool=O.next,O.next=null),O.elt=n;var S=O;null==M?(S.next=P.head,P.head=S):(S.next=M.next,M.next=S),P.pushmod=P.modified=!0,P.length++;for(var A=l.cbsets.head;null!=A;){var j=A.elt;j.zip_listeners=!0,j.invalidate_pairs(),A=A.next}if(t)for(var E=l.interactors.head;null!=E;)E.elt.wake(),E=E.next;i=i.next}}for(;null!=e;){for(var I=e.elt,T=null,N=I.listeners.head;null!=N;){var L=N.elt;if(n.precedence>L.precedence||n.precedence==L.precedence&&n.id>L.id)break;N=(T=N).next}var V,D=I.listeners;null==ql.zpp_pool?V=new ql:(V=ql.zpp_pool,ql.zpp_pool=V.next,V.next=null),V.elt=n;var F=V;null==T?(F.next=D.head,D.head=F):(F.next=T.next,T.next=F),D.pushmod=D.modified=!0,D.length++;for(var R=I.cbsets.head;null!=R;){var Z=R.elt;Z.zip_listeners=!0,Z.invalidate_pairs(),R=R.next}if(t)for(var B=I.interactors.head;null!=B;)B.elt.wake(),B=B.next;e=e.next}for(;null!=i;){for(var G=i.elt,q=null,U=G.listeners.head;null!=U;){var K=U.elt;if(n.precedence>K.precedence||n.precedence==K.precedence&&n.id>K.id)break;U=(q=U).next}var W,Y=G.listeners;null==ql.zpp_pool?W=new ql:(W=ql.zpp_pool,ql.zpp_pool=W.next,W.next=null),W.elt=n;var J=W;null==q?(J.next=Y.head,Y.head=J):(J.next=q.next,q.next=J),Y.pushmod=Y.modified=!0,Y.length++;for(var X=G.cbsets.head;null!=X;){var H=X.elt;H.zip_listeners=!0,H.invalidate_pairs(),X=X.next}if(t)for(var $=G.interactors.head;null!=$;)$.elt.wake(),$=$.next;i=i.next}this.options1.handler=Q(this,this.cbtype_change1),this.options2.handler=Q(this,this.cbtype_change2),this.with_uniquesets(!0)},le.prototype.removedFromSpace=function(){this.with_uniquesets(!1);for(var n=3==this.type,t=this.options1.includes.head,e=this.options2.includes.head;null!=t&&null!=e;){var i=t.elt,p=e.elt;if(i==p){i.listeners.remove(this);for(var l=i.cbsets.head;null!=l;){var r=l.elt;r.zip_listeners=!0,r.invalidate_pairs(),l=l.next}if(n)for(var o=i.interactors.head;null!=o;)o.elt.wake(),o=o.next;t=t.next,e=e.next}else if(i.id<p.id){i.listeners.remove(this);for(var a=i.cbsets.head;null!=a;){var s=a.elt;s.zip_listeners=!0,s.invalidate_pairs(),a=a.next}if(n)for(var _=i.interactors.head;null!=_;)_.elt.wake(),_=_.next;t=t.next}else{p.listeners.remove(this);for(var h=p.cbsets.head;null!=h;){var u=h.elt;u.zip_listeners=!0,u.invalidate_pairs(),h=h.next}if(n)for(var x=p.interactors.head;null!=x;)x.elt.wake(),x=x.next;e=e.next}}for(;null!=t;){var d=t.elt;d.listeners.remove(this);for(var y=d.cbsets.head;null!=y;){var z=y.elt;z.zip_listeners=!0,z.invalidate_pairs(),y=y.next}if(n)for(var c=d.interactors.head;null!=c;)c.elt.wake(),c=c.next;t=t.next}for(;null!=e;){var v=e.elt;v.listeners.remove(this);for(var m=v.cbsets.head;null!=m;){var f=m.elt;f.zip_listeners=!0,f.invalidate_pairs(),m=m.next}if(n)for(var b=v.interactors.head;null!=b;)b.elt.wake(),b=b.next;e=e.next}this.options1.handler=null,this.options2.handler=null},le.prototype.invalidate_precedence=function(){var n=this;if(null!=this.space){for(var t=3==this.type,e=this.options1.includes.head,i=this.options2.includes.head;null!=e&&null!=i;){var p=e.elt,l=i.elt;if(p==l){p.listeners.remove(n);for(var r=p.cbsets.head;null!=r;){var o=r.elt;o.zip_listeners=!0,o.invalidate_pairs(),r=r.next}for(var a=null,s=p.listeners.head;null!=s;){var _=s.elt;if(n.precedence>_.precedence||n.precedence==_.precedence&&n.id>_.id)break;s=(a=s).next}var h,u=p.listeners;null==ql.zpp_pool?h=new ql:(h=ql.zpp_pool,ql.zpp_pool=h.next,h.next=null),h.elt=n;var x=h;null==a?(x.next=u.head,u.head=x):(x.next=a.next,a.next=x),u.pushmod=u.modified=!0,u.length++;for(var d=p.cbsets.head;null!=d;){var y=d.elt;y.zip_listeners=!0,y.invalidate_pairs(),d=d.next}if(t)for(var z=p.interactors.head;null!=z;)z.elt.wake(),z=z.next;e=e.next,i=i.next}else if(p.id<l.id){p.listeners.remove(n);for(var c=p.cbsets.head;null!=c;){var v=c.elt;v.zip_listeners=!0,v.invalidate_pairs(),c=c.next}for(var m=null,f=p.listeners.head;null!=f;){var b=f.elt;if(n.precedence>b.precedence||n.precedence==b.precedence&&n.id>b.id)break;f=(m=f).next}var g,w=p.listeners;null==ql.zpp_pool?g=new ql:(g=ql.zpp_pool,ql.zpp_pool=g.next,g.next=null),g.elt=n;var M=g;null==m?(M.next=w.head,w.head=M):(M.next=m.next,m.next=M),w.pushmod=w.modified=!0,w.length++;for(var C=p.cbsets.head;null!=C;){var k=C.elt;k.zip_listeners=!0,k.invalidate_pairs(),C=C.next}if(t)for(var O=p.interactors.head;null!=O;)O.elt.wake(),O=O.next;e=e.next}else{l.listeners.remove(n);for(var P=l.cbsets.head;null!=P;){var S=P.elt;S.zip_listeners=!0,S.invalidate_pairs(),P=P.next}for(var A=null,j=l.listeners.head;null!=j;){var E=j.elt;if(n.precedence>E.precedence||n.precedence==E.precedence&&n.id>E.id)break;j=(A=j).next}var I,T=l.listeners;null==ql.zpp_pool?I=new ql:(I=ql.zpp_pool,ql.zpp_pool=I.next,I.next=null),I.elt=n;var N=I;null==A?(N.next=T.head,T.head=N):(N.next=A.next,A.next=N),T.pushmod=T.modified=!0,T.length++;for(var L=l.cbsets.head;null!=L;){var V=L.elt;V.zip_listeners=!0,V.invalidate_pairs(),L=L.next}if(t)for(var D=l.interactors.head;null!=D;)D.elt.wake(),D=D.next;i=i.next}}for(;null!=e;){var F=e.elt;F.listeners.remove(n);for(var R=F.cbsets.head;null!=R;){var Z=R.elt;Z.zip_listeners=!0,Z.invalidate_pairs(),R=R.next}for(var B=null,G=F.listeners.head;null!=G;){var q=G.elt;if(n.precedence>q.precedence||n.precedence==q.precedence&&n.id>q.id)break;G=(B=G).next}var U,K=F.listeners;null==ql.zpp_pool?U=new ql:(U=ql.zpp_pool,ql.zpp_pool=U.next,U.next=null),U.elt=n;var W=U;null==B?(W.next=K.head,K.head=W):(W.next=B.next,B.next=W),K.pushmod=K.modified=!0,K.length++;for(var Y=F.cbsets.head;null!=Y;){var J=Y.elt;J.zip_listeners=!0,J.invalidate_pairs(),Y=Y.next}if(t)for(var X=F.interactors.head;null!=X;)X.elt.wake(),X=X.next;e=e.next}for(;null!=i;){var H=i.elt;H.listeners.remove(n);for(var $=H.cbsets.head;null!=$;){var Q=$.elt;Q.zip_listeners=!0,Q.invalidate_pairs(),$=$.next}for(var nn=null,tn=H.listeners.head;null!=tn;){var en=tn.elt;if(n.precedence>en.precedence||n.precedence==en.precedence&&n.id>en.id)break;tn=(nn=tn).next}var pn,ln=H.listeners;null==ql.zpp_pool?pn=new ql:(pn=ql.zpp_pool,ql.zpp_pool=pn.next,pn.next=null),pn.elt=n;var rn=pn;null==nn?(rn.next=ln.head,ln.head=rn):(rn.next=nn.next,nn.next=rn),ln.pushmod=ln.modified=!0,ln.length++;for(var on=H.cbsets.head;null!=on;){var an=on.elt;an.zip_listeners=!0,an.invalidate_pairs(),on=on.next}if(t)for(var sn=H.interactors.head;null!=sn;)sn.elt.wake(),sn=sn.next;i=i.next}}},le.prototype.cbtype_change1=function(n,t,e){this.cbtype_change(this.options1,n,t,e)},le.prototype.cbtype_change2=function(n,t,e){this.cbtype_change(this.options2,n,t,e)},le.prototype.cbtype_change=function(n,t,e,i){if(this.removedFromSpace(),e)if(i){for(var p=null,l=n.includes.head;null!=l&&!(t.id<l.elt.id);)l=(p=l).next;var r,o=n.includes;null==Ze.zpp_pool?r=new Ze:(r=Ze.zpp_pool,Ze.zpp_pool=r.next,r.next=null),r.elt=t;var a=r;null==p?(a.next=o.head,o.head=a):(a.next=p.next,p.next=a),o.pushmod=o.modified=!0,o.length++}else n.includes.remove(t);else if(i){for(var s=null,_=n.excludes.head;null!=_&&!(t.id<_.elt.id);)_=(s=_).next;var h,u=n.excludes;null==Ze.zpp_pool?h=new Ze:(h=Ze.zpp_pool,Ze.zpp_pool=h.next,h.next=null),h.elt=t;var x=h;null==s?(x.next=u.head,u.head=x):(x.next=s.next,s.next=x),u.pushmod=u.modified=!0,u.length++}else n.excludes.remove(t);this.addedToSpace()},le.prototype.swapEvent=function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},le.prototype.__class__=le;var Zn=zpp_nape.callbacks.ZPP_OptionType=function(){this.wrap_excludes=null,this.wrap_includes=null,this.excludes=null,this.includes=null,this.handler=null,this.outer=null,this.includes=new Rn,this.excludes=new Rn};Zn.__name__=["zpp_nape","callbacks","ZPP_OptionType"],Zn.argument=function(n){return null==n?new v:zn.__instanceof(n,v)?n:(new v).including(n)},Zn.prototype.outer=null,Zn.prototype.handler=null,Zn.prototype.includes=null,Zn.prototype.excludes=null,Zn.prototype.wrap_includes=null,Zn.prototype.wrap_excludes=null,Zn.prototype.setup_includes=function(){this.wrap_includes=Si.get(this.includes,!0)},Zn.prototype.setup_excludes=function(){this.wrap_excludes=Si.get(this.excludes,!0)},Zn.prototype.excluded=function(n){return this.nonemptyintersection(n,this.excludes)},Zn.prototype.included=function(n){return this.nonemptyintersection(n,this.includes)},Zn.prototype.compatible=function(n){return!!this.nonemptyintersection(n,this.includes)&&!this.nonemptyintersection(n,this.excludes)},Zn.prototype.nonemptyintersection=function(n,t){for(var e=!1,i=n.head,p=t.head;null!=p&&null!=i;){var l=p.elt,r=i.elt;if(l==r){e=!0;break}l.id<r.id?p=p.next:i=i.next}return e},Zn.prototype.effect_change=function(n,t,e){if(t)if(e){for(var i=null,p=this.includes.head;null!=p&&!(n.id<p.elt.id);)p=(i=p).next;var l,r=this.includes;null==Ze.zpp_pool?l=new Ze:(l=Ze.zpp_pool,Ze.zpp_pool=l.next,l.next=null),l.elt=n;var o=l;null==i?(o.next=r.head,r.head=o):(o.next=i.next,i.next=o),r.pushmod=r.modified=!0,r.length++}else this.includes.remove(n);else if(e){for(var a=null,s=this.excludes.head;null!=s&&!(n.id<s.elt.id);)s=(a=s).next;var _,h=this.excludes;null==Ze.zpp_pool?_=new Ze:(_=Ze.zpp_pool,Ze.zpp_pool=_.next,_.next=null),_.elt=n;var u=_;null==a?(u.next=h.head,h.head=u):(u.next=a.next,a.next=u),h.pushmod=h.modified=!0,h.length++}else this.excludes.remove(n)},Zn.prototype.append_type=function(n,t){if(n==this.includes){if(!this.includes.has(t))if(this.excludes.has(t))null!=this.handler?this.handler(t,!1,!1):this.excludes.remove(t);else if(null!=this.handler)this.handler(t,!0,!0);else{for(var e=null,i=this.includes.head;null!=i&&!(t.id<i.elt.id);)i=(e=i).next;var p,l=this.includes;null==Ze.zpp_pool?p=new Ze:(p=Ze.zpp_pool,Ze.zpp_pool=p.next,p.next=null),p.elt=t;var r=p;null==e?(r.next=l.head,l.head=r):(r.next=e.next,e.next=r),l.pushmod=l.modified=!0,l.length++}}else if(!this.excludes.has(t))if(this.includes.has(t))null!=this.handler?this.handler(t,!0,!1):this.includes.remove(t);else if(null!=this.handler)this.handler(t,!1,!0);else{for(var o=null,a=this.excludes.head;null!=a&&!(t.id<a.elt.id);)a=(o=a).next;var s,_=this.excludes;null==Ze.zpp_pool?s=new Ze:(s=Ze.zpp_pool,Ze.zpp_pool=s.next,s.next=null),s.elt=t;var h=s;null==o?(h.next=_.head,_.head=h):(h.next=o.next,o.next=h),_.pushmod=_.modified=!0,_.length++}},Zn.prototype.set=function(n){if(n!=this){for(;null!=this.includes.head;)this.append_type(this.excludes,this.includes.head.elt);for(;null!=this.excludes.head;)this.append_type(this.includes,this.excludes.head.elt);for(var t=n.excludes.head;null!=t;)this.append_type(this.excludes,t.elt),t=t.next;for(var e=n.includes.head;null!=e;)this.append_type(this.includes,e.elt),e=e.next}return this},Zn.prototype.append=function(n,t){if(zn.__instanceof(t,s))this.append_type(n,t.zpp_inner);else if(zn.__instanceof(t,_)){var e=t;e.zpp_inner.valmod();for(var i=qn.get(e);;){i.zpp_inner.zpp_inner.valmod();var p=i.zpp_inner;p.zpp_inner.valmod(),p.zpp_inner.zip_length&&(p.zpp_inner.zip_length=!1,p.zpp_inner.user_length=p.zpp_inner.inner.length);var l=p.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<l||(i.zpp_next=qn.zpp_pool,(qn.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1,this.append_type(n,i.zpp_inner.at(i.zpp_i++).zpp_inner)}}else if(t instanceof Array&&null==t.__enum__)for(var r=t,o=0;o<r.length;){var a=r[o];++o;this.append_type(n,a.zpp_inner)}},Zn.prototype.__class__=Zn;var Bn=zpp_nape.constraint.ZPP_Constraint=function(){this.pre_dt=0,this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.__velocity=!1,this.ignore=!1,this.component=null,this.removeOnBreak=!1,this.breakUnderError=!1,this.breakUnderForce=!1,this.maxError=0,this.maxForce=0,this.damping=0,this.frequency=0,this.stiff=!1,this.active=!1,this.space=null,this.compound=null,this.userData=null,this.id=0,this.outer=null,this.__velocity=!1,this.id=Sn.Constraint(),this.stiff=!0,this.active=!0,this.ignore=!1,this.frequency=10,this.damping=1,this.maxForce=1/0,this.maxError=1/0,this.breakUnderForce=!1,this.removeOnBreak=!0,this.pre_dt=-1,this.cbTypes=new Rn};Bn.__name__=["zpp_nape","constraint","ZPP_Constraint"],Bn.prototype.outer=null,Bn.prototype.clear=function(){},Bn.prototype.id=null,Bn.prototype.userData=null,Bn.prototype.compound=null,Bn.prototype.space=null,Bn.prototype.active=null,Bn.prototype.stiff=null,Bn.prototype.frequency=null,Bn.prototype.damping=null,Bn.prototype.maxForce=null,Bn.prototype.maxError=null,Bn.prototype.breakUnderForce=null,Bn.prototype.breakUnderError=null,Bn.prototype.removeOnBreak=null,Bn.prototype.component=null,Bn.prototype.ignore=null,Bn.prototype.__velocity=null,Bn.prototype.immutable_midstep=function(n){},Bn.prototype.cbTypes=null,Bn.prototype.cbSet=null,Bn.prototype.wrap_cbTypes=null,Bn.prototype.setupcbTypes=function(){this.wrap_cbTypes=Si.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=Q(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=Q(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0},Bn.prototype.wrap_cbTypes_subber=function(n){var t=n.zpp_inner;this.cbTypes.has(t)&&(null!=this.space&&(this.dealloc_cbSet(),t.constraints.remove(this)),this.cbTypes.remove(t),null!=this.space&&(this.alloc_cbSet(),this.wake()))},Bn.prototype.wrap_cbTypes_adder=function(n){return this.insert_cbtype(n.zpp_inner),!1},Bn.prototype.insert_cbtype=function(n){if(!this.cbTypes.has(n)){null!=this.space&&(this.dealloc_cbSet(),n.constraints.add(this));for(var t=null,e=this.cbTypes.head;null!=e&&!(n.id<e.elt.id);)e=(t=e).next;var i,p=this.cbTypes;null==Ze.zpp_pool?i=new Ze:(i=Ze.zpp_pool,Ze.zpp_pool=i.next,i.next=null),i.elt=n;var l=i;null==t?(l.next=p.head,p.head=l):(l.next=t.next,t.next=l),p.pushmod=p.modified=!0,p.length++,null!=this.space&&(this.alloc_cbSet(),this.wake())}},Bn.prototype.alloc_cbSet=function(){null!=(this.cbSet=this.space.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.constraints.add(this))},Bn.prototype.dealloc_cbSet=function(){if(null!=this.cbSet){if(this.cbSet.constraints.remove(this),0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var n=this.cbSet;for(n.listeners.clear(),n.zip_listeners=!0,n.bodylisteners.clear(),n.zip_bodylisteners=!0,n.conlisteners.clear(),n.zip_conlisteners=!0;null!=n.cbTypes.head;)n.cbTypes.pop_unsafe().cbsets.remove(n);n.next=Tl.zpp_pool,Tl.zpp_pool=n}this.cbSet=null}},Bn.prototype.activate=function(){null!=this.space&&this.activeInSpace()},Bn.prototype.deactivate=function(){null!=this.space&&this.inactiveOrOutSpace()},Bn.prototype.addedToSpace=function(){this.active&&this.activeInSpace(),this.activeBodies();for(var n=this.cbTypes.head;null!=n;)n.elt.constraints.add(this),n=n.next},Bn.prototype.removedFromSpace=function(){this.active&&this.inactiveOrOutSpace(),this.inactiveBodies();for(var n=this.cbTypes.head;null!=n;)n.elt.constraints.remove(this),n=n.next},Bn.prototype.activeInSpace=function(){this.alloc_cbSet(),null==re.zpp_pool?this.component=new re:(this.component=re.zpp_pool,re.zpp_pool=this.component.next,this.component.next=null),this.component.isBody=!1,this.component.constraint=this},Bn.prototype.inactiveOrOutSpace=function(){this.dealloc_cbSet();var n=this.component;n.body=null,n.constraint=null,n.next=re.zpp_pool,re.zpp_pool=n,this.component=null},Bn.prototype.activeBodies=function(){},Bn.prototype.inactiveBodies=function(){},Bn.prototype.clearcache=function(){},Bn.prototype.validate=function(){},Bn.prototype.wake_connected=function(){},Bn.prototype.forest=function(){},Bn.prototype.pair_exists=function(n,t){return!1},Bn.prototype.broken=function(){},Bn.prototype.warmStart=function(){},Bn.prototype.pre_dt=null,Bn.prototype.preStep=function(n){return!1},Bn.prototype.applyImpulseVel=function(){return!1},Bn.prototype.applyImpulsePos=function(){return!1},Bn.prototype.wake=function(){null!=this.space&&this.space.wake_constraint(this)},Bn.prototype.draw=function(n){},Bn.prototype.copy=function(n,t){return null},Bn.prototype.copyto=function(n){var t=this.outer;null==t.zpp_inner.wrap_cbTypes&&t.zpp_inner.setupcbTypes();var e=t.zpp_inner.wrap_cbTypes;e.zpp_inner.valmod();for(var i=qn.get(e);;){i.zpp_inner.zpp_inner.valmod();var p=i.zpp_inner;p.zpp_inner.valmod(),p.zpp_inner.zip_length&&(p.zpp_inner.zip_length=!1,p.zpp_inner.user_length=p.zpp_inner.inner.length);var l=p.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<l||(i.zpp_next=qn.zpp_pool,(qn.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);null==n.zpp_inner.wrap_cbTypes&&n.zpp_inner.setupcbTypes();var o=n.zpp_inner.wrap_cbTypes;o.zpp_inner.reverse_flag?o.push(r):o.unshift(r)}n.zpp_inner.removeOnBreak=t.zpp_inner.removeOnBreak;var a=t.zpp_inner.breakUnderError;n.zpp_inner.breakUnderError!=a&&(n.zpp_inner.breakUnderError=a,n.zpp_inner.wake());var s=t.zpp_inner.breakUnderForce;n.zpp_inner.breakUnderForce!=s&&(n.zpp_inner.breakUnderForce=s,n.zpp_inner.wake());var _=t.zpp_inner.maxError;n.zpp_inner.maxError!=_&&(n.zpp_inner.maxError=_,n.zpp_inner.wake());var h=t.zpp_inner.maxForce;n.zpp_inner.maxForce!=h&&(n.zpp_inner.maxForce=h,n.zpp_inner.wake());var u=t.zpp_inner.damping;n.zpp_inner.damping!=u&&(n.zpp_inner.damping=u,n.zpp_inner.stiff||n.zpp_inner.wake());var x=t.zpp_inner.frequency;n.zpp_inner.frequency!=x&&(n.zpp_inner.frequency=x,n.zpp_inner.stiff||n.zpp_inner.wake());var d=t.zpp_inner.stiff;n.zpp_inner.stiff!=d&&(n.zpp_inner.stiff=d,n.zpp_inner.wake());var y=t.zpp_inner.ignore;n.zpp_inner.ignore!=y&&(n.zpp_inner.ignore=y,n.zpp_inner.wake());var z=t.zpp_inner.active;n.zpp_inner.active!=z&&(null!=n.zpp_inner.component&&(n.zpp_inner.component.woken=!1),n.zpp_inner.clearcache(),z?(n.zpp_inner.active=z,n.zpp_inner.activate(),null!=n.zpp_inner.space&&(null!=n.zpp_inner.component&&(n.zpp_inner.component.sleeping=!0),n.zpp_inner.space.wake_constraint(n.zpp_inner,!0))):(null!=n.zpp_inner.space&&(n.zpp_inner.wake(),n.zpp_inner.space.live_constraints.remove(n.zpp_inner)),n.zpp_inner.active=z,n.zpp_inner.deactivate()))},Bn.prototype.__class__=Bn;var Gn=zpp_nape.constraint.ZPP_AngleJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.scale=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=0,this.outer_zn=null,Bn.call(this),this.ratio=1,this.jAcc=0,this.slack=!1,this.jMax=1/0,this.stepped=!1};Gn.__name__=["zpp_nape","constraint","ZPP_AngleJoint"],Gn.__super__=Bn,Gn.prototype=Object.create(Bn.prototype),Gn.prototype.outer_zn=null,Gn.prototype.ratio=null,Gn.prototype.jointMin=null,Gn.prototype.jointMax=null,Gn.prototype.slack=null,Gn.prototype.equal=null,Gn.prototype.scale=null,Gn.prototype.is_slack=function(){var n,t=this.ratio*this.b2.rot-this.b1.rot;return this.equal?(n=!1,this.scale=1):n=t<this.jointMin?!(this.scale=-1):t>this.jointMax?(t-=this.jointMax,!(this.scale=1)):!(t=this.scale=0),n},Gn.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?X.get(0,0,-this.scale*this.jAcc):X.get(0,0,this.ratio*this.scale*this.jAcc):X.get(0,0,0)},Gn.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Gn.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Gn.prototype.b1=null,Gn.prototype.b2=null,Gn.prototype.kMass=null,Gn.prototype.jAcc=null,Gn.prototype.jMax=null,Gn.prototype.gamma=null,Gn.prototype.bias=null,Gn.prototype.stepped=null,Gn.prototype.copy=function(n,t){var e=new b(null,null,this.jointMin,this.jointMax,this.ratio);if(this.copyto(e),null!=n&&null!=this.b1){for(var i=null,p=0;p<n.length;){var l=n[p];if(++p,l.id==this.b1.id){i=l.bc;break}}null!=i?e.zpp_inner_zn.b1=i.zpp_inner:t.push(lt.todo(this.b1.id,function(n){e.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b2.id){r=a.bc;break}}null!=r?e.zpp_inner_zn.b2=r.zpp_inner:t.push(lt.todo(this.b2.id,function(n){e.zpp_inner_zn.b2=n.zpp_inner}))}return e},Gn.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: AngleJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new p("Error: AngleJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic")},Gn.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Gn.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},Gn.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},Gn.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1,this.slack=!1},Gn.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax;var e=this.ratio*this.b2.rot-this.b1.rot;this.equal?(e-=this.jointMax,this.slack=!1,this.scale=1):e<this.jointMin?(e=this.jointMin-e,this.scale=-1,this.slack=!1):e>this.jointMax?(e-=this.jointMax,this.scale=1,this.slack=!1):(e=this.scale=0,this.slack=!0);var i=e;if(!this.slack){if(this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&i*i>this.maxError*this.maxError)return!0;var p=2*Math.PI*this.frequency;this.gamma=1/(n*p*(2*this.damping+p*n));var l=1/(1+this.gamma),r=n*p*p*this.gamma;this.gamma*=l,this.kMass*=l,this.bias=-i*r,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=t,this.jMax=this.maxForce*n}return!1},Gn.prototype.warmStart=function(){this.slack||(this.b1.angvel-=this.scale*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*this.jAcc)},Gn.prototype.applyImpulseVel=function(){if(this.slack)return!1;var n=this.kMass*(this.bias-this.scale*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel))-this.jAcc*this.gamma,t=this.jAcc;return this.jAcc+=n,!this.equal&&0<this.jAcc&&(this.jAcc=0),!(!this.breakUnderForce||!(this.jAcc>this.jMax||this.jAcc<-this.jMax))||(this.stiff||(this.jAcc>this.jMax?this.jAcc=this.jMax:this.jAcc<-this.jMax&&(this.jAcc=-this.jMax)),n=this.jAcc-t,this.b1.angvel-=this.scale*this.b1.iinertia*n,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*n,!1)},Gn.prototype.applyImpulsePos=function(){var n,t,e=this.ratio*this.b2.rot-this.b1.rot;if(this.equal?(e-=this.jointMax,t=!1,this.scale=1):t=e<this.jointMin?(e=this.jointMin-e,!(this.scale=-1)):e>this.jointMax?(e-=this.jointMax,!(this.scale=1)):!(e=this.scale=0),n=e,!t){if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;var i,p,l,r,o,a,s,_,h,u,x,d,y=-(n*=.5)*this.kMass;(this.equal||y<0)&&(i=this.b1,p=-this.scale*y*this.b1.iinertia,i.rot+=p,1e-4<p*p?(i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)):(o=1-(l=p*p)*l/8,a=((r=1-.5*l)*i.axisx+p*i.axisy)*o,i.axisy=(r*i.axisy-p*i.axisx)*o,i.axisx=a),s=this.b2,_=this.ratio*this.scale*y*this.b2.iinertia,s.rot+=_,1e-4<_*_?(s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot)):(x=1-(h=_*_)*h/8,d=((u=1-.5*h)*s.axisx+_*s.axisy)*x,s.axisy=(u*s.axisy-_*s.axisx)*x,s.axisx=d))}return!1},Gn.prototype.draw=function(n){},Gn.prototype.__class__=Gn;var lt=zpp_nape.constraint.ZPP_CopyHelper=function(){this.cb=null,this.bc=null,this.id=0};lt.__name__=["zpp_nape","constraint","ZPP_CopyHelper"],lt.dict=function(n,t){var e=new lt;return e.id=n,e.bc=t,e},lt.todo=function(n,t){var e=new lt;return e.id=n,e.cb=t,e},lt.prototype.id=null,lt.prototype.bc=null,lt.prototype.cb=null,lt.prototype.__class__=lt;var rt=zpp_nape.constraint.ZPP_DistanceJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx2=0,this.cx1=0,this.ny=0,this.nx=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.outer_zn=null,Bn.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.jAcc=0,this.jMax=1/0,this.stepped=!1,this.cx1=this.cx2=0};rt.__name__=["zpp_nape","constraint","ZPP_DistanceJoint"],rt.__super__=Bn,rt.prototype=Object.create(Bn.prototype),rt.prototype.outer_zn=null,rt.prototype.jointMin=null,rt.prototype.jointMax=null,rt.prototype.slack=null,rt.prototype.equal=null,rt.prototype.is_slack=function(){this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var n,t=0,e=0,i=(t=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx))*t+(e=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely))*e;return i<co.epsilon||(t*=n=1/(i=Math.sqrt(i)),e*=n,!this.equal&&(!(i<this.jointMin)&&(i>this.jointMax?(i-=this.jointMax,!1):!(i=0))))},rt.prototype.nx=null,rt.prototype.ny=null,rt.prototype.cx1=null,rt.prototype.cx2=null,rt.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?X.get(-this.jAcc*this.nx,-this.jAcc*this.ny,-this.cx1*this.jAcc):X.get(this.jAcc*this.nx,this.jAcc*this.ny,this.cx2*this.jAcc):X.get(0,0,0)},rt.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},rt.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},rt.prototype.b1=null,rt.prototype.a1localx=null,rt.prototype.a1localy=null,rt.prototype.a1relx=null,rt.prototype.a1rely=null,rt.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},rt.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},rt.prototype.setup_a1=function(){var n,t,e,i,p,l=this.a1localx,r=this.a1localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=Q(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=Q(this,this.invalidate_a1)},rt.prototype.wrap_a1=null,rt.prototype.b2=null,rt.prototype.a2localx=null,rt.prototype.a2localy=null,rt.prototype.a2relx=null,rt.prototype.a2rely=null,rt.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},rt.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},rt.prototype.setup_a2=function(){var n,t,e,i,p,l=this.a2localx,r=this.a2localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=Q(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=Q(this,this.invalidate_a2)},rt.prototype.wrap_a2=null,rt.prototype.kMass=null,rt.prototype.jAcc=null,rt.prototype.jMax=null,rt.prototype.gamma=null,rt.prototype.bias=null,rt.prototype.stepped=null,rt.prototype.copy=function(n,t){var e=this.outer_zn;null==e.zpp_inner_zn.wrap_a1&&e.zpp_inner_zn.setup_a1();var i=e.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=new M(null,null,i,p.zpp_inner_zn.wrap_a2,this.jointMin,this.jointMax);if(this.copyto(l),null!=n&&null!=this.b1){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b1.id){r=a.bc;break}}null!=r?l.zpp_inner_zn.b1=r.zpp_inner:t.push(lt.todo(this.b1.id,function(n){l.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var s=null,_=0;_<n.length;){var h=n[_];if(++_,h.id==this.b2.id){s=h.bc;break}}null!=s?l.zpp_inner_zn.b2=s.zpp_inner:t.push(lt.todo(this.b2.id,function(n){l.zpp_inner_zn.b2=n.zpp_inner}))}return l},rt.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: DistanceJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: DistanceJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new p("Error: DistanceJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic")},rt.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},rt.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},rt.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},rt.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},rt.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.nx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.ny=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);var e,i=this.nx*this.nx+this.ny*this.ny;i<co.epsilon?(this.nx=0,i=this.ny=0,this.slack=!0):(e=1/(i=Math.sqrt(i)),this.nx*=e,this.ny*=e,this.equal?(i-=this.jointMax,this.slack=!1):i<this.jointMin?(i=this.jointMin-i,this.nx=-this.nx,this.ny=-this.ny,this.slack=!1):i>this.jointMax?(i-=this.jointMax,this.slack=!1):(this.nx=0,i=this.ny=0,this.slack=!0));var p=i;if(!this.slack){if(this.cx1=this.ny*this.a1relx-this.nx*this.a1rely,this.cx2=this.ny*this.a2relx-this.nx*this.a2rely,this.kMass=this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&p*p>this.maxError*this.maxError)return!0;var l=2*Math.PI*this.frequency;this.gamma=1/(n*l*(2*this.damping+l*n));var r=1/(1+this.gamma),o=n*l*l*this.gamma;this.gamma*=r,this.kMass*=r,this.bias=-p*o,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=t,this.jMax=this.maxForce*n}return!1},rt.prototype.warmStart=function(){var n,t;this.slack||(n=this.b1.imass*this.jAcc,this.b1.velx-=this.nx*n,this.b1.vely-=this.ny*n,t=this.b2.imass*this.jAcc,this.b2.velx+=this.nx*t,this.b2.vely+=this.ny*t,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc)},rt.prototype.applyImpulseVel=function(){if(this.slack)return!1;var n=this.kMass*(this.bias-(this.nx*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.ny*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1))-this.jAcc*this.gamma,t=this.jAcc;if(this.jAcc+=n,!this.equal&&0<this.jAcc&&(this.jAcc=0),this.breakUnderForce&&this.jAcc<-this.jMax)return!0;this.stiff||this.jAcc<-this.jMax&&(this.jAcc=-this.jMax),n=this.jAcc-t;var e=this.b1.imass*n;this.b1.velx-=this.nx*e,this.b1.vely-=this.ny*e;var i=this.b2.imass*n;return this.b2.velx+=this.nx*i,this.b2.vely+=this.ny*i,this.b1.angvel-=this.cx1*this.b1.iinertia*n,this.b2.angvel+=this.cx2*this.b2.iinertia*n,!1},rt.prototype.applyImpulsePos=function(){var n,t,e,i,p,l,r,o,a,s=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,_=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,h=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,u=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,x=0,d=0,y=(x=this.b2.posx+h-(this.b1.posx+s))*x+(d=this.b2.posy+u-(this.b1.posy+_))*d,z=y<co.epsilon?!(y=d=x=0):(x*=n=1/(y=Math.sqrt(y)),d*=n,this.equal?(y-=this.jointMax,!1):y<this.jointMin?(y=this.jointMin-y,x=-x,d=-d,!1):y>this.jointMax?(y-=this.jointMax,!1):!(y=d=x=0)),c=y;if(!z){if(this.breakUnderError&&c*c>this.maxError*this.maxError)return!0;if(c*c<co.constraintLinearSlop*co.constraintLinearSlop)return!1;6<(c*=.5)*c&&((l=this.b1.smass+this.b2.smass)>co.epsilon&&(r=-c*(l=.75/l),(this.equal||r<0)&&(t=r*this.b1.imass,this.b1.posx-=x*t,this.b1.posy-=d*t,e=r*this.b2.imass,this.b2.posx+=x*e,this.b2.posy+=d*e,(i=(x=this.b2.posx+h-(this.b1.posx+s))*x+(d=this.b2.posy+u-(this.b1.posy+_))*d)<co.epsilon?i=d=x=0:(x*=p=1/(i=Math.sqrt(i)),d*=p,this.equal?i-=this.jointMax:i<this.jointMin?(i=this.jointMin-i,x=-x,d=-d):i>this.jointMax?i-=this.jointMax:i=d=x=0),c=i,c*=.5))),o=d*s-x*_,a=d*h-x*u;var v,m,f,b,g,w,M,C,k,O,P,S,A,j,E=this.b1.smass+this.b2.smass+o*o*this.b1.sinertia+a*a*this.b2.sinertia;0!=E&&(E=1/E),r=-c*E,(this.equal||r<0)&&(v=this.b1.imass*r,this.b1.posx-=x*v,this.b1.posy-=d*v,m=this.b2.imass*r,this.b2.posx+=x*m,this.b2.posy+=d*m,f=this.b1,b=-o*this.b1.iinertia*r,f.rot+=b,1e-4<b*b?(f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot)):(M=1-(g=b*b)*g/8,C=((w=1-.5*g)*f.axisx+b*f.axisy)*M,f.axisy=(w*f.axisy-b*f.axisx)*M,f.axisx=C),k=this.b2,O=a*this.b2.iinertia*r,k.rot+=O,1e-4<O*O?(k.axisx=Math.sin(k.rot),k.axisy=Math.cos(k.rot)):(A=1-(P=O*O)*P/8,j=((S=1-.5*P)*k.axisx+O*k.axisy)*A,k.axisy=(S*k.axisy-O*k.axisx)*A,k.axisx=j))}return!1},rt.prototype.draw=function(n){},rt.prototype.__class__=rt;var _t=zpp_nape.constraint.ZPP_LineJoint=function(){this.biasy=0,this.biasx=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_n=null,this.nrely=0,this.nrelx=0,this.nlocaly=0,this.nlocalx=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.cx2=0,this.cx1=0,this.dot2=0,this.dot1=0,this.equal=!1,this.jointMax=0,this.jointMin=0,this.scale=0,this.outer_zn=null,Bn.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.nlocalx=0,this.nlocaly=0,this.nrelx=0,this.nrely=0,this.jAccx=0,this.jAccy=0,this.jMax=1/0,this.jointMin=-1/0,this.jointMax=1/0,this.stepped=!1};_t.__name__=["zpp_nape","constraint","ZPP_LineJoint"],_t.__super__=Bn,_t.prototype=Object.create(Bn.prototype),_t.prototype.outer_zn=null,_t.prototype.scale=null,_t.prototype.jointMin=null,_t.prototype.jointMax=null,_t.prototype.equal=null,_t.prototype.dot1=null,_t.prototype.dot2=null,_t.prototype.cx1=null,_t.prototype.cx2=null,_t.prototype.bodyImpulse=function(n){if(this.stepped){var t=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,e=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy;return n==this.b1?X.get(-t,-e,this.scale*this.cx1*e-this.dot1*t):X.get(t,e,this.scale*this.cx1*e-this.dot1*t)}return X.get(0,0,0)},_t.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},_t.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},_t.prototype.b1=null,_t.prototype.a1localx=null,_t.prototype.a1localy=null,_t.prototype.a1relx=null,_t.prototype.a1rely=null,_t.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},_t.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},_t.prototype.setup_a1=function(){var n,t,e,i,p,l=this.a1localx,r=this.a1localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=Q(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=Q(this,this.invalidate_a1)},_t.prototype.wrap_a1=null,_t.prototype.b2=null,_t.prototype.a2localx=null,_t.prototype.a2localy=null,_t.prototype.a2relx=null,_t.prototype.a2rely=null,_t.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},_t.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},_t.prototype.setup_a2=function(){var n,t,e,i,p,l=this.a2localx,r=this.a2localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=Q(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=Q(this,this.invalidate_a2)},_t.prototype.wrap_a2=null,_t.prototype.zip_n=null,_t.prototype.nlocalx=null,_t.prototype.nlocaly=null,_t.prototype.nrelx=null,_t.prototype.nrely=null,_t.prototype.validate_n=function(){this.wrap_n.zpp_inner.x=this.nlocalx,this.wrap_n.zpp_inner.y=this.nlocaly},_t.prototype.invalidate_n=function(n){this.immutable_midstep("Constraint::n"),this.nlocalx=n.x,this.nlocaly=n.y,this.zip_n=!0,this.wake()},_t.prototype.setup_n=function(){var n,t,e,i,p,l=this.nlocalx,r=this.nlocaly;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_n=n,this.wrap_n.zpp_inner._inuse=!0,this.wrap_n.zpp_inner._validate=Q(this,this.validate_n),this.wrap_n.zpp_inner._invalidate=Q(this,this.invalidate_n)},_t.prototype.wrap_n=null,_t.prototype.validate_norm=function(){var n;this.zip_n&&(this.zip_n=!1,n=1/Math.sqrt(this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly),this.nlocalx*=n,this.nlocaly*=n)},_t.prototype.kMassa=null,_t.prototype.kMassb=null,_t.prototype.kMassc=null,_t.prototype.jAccx=null,_t.prototype.jAccy=null,_t.prototype.jMax=null,_t.prototype.gamma=null,_t.prototype.biasx=null,_t.prototype.biasy=null,_t.prototype.stepped=null,_t.prototype.copy=function(n,t){var e=this.outer_zn;null==e.zpp_inner_zn.wrap_a1&&e.zpp_inner_zn.setup_a1();var i=e.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=p.zpp_inner_zn.wrap_a2,r=this.outer_zn;null==r.zpp_inner_zn.wrap_n&&r.zpp_inner_zn.setup_n();var o=new C(null,null,i,l,r.zpp_inner_zn.wrap_n,this.jointMin,this.jointMax);if(this.copyto(o),null!=n&&null!=this.b1){for(var a=null,s=0;s<n.length;){var _=n[s];if(++s,_.id==this.b1.id){a=_.bc;break}}null!=a?o.zpp_inner_zn.b1=a.zpp_inner:t.push(lt.todo(this.b1.id,function(n){o.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var h=null,u=0;u<n.length;){var x=n[u];if(++u,x.id==this.b2.id){h=x.bc;break}}null!=h?o.zpp_inner_zn.b2=h.zpp_inner:t.push(lt.todo(this.b2.id,function(n){o.zpp_inner_zn.b2=n.zpp_inner}))}return o},_t.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: DistanceJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new p("Error: DistanceJoint must have jointMin <= jointMax");if(this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly<co.epsilon)throw new p("Error: DistanceJoint direction must be non-degenerate");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic")},_t.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},_t.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},_t.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},_t.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},_t.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.equal=this.jointMin==this.jointMax,this.stepped=!0,this.validate_norm(),this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.nrelx=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,this.nrely=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var e=0,i=0,p=this.b2.posx+this.a2relx-this.b1.posx-this.a1relx,l=(e=this.b2.posy+this.a2rely-this.b1.posy-this.a1rely)*this.nrelx-p*this.nrely,i=this.nrelx*p+this.nrely*e;this.equal?(i-=this.jointMin,this.scale=1):i>this.jointMax?(i-=this.jointMax,this.scale=1):i<this.jointMin?(i=this.jointMin-i,this.scale=-1):(i=0,this.scale=0);var r=p+this.a1relx,o=e+this.a1rely;this.dot1=this.nrelx*r+this.nrely*o,this.cx1=o*this.nrelx-r*this.nrely,this.dot2=this.nrelx*this.a2relx+this.nrely*this.a2rely,this.cx2=this.a2rely*this.nrelx-this.a2relx*this.nrely,this.kMassa=this.b1.smass+this.b2.smass+this.dot1*this.dot1*this.b1.sinertia+this.dot2*this.dot2*this.b2.sinertia,this.kMassb=-this.scale*(this.dot1*this.cx1*this.b1.sinertia+this.dot2*this.cx2*this.b2.sinertia),this.kMassc=this.scale*this.scale*(this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia);var a,s,_,h=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(0!=(1&(_=h!=h?(this.kMassa=this.kMassb=this.kMassc=0,3):0==h?((a=0)!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,a=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,a|=2),this.kMassb=0,a):(h=1/h,s=this.kMassc*h,this.kMassc=this.kMassa*h,this.kMassa=s,this.kMassb*=-h,0)))&&(this.jAccx=0),0!=(2&_)&&(this.jAccy=0),this.stiff)this.gamma=0,this.biasx=0,this.biasy=0;else{if(this.breakUnderError&&l*l+i*i>this.maxError*this.maxError)return!0;var u=2*Math.PI*this.frequency;this.gamma=1/(n*u*(2*this.damping+u*n));var x=1/(1+this.gamma),d=n*u*u*this.gamma;this.gamma*=x,this.kMassa*=x,this.kMassb*=x,this.kMassc*=x,this.biasx=l,this.biasy=i;var y=-d;this.biasx*=y,this.biasy*=y;var z,c=this.maxError,v=this.biasx*this.biasx+this.biasy*this.biasy;c*c<v&&(z=c*(1/Math.sqrt(v)),this.biasx*=z,this.biasy*=z)}return this.jAccx*=t,this.jAccy*=t,this.jMax=this.maxForce*n,!1},_t.prototype.warmStart=function(){var n=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,t=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy,e=this.b1.imass;this.b1.velx-=n*e,this.b1.vely-=t*e;var i=this.b2.imass;this.b2.velx+=n*i,this.b2.vely+=t*i,this.b1.angvel+=(this.scale*this.cx1*this.jAccy-this.dot1*this.jAccx)*this.b1.iinertia,this.b2.angvel+=(this.dot2*this.jAccx-this.scale*this.cx2*this.jAccy)*this.b2.iinertia},_t.prototype.applyImpulseVel=function(){var n,t,e=this.b2.velx-this.b1.velx,i=this.b2.vely-this.b1.vely;e+=this.b2.kinvelx-this.b1.kinvelx,n=(i+=this.b2.kinvely-this.b1.kinvely)*this.nrelx-e*this.nrely+(this.b2.angvel+this.b2.kinangvel)*this.dot2-(this.b1.angvel+this.b1.kinangvel)*this.dot1,t=this.scale*(this.nrelx*e+this.nrely*i-(this.b2.angvel+this.b2.kinangvel)*this.cx2+(this.b1.angvel+this.b1.kinangvel)*this.cx1);var p=this.biasx-n,l=this.biasy-t,r=this.kMassa*p+this.kMassb*l;l=this.kMassb*p+this.kMassc*l,p=r;var o=this.gamma;p-=this.jAccx*o,l-=this.jAccy*o;var a,s,_,h=this.jAccx,u=this.jAccy;if(this.jAccx+=p,this.jAccy+=l,0<this.jAccy&&(this.jAccy=0),this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else this.stiff||(a=this.jMax)*a<(s=this.jAccx*this.jAccx+this.jAccy*this.jAccy)&&(_=a*(1/Math.sqrt(s)),this.jAccx*=_,this.jAccy*=_);p=this.jAccx-h,l=this.jAccy-u;var x=this.scale*this.nrelx*l-this.nrely*p,d=this.nrelx*p+this.scale*this.nrely*l,y=this.b1.imass;this.b1.velx-=x*y,this.b1.vely-=d*y;var z=this.b2.imass;return this.b2.velx+=x*z,this.b2.vely+=d*z,this.b1.angvel+=(this.scale*this.cx1*l-this.dot1*p)*this.b1.iinertia,this.b2.angvel+=(this.dot2*p-this.scale*this.cx2*l)*this.b2.iinertia,!1},_t.prototype.applyImpulsePos=function(){var n=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,t=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,e=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,i=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,p=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,l=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,r=0,o=0,a=0,s=0,r=this.b2.posx+p-this.b1.posx-e,a=(o=this.b2.posy+l-this.b1.posy-i)*n-r*t,s=n*r+t*o,_=this.equal?(s-=this.jointMin,1):s>this.jointMax?(s-=this.jointMax,1):s<this.jointMin?(s=this.jointMin-s,-1):s=0;if(this.breakUnderError&&a*a+s*s>this.maxError*this.maxError)return!0;if(a*a+s*s<co.constraintLinearSlop*co.constraintLinearSlop)return!1;var h,u,x,d,y,z=0,c=0;6<(a*=.5)*a+(s*=.5)*s&&((h=this.b1.smass+this.b2.smass)>co.epsilon&&(u=(h=.8/h)*(t*a-_*n*s),x=h*(n*a*_-t*a),d=this.b1.imass,this.b1.posx-=u*d,this.b1.posy-=x*d,y=this.b2.imass,this.b2.posx+=u*y,this.b2.posy+=x*y,r=this.b2.posx+p-this.b1.posx-e,a=(o=this.b2.posy+l-this.b1.posy-i)*n-r*t,s=n*r+t*o,_=this.equal?(s-=this.jointMin,1):s>this.jointMax?(s-=this.jointMax,1):s<this.jointMin?(s=this.jointMin-s,-1):s=0,a*=.5,s*=.5));var v=0,m=0,f=0,b=n*(m=r+e)+t*(f=o+i),g=f*n-m*t,w=n*p+t*l,M=l*n-p*t,C=this.b1.smass+this.b2.smass+b*b*this.b1.sinertia+w*w*this.b2.sinertia,k=-_*(b*g*this.b1.sinertia+w*M*this.b2.sinertia);z=-a,c=-s;var O,P=C*(v=_*_*(this.b1.smass+this.b2.smass+g*g*this.b1.sinertia+M*M*this.b2.sinertia))-k*k;P!=P?z=c=0:0==P?(0!=C?z/=C:z=0,0!=v?c/=v:c=0):(O=(P=1/P)*(v*z-k*c),c=P*(C*c-k*z),z=O),0<c&&(c=0);var S=_*n*c-t*z,A=n*z+_*t*c,j=this.b1.imass;this.b1.posx-=S*j,this.b1.posy-=A*j;var E=this.b2.imass;this.b2.posx+=S*E,this.b2.posy+=A*E;var I,T,N,L,V=this.b1,D=(_*g*c-b*z)*this.b1.iinertia;V.rot+=D,1e-4<D*D?(V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot)):(N=1-(I=D*D)*I/8,L=((T=1-.5*I)*V.axisx+D*V.axisy)*N,V.axisy=(T*V.axisy-D*V.axisx)*N,V.axisx=L);var F,R,Z,B,G=this.b2,q=(w*z-_*M*c)*this.b2.iinertia;return G.rot+=q,1e-4<q*q?(G.axisx=Math.sin(G.rot),G.axisy=Math.cos(G.rot)):(Z=1-(F=q*q)*F/8,B=((R=1-.5*F)*G.axisx+q*G.axisy)*Z,G.axisy=(R*G.axisy-q*G.axisx)*Z,G.axisx=B),!1},_t.prototype.draw=function(n){},_t.prototype.__class__=_t;var ht=zpp_nape.constraint.ZPP_MotorJoint=function(){this.stepped=!1,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.rate=0,this.ratio=0,this.outer_zn=null,Bn.call(this),this.jAcc=0,this.stepped=!1,this.__velocity=!0};ht.__name__=["zpp_nape","constraint","ZPP_MotorJoint"],ht.__super__=Bn,ht.prototype=Object.create(Bn.prototype),ht.prototype.outer_zn=null,ht.prototype.ratio=null,ht.prototype.rate=null,ht.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?X.get(0,0,-this.jAcc):X.get(0,0,this.ratio*this.jAcc):X.get(0,0,0)},ht.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},ht.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},ht.prototype.b1=null,ht.prototype.b2=null,ht.prototype.kMass=null,ht.prototype.jAcc=null,ht.prototype.jMax=null,ht.prototype.stepped=null,ht.prototype.copy=function(n,t){var e=new k(null,null,this.rate,this.ratio);if(this.copyto(e),null!=n&&null!=this.b1){for(var i=null,p=0;p<n.length;){var l=n[p];if(++p,l.id==this.b1.id){i=l.bc;break}}null!=i?e.zpp_inner_zn.b1=i.zpp_inner:t.push(lt.todo(this.b1.id,function(n){e.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b2.id){r=a.bc;break}}null!=r?e.zpp_inner_zn.b2=r.zpp_inner:t.push(lt.todo(this.b2.id,function(n){e.zpp_inner_zn.b2=n.zpp_inner}))}return e},ht.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: MotorJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic")},ht.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},ht.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},ht.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},ht.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},ht.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;return this.pre_dt=n,this.stepped=!0,this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,this.kMass=1/this.kMass,this.jAcc*=t,this.jMax=this.maxForce*n,!1},ht.prototype.warmStart=function(){this.b1.angvel-=this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.b2.iinertia*this.jAcc},ht.prototype.applyImpulseVel=function(){var n=-this.kMass*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel-this.rate),t=this.jAcc;if(this.jAcc+=n,this.breakUnderForce){if(this.jAcc>this.jMax||this.jAcc<-this.jMax)return!0}else this.jAcc<-this.jMax?this.jAcc=-this.jMax:this.jAcc>this.jMax&&(this.jAcc=this.jMax);return n=this.jAcc-t,this.b1.angvel-=this.b1.iinertia*n,this.b2.angvel+=this.ratio*this.b2.iinertia*n,!1},ht.prototype.applyImpulsePos=function(){return!1},ht.prototype.__class__=ht;var ut=zpp_nape.constraint.ZPP_PivotJoint=function(){this.stepped=!1,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,Bn.call(this),this.stepped=!1,this.jAccx=0,this.jAccy=0,this.jMax=1/0,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};ut.__name__=["zpp_nape","constraint","ZPP_PivotJoint"],ut.__super__=Bn,ut.prototype=Object.create(Bn.prototype),ut.prototype.outer_zn=null,ut.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?X.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely)):X.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely):X.get(0,0,0)},ut.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},ut.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},ut.prototype.b1=null,ut.prototype.a1localx=null,ut.prototype.a1localy=null,ut.prototype.a1relx=null,ut.prototype.a1rely=null,ut.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},ut.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},ut.prototype.setup_a1=function(){var n,t,e,i,p,l=this.a1localx,r=this.a1localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=Q(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=Q(this,this.invalidate_a1)},ut.prototype.wrap_a1=null,ut.prototype.b2=null,ut.prototype.a2localx=null,ut.prototype.a2localy=null,ut.prototype.a2relx=null,ut.prototype.a2rely=null,ut.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},ut.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},ut.prototype.setup_a2=function(){var n,t,e,i,p,l=this.a2localx,r=this.a2localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=Q(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=Q(this,this.invalidate_a2)},ut.prototype.wrap_a2=null,ut.prototype.kMassa=null,ut.prototype.kMassb=null,ut.prototype.kMassc=null,ut.prototype.jAccx=null,ut.prototype.jAccy=null,ut.prototype.jMax=null,ut.prototype.gamma=null,ut.prototype.biasx=null,ut.prototype.biasy=null,ut.prototype.stepped=null,ut.prototype.copy=function(n,t){var e=this.outer_zn;null==e.zpp_inner_zn.wrap_a1&&e.zpp_inner_zn.setup_a1();var i=e.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=new O(null,null,i,p.zpp_inner_zn.wrap_a2);if(this.copyto(l),null!=n&&null!=this.b1){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b1.id){r=a.bc;break}}null!=r?l.zpp_inner_zn.b1=r.zpp_inner:t.push(lt.todo(this.b1.id,function(n){l.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var s=null,_=0;_<n.length;){var h=n[_];if(++_,h.id==this.b2.id){s=h.bc;break}}null!=s?l.zpp_inner_zn.b2=s.zpp_inner:t.push(lt.todo(this.b2.id,function(n){l.zpp_inner_zn.b2=n.zpp_inner}))}return l},ut.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: PivotJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: PivotJoint cannot be simulated with body1 == body2 (body1=body2="+this.b1.outer.toString()+")");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")")},ut.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},ut.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},ut.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},ut.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},ut.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var e,i,p,l,r=this.b1.smass+this.b2.smass;this.kMassa=r,this.kMassb=0,this.kMassc=r,0!=this.b1.sinertia&&(e=this.a1relx*this.b1.sinertia,i=this.a1rely*this.b1.sinertia,this.kMassa+=i*this.a1rely,this.kMassb+=-i*this.a1relx,this.kMassc+=e*this.a1relx),0!=this.b2.sinertia&&(p=this.a2relx*this.b2.sinertia,l=this.a2rely*this.b2.sinertia,this.kMassa+=l*this.a2rely,this.kMassb+=-l*this.a2relx,this.kMassc+=p*this.a2relx);var o,a,s,_=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(0!=(1&(s=_!=_?(this.kMassa=this.kMassb=this.kMassc=0,3):0==_?((o=0)!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,o=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,o|=2),this.kMassb=0,o):(_=1/_,a=this.kMassc*_,this.kMassc=this.kMassa*_,this.kMassa=a,this.kMassb*=-_,0)))&&(this.jAccx=0),0!=(2&s)&&(this.jAccy=0),this.stiff)this.biasx=0,this.biasy=0,this.gamma=0;else{var h=2*Math.PI*this.frequency;this.gamma=1/(n*h*(2*this.damping+h*n));var u=1/(1+this.gamma),x=n*h*h*this.gamma;if(this.gamma*=u,this.kMassa*=u,this.kMassb*=u,this.kMassc*=u,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy>this.maxError*this.maxError)return!0;var d=-x;this.biasx*=d,this.biasy*=d;var y,z=this.maxError,c=this.biasx*this.biasx+this.biasy*this.biasy;z*z<c&&(y=z*(1/Math.sqrt(c)),this.biasx*=y,this.biasy*=y)}return this.jAccx*=t,this.jAccy*=t,this.jMax=this.maxForce*n,!1},ut.prototype.warmStart=function(){var n=this.b1.imass;this.b1.velx-=this.jAccx*n,this.b1.vely-=this.jAccy*n;var t=this.b2.imass;this.b2.velx+=this.jAccx*t,this.b2.vely+=this.jAccy*t,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely)*this.b2.iinertia},ut.prototype.applyImpulseVel=function(){var n=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),t=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),e=this.biasx-n,i=this.biasy-t,p=this.kMassa*e+this.kMassb*i;i=this.kMassb*e+this.kMassc*i,e=p;var l=this.gamma;e-=this.jAccx*l,i-=this.jAccy*l;var r,o,a,s=this.jAccx,_=this.jAccy;if(this.jAccx+=e,this.jAccy+=i,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else this.stiff||(r=this.jMax)*r<(o=this.jAccx*this.jAccx+this.jAccy*this.jAccy)&&(a=r*(1/Math.sqrt(o)),this.jAccx*=a,this.jAccy*=a);e=this.jAccx-s,i=this.jAccy-_;var h=this.b1.imass;this.b1.velx-=e*h,this.b1.vely-=i*h;var u=this.b2.imass;return this.b2.velx+=e*u,this.b2.vely+=i*u,this.b1.angvel-=(i*this.a1relx-e*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(i*this.a2relx-e*this.a2rely)*this.b2.iinertia,!1},ut.prototype.applyImpulsePos=function(){var n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,t=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,e=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,p=0,l=0,p=this.b2.posx+e-(this.b1.posx+n),l=this.b2.posy+i-(this.b1.posy+t);if(this.breakUnderError&&p*p+l*l>this.maxError*this.maxError)return!0;if(p*p+l*l<co.constraintLinearSlop*co.constraintLinearSlop)return!1;var r,o,a,s,_,h=0,u=0;6<(p*=.5)*p+(l*=.5)*l&&((r=this.b1.smass+this.b2.smass)>co.epsilon&&(400<(o=(h=-p*(r=.75/r))*h+(u=-l*r)*u)&&(h*=a=1/Math.sqrt(o)*20,u*=a),s=this.b1.imass,this.b1.posx-=h*s,this.b1.posy-=u*s,_=this.b2.imass,this.b2.posx+=h*_,this.b2.posy+=u*_,p=this.b2.posx+e-(this.b1.posx+n),l=this.b2.posy+i-(this.b1.posy+t),p*=.5,l*=.5));var x,d,y,z,c=0,v=0,m=0,f=this.b1.smass+this.b2.smass,m=c=f;(v=0)!=this.b1.sinertia&&(x=n*this.b1.sinertia,c=f+(d=t*this.b1.sinertia)*t,v+=-d*n,m=f+x*n),0!=this.b2.sinertia&&(y=e*this.b2.sinertia,c+=(z=i*this.b2.sinertia)*i,v+=-z*e,m+=y*e);var b,g=(h=-p)*h+(u=-l)*u;36<g&&(h*=b=1/Math.sqrt(g)*6,u*=b);var w,M=c*m-v*v;M!=M?h=u=0:0==M?(0!=c?h/=c:h=0,0!=m?u/=m:u=0):(w=(M=1/M)*(m*h-v*u),u=M*(c*u-v*h),h=w);var C=this.b1.imass;this.b1.posx-=h*C,this.b1.posy-=u*C;var k=this.b2.imass;this.b2.posx+=h*k,this.b2.posy+=u*k;var O,P,S,A,j=this.b1,E=-(u*n-h*t)*this.b1.iinertia;j.rot+=E,1e-4<E*E?(j.axisx=Math.sin(j.rot),j.axisy=Math.cos(j.rot)):(S=1-(O=E*E)*O/8,A=((P=1-.5*O)*j.axisx+E*j.axisy)*S,j.axisy=(P*j.axisy-E*j.axisx)*S,j.axisx=A);var I,T,N,L,V=this.b2,D=(u*e-h*i)*this.b2.iinertia;return V.rot+=D,1e-4<D*D?(V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot)):(N=1-(I=D*D)*I/8,L=((T=1-.5*I)*V.axisx+D*V.axisy)*N,V.axisy=(T*V.axisy-D*V.axisx)*N,V.axisx=L),!1},ut.prototype.draw=function(n){},ut.prototype.__class__=ut;var xt=zpp_nape.constraint.ZPP_PulleyJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a4=null,this.a4rely=0,this.a4relx=0,this.a4localy=0,this.a4localx=0,this.b4=null,this.wrap_a3=null,this.a3rely=0,this.a3relx=0,this.a3localy=0,this.a3localx=0,this.b3=null,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx4=0,this.cx3=0,this.cx2=0,this.cx1=0,this.n34y=0,this.n34x=0,this.n12y=0,this.n12x=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=1,this.outer_zn=null,Bn.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.a3localx=0,this.a3localy=0,this.a3relx=0,this.a3rely=0,this.a4localx=0,this.a4localy=0,this.a4relx=0,this.a4rely=0,this.n12x=1,this.n12y=0,this.n34x=1,this.n34y=0,this.jAcc=0,this.jMax=1/0,this.stepped=!1,this.cx1=this.cx2=this.cx3=this.cx4=0};xt.__name__=["zpp_nape","constraint","ZPP_PulleyJoint"],xt.__super__=Bn,xt.prototype=Object.create(Bn.prototype),xt.prototype.outer_zn=null,xt.prototype.ratio=null,xt.prototype.jointMin=null,xt.prototype.jointMax=null,xt.prototype.slack=null,xt.prototype.equal=null,xt.prototype.is_slack=function(){this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var n=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),t=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),e=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),i=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely),p=Math.sqrt(n*n+t*t),l=Math.sqrt(e*e+i*i);0==l&&Math.sqrt(0);var r=p+this.ratio*l;return!this.equal&&(!(r<this.jointMin)&&(r>this.jointMax?(r-=this.jointMax,!1):!(r=0)))},xt.prototype.n12x=null,xt.prototype.n12y=null,xt.prototype.n34x=null,xt.prototype.n34y=null,xt.prototype.cx1=null,xt.prototype.cx2=null,xt.prototype.cx3=null,xt.prototype.cx4=null,xt.prototype.bodyImpulse=function(n){if(this.stepped){var t,e,i,p,l,r,o,a,s,_,h,u,x,d,y,z,c,v,m,f,b,g,w,M,C=X.get();return n==this.b1&&(null!=(t=C.zpp_inner)._validate&&t._validate(),C.zpp_inner.x=C.zpp_inner.x-this.jAcc*this.n12x,null!=(e=C.zpp_inner)._validate&&e._validate(),null!=(i=C.zpp_inner)._validate&&i._validate(),C.zpp_inner.y=C.zpp_inner.y-this.jAcc*this.n12y,null!=(p=C.zpp_inner)._validate&&p._validate(),null!=(l=C.zpp_inner)._validate&&l._validate(),C.zpp_inner.z=C.zpp_inner.z-this.cx1*this.jAcc,null!=(r=C.zpp_inner)._validate&&r._validate()),n==this.b2&&(null!=(o=C.zpp_inner)._validate&&o._validate(),C.zpp_inner.x=C.zpp_inner.x+this.jAcc*this.n12x,null!=(a=C.zpp_inner)._validate&&a._validate(),null!=(s=C.zpp_inner)._validate&&s._validate(),C.zpp_inner.y=C.zpp_inner.y+this.jAcc*this.n12y,null!=(_=C.zpp_inner)._validate&&_._validate(),null!=(h=C.zpp_inner)._validate&&h._validate(),C.zpp_inner.z=C.zpp_inner.z+this.cx2*this.jAcc,null!=(u=C.zpp_inner)._validate&&u._validate()),n==this.b3&&(null!=(x=C.zpp_inner)._validate&&x._validate(),C.zpp_inner.x=C.zpp_inner.x-this.jAcc*this.n34x,null!=(d=C.zpp_inner)._validate&&d._validate(),null!=(y=C.zpp_inner)._validate&&y._validate(),C.zpp_inner.y=C.zpp_inner.y-this.jAcc*this.n34y,null!=(z=C.zpp_inner)._validate&&z._validate(),null!=(c=C.zpp_inner)._validate&&c._validate(),C.zpp_inner.z=C.zpp_inner.z-this.cx3*this.jAcc,null!=(v=C.zpp_inner)._validate&&v._validate()),n==this.b4&&(null!=(m=C.zpp_inner)._validate&&m._validate(),C.zpp_inner.x=C.zpp_inner.x+this.jAcc*this.n34x,null!=(f=C.zpp_inner)._validate&&f._validate(),null!=(b=C.zpp_inner)._validate&&b._validate(),C.zpp_inner.y=C.zpp_inner.y+this.jAcc*this.n34y,null!=(g=C.zpp_inner)._validate&&g._validate(),null!=(w=C.zpp_inner)._validate&&w._validate(),C.zpp_inner.z=C.zpp_inner.z+this.cx4*this.jAcc,null!=(M=C.zpp_inner)._validate&&M._validate()),C}return X.get(0,0,0)},xt.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.add(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.add(this)},xt.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.remove(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.remove(this)},xt.prototype.b1=null,xt.prototype.a1localx=null,xt.prototype.a1localy=null,xt.prototype.a1relx=null,xt.prototype.a1rely=null,xt.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},xt.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},xt.prototype.setup_a1=function(){var n,t,e,i,p,l=this.a1localx,r=this.a1localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=Q(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=Q(this,this.invalidate_a1)},xt.prototype.wrap_a1=null,xt.prototype.b2=null,xt.prototype.a2localx=null,xt.prototype.a2localy=null,xt.prototype.a2relx=null,xt.prototype.a2rely=null,xt.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},xt.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},xt.prototype.setup_a2=function(){var n,t,e,i,p,l=this.a2localx,r=this.a2localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=Q(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=Q(this,this.invalidate_a2)},xt.prototype.wrap_a2=null,xt.prototype.b3=null,xt.prototype.a3localx=null,xt.prototype.a3localy=null,xt.prototype.a3relx=null,xt.prototype.a3rely=null,xt.prototype.validate_a3=function(){this.wrap_a3.zpp_inner.x=this.a3localx,this.wrap_a3.zpp_inner.y=this.a3localy},xt.prototype.invalidate_a3=function(n){this.immutable_midstep("Constraint::a3"),this.a3localx=n.x,this.a3localy=n.y,this.wake()},xt.prototype.setup_a3=function(){var n,t,e,i,p,l=this.a3localx,r=this.a3localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a3=n,this.wrap_a3.zpp_inner._inuse=!0,this.wrap_a3.zpp_inner._validate=Q(this,this.validate_a3),this.wrap_a3.zpp_inner._invalidate=Q(this,this.invalidate_a3)},xt.prototype.wrap_a3=null,xt.prototype.b4=null,xt.prototype.a4localx=null,xt.prototype.a4localy=null,xt.prototype.a4relx=null,xt.prototype.a4rely=null,xt.prototype.validate_a4=function(){this.wrap_a4.zpp_inner.x=this.a4localx,this.wrap_a4.zpp_inner.y=this.a4localy},xt.prototype.invalidate_a4=function(n){this.immutable_midstep("Constraint::a4"),this.a4localx=n.x,this.a4localy=n.y,this.wake()},xt.prototype.setup_a4=function(){var n,t,e,i,p,l=this.a4localx,r=this.a4localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a4=n,this.wrap_a4.zpp_inner._inuse=!0,this.wrap_a4.zpp_inner._validate=Q(this,this.validate_a4),this.wrap_a4.zpp_inner._invalidate=Q(this,this.invalidate_a4)},xt.prototype.wrap_a4=null,xt.prototype.kMass=null,xt.prototype.jAcc=null,xt.prototype.jMax=null,xt.prototype.gamma=null,xt.prototype.bias=null,xt.prototype.stepped=null,xt.prototype.copy=function(n,t){var e=this.outer_zn;null==e.zpp_inner_zn.wrap_a1&&e.zpp_inner_zn.setup_a1();var i=e.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=p.zpp_inner_zn.wrap_a2,r=this.outer_zn;null==r.zpp_inner_zn.wrap_a3&&r.zpp_inner_zn.setup_a3();var o=r.zpp_inner_zn.wrap_a3,a=this.outer_zn;null==a.zpp_inner_zn.wrap_a4&&a.zpp_inner_zn.setup_a4();var s=new P(null,null,null,null,i,l,o,a.zpp_inner_zn.wrap_a4,this.jointMin,this.jointMax,this.ratio);if(this.copyto(s),null!=n&&null!=this.b1){for(var _=null,h=0;h<n.length;){var u=n[h];if(++h,u.id==this.b1.id){_=u.bc;break}}null!=_?s.zpp_inner_zn.b1=_.zpp_inner:t.push(lt.todo(this.b1.id,function(n){s.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var x=null,d=0;d<n.length;){var y=n[d];if(++d,y.id==this.b2.id){x=y.bc;break}}null!=x?s.zpp_inner_zn.b2=x.zpp_inner:t.push(lt.todo(this.b2.id,function(n){s.zpp_inner_zn.b2=n.zpp_inner}))}if(null!=n&&null!=this.b3){for(var z=null,c=0;c<n.length;){var v=n[c];if(++c,v.id==this.b3.id){z=v.bc;break}}null!=z?s.zpp_inner_zn.b3=z.zpp_inner:t.push(lt.todo(this.b3.id,function(n){s.zpp_inner_zn.b3=n.zpp_inner}))}if(null!=n&&null!=this.b4){for(var m=null,f=0;f<n.length;){var b=n[f];if(++f,b.id==this.b4.id){m=b.bc;break}}null!=m?s.zpp_inner_zn.b4=m.zpp_inner:t.push(lt.todo(this.b4.id,function(n){s.zpp_inner_zn.b4=n.zpp_inner}))}return s},xt.prototype.validate=function(){if(null==this.b1||null==this.b2||null==this.b3||null==this.b4)throw new p("Error: PulleyJoint cannot be simulated with null bodies");if(this.b1==this.b2||this.b3==this.b4)throw new p("Error: PulleyJoint cannot have body1==body2 or body3==body4");if(this.b1.space!=this.space||this.b2.space!=this.space||this.b3.space!=this.space||this.b4.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new p("Error: PulleyJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: PulleyJoint cannot have both bodies in a linked pair non-dynamic");if(2!=this.b3.type&&2!=this.b4.type)throw new p("Error: PulleyJoint cannot have both bodies in a linked pair non-dynamic")},xt.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake(),null!=this.b3&&2==this.b3.type&&this.b3.wake(),null!=this.b4&&2==this.b4.type&&this.b4.wake()},xt.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}if(2==this.b3.type){var f,b;if(this.b3.component==this.b3.component.parent)f=this.b3.component;else{for(var g=this.b3.component,w=null;g!=g.parent;){var M=g.parent;g.parent=w,w=g,g=M}for(;null!=w;){var C=w.parent;w.parent=g,w=C}f=g}if(this.component==this.component.parent)b=this.component;else{for(var k=this.component,O=null;k!=k.parent;){var P=k.parent;k.parent=O,O=k,k=P}for(;null!=O;){var S=O.parent;O.parent=k,O=S}b=k}f!=b&&(f.rank<b.rank?f.parent=b:f.rank>b.rank?b.parent=f:(b.parent=f).rank++)}if(2==this.b4.type){var A,j;if(this.b4.component==this.b4.component.parent)A=this.b4.component;else{for(var E=this.b4.component,I=null;E!=E.parent;){var T=E.parent;E.parent=I,I=E,E=T}for(;null!=I;){var N=I.parent;I.parent=E,I=N}A=E}if(this.component==this.component.parent)j=this.component;else{for(var L=this.component,V=null;L!=L.parent;){var D=L.parent;L.parent=V,V=L,L=D}for(;null!=V;){var F=V.parent;V.parent=L,V=F}j=L}A!=j&&(A.rank<j.rank?A.parent=j:A.rank>j.rank?j.parent=A:(j.parent=A).rank++)}},xt.prototype.pair_exists=function(n,t){return this.b1.id==n&&(this.b2.id==t||this.b3.id==t||this.b4.id==t)||this.b2.id==n&&(this.b3.id==t||this.b4.id==t||this.b1.id==t)||this.b3.id==n&&(this.b4.id==t||this.b1.id==t||this.b2.id==t)||this.b4.id==n&&(this.b1.id==t||this.b2.id==t||this.b3.id==t)},xt.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},xt.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var e,i,p,l,r=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),o=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),a=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),s=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely),_=Math.sqrt(r*r+o*o),h=Math.sqrt(a*a+s*s);0!=_&&(e=1/_,this.n12x=r*e,this.n12y=o*e),0!=h?(i=1/h,this.n34x=a*i,this.n34y=s*i,p=this.ratio,this.n34x*=p,this.n34y*=p):(l=this.ratio/Math.sqrt(this.n34x*this.n34x+this.n34y*this.n34y),this.n34x*=l,this.n34y*=l);var u=_+this.ratio*h;this.equal?(u-=this.jointMax,this.slack=!1):u<this.jointMin?(u=this.jointMin-u,this.n12x=-this.n12x,this.n12y=-this.n12y,this.n34x=-this.n34x,this.n34y=-this.n34y,this.slack=!1):u>this.jointMax?(u-=this.jointMax,this.slack=!1):(this.n12x=0,this.n12y=0,this.n34x=0,u=this.n34y=0,this.slack=!0);var x=u;if(!this.slack){this.cx1=this.n12y*this.a1relx-this.n12x*this.a1rely,this.cx2=this.n12y*this.a2relx-this.n12x*this.a2rely,this.cx3=this.n34y*this.a3relx-this.n34x*this.a3rely,this.cx4=this.n34y*this.a4relx-this.n34x*this.a4rely;var d=this.b1.smass+this.b2.smass+this.ratio*this.ratio*(this.b3.smass+this.b4.smass)+this.b1.sinertia*this.cx1*this.cx1+this.b2.sinertia*this.cx2*this.cx2+this.b3.sinertia*this.cx3*this.cx3+this.b4.sinertia*this.cx4*this.cx4;if(this.b1==this.b4&&(d-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx4*this.b1.sinertia)),this.b1==this.b3&&(d+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx3*this.b1.sinertia)),this.b2==this.b3&&(d-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx3*this.b2.sinertia)),this.b2==this.b4&&(d+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx4*this.b2.sinertia)),this.kMass=d,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&x*x>this.maxError*this.maxError)return!0;var y=2*Math.PI*this.frequency;this.gamma=1/(n*y*(2*this.damping+y*n));var z=1/(1+this.gamma),c=n*y*y*this.gamma;this.gamma*=z,this.kMass*=z,this.bias=-x*c,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=t,this.jMax=this.maxForce*n}return!1},xt.prototype.warmStart=function(){var n,t,e,i;this.slack||(n=this.b1.imass*this.jAcc,this.b1.velx-=this.n12x*n,this.b1.vely-=this.n12y*n,t=this.b2.imass*this.jAcc,this.b2.velx+=this.n12x*t,this.b2.vely+=this.n12y*t,e=this.b3.imass*this.jAcc,this.b3.velx-=this.n34x*e,this.b3.vely-=this.n34y*e,i=this.b4.imass*this.jAcc,this.b4.velx+=this.n34x*i,this.b4.vely+=this.n34y*i,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc,this.b3.angvel-=this.cx3*this.b3.iinertia*this.jAcc,this.b4.angvel+=this.cx4*this.b4.iinertia*this.jAcc)},xt.prototype.applyImpulseVel=function(){if(this.slack)return!1;var n=this.kMass*(this.bias-(this.n12x*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.n12y*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+this.n34x*(this.b4.velx+this.b4.kinvelx-this.b3.velx-this.b3.kinvelx)+this.n34y*(this.b4.vely+this.b4.kinvely-this.b3.vely-this.b3.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1+(this.b4.angvel+this.b4.kinangvel)*this.cx4-(this.b3.angvel+this.b3.kinangvel)*this.cx3))-this.jAcc*this.gamma,t=this.jAcc;if(this.jAcc+=n,!this.equal&&0<this.jAcc&&(this.jAcc=0),this.breakUnderForce&&this.jAcc<-this.jMax)return!0;this.stiff||this.jAcc<-this.jMax&&(this.jAcc=-this.jMax),n=this.jAcc-t;var e=this.b1.imass*n;this.b1.velx-=this.n12x*e,this.b1.vely-=this.n12y*e;var i=this.b2.imass*n;this.b2.velx+=this.n12x*i,this.b2.vely+=this.n12y*i;var p=this.b3.imass*n;this.b3.velx-=this.n34x*p,this.b3.vely-=this.n34y*p;var l=this.b4.imass*n;return this.b4.velx+=this.n34x*l,this.b4.vely+=this.n34y*l,this.b1.angvel-=this.cx1*this.b1.iinertia*n,this.b2.angvel+=this.cx2*this.b2.iinertia*n,this.b3.angvel-=this.cx3*this.b3.iinertia*n,this.b4.angvel+=this.cx4*this.b4.iinertia*n,!1},xt.prototype.applyImpulsePos=function(){var n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,t=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,e=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,p=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,l=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,r=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,o=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy,a=0,s=0,_=0,h=0;a=this.n12x,s=this.n12y,_=this.n34x,h=this.n34y;var u,x,d,y,z=this.b2.posx+e-(this.b1.posx+n),c=this.b2.posy+i-(this.b1.posy+t),v=this.b4.posx+r-(this.b3.posx+p),m=this.b4.posy+o-(this.b3.posy+l),f=Math.sqrt(z*z+c*c),b=Math.sqrt(v*v+m*m);0!=f&&(a=z*(u=1/f),s=c*u),0!=b?(_=v*(x=1/b),h=m*x,_*=d=this.ratio,h*=d):(_*=y=this.ratio/Math.sqrt(_*_+h*h),h*=y);var g,w,M,C,k,O,P,S,A,j,E,I,T,N,L,V,D,F,R,Z,B,G=f+this.ratio*b,q=this.equal?(G-=this.jointMax,!1):G<this.jointMin?(G=this.jointMin-G,a=-a,s=-s,_=-_,h=-h,!1):G>this.jointMax?(G-=this.jointMax,!1):!(G=h=_=s=a=0),U=G;if(!q){if(this.breakUnderError&&U*U>this.maxError*this.maxError)return!0;if(U*U<co.constraintLinearSlop*co.constraintLinearSlop)return!1;6<(U*=.5)*U&&((V=this.b1.smass+this.b2.smass)>co.epsilon&&(D=-U*(V=.75/V),(this.equal||D<0)&&(g=D*this.b1.imass,this.b1.posx-=a*g,this.b1.posy-=s*g,w=D*this.b2.imass,this.b2.posx+=a*w,this.b2.posy+=s*w,M=D*this.b3.imass,this.b3.posx-=_*M,this.b3.posy-=h*M,C=D*this.b4.imass,this.b4.posx+=_*C,this.b4.posy+=h*C,S=P=O=k=0,k=this.b2.posx+e-(this.b1.posx+n),O=this.b2.posy+i-(this.b1.posy+t),P=this.b4.posx+r-(this.b3.posx+p),S=this.b4.posy+o-(this.b3.posy+l),0!=(A=Math.sqrt(k*k+O*O))&&(a=k*(E=1/A),s=O*E),0!=(j=Math.sqrt(P*P+S*S))?(_=P*(I=1/j),h=S*I,_*=T=this.ratio,h*=T):(_*=N=this.ratio/Math.sqrt(_*_+h*h),h*=N),L=A+this.ratio*j,this.equal?L-=this.jointMax:L<this.jointMin?(L=this.jointMin-L,a=-a,s=-s,_=-_,h=-h):L>this.jointMax?L-=this.jointMax:L=h=_=s=a=0,U=L,U*=.5))),F=s*n-a*t,R=s*e-a*i,Z=h*p-_*l,B=h*r-_*o;var K=this.b1.smass+this.b2.smass+this.ratio*this.ratio*(this.b3.smass+this.b4.smass)+this.b1.sinertia*F*F+this.b2.sinertia*R*R+this.b3.sinertia*Z*Z+this.b4.sinertia*B*B;this.b1==this.b4&&(K-=2*((a*_+s*h)*this.b1.smass+F*B*this.b1.sinertia)),this.b1==this.b3&&(K+=2*((a*_+s*h)*this.b1.smass+F*Z*this.b1.sinertia)),this.b2==this.b3&&(K-=2*((a*_+s*h)*this.b2.smass+R*Z*this.b2.sinertia)),this.b2==this.b4&&(K+=2*((a*_+s*h)*this.b2.smass+R*B*this.b2.sinertia));var W,Y,J,X,H,$,Q,nn,tn,en,pn,ln,rn,on,an,sn,_n,hn,un,xn,dn,yn,zn,cn,vn,mn,fn,bn,gn=K;0!=gn&&(gn=1/gn),D=-U*gn,(this.equal||D<0)&&(W=this.b1.imass*D,this.b1.posx-=a*W,this.b1.posy-=s*W,Y=this.b2.imass*D,this.b2.posx+=a*Y,this.b2.posy+=s*Y,J=this.b3.imass*D,this.b3.posx-=_*J,this.b3.posy-=h*J,X=this.b4.imass*D,this.b4.posx+=_*X,this.b4.posy+=h*X,H=this.b1,$=-F*this.b1.iinertia*D,H.rot+=$,1e-4<$*$?(H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)):(tn=1-(Q=$*$)*Q/8,en=((nn=1-.5*Q)*H.axisx+$*H.axisy)*tn,H.axisy=(nn*H.axisy-$*H.axisx)*tn,H.axisx=en),pn=this.b2,ln=R*this.b2.iinertia*D,pn.rot+=ln,1e-4<ln*ln?(pn.axisx=Math.sin(pn.rot),pn.axisy=Math.cos(pn.rot)):(an=1-(rn=ln*ln)*rn/8,sn=((on=1-.5*rn)*pn.axisx+ln*pn.axisy)*an,pn.axisy=(on*pn.axisy-ln*pn.axisx)*an,pn.axisx=sn),_n=this.b3,hn=-Z*this.b3.iinertia*D,_n.rot+=hn,1e-4<hn*hn?(_n.axisx=Math.sin(_n.rot),_n.axisy=Math.cos(_n.rot)):(dn=1-(un=hn*hn)*un/8,yn=((xn=1-.5*un)*_n.axisx+hn*_n.axisy)*dn,_n.axisy=(xn*_n.axisy-hn*_n.axisx)*dn,_n.axisx=yn),zn=this.b4,cn=B*this.b4.iinertia*D,zn.rot+=cn,1e-4<cn*cn?(zn.axisx=Math.sin(zn.rot),zn.axisy=Math.cos(zn.rot)):(fn=1-(vn=cn*cn)*vn/8,bn=((mn=1-.5*vn)*zn.axisx+cn*zn.axisy)*fn,zn.axisy=(mn*zn.axisy-cn*zn.axisx)*fn,zn.axisx=bn))}return!1},xt.prototype.draw=function(n){},xt.prototype.__class__=xt;var dt=zpp_nape.constraint.ZPP_UserConstraint=function(n,t){this.jOld=null,this.J=null,this.vec3=null,this.Keff=null,this.jMax=0,this.velonly=!1,this.gamma=0,this.soft=0,this.y=null,this.L=null,this.stepped=!1,this.bias=null,this.jAcc=null,this.dim=0,this.bodies=null,this.outer_zn=null,Bn.call(this),this.bodies=[],this.dim=n,this.velonly=t,this.jAcc=[],this.bias=[],this.L=[],this.J=[],this.jOld=[],this.y=[],this.Keff=[],this.vec3=X.get(0,0,0);for(var e=0;e<n;){var i=e++;this.J[i]=this.jOld[i]=this.y[i]=0,this.bias[i]=0;for(var p=this.jAcc[i]=0;p<n;)this.L[i*n+p++]=0}this.stepped=!1};dt.__name__=["zpp_nape","constraint","ZPP_UserConstraint"],dt.__super__=Bn,dt.prototype=Object.create(Bn.prototype),dt.prototype.outer_zn=null,dt.prototype.bindVec2_invalidate=function(n){this.outer_zn.__invalidate()},dt.prototype.bodies=null,dt.prototype.dim=null,dt.prototype.jAcc=null,dt.prototype.bias=null,dt.prototype.addBody=function(n){for(var t=null,e=0,i=this.bodies;e<i.length;){var p=i[e];if(++e,p.body==n){t=p;break}}null==t?(this.bodies.push(new yt(1,n)),this.active&&null!=this.space&&null!=n&&n.constraints.add(this)):t.cnt++},dt.prototype.remBody=function(n){for(var t=null,e=0|this.bodies.length,i=0;i<e;){var p=this.bodies[i];if(p.body==n){p.cnt--,0==p.cnt&&(0<e&&(this.bodies[i]=this.bodies[e-1]),this.bodies.pop(),this.active&&null!=this.space&&null!=n&&n.constraints.remove(this)),t=p;break}++i}return null!=t},dt.prototype.bodyImpulse=function(n){for(var t=0,e=this.dim;t<e;){var i=t++;this.J[i]=this.jAcc[i]}var p=X.get(0,0,0);return this.stepped&&this.outer_zn.__impulse(this.J,n.outer,p),p},dt.prototype.activeBodies=function(){for(var n=0,t=this.bodies;n<t.length;){var e=t[n];++n,null!=e.body&&e.body.constraints.add(this)}},dt.prototype.inactiveBodies=function(){for(var n=0,t=this.bodies;n<t.length;){var e=t[n];++n,null!=e.body&&e.body.constraints.remove(this)}},dt.prototype.stepped=null,dt.prototype.copy=function(n,t){throw this.copyto(this.outer_zn.__copy()),new p("not done yet")},dt.prototype.validate=function(){for(var n=0,t=this.bodies;n<t.length;){var e=t[n];if(++n,e.body.space!=this.space)throw new p("Error: Constraints must have each body within the same sapce to which the constraint has been assigned")}this.outer_zn.__validate()},dt.prototype.wake_connected=function(){for(var n=0,t=this.bodies;n<t.length;){var e=t[n];++n,2==e.body.type&&e.body.wake()}},dt.prototype.forest=function(){for(var n=0,t=this.bodies;n<t.length;){var e,i,p=t[n];if(++n,2==p.body.type){if(p.body.component==p.body.component.parent)e=p.body.component;else{for(var l=p.body.component,r=null;l!=l.parent;){var o=l.parent;l.parent=r,r=l,l=o}for(;null!=r;){var a=r.parent;r.parent=l,r=a}e=l}if(this.component==this.component.parent)i=this.component;else{for(var s=this.component,_=null;s!=s.parent;){var h=s.parent;s.parent=_,_=s,s=h}for(;null!=_;){var u=_.parent;_.parent=s,_=u}i=s}e!=i&&(e.rank<i.rank?e.parent=i:e.rank>i.rank?i.parent=e:(i.parent=e).rank++)}}},dt.prototype.pair_exists=function(n,t){for(var e=!1,i=0|this.bodies.length,p=0;p<i;){for(var l=p++,r=this.bodies[l].body,o=1+l;o<i;){var a=this.bodies[o++].body;if(r.id==n&&a.id==t||r.id==t&&a.id==n){e=!0;break}}if(e)break}return e},dt.prototype.broken=function(){this.outer_zn.__broken()},dt.prototype.clearcache=function(){for(var n=0,t=this.dim;n<t;)this.jAcc[n++]=0;this.pre_dt=-1},dt.prototype.lsq=function(n){for(var t=0,e=0,i=this.dim;e<i;){var p=e++;t+=n[p]*n[p]}return t},dt.prototype._clamp=function(n,t){var e=this.lsq(n);if(t*t<e)for(var i=t/Math.sqrt(e),p=0,l=this.dim;p<l;)n[p++]*=i},dt.prototype.L=null,dt.prototype.solve=function(n){for(var t=0,e=0,i=this.dim;e<i;){for(var p=e++,l=0,r=0,o=p-1;r<o;){var a=r++;l+=this.L[p*this.dim+a]*this.L[p*this.dim+a]}var s=Math.sqrt(n[t++]-l);if(0!=(this.L[p*this.dim+p]=s)){s=1/s;for(var _=1+p,h=this.dim;_<h;){for(var u=_++,x=0,d=0,y=p-1;d<y;){var z=d++;x+=this.L[u*this.dim+z]*this.L[p*this.dim+z]}this.L[u*this.dim+p]=s*(n[t++]-x)}}else{for(var c=1+p,v=this.dim;c<v;)this.L[c++*this.dim+p]=0;t+=this.dim-p-1}}return this.L},dt.prototype.y=null,dt.prototype.transform=function(n,t){for(var e=0,i=this.dim;e<i;){var p=e++,l=t[p],r=n[p*this.dim+p];if(0!=r){for(var o=0;o<p;){var a=o++;l-=n[p*this.dim+a]*this.y[a]}this.y[p]=l/r}else this.y[p]=0}for(var s=0,_=this.dim;s<_;){var h=this.dim-1-s++,u=n[h*this.dim+h];if(0!=u){for(var x=this.y[h],d=1+h,y=this.dim;d<y;){var z=d++;x-=n[z*this.dim+h]*t[z]}t[h]=x/u}else t[h]=0}},dt.prototype.soft=null,dt.prototype.gamma=null,dt.prototype.velonly=null,dt.prototype.jMax=null,dt.prototype.Keff=null,dt.prototype.preStep=function(n){this.outer_zn.__validate(),-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;if(this.pre_dt=n,this.stepped=!0,this.outer_zn.__prepare(),this.outer_zn.__eff_mass(this.Keff),this.L=this.solve(this.Keff),this.stiff||this.velonly){for(var e=0,i=this.dim;e<i;)this.bias[e++]=0;this.gamma=0,this.soft=1}else{var p=2*Math.PI*this.frequency;this.gamma=1/(n*p*(2*this.damping+p*n));var l=1/(1+this.gamma),r=n*p*p*this.gamma;if(this.gamma*=l,this.soft=l,this.outer_zn.__position(this.bias),this.breakUnderError&&this.lsq(this.bias)>this.maxError*this.maxError)return!0;for(var o=0,a=this.dim;o<a;)this.bias[o++]*=-r;this._clamp(this.bias,this.maxError)}for(var s=0,_=this.dim;s<_;)this.jAcc[s++]*=t;return this.jMax=this.maxForce*n,!1},dt.prototype.vec3=null,dt.prototype.warmStart=function(){for(var n=0,t=this.bodies;n<t.length;){var e=t[n];++n;var i=e.body;this.outer_zn.__impulse(this.jAcc,i.outer,this.vec3);var p=i.imass,l=this.vec3,r=l.zpp_inner;null!=r._validate&&r._validate(),i.velx+=l.zpp_inner.x*p;var o=this.vec3,a=o.zpp_inner;null!=a._validate&&a._validate(),i.vely+=o.zpp_inner.y*p;var s=this.vec3,_=s.zpp_inner;null!=_._validate&&_._validate(),i.angvel+=s.zpp_inner.z*i.iinertia}},dt.prototype.J=null,dt.prototype.jOld=null,dt.prototype.applyImpulseVel=function(){this.outer_zn.__velocity(this.J);for(var n=0,t=this.dim;n<t;){var e=n++;this.J[e]=this.bias[e]-this.J[e]}this.transform(this.L,this.J);for(var i=0,p=this.dim;i<p;){var l=i++;this.jOld[l]=this.jAcc[l],this.jAcc[l]+=this.J[l]=this.J[l]*this.soft-this.jAcc[l]*this.gamma}if(this.outer_zn.__clamp(this.jAcc),(this.breakUnderForce||!this.stiff)&&this.lsq(this.jAcc)>this.jMax*this.jMax){if(this.breakUnderForce)return!0;this.stiff||this._clamp(this.jAcc,this.jMax)}for(var r=0,o=this.dim;r<o;){var a=r++;this.J[a]=this.jAcc[a]-this.jOld[a]}for(var s=0,_=this.bodies;s<_.length;){var h=_[s];++s;var u=h.body;this.outer_zn.__impulse(this.J,u.outer,this.vec3);var x=u.imass,d=this.vec3,y=d.zpp_inner;null!=y._validate&&y._validate(),u.velx+=d.zpp_inner.x*x;var z=this.vec3,c=z.zpp_inner;null!=c._validate&&c._validate(),u.vely+=z.zpp_inner.y*x;var v=this.vec3,m=v.zpp_inner;null!=m._validate&&m._validate(),u.angvel+=v.zpp_inner.z*u.iinertia}return!1},dt.prototype.applyImpulsePos=function(){if(this.velonly)return!1;this.outer_zn.__prepare(),this.outer_zn.__position(this.J);var n=this.lsq(this.J);if(this.breakUnderError&&n>this.maxError*this.maxError)return!0;if(n<co.constraintLinearSlop*co.constraintLinearSlop)return!1;for(var t=0,e=this.dim;t<e;)this.J[t++]*=-1;this.outer_zn.__eff_mass(this.Keff),this.transform(this.solve(this.Keff),this.J),this.outer_zn.__clamp(this.J);for(var i=0,p=this.bodies;i<p.length;){var l=p[i];++i;var r=l.body;this.outer_zn.__impulse(this.J,r.outer,this.vec3);var o=r.imass,a=this.vec3,s=a.zpp_inner;null!=s._validate&&s._validate(),r.posx+=a.zpp_inner.x*o;var _=this.vec3,h=_.zpp_inner;null!=h._validate&&h._validate(),r.posy+=_.zpp_inner.y*o;var u=this.vec3,x=u.zpp_inner;null!=x._validate&&x._validate();var d,y,z,c,v=u.zpp_inner.z*r.iinertia;r.rot+=v,1e-4<v*v?(r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot)):(z=1-(d=v*v)*d/8,c=((y=1-.5*d)*r.axisx+v*r.axisy)*z,r.axisy=(y*r.axisy-v*r.axisx)*z,r.axisx=c)}return!1},dt.prototype.draw=function(n){this.outer_zn.__draw(n)},dt.prototype.__class__=dt;var yt=zpp_nape.constraint.ZPP_UserBody=function(n,t){this.body=null,this.cnt=0,this.cnt=n,this.body=t};yt.__name__=["zpp_nape","constraint","ZPP_UserBody"],yt.prototype.cnt=null,yt.prototype.body=null,yt.prototype.__class__=yt;var zt=zpp_nape.constraint.ZPP_WeldJoint=function(){this.stepped=!1,this.biasz=0,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccz=0,this.jAccy=0,this.jAccx=0,this.kMassf=0,this.kMasse=0,this.kMassc=0,this.kMassd=0,this.kMassb=0,this.kMassa=0,this.phase=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,Bn.call(this),this.phase=0,this.jAccx=0,this.jAccy=0,this.jAccz=0,this.jMax=1/0,this.stepped=!1,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};zt.__name__=["zpp_nape","constraint","ZPP_WeldJoint"],zt.__super__=Bn,zt.prototype=Object.create(Bn.prototype),zt.prototype.outer_zn=null,zt.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?X.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)):X.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz):X.get(0,0,0)},zt.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},zt.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},zt.prototype.b1=null,zt.prototype.a1localx=null,zt.prototype.a1localy=null,zt.prototype.a1relx=null,zt.prototype.a1rely=null,zt.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},zt.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},zt.prototype.setup_a1=function(){var n,t,e,i,p,l=this.a1localx,r=this.a1localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=Q(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=Q(this,this.invalidate_a1)},zt.prototype.wrap_a1=null,zt.prototype.b2=null,zt.prototype.a2localx=null,zt.prototype.a2localy=null,zt.prototype.a2relx=null,zt.prototype.a2rely=null,zt.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},zt.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},zt.prototype.setup_a2=function(){var n,t,e,i,p,l=this.a2localx,r=this.a2localy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=Q(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=Q(this,this.invalidate_a2)},zt.prototype.wrap_a2=null,zt.prototype.phase=null,zt.prototype.kMassa=null,zt.prototype.kMassb=null,zt.prototype.kMassd=null,zt.prototype.kMassc=null,zt.prototype.kMasse=null,zt.prototype.kMassf=null,zt.prototype.jAccx=null,zt.prototype.jAccy=null,zt.prototype.jAccz=null,zt.prototype.jMax=null,zt.prototype.gamma=null,zt.prototype.biasx=null,zt.prototype.biasy=null,zt.prototype.biasz=null,zt.prototype.stepped=null,zt.prototype.copy=function(n,t){var e=this.outer_zn;null==e.zpp_inner_zn.wrap_a1&&e.zpp_inner_zn.setup_a1();var i=e.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=new A(null,null,i,p.zpp_inner_zn.wrap_a2);if(this.copyto(l),null!=n&&null!=this.b1){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b1.id){r=a.bc;break}}null!=r?l.zpp_inner_zn.b1=r.zpp_inner:t.push(lt.todo(this.b1.id,function(n){l.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var s=null,_=0;_<n.length;){var h=n[_];if(++_,h.id==this.b2.id){s=h.bc;break}}null!=s?l.zpp_inner_zn.b2=s.zpp_inner:t.push(lt.todo(this.b2.id,function(n){l.zpp_inner_zn.b2=n.zpp_inner}))}return l},zt.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: WeldJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic")},zt.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},zt.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},zt.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},zt.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.jAccz=0,this.pre_dt=-1},zt.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var e,i,p,l,r=this.b1.smass+this.b2.smass;this.kMassa=r,this.kMassb=0,this.kMassd=r,this.kMassc=0,this.kMasse=0,(this.kMassf=0)!=this.b1.sinertia&&(e=this.a1relx*this.b1.sinertia,i=this.a1rely*this.b1.sinertia,this.kMassa+=i*this.a1rely,this.kMassb+=-i*this.a1relx,this.kMassd+=e*this.a1relx,this.kMassc+=-i,this.kMasse+=e,this.kMassf+=this.b1.sinertia),0!=this.b2.sinertia&&(p=this.a2relx*this.b2.sinertia,l=this.a2rely*this.b2.sinertia,this.kMassa+=l*this.a2rely,this.kMassb+=-l*this.a2relx,this.kMassd+=p*this.a2relx,this.kMassc+=-l,this.kMasse+=p,this.kMassf+=this.b2.sinertia);var o,a,s,_,h,u,x,d,y=this.kMassa*(this.kMassd*this.kMassf-this.kMasse*this.kMasse)+this.kMassb*(this.kMassc*this.kMasse-this.kMassb*this.kMassf)+this.kMassc*(this.kMassb*this.kMasse-this.kMassc*this.kMassd);if(0!=(1&(d=y!=y?(this.kMassa=0,this.kMassb=0,this.kMassd=0,this.kMassc=0,this.kMasse=0,this.kMassf=0,7):0==y?((o=0)!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,o=1),0!=this.kMassd?this.kMassd=1/this.kMassd:(this.kMassd=0,o|=2),0!=this.kMassf?this.kMassf=1/this.kMassf:(this.kMassf=0,o|=4),this.kMassb=this.kMassc=this.kMasse=0,o):(a=(y=1/y)*(this.kMassd*this.kMassf-this.kMasse*this.kMasse),s=y*(this.kMasse*this.kMassc-this.kMassb*this.kMassf),_=y*(this.kMassa*this.kMassf-this.kMassc*this.kMassc),h=y*(this.kMassb*this.kMasse-this.kMassc*this.kMassd),u=y*(this.kMassb*this.kMassc-this.kMassa*this.kMasse),x=this.kMassa*this.kMassd-this.kMassb*this.kMassb,this.kMassa=a,this.kMassb=s,this.kMassd=_,this.kMassc=h,this.kMasse=u,this.kMassf=y*x,0)))&&(this.jAccx=0),0!=(2&d)&&(this.jAccy=0),0!=(4&d)&&(this.jAccz=0),this.stiff)this.biasx=0,this.biasy=0,this.biasz=0,this.gamma=0;else{var z=2*Math.PI*this.frequency;this.gamma=1/(n*z*(2*this.damping+z*n));var c=1/(1+this.gamma),v=n*z*z*this.gamma;if(this.gamma*=c,this.kMassa*=c,this.kMassb*=c,this.kMassd*=c,this.kMassc*=c,this.kMasse*=c,this.kMassf*=c,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.biasz=this.b2.rot-this.b1.rot-this.phase,this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz>this.maxError*this.maxError)return!0;var m=-v;this.biasx*=m,this.biasy*=m,this.biasz*=m;var f,b=this.maxError,g=this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz;b*b<g&&(f=b*(1/Math.sqrt(g)),this.biasx*=f,this.biasy*=f,this.biasz*=f)}return this.jAccx*=t,this.jAccy*=t,this.jAccz*=t,this.jMax=this.maxForce*n,!1},zt.prototype.warmStart=function(){var n=this.b1.imass;this.b1.velx-=this.jAccx*n,this.b1.vely-=this.jAccy*n;var t=this.b2.imass;this.b2.velx+=this.jAccx*t,this.b2.vely+=this.jAccy*t,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz)*this.b2.iinertia},zt.prototype.applyImpulseVel=function(){var n=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),t=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),e=this.b2.angvel+this.b2.kinangvel-this.b1.angvel-this.b1.kinangvel,i=this.biasx-n,p=this.biasy-t,l=this.biasz-e,r=this.kMassa*i+this.kMassb*p+this.kMassc*l,o=this.kMassb*i+this.kMassd*p+this.kMasse*l;l=this.kMassc*i+this.kMasse*p+this.kMassf*l,i=r,p=o;var a=this.gamma;i-=this.jAccx*a,p-=this.jAccy*a,l-=this.jAccz*a;var s,_,h,u=this.jAccx,x=this.jAccy,d=this.jAccz;if(this.jAccx+=i,this.jAccy+=p,this.jAccz+=l,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz>this.jMax*this.jMax)return!0}else this.stiff||(s=this.jMax)*s<(_=this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz)&&(h=s*(1/Math.sqrt(_)),this.jAccx*=h,this.jAccy*=h,this.jAccz*=h);i=this.jAccx-u,p=this.jAccy-x,l=this.jAccz-d;var y=this.b1.imass;this.b1.velx-=i*y,this.b1.vely-=p*y;var z=this.b2.imass;return this.b2.velx+=i*z,this.b2.vely+=p*z,this.b1.angvel-=(p*this.a1relx-i*this.a1rely+l)*this.b1.iinertia,this.b2.angvel+=(p*this.a2relx-i*this.a2rely+l)*this.b2.iinertia,!1},zt.prototype.applyImpulsePos=function(){var n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,t=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,e=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,p=0,l=0,r=0,p=this.b2.posx+e-(this.b1.posx+n),l=this.b2.posy+i-(this.b1.posy+t),r=this.b2.rot-this.b1.rot-this.phase,o=0,a=0,s=0;if(this.breakUnderError&&p*p+l*l+r*r>this.maxError*this.maxError)return!0;var _=!0;p*p+l*l<co.constraintLinearSlop*co.constraintLinearSlop&&(_=!1,l=p=0);var h,u,x,d,y,z=r*r,c=co.constraintAngularSlop;if(z<c*c){if(!_)return!1;r=0}r*=.5,6<(p*=.5)*p+(l*=.5)*l&&((h=this.b1.smass+this.b2.smass)>co.epsilon&&(400<(u=(o=-p*(h=.75/h))*o+(a=-l*h)*a)&&(o*=x=1/Math.sqrt(u)*20,a*=x),d=this.b1.imass,this.b1.posx-=o*d,this.b1.posy-=a*d,y=this.b2.imass,this.b2.posx+=o*y,this.b2.posy+=a*y,p=this.b2.posx+e-(this.b1.posx+n),l=this.b2.posy+i-(this.b1.posy+t),r=this.b2.rot-this.b1.rot-this.phase,p*=.5,l*=.5,r*=.5));var v,m,f,b,g=0,w=0,M=0,C=0,k=0,O=0,P=this.b1.smass+this.b2.smass,M=g=P;(O=k=C=w=0)!=this.b1.sinertia&&(v=n*this.b1.sinertia,g=P+(m=t*this.b1.sinertia)*t,w+=-m*n,M=P+v*n,C+=-m,k+=v,O+=this.b1.sinertia),0!=this.b2.sinertia&&(f=e*this.b2.sinertia,g+=(b=i*this.b2.sinertia)*i,w+=-b*e,M+=f*e,C+=-b,k+=f,O+=this.b2.sinertia),s=-r;var S,A=(o=-p)*o+(a=-l)*a;36<A&&(o*=S=1/Math.sqrt(A)*6,a*=S);var j,E,I,T,N,L=g*(M*O-k*k)+w*(C*k-w*O)+C*(w*k-C*M);L!=L?o=a=s=0:0==L?(0!=g?o/=g:o=0,0!=M?a/=M:a=0,0!=O?s/=O:s=0):(T=(L=1/L)*(o*(M*O-k*k)+a*(j=k*C-w*O)+s*(E=w*k-C*M)),N=L*(o*j+a*(g*O-C*C)+s*(I=w*C-g*k)),s=L*(o*E+a*I+s*(g*M-w*w)),o=T,a=N);var V=this.b1.imass;this.b1.posx-=o*V,this.b1.posy-=a*V;var D=this.b2.imass;this.b2.posx+=o*D,this.b2.posy+=a*D;var F,R,Z,B,G=this.b1,q=-(a*n-o*t+s)*this.b1.iinertia;G.rot+=q,1e-4<q*q?(G.axisx=Math.sin(G.rot),G.axisy=Math.cos(G.rot)):(Z=1-(F=q*q)*F/8,B=((R=1-.5*F)*G.axisx+q*G.axisy)*Z,G.axisy=(R*G.axisy-q*G.axisx)*Z,G.axisx=B);var U,K,W,Y,J=this.b2,X=(a*e-o*i+s)*this.b2.iinertia;return J.rot+=X,1e-4<X*X?(J.axisx=Math.sin(J.rot),J.axisy=Math.cos(J.rot)):(W=1-(U=X*X)*U/8,Y=((K=1-.5*U)*J.axisx+X*J.axisy)*W,J.axisy=(K*J.axisy-X*J.axisx)*W,J.axisx=Y),!1},zt.prototype.draw=function(n){},zt.prototype.__class__=zt;var ri=zpp_nape.dynamics.ZPP_Arbiter=function(){this.sensorarb=null,this.fluidarb=null,this.colarb=null,this.type=0,this.pair=null,this.ws2=null,this.ws1=null,this.b2=null,this.b1=null,this.invalidated=!1,this.immState=0,this.fresh=!1,this.continuous=!1,this.presentable=!1,this.intchange=!1,this.present=0,this.sleeping=!1,this.cleared=!1,this.active=!1,this.endGenerated=0,this.sleep_stamp=0,this.up_stamp=0,this.stamp=0,this.di=0,this.id=0,this.hnext=null,this.outer=null};ri.__name__=["zpp_nape","dynamics","ZPP_Arbiter"],ri.prototype.outer=null,ri.prototype.wrapper=function(){return null==this.outer&&(ri.internal=!0,this.type==ri.COL?(this.colarb.outer_zn=new T,this.outer=this.colarb.outer_zn):this.type==ri.FLUID?(this.fluidarb.outer_zn=new V,this.outer=this.fluidarb.outer_zn):this.outer=new j,this.outer.zpp_inner=this,ri.internal=!1),this.outer},ri.prototype.inactiveme=function(){return!this.active},ri.prototype.hnext=null,ri.prototype.id=null,ri.prototype.di=null,ri.prototype.stamp=null,ri.prototype.up_stamp=null,ri.prototype.sleep_stamp=null,ri.prototype.endGenerated=null,ri.prototype.active=null,ri.prototype.cleared=null,ri.prototype.sleeping=null,ri.prototype.present=null,ri.prototype.intchange=null,ri.prototype.presentable=null,ri.prototype.continuous=null,ri.prototype.fresh=null,ri.prototype.immState=null,ri.prototype.acting=function(){return!!this.active&&0!=(1&this.immState)},ri.prototype.invalidated=null,ri.prototype.b1=null,ri.prototype.b2=null,ri.prototype.ws1=null,ri.prototype.ws2=null,ri.prototype.pair=null,ri.prototype.swap_features=function(){var n=this.b1;this.b1=this.b2,this.b2=n;var t=this.ws1;this.ws1=this.ws2,this.ws2=t;var e=this.colarb.s1;this.colarb.s1=this.colarb.s2,this.colarb.s2=e},ri.prototype.type=null,ri.prototype.colarb=null,ri.prototype.fluidarb=null,ri.prototype.sensorarb=null,ri.prototype.lazyRetire=function(n,t){if(this.cleared=!0,null==t||this.b2==t)for(var e,i,p=this.b1.arbiters,l=null,r=p.head;null!=r;){if(r.elt==this){null==l?(i=(e=p.head).next,p.head=i,null==p.head&&(p.pushmod=!0)):(i=(e=l.next).next,null==(l.next=i)&&(p.pushmod=!0));var o=e;o.elt=null,o.next=Gl.zpp_pool,Gl.zpp_pool=o,p.modified=!0,p.length--,p.pushmod=!0;break}r=(l=r).next}if(null==t||this.b1==t)for(var a,s,_=this.b2.arbiters,h=null,u=_.head;null!=u;){if(u.elt==this){null==h?(s=(a=_.head).next,_.head=s,null==_.head&&(_.pushmod=!0)):(s=(a=h.next).next,null==(h.next=s)&&(_.pushmod=!0));var x=a;x.elt=null,x.next=Gl.zpp_pool,Gl.zpp_pool=x,_.modified=!0,_.length--,_.pushmod=!0;break}u=(h=u).next}null!=this.pair&&(this.pair.arb=null,this.pair=null),this.active=!1,n.f_arbiters.modified=!0},ri.prototype.sup_assign=function(n,t,e,i){this.b1=n.body,this.ws1=n,this.b2=t.body,this.ws2=t,this.id=e,this.di=i;var p,l=this.b1.arbiters;null==Gl.zpp_pool?p=new Gl:(p=Gl.zpp_pool,Gl.zpp_pool=p.next,p.next=null),p.elt=this;var r=p;r.next=l.head,l.head=r,l.modified=!0,l.length++;var o,a=this.b2.arbiters;null==Gl.zpp_pool?o=new Gl:(o=Gl.zpp_pool,Gl.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},ri.prototype.sup_retire=function(){if(!this.cleared){for(var n,t,e=this.b1.arbiters,i=null,p=e.head;null!=p;){if(p.elt==this){null==i?(t=(n=e.head).next,e.head=t,null==e.head&&(e.pushmod=!0)):(t=(n=i.next).next,null==(i.next=t)&&(e.pushmod=!0));var l=n;l.elt=null,l.next=Gl.zpp_pool,Gl.zpp_pool=l,e.modified=!0,e.length--,e.pushmod=!0;break}p=(i=p).next}for(var r,o,a=this.b2.arbiters,s=null,_=a.head;null!=_;){if(_.elt==this){null==s?(o=(r=a.head).next,a.head=o,null==a.head&&(a.pushmod=!0)):(o=(r=s.next).next,null==(s.next=o)&&(a.pushmod=!0));var h=r;h.elt=null,h.next=Gl.zpp_pool,Gl.zpp_pool=h,a.modified=!0,a.length--,a.pushmod=!0;break}_=(s=_).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1},ri.prototype.__class__=ri;var Vl=zpp_nape.dynamics.ZPP_SensorArbiter=function(){this.next=null,ri.call(this),this.type=ri.SENSOR,this.sensorarb=this};Vl.__name__=["zpp_nape","dynamics","ZPP_SensorArbiter"],Vl.__super__=ri,Vl.prototype=Object.create(ri.prototype),Vl.prototype.next=null,Vl.prototype.alloc=function(){},Vl.prototype.free=function(){},Vl.prototype.assign=function(n,t,e,i){this.b1=n.body,this.ws1=n,this.b2=t.body,this.ws2=t,this.id=e,this.di=i;var p,l=this.b1.arbiters;null==Gl.zpp_pool?p=new Gl:(p=Gl.zpp_pool,Gl.zpp_pool=p.next,p.next=null),p.elt=this;var r=p;r.next=l.head,l.head=r,l.modified=!0,l.length++;var o,a=this.b2.arbiters;null==Gl.zpp_pool?o=new Gl:(o=Gl.zpp_pool,Gl.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},Vl.prototype.retire=function(){if(!this.cleared){for(var n,t,e=this.b1.arbiters,i=null,p=e.head;null!=p;){if(p.elt==this){null==i?(t=(n=e.head).next,e.head=t,null==e.head&&(e.pushmod=!0)):(t=(n=i.next).next,null==(i.next=t)&&(e.pushmod=!0));var l=n;l.elt=null,l.next=Gl.zpp_pool,Gl.zpp_pool=l,e.modified=!0,e.length--,e.pushmod=!0;break}p=(i=p).next}for(var r,o,a=this.b2.arbiters,s=null,_=a.head;null!=_;){if(_.elt==this){null==s?(o=(r=a.head).next,a.head=o,null==a.head&&(a.pushmod=!0)):(o=(r=s.next).next,null==(s.next=o)&&(a.pushmod=!0));var h=r;h.elt=null,h.next=Gl.zpp_pool,Gl.zpp_pool=h,a.modified=!0,a.length--,a.pushmod=!0;break}_=(s=_).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;this.next=Vl.zpp_pool,Vl.zpp_pool=this},Vl.prototype.makemutable=function(){},Vl.prototype.makeimmutable=function(){},Vl.prototype.__class__=Vl;var Dl=zpp_nape.dynamics.ZPP_FluidArbiter=function(){this.pre_dt=0,this.mutable=!1,this.wrap_position=null,this.buoyy=0,this.buoyx=0,this.ny=0,this.nx=0,this.lgamma=0,this.dampy=0,this.dampx=0,this.vMassc=0,this.vMassb=0,this.vMassa=0,this.agamma=0,this.adamp=0,this.wMass=0,this.nodrag=!1,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0,this.overlap=0,this.centroidy=0,this.centroidx=0,this.next=null,this.outer_zn=null,ri.call(this),this.type=ri.FLUID,(this.fluidarb=this).buoyx=0,this.buoyy=0,this.pre_dt=-1};Dl.__name__=["zpp_nape","dynamics","ZPP_FluidArbiter"],Dl.__super__=ri,Dl.prototype=Object.create(ri.prototype),Dl.prototype.outer_zn=null,Dl.prototype.next=null,Dl.prototype.alloc=function(){},Dl.prototype.free=function(){},Dl.prototype.centroidx=null,Dl.prototype.centroidy=null,Dl.prototype.overlap=null,Dl.prototype.r1x=null,Dl.prototype.r1y=null,Dl.prototype.r2x=null,Dl.prototype.r2y=null,Dl.prototype.nodrag=null,Dl.prototype.wMass=null,Dl.prototype.adamp=null,Dl.prototype.agamma=null,Dl.prototype.vMassa=null,Dl.prototype.vMassb=null,Dl.prototype.vMassc=null,Dl.prototype.dampx=null,Dl.prototype.dampy=null,Dl.prototype.lgamma=null,Dl.prototype.nx=null,Dl.prototype.ny=null,Dl.prototype.buoyx=null,Dl.prototype.buoyy=null,Dl.prototype.position_validate=function(){this.wrap_position.zpp_inner.x=this.centroidx,this.wrap_position.zpp_inner.y=this.centroidy},Dl.prototype.position_invalidate=function(n){this.centroidx=n.x,this.centroidy=n.y},Dl.prototype.wrap_position=null,Dl.prototype.getposition=function(){var n,t,e,i,p;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),0==n.zpp_inner.x&&(null!=(i=n.zpp_inner)._validate&&i._validate(),0==n.zpp_inner.y)||(n.zpp_inner.x=0,n.zpp_inner.y=0,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_position=n,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!this.mutable,this.wrap_position.zpp_inner._validate=Q(this,this.position_validate),this.wrap_position.zpp_inner._invalidate=Q(this,this.position_invalidate)},Dl.prototype.assign=function(n,t,e,i){this.b1=n.body,this.ws1=n,this.b2=t.body,this.ws2=t,this.id=e,this.di=i;var p,l=this.b1.arbiters;null==Gl.zpp_pool?p=new Gl:(p=Gl.zpp_pool,Gl.zpp_pool=p.next,p.next=null),p.elt=this;var r=p;r.next=l.head,l.head=r,l.modified=!0,l.length++;var o,a=this.b2.arbiters;null==Gl.zpp_pool?o=new Gl:(o=Gl.zpp_pool,Gl.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.nx=0,this.ny=1,this.dampx=0,this.dampy=0,this.adamp=0},Dl.prototype.retire=function(){if(!this.cleared){for(var n,t,e=this.b1.arbiters,i=null,p=e.head;null!=p;){if(p.elt==this){null==i?(t=(n=e.head).next,e.head=t,null==e.head&&(e.pushmod=!0)):(t=(n=i.next).next,null==(i.next=t)&&(e.pushmod=!0));var l=n;l.elt=null,l.next=Gl.zpp_pool,Gl.zpp_pool=l,e.modified=!0,e.length--,e.pushmod=!0;break}p=(i=p).next}for(var r,o,a=this.b2.arbiters,s=null,_=a.head;null!=_;){if(_.elt==this){null==s?(o=(r=a.head).next,a.head=o,null==a.head&&(a.pushmod=!0)):(o=(r=s.next).next,null==(s.next=o)&&(a.pushmod=!0));var h=r;h.elt=null,h.next=Gl.zpp_pool,Gl.zpp_pool=h,a.modified=!0,a.length--,a.pushmod=!0;break}_=(s=_).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;this.next=Dl.zpp_pool,(Dl.zpp_pool=this).pre_dt=-1},Dl.prototype.mutable=null,Dl.prototype.makemutable=function(){this.mutable=!0,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!1)},Dl.prototype.makeimmutable=function(){this.mutable=!1,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!0)},Dl.prototype.inject=function(n,t,e){this.overlap=n,this.centroidx=t,this.centroidy=e},Dl.prototype.pre_dt=null,Dl.prototype.preStep=function(n,t){-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;this.pre_dt=t,this.r1x=this.centroidx-this.b1.posx,this.r1y=this.centroidy-this.b1.posy,this.r2x=this.centroidx-this.b2.posx,this.r2y=this.centroidy-this.b2.posy;var i,p,l,r,o,a,s,_,h,u,x,d,y=0,z=0,z=this.ws1.fluidEnabled&&null!=this.ws1.fluidProperties.wrap_gravity?(y=this.ws1.fluidProperties.gravityx,this.ws1.fluidProperties.gravityy):(y=n.gravityx,n.gravityy),c=0,v=0,v=this.ws2.fluidEnabled&&null!=this.ws2.fluidProperties.wrap_gravity?(c=this.ws2.fluidProperties.gravityx,this.ws2.fluidProperties.gravityy):(c=n.gravityx,n.gravityy),m=0,f=0;if(this.ws1.fluidEnabled&&this.ws2.fluidEnabled?(i=this.overlap*this.ws1.fluidProperties.density,(p=this.overlap*this.ws2.fluidProperties.density)<i?(m-=y*(l=i+p),f-=z*l):i<p?(m+=c*(r=i+p),f+=v*r):(_=s=0,s=y+c,_=z+v,s*=.5,_*=.5,this.ws1.worldCOMx*s+this.ws1.worldCOMy*_>this.ws2.worldCOMx*s+this.ws2.worldCOMy*_?(m-=s*(o=i+p),f-=_*o):(m+=s*(a=i+p),f+=_*a))):this.ws1.fluidEnabled?(m-=y*(h=this.overlap*this.ws1.fluidProperties.density),f-=z*h):this.ws2.fluidEnabled&&(m+=c*(u=this.overlap*this.ws2.fluidProperties.density),f+=v*u),m*=t,f*=t,this.buoyx=m,this.buoyy=f,2==this.b1.type&&(x=this.b1.imass,this.b1.velx-=m*x,this.b1.vely-=f*x,this.b1.angvel-=(f*this.r1x-m*this.r1y)*this.b1.iinertia),2==this.b2.type&&(d=this.b2.imass,this.b2.velx+=m*d,this.b2.vely+=f*d,this.b2.angvel+=(f*this.r2x-m*this.r2y)*this.b2.iinertia),this.ws1.fluidEnabled&&0!=this.ws1.fluidProperties.viscosity||this.ws2.fluidEnabled&&0!=this.ws2.fluidProperties.viscosity){this.nodrag=!1;var b,g,w,M=0;this.ws1.fluidEnabled&&(this.ws2.validate_angDrag(),M=this.ws1.fluidProperties.viscosity*this.ws2.angDrag*this.overlap/this.ws2.area),this.ws2.fluidEnabled&&(this.ws1.validate_angDrag(),M+=this.ws2.fluidProperties.viscosity*this.ws1.angDrag*this.overlap/this.ws1.area),0!=M?(b=this.b1.sinertia+this.b2.sinertia,this.wMass=0!=b?1/b:0,M*=4e-4,g=2*Math.PI*M,this.agamma=1/(t*g*(2+g*t)),w=1/(1+this.agamma),this.agamma*=w,this.wMass*=w):(this.wMass=0,this.agamma=0);var C,k=this.b2.velx+this.b2.kinvelx-this.r2y*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.r1y*(this.b2.angvel+this.b2.kinangvel)),O=this.b2.vely+this.b2.kinvely+this.r2x*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.r1x*(this.b1.angvel+this.b1.kinangvel));k*k+O*O<co.epsilon*co.epsilon||(k*=C=1/Math.sqrt(k*k+O*O),O*=C,this.nx=k,this.ny=O);var P,S,A,j,E,I,T,N,L,V,D,F,R=0;if(this.ws1.fluidEnabled){var Z=-this.ws1.fluidProperties.viscosity*this.overlap/this.ws2.area;if(0==this.ws2.type)R=0-Z*this.ws2.circle.radius*co.fluidLinearDrag/(2*this.ws2.circle.radius*Math.PI);else{for(var B=0,G=0,q=this.ws2.polygon.edges.head;null!=q;){var U=q.elt;B+=U.length;var K=Z*U.length*(U.gnormx*this.nx+U.gnormy*this.ny);0<K&&(K*=-co.fluidVacuumDrag),G-=.5*K*co.fluidLinearDrag,q=q.next}R=G/B}}if(this.ws2.fluidEnabled){var W=-this.ws2.fluidProperties.viscosity*this.overlap/this.ws1.area;if(0==this.ws1.type)R-=W*this.ws1.circle.radius*co.fluidLinearDrag/(2*this.ws1.circle.radius*Math.PI);else{for(var Y=0,J=0,X=this.ws1.polygon.edges.head;null!=X;){var H=X.elt;Y+=H.length;var $=W*H.length*(H.gnormx*this.nx+H.gnormy*this.ny);0<$&&($*=-co.fluidVacuumDrag),J-=.5*$*co.fluidLinearDrag,X=X.next}R+=J/Y}}0!=R?(V=S=E=0,V=E=P=this.b1.smass+this.b2.smass,(S=0)!=this.b1.sinertia&&(A=this.r1x*this.b1.sinertia,E=P+(j=this.r1y*this.b1.sinertia)*this.r1y,S+=-j*this.r1x,V=P+A*this.r1x),0!=this.b2.sinertia&&(I=this.r2x*this.b2.sinertia,E+=(T=this.r2y*this.b2.sinertia)*this.r2y,S+=-T*this.r2x,V+=I*this.r2x),(N=E*V-S*S)!=N?E=S=V=0:0==N?(E=0!=E?1/E:0,V=0!=V?1/V:0,S=0):(L=V*(N=1/N),V=E*N,E=L,S*=-N),this.vMassa=E,this.vMassb=S,this.vMassc=V,D=2*Math.PI*R,this.lgamma=1/(t*D*(2+D*t)),F=1/(1+this.lgamma),this.lgamma*=F,this.vMassa*=F,this.vMassb*=F,this.vMassc*=F):(this.vMassa=0,this.vMassb=0,this.vMassc=0,this.lgamma=0)}else this.nodrag=!0,this.dampx=0,this.dampy=0,this.adamp=0;this.dampx*=e,this.dampy*=e,this.adamp*=e},Dl.prototype.warmStart=function(){var n=this.b1.imass;this.b1.velx-=this.dampx*n,this.b1.vely-=this.dampy*n;var t=this.b2.imass;this.b2.velx+=this.dampx*t,this.b2.vely+=this.dampy*t,this.b1.angvel-=this.b1.iinertia*(this.dampy*this.r1x-this.dampx*this.r1y),this.b2.angvel+=this.b2.iinertia*(this.dampy*this.r2x-this.dampx*this.r2y),this.b1.angvel-=this.adamp*this.b1.iinertia,this.b2.angvel+=this.adamp*this.b2.iinertia},Dl.prototype.applyImpulseVel=function(){var n,t,e,i,p,l,r,o,a;this.nodrag||(n=this.b1.angvel+this.b1.kinangvel,t=this.b2.angvel+this.b2.kinangvel,p=this.b1.velx+this.b1.kinvelx-this.r1y*n-(this.b2.velx+this.b2.kinvelx-this.r2y*t),i=this.b1.vely+this.b1.kinvely+this.r1x*n-(this.b2.vely+this.b2.kinvely+this.r2x*t),e=this.vMassa*p+this.vMassb*i,i=this.vMassb*p+this.vMassc*i,p=e,l=this.lgamma,p-=this.dampx*l,i-=this.dampy*l,this.dampx+=p,this.dampy+=i,r=this.b1.imass,this.b1.velx-=p*r,this.b1.vely-=i*r,o=this.b2.imass,this.b2.velx+=p*o,this.b2.vely+=i*o,this.b1.angvel-=this.b1.iinertia*(i*this.r1x-p*this.r1y),this.b2.angvel+=this.b2.iinertia*(i*this.r2x-p*this.r2y),a=(n-t)*this.wMass-this.adamp*this.agamma,this.adamp+=a,this.b1.angvel-=a*this.b1.iinertia,this.b2.angvel+=a*this.b2.iinertia)},Dl.prototype.__class__=Dl;var Fl=zpp_nape.dynamics.ZPP_ColArbiter=function(){this.pre_dt=0,this.mutable=!1,this.stat=!1,this.next=null,this.hpc2=!1,this.hc2=!1,this.oc2=null,this.c2=null,this.oc1=null,this.c1=null,this.__ref_vertex=0,this.__ref_edge2=null,this.__ref_edge1=null,this.biasCoef=0,this.rev=!1,this.radius=0,this.lproj=0,this.lnormy=0,this.lnormx=0,this.surfacey=0,this.surfacex=0,this.k2y=0,this.k2x=0,this.k1y=0,this.k1x=0,this.rt2b=0,this.rn2b=0,this.rt2a=0,this.rn2a=0,this.rt1b=0,this.rn1b=0,this.rt1a=0,this.rn1a=0,this.jrAcc=0,this.rMass=0,this.Kc=0,this.Kb=0,this.Ka=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_normal=null,this.ny=0,this.nx=0,this.innards=null,this.wrap_contacts=null,this.contacts=null,this.s2=null,this.s1=null,this.userdef_rfric=!1,this.userdef_restitution=!1,this.userdef_stat_fric=!1,this.userdef_dyn_fric=!1,this.rfric=0,this.restitution=0,this.stat_fric=0,this.dyn_fric=0,this.outer_zn=null,ri.call(this),this.pre_dt=-1,this.contacts=new Rl,this.innards=new ct,this.type=ri.COL,this.colarb=this};Fl.__name__=["zpp_nape","dynamics","ZPP_ColArbiter"],Fl.__super__=ri,Fl.prototype=Object.create(ri.prototype),Fl.prototype.outer_zn=null,Fl.prototype.dyn_fric=null,Fl.prototype.stat_fric=null,Fl.prototype.restitution=null,Fl.prototype.rfric=null,Fl.prototype.userdef_dyn_fric=null,Fl.prototype.userdef_stat_fric=null,Fl.prototype.userdef_restitution=null,Fl.prototype.userdef_rfric=null,Fl.prototype.s1=null,Fl.prototype.s2=null,Fl.prototype.contacts=null,Fl.prototype.wrap_contacts=null,Fl.prototype.innards=null,Fl.prototype.nx=null,Fl.prototype.ny=null,Fl.prototype.normal_validate=function(){if(this.cleared)throw new p("Error: Arbiter not currently in use");this.wrap_normal.zpp_inner.x=this.nx,this.wrap_normal.zpp_inner.y=this.ny,this.ws1.id>this.ws2.id&&(this.wrap_normal.zpp_inner.x=-this.wrap_normal.zpp_inner.x,this.wrap_normal.zpp_inner.y=-this.wrap_normal.zpp_inner.y)},Fl.prototype.wrap_normal=null,Fl.prototype.getnormal=function(){var n,t,e,i,p;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),0==n.zpp_inner.x&&(null!=(i=n.zpp_inner)._validate&&i._validate(),0==n.zpp_inner.y)||(n.zpp_inner.x=0,n.zpp_inner.y=0,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_normal=n,this.wrap_normal.zpp_inner._immutable=!0,this.wrap_normal.zpp_inner._inuse=!0,this.wrap_normal.zpp_inner._validate=Q(this,this.normal_validate)},Fl.prototype.kMassa=null,Fl.prototype.kMassb=null,Fl.prototype.kMassc=null,Fl.prototype.Ka=null,Fl.prototype.Kb=null,Fl.prototype.Kc=null,Fl.prototype.rMass=null,Fl.prototype.jrAcc=null,Fl.prototype.rn1a=null,Fl.prototype.rt1a=null,Fl.prototype.rn1b=null,Fl.prototype.rt1b=null,Fl.prototype.rn2a=null,Fl.prototype.rt2a=null,Fl.prototype.rn2b=null,Fl.prototype.rt2b=null,Fl.prototype.k1x=null,Fl.prototype.k1y=null,Fl.prototype.k2x=null,Fl.prototype.k2y=null,Fl.prototype.surfacex=null,Fl.prototype.surfacey=null,Fl.prototype.ptype=null,Fl.prototype.lnormx=null,Fl.prototype.lnormy=null,Fl.prototype.lproj=null,Fl.prototype.radius=null,Fl.prototype.rev=null,Fl.prototype.biasCoef=null,Fl.prototype.__ref_edge1=null,Fl.prototype.__ref_edge2=null,Fl.prototype.__ref_vertex=null,Fl.prototype.c1=null,Fl.prototype.oc1=null,Fl.prototype.c2=null,Fl.prototype.oc2=null,Fl.prototype.hc2=null,Fl.prototype.hpc2=null,Fl.prototype.next=null,Fl.prototype.alloc=function(){},Fl.prototype.free=function(){this.userdef_dyn_fric=!1,this.userdef_stat_fric=!1,this.userdef_restitution=!1,this.userdef_rfric=!1,this.__ref_edge1=this.__ref_edge2=null},Fl.prototype.stat=null,Fl.prototype.injectContact=function(n,t,e,i,p,l,r){null==r&&(r=!1);for(var o,a,s,_=null,h=this.contacts.next;null!=h;){if(l==h.hash){_=h;break}h=h.next}return null==_?(null==Rl.zpp_pool?_=new Rl:(_=Rl.zpp_pool,Rl.zpp_pool=_.next,_.next=null),(o=_.inner).jnAcc=o.jtAcc=0,_.hash=l,_.fresh=!0,(_.arbiter=this).jrAcc=0,a=this.contacts,_._inuse=!0,(s=_).next=a.next,a.next=s,a.modified=!0,a.length++,this.innards.add(o)):_.fresh=!1,_.px=n,_.py=t,this.nx=e,this.ny=i,_.dist=p,_.stamp=this.stamp,_.posOnly=r,_},Fl.prototype.assign=function(n,t,e,i){this.b1=n.body,this.ws1=n,this.b2=t.body,this.ws2=t,this.id=e,this.di=i;var p,l=this.b1.arbiters;null==Gl.zpp_pool?p=new Gl:(p=Gl.zpp_pool,Gl.zpp_pool=p.next,p.next=null),p.elt=this;var r=p;r.next=l.head,l.head=r,l.modified=!0,l.length++;var o,a=this.b2.arbiters;null==Gl.zpp_pool?o=new Gl:(o=Gl.zpp_pool,Gl.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.s1=n,this.s2=t,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},Fl.prototype.calcProperties=function(){this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},Fl.prototype.validate_props=function(){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction)))},Fl.prototype.retire=function(){if(!this.cleared){for(var n,t,e=this.b1.arbiters,i=null,p=e.head;null!=p;){if(p.elt==this){null==i?(t=(n=e.head).next,e.head=t,null==e.head&&(e.pushmod=!0)):(t=(n=i.next).next,null==(i.next=t)&&(e.pushmod=!0));var l=n;l.elt=null,l.next=Gl.zpp_pool,Gl.zpp_pool=l,e.modified=!0,e.length--,e.pushmod=!0;break}p=(i=p).next}for(var r,o,a=this.b2.arbiters,s=null,_=a.head;null!=_;){if(_.elt==this){null==s?(o=(r=a.head).next,a.head=o,null==a.head&&(a.pushmod=!0)):(o=(r=s.next).next,null==(s.next=o)&&(a.pushmod=!0));var h=r;h.elt=null,h.next=Gl.zpp_pool,Gl.zpp_pool=h,a.modified=!0,a.length--,a.pushmod=!0;break}_=(s=_).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}for(this.b1=this.b2=null,this.active=!1,this.intchange=!1;null!=this.contacts.next;){var u=this.contacts,x=u.next;u.pop(),x.arbiter=null,x.next=Rl.zpp_pool,Rl.zpp_pool=x;var d=this.innards,y=d.next;d.next=y.next,y._inuse=!1,null==d.next&&(d.pushmod=!0),d.modified=!0,d.length--}this.userdef_dyn_fric=!1,this.userdef_stat_fric=!1,this.userdef_restitution=!1,this.userdef_rfric=!1,this.__ref_edge1=this.__ref_edge2=null,this.next=Fl.zpp_pool,(Fl.zpp_pool=this).pre_dt=-1},Fl.prototype.mutable=null,Fl.prototype.makemutable=function(){this.mutable=!0,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!1),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!1)},Fl.prototype.makeimmutable=function(){this.mutable=!1,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!0),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!0)},Fl.prototype.contacts_adder=function(n){return!1},Fl.prototype.contacts_subber=function(n){for(var t=null,e=null,i=this.innards.next,p=this.contacts.next;null!=p;){var l=p;if(l==n.zpp_inner){this.contacts.erase(t),this.innards.erase(e),l.arbiter=null,l.next=Rl.zpp_pool,Rl.zpp_pool=l;break}t=p,i=(e=i).next,p=p.next}},Fl.prototype.setupcontacts=function(){this.wrap_contacts=Di.get(this.contacts,!0),this.wrap_contacts.zpp_inner.immutable=!this.mutable,this.wrap_contacts.zpp_inner.adder=Q(this,this.contacts_adder),this.wrap_contacts.zpp_inner.dontremove=!0,this.wrap_contacts.zpp_inner.subber=Q(this,this.contacts_subber)},Fl.prototype.cleanupContacts=function(){var n=!0,t=null,e=null,i=this.innards.next;this.hc2=!1;for(var p,l,r=this.contacts.next;null!=r;){var o,a,s,_,h,u,x,d,y=r;y.stamp+co.arbiterExpirationDelay<this.stamp?(o=this.contacts,null==t?(s=(a=o.next).next,o.next=s,null==o.next&&(o.pushmod=!0)):(s=(a=t.next).next,null==(t.next=s)&&(o.pushmod=!0)),a._inuse=!1,o.modified=!0,o.length--,o.pushmod=!0,r=s,_=this.innards,null==e?(u=(h=_.next).next,_.next=u,null==_.next&&(_.pushmod=!0)):(u=(h=e.next).next,null==(e.next=u)&&(_.pushmod=!0)),h._inuse=!1,_.modified=!0,_.length--,_.pushmod=!0,i=u,y.arbiter=null,y.next=Rl.zpp_pool,Rl.zpp_pool=y):(x=y.inner,d=y.active,y.active=y.stamp==this.stamp,y.active&&(n?(n=!1,this.c1=x,this.oc1=y):(this.hc2=!0,this.c2=x,this.oc2=y)),d!=y.active&&(this.contacts.modified=!0),t=r,i=(e=i).next,r=r.next)}return this.hc2?(this.hpc2=!0,this.oc1.posOnly?(p=this.c1,this.c1=this.c2,this.c2=p,l=this.oc1,this.oc1=this.oc2,this.oc2=l,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(n=!0)):this.hpc2=!1,n},Fl.prototype.pre_dt=null,Fl.prototype.preStep=function(n){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))),-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n;var e=this.b1.smass+this.b2.smass,i=!(this.hc2=!1);this.biasCoef=2!=this.b1.type||2!=this.b2.type?this.continuous?co.contactContinuousStaticBiasCoef:co.contactStaticBiasCoef:this.continuous?co.contactContinuousBiasCoef:co.contactBiasCoef,this.continuous=!1;for(var p,l,r,o,a,s=null,_=null,h=this.innards.next,u=this.contacts.next;null!=u;){var x,d,y,z,c,v,m,f,b,g,w,M,C,k,O,P,S,A,j,E=u;E.stamp+co.arbiterExpirationDelay<this.stamp?(x=this.contacts,null==s?(y=(d=x.next).next,x.next=y,null==x.next&&(x.pushmod=!0)):(y=(d=s.next).next,null==(s.next=y)&&(x.pushmod=!0)),d._inuse=!1,x.modified=!0,x.length--,x.pushmod=!0,u=y,z=this.innards,null==_?(v=(c=z.next).next,z.next=v,null==z.next&&(z.pushmod=!0)):(v=(c=_.next).next,null==(_.next=v)&&(z.pushmod=!0)),c._inuse=!1,z.modified=!0,z.length--,z.pushmod=!0,h=v,E.arbiter=null,E.next=Rl.zpp_pool,Rl.zpp_pool=E):(m=E.inner,f=E.active,E.active=E.stamp==this.stamp,E.active&&(i?(i=!1,this.c1=m,this.oc1=E):(this.hc2=!0,this.c2=m,this.oc2=E),m.r2x=E.px-this.b2.posx,m.r2y=E.py-this.b2.posy,m.r1x=E.px-this.b1.posx,m.r1y=E.py-this.b1.posy,b=m.r2x*this.nx+m.r2y*this.ny,g=e+this.b2.sinertia*(b*b),w=m.r1x*this.nx+m.r1y*this.ny,g+=this.b1.sinertia*(w*w),m.tMass=g<co.epsilon*co.epsilon?0:1/g,M=this.ny*m.r2x-this.nx*m.r2y,C=e+this.b2.sinertia*(M*M),k=this.ny*m.r1x-this.nx*m.r1y,C+=this.b1.sinertia*(k*k),m.nMass=C<co.epsilon*co.epsilon?0:1/C,P=O=0,S=this.b2.angvel+this.b2.kinangvel,O=this.b2.velx+this.b2.kinvelx-m.r2y*S,P=this.b2.vely+this.b2.kinvely+m.r2x*S,S=this.b1.angvel+this.b1.kinangvel,O-=this.b1.velx+this.b1.kinvelx-m.r1y*S,P-=this.b1.vely+this.b1.kinvely+m.r1x*S,A=this.nx*O+this.ny*P,E.elasticity=this.restitution,m.bounce=A*E.elasticity,m.bounce>-co.elasticThreshold&&(m.bounce=0),A=P*this.nx-O*this.ny,j=co.staticFrictionThreshold,m.friction=j*j<A*A?this.dyn_fric:this.stat_fric,m.jnAcc*=t,m.jtAcc*=t),f!=E.active&&(this.contacts.modified=!0),s=u,h=(_=h).next,u=u.next)}return this.hc2?(this.hpc2=!0,this.oc1.posOnly?(p=this.c1,this.c1=this.c2,this.c2=p,l=this.oc1,this.oc1=this.oc2,this.oc2=l,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(i=!0)):this.hpc2=!1,this.jrAcc*=t,i||(this.rn1a=this.ny*this.c1.r1x-this.nx*this.c1.r1y,this.rt1a=this.c1.r1x*this.nx+this.c1.r1y*this.ny,this.rn1b=this.ny*this.c1.r2x-this.nx*this.c1.r2y,this.rt1b=this.c1.r2x*this.nx+this.c1.r2y*this.ny,this.k1x=this.b2.kinvelx-this.c1.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c1.r1y*this.b1.kinangvel),this.k1y=this.b2.kinvely+this.c1.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c1.r1x*this.b1.kinangvel)),this.hc2&&(this.rn2a=this.ny*this.c2.r1x-this.nx*this.c2.r1y,this.rt2a=this.c2.r1x*this.nx+this.c2.r1y*this.ny,this.rn2b=this.ny*this.c2.r2x-this.nx*this.c2.r2y,this.rt2b=this.c2.r2x*this.nx+this.c2.r2y*this.ny,this.k2x=this.b2.kinvelx-this.c2.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c2.r1y*this.b1.kinangvel),this.k2y=this.b2.kinvely+this.c2.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c2.r1x*this.b1.kinangvel),this.kMassa=e+this.b1.sinertia*this.rn1a*this.rn1a+this.b2.sinertia*this.rn1b*this.rn1b,this.kMassb=e+this.b1.sinertia*this.rn1a*this.rn2a+this.b2.sinertia*this.rn1b*this.rn2b,this.kMassc=e+this.b1.sinertia*this.rn2a*this.rn2a+this.b2.sinertia*this.rn2b*this.rn2b,this.kMassa*this.kMassa+2*this.kMassb*this.kMassb+this.kMassc*this.kMassc<co.illConditionedThreshold*(this.kMassa*this.kMassc-this.kMassb*this.kMassb)?(this.Ka=this.kMassa,this.Kb=this.kMassb,this.Kc=this.kMassc,(r=this.kMassa*this.kMassc-this.kMassb*this.kMassb)!=r?this.kMassa=this.kMassb=this.kMassc=0:0==r?(0!=this.kMassa?this.kMassa=1/this.kMassa:this.kMassa=0,0!=this.kMassc?this.kMassc=1/this.kMassc:this.kMassc=0,this.kMassb=0):(r=1/r,o=this.kMassc*r,this.kMassc=this.kMassa*r,this.kMassa=o,this.kMassb*=-r)):(this.hc2=!1,this.oc2.dist<this.oc1.dist&&(a=this.c1,this.c1=this.c2,this.c2=a),this.oc2.active=!1,this.contacts.modified=!0)),this.surfacex=this.b2.svelx,this.surfacey=this.b2.svely,this.surfacex+=this.b1.svelx,this.surfacey+=this.b1.svely,this.surfacex=-this.surfacex,this.surfacey=-this.surfacey,this.rMass=this.b1.sinertia+this.b2.sinertia,0!=this.rMass&&(this.rMass=1/this.rMass),i},Fl.prototype.warmStart=function(){var n=this.nx*this.c1.jnAcc-this.ny*this.c1.jtAcc,t=this.ny*this.c1.jnAcc+this.nx*this.c1.jtAcc,e=this.b1.imass;this.b1.velx-=n*e,this.b1.vely-=t*e,this.b1.angvel-=this.b1.iinertia*(t*this.c1.r1x-n*this.c1.r1y);var i,p,l,r,o=this.b2.imass;this.b2.velx+=n*o,this.b2.vely+=t*o,this.b2.angvel+=this.b2.iinertia*(t*this.c1.r2x-n*this.c1.r2y),this.hc2&&(i=this.nx*this.c2.jnAcc-this.ny*this.c2.jtAcc,p=this.ny*this.c2.jnAcc+this.nx*this.c2.jtAcc,l=this.b1.imass,this.b1.velx-=i*l,this.b1.vely-=p*l,this.b1.angvel-=this.b1.iinertia*(p*this.c2.r1x-i*this.c2.r1y),r=this.b2.imass,this.b2.velx+=i*r,this.b2.vely+=p*r,this.b2.angvel+=this.b2.iinertia*(p*this.c2.r2x-i*this.c2.r2y)),this.b2.angvel+=this.jrAcc*this.b2.iinertia,this.b1.angvel-=this.jrAcc*this.b1.iinertia},Fl.prototype.applyImpulseVel=function(){var n,t,e,i,p,l,r,o,a,s,_,h,u,x,d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),y=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel);p=(y*this.nx-d*this.ny+this.surfacex)*this.c1.tMass,(l=this.c1.friction*this.c1.jnAcc)<(o=(r=this.c1.jtAcc)-p)?o=l:o<-l&&(o=-l),p=o-r,this.c1.jtAcc=o,n=-this.ny*p,t=this.nx*p,this.b2.velx+=n*this.b2.imass,this.b2.vely+=t*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=t*this.b1.imass,this.b2.angvel+=this.rt1b*p*this.b2.iinertia,this.b1.angvel-=this.rt1a*p*this.b1.iinertia,this.hc2?(e=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),p=((i=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel))*this.nx-e*this.ny+this.surfacex)*this.c2.tMass,(l=this.c2.friction*this.c2.jnAcc)<(o=(r=this.c2.jtAcc)-p)?o=l:o<-l&&(o=-l),p=o-r,this.c2.jtAcc=o,n=-this.ny*p,t=this.nx*p,this.b2.velx+=n*this.b2.imass,this.b2.vely+=t*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=t*this.b1.imass,this.b2.angvel+=this.rt2b*p*this.b2.iinertia,this.b1.angvel-=this.rt2a*p*this.b1.iinertia,d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),y=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),e=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),i=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel),a=this.c1.jnAcc,s=this.c2.jnAcc,_=d*this.nx+y*this.ny+this.surfacey+this.c1.bounce-(this.Ka*a+this.Kb*s),h=e*this.nx+i*this.ny+this.surfacey+this.c2.bounce-(this.Kb*a+this.Kc*s),u=-(this.kMassa*_+this.kMassb*h),x=-(this.kMassb*_+this.kMassc*h),0<=u&&0<=x?(_=u-a,h=x-s,this.c1.jnAcc=u,this.c2.jnAcc=x):0<=(u=-this.c1.nMass*_)&&0<=this.Kb*u+h?(_=u-a,h=-s,this.c1.jnAcc=u,this.c2.jnAcc=0):0<=(x=-this.c2.nMass*h)&&0<=this.Kb*x+_?(_=-a,h=x-s,this.c1.jnAcc=0,this.c2.jnAcc=x):0<=_&&0<=h?(_=-a,h=-s,this.c1.jnAcc=this.c2.jnAcc=0):h=_=0,p=_+h,n=this.nx*p,t=this.ny*p,this.b2.velx+=n*this.b2.imass,this.b2.vely+=t*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=t*this.b1.imass,this.b2.angvel+=(this.rn1b*_+this.rn2b*h)*this.b2.iinertia,this.b1.angvel-=(this.rn1a*_+this.rn2a*h)*this.b1.iinertia):(0!=this.radius&&(p=(this.b2.angvel-this.b1.angvel)*this.rMass,l=this.rfric*this.c1.jnAcc,r=this.jrAcc,this.jrAcc-=p,this.jrAcc>l?this.jrAcc=l:this.jrAcc<-l&&(this.jrAcc=-l),p=this.jrAcc-r,this.b2.angvel+=p*this.b2.iinertia,this.b1.angvel-=p*this.b1.iinertia),d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),y=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),p=(this.c1.bounce+(this.nx*d+this.ny*y)+this.surfacey)*this.c1.nMass,(o=(r=this.c1.jnAcc)-p)<0&&(o=0),p=o-r,this.c1.jnAcc=o,n=this.nx*p,t=this.ny*p,this.b2.velx+=n*this.b2.imass,this.b2.vely+=t*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=t*this.b1.imass,this.b2.angvel+=this.rn1b*p*this.b2.iinertia,this.b1.angvel-=this.rn1a*p*this.b1.iinertia)},Fl.prototype.applyImpulsePos=function(){if(2==this.ptype){var n=this.c1,t=0,e=0;t=this.b2.axisy*n.lr2x-this.b2.axisx*n.lr2y,e=n.lr2x*this.b2.axisx+n.lr2y*this.b2.axisy,t+=this.b2.posx,e+=this.b2.posy;var i=0,p=0;i=this.b1.axisy*n.lr1x-this.b1.axisx*n.lr1y,p=n.lr1x*this.b1.axisx+n.lr1y*this.b1.axisy;var l,r,o,a,s,_,h,u,x,d,y,z,c,v,m,f,b,g,w,M,C,k,O,P,S=0,A=0,S=t-(i+=this.b1.posx),A=e-(p+=this.b1.posy),j=Math.sqrt(S*S+A*A),E=this.radius-co.collisionSlop,I=j-E;S*this.nx+A*this.ny<0&&(S=-S,A=-A,I-=this.radius),I<0&&(j<co.epsilon?0!=this.b1.smass?this.b1.posx+=10*co.epsilon:this.b2.posx+=10*co.epsilon:(S*=l=1/j,o=.5*(p+e),a=j-E,s=(A*=l)*(i=(r=.5*(i+t))-this.b1.posx)-S*(p=o-this.b1.posy),_=A*(t=r-this.b2.posx)-S*(e=o-this.b2.posy),0!=(h=this.b2.smass+_*_*this.b2.sinertia+this.b1.smass+s*s*this.b1.sinertia)&&(d=x=0,x=S*(u=-this.biasCoef*a/h),d=A*u,y=this.b1.imass,this.b1.posx-=x*y,this.b1.posy-=d*y,z=this.b1,c=-s*this.b1.iinertia*u,z.rot+=c,1e-4<c*c?(z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot)):(f=1-(v=c*c)*v/8,b=((m=1-.5*v)*z.axisx+c*z.axisy)*f,z.axisy=(m*z.axisy-c*z.axisx)*f,z.axisx=b),g=this.b2.imass,this.b2.posx+=x*g,this.b2.posy+=d*g,w=this.b2,M=_*this.b2.iinertia*u,w.rot+=M,1e-4<M*M?(w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot)):(O=1-(C=M*M)*C/8,P=((k=1-.5*C)*w.axisx+M*w.axisy)*O,w.axisy=(k*w.axisy-M*w.axisx)*O,w.axisx=P))))}else{var T,N=0,L=0,V=0,D=0,F=0,R=0;0==this.ptype?(N=this.b1.axisy*this.lnormx-this.b1.axisx*this.lnormy,L=this.lnormx*this.b1.axisx+this.lnormy*this.b1.axisy,T=this.lproj+(N*this.b1.posx+L*this.b1.posy),V=this.b2.axisy*this.c1.lr1x-this.b2.axisx*this.c1.lr1y,D=this.c1.lr1x*this.b2.axisx+this.c1.lr1y*this.b2.axisy,V+=this.b2.posx,D+=this.b2.posy,this.hpc2&&(F=this.b2.axisy*this.c2.lr1x-this.b2.axisx*this.c2.lr1y,R=this.c2.lr1x*this.b2.axisx+this.c2.lr1y*this.b2.axisy,F+=this.b2.posx,R+=this.b2.posy)):(N=this.b2.axisy*this.lnormx-this.b2.axisx*this.lnormy,L=this.lnormx*this.b2.axisx+this.lnormy*this.b2.axisy,T=this.lproj+(N*this.b2.posx+L*this.b2.posy),V=this.b1.axisy*this.c1.lr1x-this.b1.axisx*this.c1.lr1y,D=this.c1.lr1x*this.b1.axisx+this.c1.lr1y*this.b1.axisy,V+=this.b1.posx,D+=this.b1.posy,this.hpc2&&(F=this.b1.axisy*this.c2.lr1x-this.b1.axisx*this.c2.lr1y,R=this.c2.lr1x*this.b1.axisx+this.c2.lr1y*this.b1.axisy,F+=this.b1.posx,R+=this.b1.posy));var Z=V*N+D*L-T-this.radius;Z+=co.collisionSlop;var B=0;if(this.hpc2&&(B=F*N+R*L-T-this.radius,B+=co.collisionSlop),Z<0||B<0){this.rev&&(N=-N,L=-L);var G=V-this.b1.posx,q=D-this.b1.posy,U=V-this.b2.posx,K=D-this.b2.posy;if(this.hpc2){var W=L*G-N*q,Y=L*U-N*K,J=L*(F-this.b1.posx)-N*(R-this.b1.posy),X=L*(F-this.b2.posx)-N*(R-this.b2.posy),H=this.b1.smass+this.b2.smass;this.kMassa=H+this.b1.sinertia*W*W+this.b2.sinertia*Y*Y,this.kMassb=H+this.b1.sinertia*W*J+this.b2.sinertia*Y*X,this.kMassc=H+this.b1.sinertia*J*J+this.b2.sinertia*X*X;for(var $=this.kMassa,Q=this.kMassb,nn=this.kMassc,tn=Z*this.biasCoef,en=B*this.biasCoef;;){var pn=0,ln=0;pn=-(pn=tn),ln=-(ln=en);var rn,on=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(on!=on?pn=ln=0:0==on?(0!=this.kMassa?pn/=this.kMassa:pn=0,0!=this.kMassc?ln/=this.kMassc:ln=0):(rn=(on=1/on)*(this.kMassc*pn-this.kMassb*ln),ln=on*(this.kMassa*ln-this.kMassb*pn),pn=rn),0<=pn&&0<=ln){var an=(pn+ln)*this.b1.imass;this.b1.posx-=N*an,this.b1.posy-=L*an;var sn,_n,hn,un,xn=this.b1,dn=-this.b1.iinertia*(W*pn+J*ln);xn.rot+=dn,1e-4<dn*dn?(xn.axisx=Math.sin(xn.rot),xn.axisy=Math.cos(xn.rot)):(hn=1-(sn=dn*dn)*sn/8,un=((_n=1-.5*sn)*xn.axisx+dn*xn.axisy)*hn,xn.axisy=(_n*xn.axisy-dn*xn.axisx)*hn,xn.axisx=un);var yn=(pn+ln)*this.b2.imass;this.b2.posx+=N*yn,this.b2.posy+=L*yn;var zn,cn,vn,mn,fn=this.b2,bn=this.b2.iinertia*(Y*pn+X*ln);fn.rot+=bn,1e-4<bn*bn?(fn.axisx=Math.sin(fn.rot),fn.axisy=Math.cos(fn.rot)):(vn=1-(zn=bn*bn)*zn/8,mn=((cn=1-.5*zn)*fn.axisx+bn*fn.axisy)*vn,fn.axisy=(cn*fn.axisy-bn*fn.axisx)*vn,fn.axisx=mn);break}if((ln=0)<=(pn=-tn/$)&&0<=Q*pn+en){var gn=(pn+ln)*this.b1.imass;this.b1.posx-=N*gn,this.b1.posy-=L*gn;var wn,Mn,Cn,kn,On=this.b1,Pn=-this.b1.iinertia*(W*pn+J*ln);On.rot+=Pn,1e-4<Pn*Pn?(On.axisx=Math.sin(On.rot),On.axisy=Math.cos(On.rot)):(Cn=1-(wn=Pn*Pn)*wn/8,kn=((Mn=1-.5*wn)*On.axisx+Pn*On.axisy)*Cn,On.axisy=(Mn*On.axisy-Pn*On.axisx)*Cn,On.axisx=kn);var Sn=(pn+ln)*this.b2.imass;this.b2.posx+=N*Sn,this.b2.posy+=L*Sn;var An,jn,En,In,Tn=this.b2,Nn=this.b2.iinertia*(Y*pn+X*ln);Tn.rot+=Nn,1e-4<Nn*Nn?(Tn.axisx=Math.sin(Tn.rot),Tn.axisy=Math.cos(Tn.rot)):(En=1-(An=Nn*Nn)*An/8,In=((jn=1-.5*An)*Tn.axisx+Nn*Tn.axisy)*En,Tn.axisy=(jn*Tn.axisy-Nn*Tn.axisx)*En,Tn.axisx=In);break}if((pn=0)<=(ln=-en/nn)&&0<=Q*ln+tn){var Ln=(pn+ln)*this.b1.imass;this.b1.posx-=N*Ln,this.b1.posy-=L*Ln;var Vn,Dn,Fn,Rn,Zn=this.b1,Bn=-this.b1.iinertia*(W*pn+J*ln);Zn.rot+=Bn,1e-4<Bn*Bn?(Zn.axisx=Math.sin(Zn.rot),Zn.axisy=Math.cos(Zn.rot)):(Fn=1-(Vn=Bn*Bn)*Vn/8,Rn=((Dn=1-.5*Vn)*Zn.axisx+Bn*Zn.axisy)*Fn,Zn.axisy=(Dn*Zn.axisy-Bn*Zn.axisx)*Fn,Zn.axisx=Rn);var Gn=(pn+ln)*this.b2.imass;this.b2.posx+=N*Gn,this.b2.posy+=L*Gn;var qn,Un,Kn,Wn,Yn=this.b2,Jn=this.b2.iinertia*(Y*pn+X*ln);Yn.rot+=Jn,1e-4<Jn*Jn?(Yn.axisx=Math.sin(Yn.rot),Yn.axisy=Math.cos(Yn.rot)):(Kn=1-(qn=Jn*Jn)*qn/8,Wn=((Un=1-.5*qn)*Yn.axisx+Jn*Yn.axisy)*Kn,Yn.axisy=(Un*Yn.axisy-Jn*Yn.axisx)*Kn,Yn.axisx=Wn);break}break}}else{var Xn,Hn,$n,Qn,nt,tt,et,it,pt,lt,rt,ot,at,st,_t,ht,ut,xt=L*G-N*q,dt=L*U-N*K,yt=this.b2.smass+dt*dt*this.b2.sinertia+this.b1.smass+xt*xt*this.b1.sinertia;0!=yt&&($n=Hn=0,Hn=N*(Xn=-this.biasCoef*Z/yt),$n=L*Xn,Qn=this.b1.imass,this.b1.posx-=Hn*Qn,this.b1.posy-=$n*Qn,nt=this.b1,tt=-xt*this.b1.iinertia*Xn,nt.rot+=tt,1e-4<tt*tt?(nt.axisx=Math.sin(nt.rot),nt.axisy=Math.cos(nt.rot)):(pt=1-(et=tt*tt)*et/8,lt=((it=1-.5*et)*nt.axisx+tt*nt.axisy)*pt,nt.axisy=(it*nt.axisy-tt*nt.axisx)*pt,nt.axisx=lt),rt=this.b2.imass,this.b2.posx+=Hn*rt,this.b2.posy+=$n*rt,ot=this.b2,at=dt*this.b2.iinertia*Xn,ot.rot+=at,1e-4<at*at?(ot.axisx=Math.sin(ot.rot),ot.axisy=Math.cos(ot.rot)):(ht=1-(st=at*at)*st/8,ut=((_t=1-.5*st)*ot.axisx+at*ot.axisy)*ht,ot.axisy=(_t*ot.axisy-at*ot.axisx)*ht,ot.axisx=ut))}}}},Fl.prototype.__class__=Fl;var Rl=zpp_nape.dynamics.ZPP_Contact=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.elasticity=0,this.dist=0,this.fresh=!1,this.hash=0,this.stamp=0,this.posOnly=!1,this.active=!1,this.inner=null,this.arbiter=null,this.wrap_position=null,this.py=0,this.px=0,this.outer=null,this.inner=new ct};Rl.__name__=["zpp_nape","dynamics","ZPP_Contact"],Rl.prototype.outer=null,Rl.prototype.wrapper=function(){return null==this.outer&&(Rl.internal=!0,this.outer=new N,Rl.internal=!1,this.outer.zpp_inner=this),this.outer},Rl.prototype.px=null,Rl.prototype.py=null,Rl.prototype.position_validate=function(){this.wrap_position.zpp_inner.x=this.px,this.wrap_position.zpp_inner.y=this.py},Rl.prototype.wrap_position=null,Rl.prototype.getposition=function(){var n,t,e,i,p;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),0==n.zpp_inner.x&&(null!=(i=n.zpp_inner)._validate&&i._validate(),0==n.zpp_inner.y)||(n.zpp_inner.x=0,n.zpp_inner.y=0,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_position=n,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!0,this.wrap_position.zpp_inner._validate=Q(this,this.position_validate)},Rl.prototype.inactiveme=function(){return!(this.active&&null!=this.arbiter&&this.arbiter.active)},Rl.prototype.arbiter=null,Rl.prototype.inner=null,Rl.prototype.active=null,Rl.prototype.posOnly=null,Rl.prototype.stamp=null,Rl.prototype.hash=null,Rl.prototype.fresh=null,Rl.prototype.dist=null,Rl.prototype.elasticity=null,Rl.prototype.free=function(){this.arbiter=null},Rl.prototype.alloc=function(){},Rl.prototype.next=null,Rl.prototype.elem=function(){return this},Rl.prototype.begin=function(){return this.next},Rl.prototype._inuse=null,Rl.prototype.modified=null,Rl.prototype.pushmod=null,Rl.prototype.length=null,Rl.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},Rl.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Rl.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Rl.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},Rl.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},Rl.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},Rl.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Rl.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Rl.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},Rl.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},Rl.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Rl.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Rl.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Rl.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Rl.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},Rl.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},Rl.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Rl.prototype.clear=function(){},Rl.prototype.inlined_clear=function(){},Rl.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},Rl.prototype.empty=function(){return null==this.next},Rl.prototype.size=function(){return this.length},Rl.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},Rl.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},Rl.prototype.front=function(){return this.next},Rl.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},Rl.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},Rl.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t:null},Rl.prototype.__class__=Rl;var ct=zpp_nape.dynamics.ZPP_IContact=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.lr2y=0,this.lr2x=0,this.lr1y=0,this.lr1x=0,this.jtAcc=0,this.jnAcc=0,this.friction=0,this.bounce=0,this.tMass=0,this.nMass=0,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0};ct.__name__=["zpp_nape","dynamics","ZPP_IContact"],ct.prototype.r1x=null,ct.prototype.r1y=null,ct.prototype.r2x=null,ct.prototype.r2y=null,ct.prototype.nMass=null,ct.prototype.tMass=null,ct.prototype.bounce=null,ct.prototype.friction=null,ct.prototype.jnAcc=null,ct.prototype.jtAcc=null,ct.prototype.lr1x=null,ct.prototype.lr1y=null,ct.prototype.lr2x=null,ct.prototype.lr2y=null,ct.prototype.next=null,ct.prototype.elem=function(){return this},ct.prototype.begin=function(){return this.next},ct.prototype._inuse=null,ct.prototype.modified=null,ct.prototype.pushmod=null,ct.prototype.length=null,ct.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},ct.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},ct.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},ct.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},ct.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},ct.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},ct.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},ct.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},ct.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},ct.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},ct.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ct.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ct.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ct.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ct.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},ct.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},ct.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ct.prototype.clear=function(){},ct.prototype.inlined_clear=function(){},ct.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},ct.prototype.empty=function(){return null==this.next},ct.prototype.size=function(){return this.length},ct.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},ct.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},ct.prototype.front=function(){return this.next},ct.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},ct.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},ct.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t:null},ct.prototype.__class__=ct;var vt=zpp_nape.dynamics.ZPP_InteractionFilter=function(){this.fluidMask=0,this.fluidGroup=0,this.sensorMask=0,this.sensorGroup=0,this.collisionMask=0,this.collisionGroup=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ce,this.collisionGroup=this.sensorGroup=this.fluidGroup=1,this.collisionMask=this.sensorMask=this.fluidMask=-1};vt.__name__=["zpp_nape","dynamics","ZPP_InteractionFilter"],vt.prototype.next=null,vt.prototype.userData=null,vt.prototype.outer=null,vt.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new D,(n=this.outer.zpp_inner).outer=null,n.next=vt.zpp_pool,vt.zpp_pool=n,this.outer.zpp_inner=this),this.outer},vt.prototype.free=function(){this.outer=null},vt.prototype.alloc=function(){},vt.prototype.shapes=null,vt.prototype.wrap_shapes=null,vt.prototype.feature_cons=function(){this.shapes=new ce},vt.prototype.addShape=function(n){this.shapes.add(n)},vt.prototype.remShape=function(n){this.shapes.remove(n)},vt.prototype.copy=function(){var n;return null==vt.zpp_pool?n=new vt:(n=vt.zpp_pool,vt.zpp_pool=n.next,n.next=null),n.collisionGroup=this.collisionGroup,n.collisionMask=this.collisionMask,n.sensorGroup=this.sensorGroup,n.sensorMask=this.sensorMask,n.fluidGroup=this.fluidGroup,n.fluidMask=this.fluidMask,n},vt.prototype.collisionGroup=null,vt.prototype.collisionMask=null,vt.prototype.shouldCollide=function(n){return 0!=(this.collisionMask&n.collisionGroup)&&0!=(n.collisionMask&this.collisionGroup)},vt.prototype.sensorGroup=null,vt.prototype.sensorMask=null,vt.prototype.shouldSense=function(n){return 0!=(this.sensorMask&n.sensorGroup)&&0!=(n.sensorMask&this.sensorGroup)},vt.prototype.fluidGroup=null,vt.prototype.fluidMask=null,vt.prototype.shouldFlow=function(n){return 0!=(this.fluidMask&n.fluidGroup)&&0!=(n.fluidMask&this.fluidGroup)},vt.prototype.invalidate=function(){for(var n=this.shapes.head;null!=n;)n.elt.invalidate_filter(),n=n.next},vt.prototype.__class__=vt;var mt=zpp_nape.dynamics.ZPP_InteractionGroup=function(){this.depth=0,this.wrap_interactors=null,this.interactors=null,this.wrap_groups=null,this.groups=null,this.group=null,this.ignore=!1,this.outer=null,this.depth=0,this.groups=new Le,this.interactors=new Tn};mt.__name__=["zpp_nape","dynamics","ZPP_InteractionGroup"],mt.prototype.outer=null,mt.prototype.ignore=null,mt.prototype.group=null,mt.prototype.setGroup=function(n){this.group!=n&&(null!=this.group&&(this.group.groups.remove(this),this.depth=0,this.group.invalidate(!0)),null!=(this.group=n)?(n.groups.add(this),this.depth=n.depth+1,n.invalidate(!0)):this.invalidate(!0))},mt.prototype.groups=null,mt.prototype.wrap_groups=null,mt.prototype.interactors=null,mt.prototype.wrap_interactors=null,mt.prototype.depth=null,mt.prototype.invalidate=function(n){if(null==n&&(n=!1),n||this.ignore){for(var t=this.interactors.head;null!=t;){var e=t.elt;null!=e.ibody?e.ibody.wake():null!=e.ishape?e.ishape.body.wake():e.icompound.wake(),t=t.next}for(var i=this.groups.head;null!=i;)i.elt.invalidate(n),i=i.next}},mt.prototype.addGroup=function(n){this.groups.add(n),n.depth=this.depth+1},mt.prototype.remGroup=function(n){this.groups.remove(n),n.depth=0},mt.prototype.addInteractor=function(n){this.interactors.add(n)},mt.prototype.remInteractor=function(n,t){null==t&&(t=-1),this.interactors.remove(n)},mt.prototype.__class__=mt;var ft=zpp_nape.dynamics.ZPP_SpaceArbiterList=function(){this.at_index_3=0,this.at_index_2=0,this.at_index_1=0,this.at_index_0=0,this.ite_3=null,this.ite_2=null,this.ite_1=null,this.ite_0=null,this.lengths=null,this.zip_length=!1,this._length=0,this.space=null,E.call(this),this.at_index_0=0,this.at_index_1=0,this.at_index_2=0,this.at_index_3=0,this.zip_length=!0,this._length=0,this.lengths=[];for(var n=0;n<4;)++n,this.lengths.push(0)};ft.__name__=["zpp_nape","dynamics","ZPP_SpaceArbiterList"],ft.__super__=E,ft.prototype=Object.create(E.prototype),ft.prototype.space=null,ft.prototype._length=null,ft.prototype.zip_length=null,ft.prototype.zpp_gl=function(){if(this.zpp_vm(),this.zip_length){for(var n=this._length=0,t=this.space.c_arbiters_true.head;null!=t;)t.elt.active&&++n,t=t.next;this.lengths[0]=n,this._length+=n;for(var e=0,i=this.space.c_arbiters_false.head;null!=i;)i.elt.active&&++e,i=i.next;this.lengths[1]=e,this._length+=e;for(var p=0,l=this.space.f_arbiters.head;null!=l;)l.elt.active&&++p,l=l.next;this.lengths[2]=p,this._length+=p;for(var r=0,o=this.space.s_arbiters.head;null!=o;)o.elt.active&&++r,o=o.next;this.lengths[3]=r,this._length+=r,this.zip_length=!1}return this._length},ft.prototype.lengths=null,ft.prototype.ite_0=null,ft.prototype.ite_1=null,ft.prototype.ite_2=null,ft.prototype.ite_3=null,ft.prototype.at_index_0=null,ft.prototype.at_index_1=null,ft.prototype.at_index_2=null,ft.prototype.at_index_3=null,ft.prototype.zpp_vm=function(){var n=!1;this.space.c_arbiters_true.modified&&(n=!0,this.space.c_arbiters_true.modified=!1),this.space.c_arbiters_false.modified&&(n=!0,this.space.c_arbiters_false.modified=!1),this.space.f_arbiters.modified&&(n=!0,this.space.f_arbiters.modified=!1),this.space.s_arbiters.modified&&(n=!0,this.space.s_arbiters.modified=!1),n&&(this.zip_length=!0,this._length=0,this.ite_0=null,this.ite_1=null,this.ite_2=null,this.ite_3=null)},ft.prototype.push=function(n){return!1},ft.prototype.pop=function(){return null},ft.prototype.unshift=function(n){return!1},ft.prototype.shift=function(){return null},ft.prototype.remove=function(n){return!1},ft.prototype.clear=function(){},ft.prototype.at=function(n){this.zpp_vm();var t=null,e=0;if(null==t)if(n<this.lengths[0]){var i=n;if(i<this.at_index_0||null==this.ite_0)for(this.at_index_0=0,this.ite_0=this.space.c_arbiters_true.head;!this.ite_0.elt.active;)this.ite_0=this.ite_0.next;for(;this.at_index_0!=i;)for(this.at_index_0++,this.ite_0=this.ite_0.next;!this.ite_0.elt.active;)this.ite_0=this.ite_0.next;t=this.ite_0.elt.wrapper()}else e=this.lengths[0];if(null==t)if(n<e+this.lengths[1]){var p=n-e;if(p<this.at_index_1||null==this.ite_1)for(this.at_index_1=0,this.ite_1=this.space.c_arbiters_false.head;!this.ite_1.elt.active;)this.ite_1=this.ite_1.next;for(;this.at_index_1!=p;)for(this.at_index_1++,this.ite_1=this.ite_1.next;!this.ite_1.elt.active;)this.ite_1=this.ite_1.next;t=this.ite_1.elt.wrapper()}else e+=this.lengths[1];if(null==t)if(n<e+this.lengths[2]){var l=n-e;if(l<this.at_index_2||null==this.ite_2)for(this.at_index_2=0,this.ite_2=this.space.f_arbiters.head;!this.ite_2.elt.active;)this.ite_2=this.ite_2.next;for(;this.at_index_2!=l;)for(this.at_index_2++,this.ite_2=this.ite_2.next;!this.ite_2.elt.active;)this.ite_2=this.ite_2.next;t=this.ite_2.elt.wrapper()}else e+=this.lengths[2];if(null==t)if(n<e+this.lengths[3]){var r=n-e;if(r<this.at_index_3||null==this.ite_3)for(this.at_index_3=0,this.ite_3=this.space.s_arbiters.head;!this.ite_3.elt.active;)this.ite_3=this.ite_3.next;for(;this.at_index_3!=r;)for(this.at_index_3++,this.ite_3=this.ite_3.next;!this.ite_3.elt.active;)this.ite_3=this.ite_3.next;t=this.ite_3.elt.wrapper()}else e+=this.lengths[3];return t},ft.prototype.__class__=ft;var Al=zpp_nape.geom.ZPP_AABB=function(){this.wrap_max=null,this.maxy=0,this.maxx=0,this.wrap_min=null,this.miny=0,this.minx=0,this.next=null,this.outer=null,this._immutable=!1,this._validate=null,this._invalidate=null};Al.__name__=["zpp_nape","geom","ZPP_AABB"],Al.get=function(n,t,e,i){var p;return null==Al.zpp_pool?p=new Al:(p=Al.zpp_pool,Al.zpp_pool=p.next,p.next=null),p.minx=n,p.miny=t,p.maxx=e,p.maxy=i,p},Al.prototype._invalidate=null,Al.prototype._validate=null,Al.prototype._immutable=null,Al.prototype.validate=function(){null!=this._validate&&this._validate()},Al.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate(this)},Al.prototype.outer=null,Al.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new Z,null!=(n=this.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Al.zpp_pool,Al.zpp_pool=n,this.outer.zpp_inner=this),this.outer},Al.prototype.next=null,Al.prototype.alloc=function(){},Al.prototype.free=function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this.wrap_min=this.wrap_max=null,this._invalidate=null,this._validate=null},Al.prototype.copy=function(){var n,t=this.minx,e=this.miny,i=this.maxx,p=this.maxy;return null==Al.zpp_pool?n=new Al:(n=Al.zpp_pool,Al.zpp_pool=n.next,n.next=null),n.minx=t,n.miny=e,n.maxx=i,n.maxy=p,n},Al.prototype.width=function(){return this.maxx-this.minx},Al.prototype.height=function(){return this.maxy-this.miny},Al.prototype.perimeter=function(){return 2*(this.maxx-this.minx+(this.maxy-this.miny))},Al.prototype.minx=null,Al.prototype.miny=null,Al.prototype.wrap_min=null,Al.prototype.getmin=function(){var n,t,e,i,p,l,r;return null==this.wrap_min&&(n=this.minx,t=this.miny,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,this.wrap_min=e,this.wrap_min.zpp_inner._inuse=!0,this._immutable?this.wrap_min.zpp_inner._immutable=!0:this.wrap_min.zpp_inner._invalidate=Q(this,this.mod_min),this.wrap_min.zpp_inner._validate=Q(this,this.dom_min)),this.wrap_min},Al.prototype.dom_min=function(){null!=this._validate&&this._validate(),this.wrap_min.zpp_inner.x=this.minx,this.wrap_min.zpp_inner.y=this.miny},Al.prototype.mod_min=function(n){n.x==this.minx&&n.y==this.miny||(this.minx=n.x,this.miny=n.y,null!=this._invalidate&&this._invalidate(this))},Al.prototype.maxx=null,Al.prototype.maxy=null,Al.prototype.wrap_max=null,Al.prototype.getmax=function(){var n,t,e,i,p,l,r;return null==this.wrap_max&&(n=this.maxx,t=this.maxy,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,this.wrap_max=e,this.wrap_max.zpp_inner._inuse=!0,this._immutable?this.wrap_max.zpp_inner._immutable=!0:this.wrap_max.zpp_inner._invalidate=Q(this,this.mod_max),this.wrap_max.zpp_inner._validate=Q(this,this.dom_max)),this.wrap_max},Al.prototype.dom_max=function(){null!=this._validate&&this._validate(),this.wrap_max.zpp_inner.x=this.maxx,this.wrap_max.zpp_inner.y=this.maxy},Al.prototype.mod_max=function(n){n.x==this.maxx&&n.y==this.maxy||(this.maxx=n.x,this.maxy=n.y,null!=this._invalidate&&this._invalidate(this))},Al.prototype.intersectX=function(n){return!(n.minx>this.maxx||this.minx>n.maxx)},Al.prototype.intersectY=function(n){return!(n.miny>this.maxy||this.miny>n.maxy)},Al.prototype.intersect=function(n){return n.miny<=this.maxy&&this.miny<=n.maxy&&n.minx<=this.maxx&&this.minx<=n.maxx},Al.prototype.combine=function(n){n.minx<this.minx&&(this.minx=n.minx),n.maxx>this.maxx&&(this.maxx=n.maxx),n.miny<this.miny&&(this.miny=n.miny),n.maxy>this.maxy&&(this.maxy=n.maxy)},Al.prototype.contains=function(n){return n.minx>=this.minx&&n.miny>=this.miny&&n.maxx<=this.maxx&&n.maxy<=this.maxy},Al.prototype.containsPoint=function(n){return n.x>=this.minx&&n.x<=this.maxx&&n.y>=this.miny&&n.y<=this.maxy},Al.prototype.setCombine=function(n,t){this.minx=n.minx<t.minx?n.minx:t.minx,this.miny=n.miny<t.miny?n.miny:t.miny,this.maxx=n.maxx>t.maxx?n.maxx:t.maxx,this.maxy=n.maxy>t.maxy?n.maxy:t.maxy},Al.prototype.setExpand=function(n,t){this.minx=n.minx-t,this.miny=n.miny-t,this.maxx=n.maxx+t,this.maxy=n.maxy+t},Al.prototype.setExpandPoint=function(n,t){n<this.minx&&(this.minx=n),n>this.maxx&&(this.maxx=n),t<this.miny&&(this.miny=t),t>this.maxy&&(this.maxy=t)},Al.prototype.toString=function(){return"{ x: "+this.minx+" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},Al.prototype.__class__=Al;var bt=zpp_nape.util.ZNPList_ZPP_Vec2=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};bt.__name__=["zpp_nape","util","ZNPList_ZPP_Vec2"],bt.prototype.head=null,bt.prototype.begin=function(){return this.head},bt.prototype.modified=null,bt.prototype.pushmod=null,bt.prototype.length=null,bt.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},bt.prototype.add=function(n){var t;null==li.zpp_pool?t=new li:(t=li.zpp_pool,li.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},bt.prototype.inlined_add=function(n){var t;null==li.zpp_pool?t=new li:(t=li.zpp_pool,li.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},bt.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},bt.prototype.insert=function(n,t){var e;null==li.zpp_pool?e=new li:(e=li.zpp_pool,li.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},bt.prototype.inlined_insert=function(n,t){var e;null==li.zpp_pool?e=new li:(e=li.zpp_pool,li.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},bt.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=li.zpp_pool,li.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},bt.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=li.zpp_pool,li.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},bt.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},bt.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},bt.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=li.zpp_pool,li.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},bt.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},bt.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=li.zpp_pool,li.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},bt.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=li.zpp_pool,li.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},bt.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=li.zpp_pool,li.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},bt.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=li.zpp_pool,li.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},bt.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},bt.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=li.zpp_pool,li.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},bt.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=li.zpp_pool,li.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},bt.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},bt.prototype.empty=function(){return null==this.head},bt.prototype.size=function(){return this.length},bt.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},bt.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},bt.prototype.front=function(){return this.head.elt},bt.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},bt.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},bt.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},bt.prototype.__class__=bt;var vo=zpp_nape.geom.ZPP_Collide=function(){};vo.__name__=["zpp_nape","geom","ZPP_Collide"],vo.circleContains=function(n,t){var e=0,i=0;return(e=t.x-n.worldCOMx)*e+(i=t.y-n.worldCOMy)*i<n.radius*n.radius},vo.polyContains=function(n,t){for(var e=!0,i=n.edges.head;null!=i;){var p=i.elt;if(!(p.gnormx*t.x+p.gnormy*t.y<=p.gprojection)){e=!1;break}i=i.next}return e},vo.shapeContains=function(n,t){return 0==n.type?vo.circleContains(n.circle,t):vo.polyContains(n.polygon,t)},vo.bodyContains=function(n,t){for(var e=!1,i=n.shapes.head;null!=i;){if(vo.shapeContains(i.elt,t)){e=!0;break}i=i.next}return e},vo.containTest=function(n,t){var e=n.aabb,i=t.aabb;if(i.minx>=e.minx&&i.miny>=e.miny&&i.maxx<=e.maxx&&i.maxy<=e.maxy){if(0==n.type){if(0==t.type){var p=n.circle.radius+-t.circle.radius,l=0,r=0;return(l=t.circle.worldCOMx-n.circle.worldCOMx)*l+(r=t.circle.worldCOMy-n.circle.worldCOMy)*r<=p*p}for(var o=!0,a=t.polygon.gverts.next;null!=a;){var s=n.circle.radius,_=0,h=0;if(!((_=a.x-n.circle.worldCOMx)*_+(h=a.y-n.circle.worldCOMy)*h<=s*s)){o=!1;break}a=a.next}return o}if(0==t.type){for(var u=!0,x=n.polygon.edges.head;null!=x;){var d=x.elt;if(!(d.gnormx*t.circle.worldCOMx+d.gnormy*t.circle.worldCOMy+t.circle.radius<=d.gprojection)){u=!1;break}x=x.next}return u}for(var y=!0,z=n.polygon.edges.head;null!=z;){for(var c=z.elt,v=-1e100,m=t.polygon.gverts.next;null!=m;){var f=c.gnormx*m.x+c.gnormy*m.y;v<f&&(v=f),m=m.next}if(!(v<=c.gprojection)){y=!1;break}z=z.next}return y}return!1},vo.contactCollide=function(n,t,e,i){if(1==t.type){if(1==n.type){for(var p=!0,l=-1e100,r=-1,o=null,a=null,s=n.polygon.edges.head;null!=s;){for(var _=s.elt,h=1e100,u=t.polygon.gverts.next;null!=u;){var x=_.gnormx*u.x+_.gnormy*u.y;if(x<h&&(h=x),h-_.gprojection<=l)break;u=u.next}if(0<=(h-=_.gprojection)){p=!1;break}l<h&&(l=h,o=_,r=1),s=s.next}if(p){for(var d=t.polygon.edges.head;null!=d;){for(var y=d.elt,z=1e100,c=n.polygon.gverts.next;null!=c;){var v=y.gnormx*c.x+y.gnormy*c.y;if(v<z&&(z=v),z-y.gprojection<=l)break;c=c.next}if(0<=(z-=y.gprojection)){p=!1;break}l<z&&(l=z,a=y,r=2),d=d.next}if(p){for(var m,f,b=1==r?(m=t.polygon,f=o,1):(m=n.polygon,f=a,-1),g=null,w=1e100,M=m.edges.head;null!=M;){var C=M.elt,k=f.gnormx*C.gnormx+f.gnormy*C.gnormy;k<w&&(w=k,g=C),M=M.next}var O=0,P=0,O=g.gp0.x,P=g.gp0.y,S=0,A=0,j=(S=g.gp1.x)-O,E=(A=g.gp1.y)-P,I=f.gnormy*O-f.gnormx*P,T=f.gnormy*S-f.gnormx*A,N=1/(T-I),L=(-f.tp1-I)*N;L>co.epsilon&&(O+=j*L,P+=E*L);var V=(-f.tp0-T)*N;V<-co.epsilon&&(S+=j*V,A+=E*V);var D=0,F=0,D=f.gnormx*b,F=f.gnormy*b;e.lnormx=f.lnormx,e.lnormy=f.lnormy,e.lproj=f.lprojection,e.radius=0,e.rev=i!=(-1==b),e.ptype=e.rev?1:0;var R=O*f.gnormx+P*f.gnormy-f.gprojection,Z=S*f.gnormx+A*f.gnormy-f.gprojection;if(0<R&&0<Z)return!1;i&&(D=-D,F=-F);for(var B,G,q,U=O-f.gnormx*R*.5,K=P-f.gnormy*R*.5,W=e.rev?1:0,Y=null,J=e.contacts.next;null!=J;){if(W==J.hash){Y=J;break}J=J.next}null==Y?(null==Rl.zpp_pool?Y=new Rl:(Y=Rl.zpp_pool,Rl.zpp_pool=Y.next,Y.next=null),(B=Y.inner).jnAcc=B.jtAcc=0,Y.hash=W,Y.fresh=!0,(Y.arbiter=e).jrAcc=0,G=e.contacts,Y._inuse=!0,(q=Y).next=G.next,G.next=q,G.modified=!0,G.length++,e.innards.add(B)):Y.fresh=!1,Y.px=U,Y.py=K,e.nx=D,e.ny=F,Y.dist=R,Y.stamp=e.stamp,Y.posOnly=0<R;var X=Y;O-=m.body.posx,P-=m.body.posy,X.inner.lr1x=O*m.body.axisy+P*m.body.axisx,X.inner.lr1y=P*m.body.axisy-O*m.body.axisx;for(var H,$,Q,nn=S-f.gnormx*Z*.5,tn=A-f.gnormy*Z*.5,en=e.rev?0:1,pn=null,ln=e.contacts.next;null!=ln;){if(en==ln.hash){pn=ln;break}ln=ln.next}return null==pn?(null==Rl.zpp_pool?pn=new Rl:(pn=Rl.zpp_pool,Rl.zpp_pool=pn.next,pn.next=null),(H=pn.inner).jnAcc=H.jtAcc=0,pn.hash=en,pn.fresh=!0,(pn.arbiter=e).jrAcc=0,$=e.contacts,pn._inuse=!0,(Q=pn).next=$.next,$.next=Q,$.modified=!0,$.length++,e.innards.add(H)):pn.fresh=!1,pn.px=nn,pn.py=tn,e.nx=D,e.ny=F,pn.dist=Z,pn.stamp=e.stamp,pn.posOnly=0<Z,X=pn,S-=m.body.posx,A-=m.body.posy,X.inner.lr1x=S*m.body.axisy+A*m.body.axisx,X.inner.lr1y=A*m.body.axisy-S*m.body.axisx,1==r?(e.__ref_edge1=f,e.__ref_edge2=g):(e.__ref_edge2=f,e.__ref_edge1=g),!0}return!1}return!1}for(var rn=-1e100,on=!0,an=null,sn=null,_n=t.polygon.gverts.next,hn=t.polygon.edges.head;null!=hn;){var un=hn.elt,xn=un.gnormx*n.circle.worldCOMx+un.gnormy*n.circle.worldCOMy-un.gprojection-n.circle.radius;if(0<xn){on=!1;break}rn<xn&&(rn=xn,an=un,sn=_n),_n=_n.next,hn=hn.next}if(on){var dn=sn,yn=null==sn.next?t.polygon.gverts.next:sn.next,zn=n.circle.worldCOMy*an.gnormx-n.circle.worldCOMx*an.gnormy;if(zn<=dn.y*an.gnormx-dn.x*an.gnormy){var cn,vn,mn,fn,bn=n.circle.radius,gn=0,wn=0,Mn=(gn=dn.x-n.circle.worldCOMx)*gn+(wn=dn.y-n.circle.worldCOMy)*wn;if(bn*bn<Mn)cn=null;else if(Mn<co.epsilon*co.epsilon){for(var Cn,kn,On,Pn=n.circle.worldCOMx,Sn=n.circle.worldCOMy,An=null,jn=e.contacts.next;null!=jn;){if(0==jn.hash){An=jn;break}jn=jn.next}null==An?(null==Rl.zpp_pool?An=new Rl:(An=Rl.zpp_pool,Rl.zpp_pool=An.next,An.next=null),(Cn=An.inner).jnAcc=Cn.jtAcc=0,An.hash=0,An.fresh=!0,(An.arbiter=e).jrAcc=0,kn=e.contacts,An._inuse=!0,(On=An).next=kn.next,kn.next=On,kn.modified=!0,kn.length++,e.innards.add(Cn)):An.fresh=!1,An.px=Pn,An.py=Sn,e.nx=1,e.ny=0,An.dist=-bn,An.stamp=e.stamp,An.posOnly=!1,cn=An}else{var En=1/Math.sqrt(Mn),In=En<co.epsilon?1e100:1/En,Tn=.5+(n.circle.radius-.5*bn)*En;if(i){for(var Nn,Ln,Vn,Dn=n.circle.worldCOMx+gn*Tn,Fn=n.circle.worldCOMy+wn*Tn,Rn=null,Zn=e.contacts.next;null!=Zn;){if(0==Zn.hash){Rn=Zn;break}Zn=Zn.next}null==Rn?(null==Rl.zpp_pool?Rn=new Rl:(Rn=Rl.zpp_pool,Rl.zpp_pool=Rn.next,Rn.next=null),(Nn=Rn.inner).jnAcc=Nn.jtAcc=0,Rn.hash=0,Rn.fresh=!0,(Rn.arbiter=e).jrAcc=0,Ln=e.contacts,Rn._inuse=!0,(Vn=Rn).next=Ln.next,Ln.next=Vn,Ln.modified=!0,Ln.length++,e.innards.add(Nn)):Rn.fresh=!1,Rn.px=Dn,Rn.py=Fn,e.nx=-gn*En,e.ny=-wn*En,Rn.dist=In-bn,Rn.stamp=e.stamp,Rn.posOnly=!1,cn=Rn}else{for(var Bn,Gn,qn,Un=n.circle.worldCOMx+gn*Tn,Kn=n.circle.worldCOMy+wn*Tn,Wn=null,Yn=e.contacts.next;null!=Yn;){if(0==Yn.hash){Wn=Yn;break}Yn=Yn.next}null==Wn?(null==Rl.zpp_pool?Wn=new Rl:(Wn=Rl.zpp_pool,Rl.zpp_pool=Wn.next,Wn.next=null),(Bn=Wn.inner).jnAcc=Bn.jtAcc=0,Wn.hash=0,Wn.fresh=!0,(Wn.arbiter=e).jrAcc=0,Gn=e.contacts,Wn._inuse=!0,(qn=Wn).next=Gn.next,Gn.next=qn,Gn.modified=!0,Gn.length++,e.innards.add(Bn)):Wn.fresh=!1,Wn.px=Un,Wn.py=Kn,e.nx=gn*En,e.ny=wn*En,Wn.dist=In-bn,Wn.stamp=e.stamp,Wn.posOnly=!1,cn=Wn}}return null!=cn&&(vn=cn.inner,e.ptype=2,fn=mn=0,mn=dn.x-t.polygon.body.posx,fn=dn.y-t.polygon.body.posy,e.__ref_edge1=an,e.__ref_vertex=-1,i?(vn.lr1x=mn*t.polygon.body.axisy+fn*t.polygon.body.axisx,vn.lr1y=fn*t.polygon.body.axisy-mn*t.polygon.body.axisx,vn.lr2x=n.circle.localCOMx,vn.lr2y=n.circle.localCOMy):(vn.lr2x=mn*t.polygon.body.axisy+fn*t.polygon.body.axisx,vn.lr2y=fn*t.polygon.body.axisy-mn*t.polygon.body.axisx,vn.lr1x=n.circle.localCOMx,vn.lr1y=n.circle.localCOMy),e.radius=n.circle.radius),null!=cn}if(zn>=yn.y*an.gnormx-yn.x*an.gnormy){var Jn,Xn,Hn,$n,Qn=n.circle.radius,nt=0,tt=0,et=(nt=yn.x-n.circle.worldCOMx)*nt+(tt=yn.y-n.circle.worldCOMy)*tt;if(Qn*Qn<et)Jn=null;else if(et<co.epsilon*co.epsilon){for(var it,pt,lt,rt=n.circle.worldCOMx,ot=n.circle.worldCOMy,at=null,st=e.contacts.next;null!=st;){if(0==st.hash){at=st;break}st=st.next}null==at?(null==Rl.zpp_pool?at=new Rl:(at=Rl.zpp_pool,Rl.zpp_pool=at.next,at.next=null),(it=at.inner).jnAcc=it.jtAcc=0,at.hash=0,at.fresh=!0,(at.arbiter=e).jrAcc=0,pt=e.contacts,at._inuse=!0,(lt=at).next=pt.next,pt.next=lt,pt.modified=!0,pt.length++,e.innards.add(it)):at.fresh=!1,at.px=rt,at.py=ot,e.nx=1,e.ny=0,at.dist=-Qn,at.stamp=e.stamp,at.posOnly=!1,Jn=at}else{var _t=1/Math.sqrt(et),ht=_t<co.epsilon?1e100:1/_t,ut=.5+(n.circle.radius-.5*Qn)*_t;if(i){for(var xt,dt,yt,zt=n.circle.worldCOMx+nt*ut,ct=n.circle.worldCOMy+tt*ut,vt=null,mt=e.contacts.next;null!=mt;){if(0==mt.hash){vt=mt;break}mt=mt.next}null==vt?(null==Rl.zpp_pool?vt=new Rl:(vt=Rl.zpp_pool,Rl.zpp_pool=vt.next,vt.next=null),(xt=vt.inner).jnAcc=xt.jtAcc=0,vt.hash=0,vt.fresh=!0,(vt.arbiter=e).jrAcc=0,dt=e.contacts,vt._inuse=!0,(yt=vt).next=dt.next,dt.next=yt,dt.modified=!0,dt.length++,e.innards.add(xt)):vt.fresh=!1,vt.px=zt,vt.py=ct,e.nx=-nt*_t,e.ny=-tt*_t,vt.dist=ht-Qn,vt.stamp=e.stamp,vt.posOnly=!1,Jn=vt}else{for(var ft,bt,gt,wt=n.circle.worldCOMx+nt*ut,Mt=n.circle.worldCOMy+tt*ut,Ct=null,kt=e.contacts.next;null!=kt;){if(0==kt.hash){Ct=kt;break}kt=kt.next}null==Ct?(null==Rl.zpp_pool?Ct=new Rl:(Ct=Rl.zpp_pool,Rl.zpp_pool=Ct.next,Ct.next=null),(ft=Ct.inner).jnAcc=ft.jtAcc=0,Ct.hash=0,Ct.fresh=!0,(Ct.arbiter=e).jrAcc=0,bt=e.contacts,Ct._inuse=!0,(gt=Ct).next=bt.next,bt.next=gt,bt.modified=!0,bt.length++,e.innards.add(ft)):Ct.fresh=!1,Ct.px=wt,Ct.py=Mt,e.nx=nt*_t,e.ny=tt*_t,Ct.dist=ht-Qn,Ct.stamp=e.stamp,Ct.posOnly=!1,Jn=Ct}}return null!=Jn&&(Xn=Jn.inner,e.ptype=2,$n=Hn=0,Hn=yn.x-t.polygon.body.posx,$n=yn.y-t.polygon.body.posy,e.__ref_edge1=an,e.__ref_vertex=1,i?(Xn.lr1x=Hn*t.polygon.body.axisy+$n*t.polygon.body.axisx,Xn.lr1y=$n*t.polygon.body.axisy-Hn*t.polygon.body.axisx,Xn.lr2x=n.circle.localCOMx,Xn.lr2y=n.circle.localCOMy):(Xn.lr2x=Hn*t.polygon.body.axisy+$n*t.polygon.body.axisx,Xn.lr2y=$n*t.polygon.body.axisy-Hn*t.polygon.body.axisx,Xn.lr1x=n.circle.localCOMx,Xn.lr1y=n.circle.localCOMy),e.radius=n.circle.radius),null!=Jn}var Ot,Pt=n.circle.radius+.5*rn,St=an.gnormx*Pt,At=an.gnormy*Pt,jt=n.circle.worldCOMx-St,Et=n.circle.worldCOMy-At;if(i){for(var It,Tt,Nt,Lt=an.gnormx,Vt=an.gnormy,Dt=null,Ft=e.contacts.next;null!=Ft;){if(0==Ft.hash){Dt=Ft;break}Ft=Ft.next}null==Dt?(null==Rl.zpp_pool?Dt=new Rl:(Dt=Rl.zpp_pool,Rl.zpp_pool=Dt.next,Dt.next=null),(It=Dt.inner).jnAcc=It.jtAcc=0,Dt.hash=0,Dt.fresh=!0,(Dt.arbiter=e).jrAcc=0,Tt=e.contacts,Dt._inuse=!0,(Nt=Dt).next=Tt.next,Tt.next=Nt,Tt.modified=!0,Tt.length++,e.innards.add(It)):Dt.fresh=!1,Dt.px=jt,Dt.py=Et,e.nx=Lt,e.ny=Vt,Dt.dist=rn,Dt.stamp=e.stamp,Dt.posOnly=!1,Ot=Dt}else{for(var Rt,Zt,Bt,Gt=-an.gnormx,qt=-an.gnormy,Ut=null,Kt=e.contacts.next;null!=Kt;){if(0==Kt.hash){Ut=Kt;break}Kt=Kt.next}null==Ut?(null==Rl.zpp_pool?Ut=new Rl:(Ut=Rl.zpp_pool,Rl.zpp_pool=Ut.next,Ut.next=null),(Rt=Ut.inner).jnAcc=Rt.jtAcc=0,Ut.hash=0,Ut.fresh=!0,(Ut.arbiter=e).jrAcc=0,Zt=e.contacts,Ut._inuse=!0,(Bt=Ut).next=Zt.next,Zt.next=Bt,Zt.modified=!0,Zt.length++,e.innards.add(Rt)):Ut.fresh=!1,Ut.px=jt,Ut.py=Et,e.nx=Gt,e.ny=qt,Ut.dist=rn,Ut.stamp=e.stamp,Ut.posOnly=!1,Ot=Ut}return e.ptype=i?0:1,e.lnormx=an.lnormx,e.lnormy=an.lnormy,e.rev=!i,e.lproj=an.lprojection,e.radius=n.circle.radius,Ot.inner.lr1x=n.circle.localCOMx,Ot.inner.lr1y=n.circle.localCOMy,e.__ref_edge1=an,!(e.__ref_vertex=0)}return!1}var Wt,Yt=n.circle.radius+t.circle.radius,Jt=0,Xt=0,Ht=(Jt=t.circle.worldCOMx-n.circle.worldCOMx)*Jt+(Xt=t.circle.worldCOMy-n.circle.worldCOMy)*Xt;if(Yt*Yt<Ht)Wt=null;else if(Ht<co.epsilon*co.epsilon){for(var $t,Qt,ne,te=n.circle.worldCOMx,ee=n.circle.worldCOMy,ie=null,pe=e.contacts.next;null!=pe;){if(0==pe.hash){ie=pe;break}pe=pe.next}null==ie?(null==Rl.zpp_pool?ie=new Rl:(ie=Rl.zpp_pool,Rl.zpp_pool=ie.next,ie.next=null),($t=ie.inner).jnAcc=$t.jtAcc=0,ie.hash=0,ie.fresh=!0,(ie.arbiter=e).jrAcc=0,Qt=e.contacts,ie._inuse=!0,(ne=ie).next=Qt.next,Qt.next=ne,Qt.modified=!0,Qt.length++,e.innards.add($t)):ie.fresh=!1,ie.px=te,ie.py=ee,e.nx=1,e.ny=0,ie.dist=-Yt,ie.stamp=e.stamp,ie.posOnly=!1,Wt=ie}else{var le=1/Math.sqrt(Ht),re=le<co.epsilon?1e100:1/le,oe=.5+(n.circle.radius-.5*Yt)*le;if(i){for(var ae,se,_e,he=n.circle.worldCOMx+Jt*oe,ue=n.circle.worldCOMy+Xt*oe,xe=null,de=e.contacts.next;null!=de;){if(0==de.hash){xe=de;break}de=de.next}null==xe?(null==Rl.zpp_pool?xe=new Rl:(xe=Rl.zpp_pool,Rl.zpp_pool=xe.next,xe.next=null),(ae=xe.inner).jnAcc=ae.jtAcc=0,xe.hash=0,xe.fresh=!0,(xe.arbiter=e).jrAcc=0,se=e.contacts,xe._inuse=!0,(_e=xe).next=se.next,se.next=_e,se.modified=!0,se.length++,e.innards.add(ae)):xe.fresh=!1,xe.px=he,xe.py=ue,e.nx=-Jt*le,e.ny=-Xt*le,xe.dist=re-Yt,xe.stamp=e.stamp,xe.posOnly=!1,Wt=xe}else{for(var ye,ze,ce,ve=n.circle.worldCOMx+Jt*oe,me=n.circle.worldCOMy+Xt*oe,fe=null,be=e.contacts.next;null!=be;){if(0==be.hash){fe=be;break}be=be.next}null==fe?(null==Rl.zpp_pool?fe=new Rl:(fe=Rl.zpp_pool,Rl.zpp_pool=fe.next,fe.next=null),(ye=fe.inner).jnAcc=ye.jtAcc=0,fe.hash=0,fe.fresh=!0,(fe.arbiter=e).jrAcc=0,ze=e.contacts,fe._inuse=!0,(ce=fe).next=ze.next,ze.next=ce,ze.modified=!0,ze.length++,e.innards.add(ye)):fe.fresh=!1,fe.px=ve,fe.py=me,e.nx=Jt*le,e.ny=Xt*le,fe.dist=re-Yt,fe.stamp=e.stamp,fe.posOnly=!1,Wt=fe}}if(null==Wt)return!1;var ge=Wt.inner;return i?(ge.lr1x=t.circle.localCOMx,ge.lr1y=t.circle.localCOMy,ge.lr2x=n.circle.localCOMx,ge.lr2y=n.circle.localCOMy):(ge.lr1x=n.circle.localCOMx,ge.lr1y=n.circle.localCOMy,ge.lr2x=t.circle.localCOMx,ge.lr2y=t.circle.localCOMy),e.radius=n.circle.radius+t.circle.radius,e.ptype=2,!0},vo.testCollide_safe=function(n,t){var e;return 0==t.type&&(e=n,n=t,t=e),vo.testCollide(n,t)},vo.testCollide=function(n,t){if(1==t.type){if(1==n.type){for(var e=!0,i=n.polygon.edges.head;null!=i;){for(var p=i.elt,l=1e100,r=t.polygon.gverts.next;null!=r;){var o=p.gnormx*r.x+p.gnormy*r.y;o<l&&(l=o),r=r.next}if(0<(l-=p.gprojection)){e=!1;break}i=i.next}if(e){for(var a=t.polygon.edges.head;null!=a;){for(var s=a.elt,_=1e100,h=n.polygon.gverts.next;null!=h;){var u=s.gnormx*h.x+s.gnormy*h.y;u<_&&(_=u),h=h.next}if(0<(_-=s.gprojection)){e=!1;break}a=a.next}return e}return!1}for(var x=null,d=null,y=!0,z=-1e100,c=t.polygon.gverts.next,v=t.polygon.edges.head;null!=v;){var m=v.elt,f=m.gnormx*n.circle.worldCOMx+m.gnormy*n.circle.worldCOMy-m.gprojection-n.circle.radius;if(0<f){y=!1;break}z<f&&(z=f,x=m,d=c),c=c.next,v=v.next}if(y){var b=null==d.next?t.polygon.gverts.next:d.next,g=n.circle.worldCOMy*x.gnormx-n.circle.worldCOMx*x.gnormy;if(g<=d.y*x.gnormx-d.x*x.gnormy){var w=n.circle.radius,M=0,C=0;return(M=d.x-n.circle.worldCOMx)*M+(C=d.y-n.circle.worldCOMy)*C<=w*w}if(g>=b.y*x.gnormx-b.x*x.gnormy){var k=n.circle.radius,O=0,P=0;return(O=b.x-n.circle.worldCOMx)*O+(P=b.y-n.circle.worldCOMy)*P<=k*k}return!0}return!1}var S=n.circle.radius+t.circle.radius,A=0,j=0;return(A=t.circle.worldCOMx-n.circle.worldCOMx)*A+(j=t.circle.worldCOMy-n.circle.worldCOMy)*j<=S*S},vo.flowCollide=function(n,t,e){if(1==t.type){if(1==n.type){for(var i=[],p=[],l=!0,r=!0,o=n.polygon.edges.head;null!=o;){for(var a=o.elt,s=1e100,_=0,h=t.polygon.gverts.next;null!=h;){var u=a.gnormx*h.x+a.gnormy*h.y;u<s&&(s=u),u>=a.gprojection+co.epsilon&&(r=!(p[_]=!0)),++_,h=h.next}if(0<(s-=a.gprojection)){l=!1;break}o=o.next}if(r){var x=t.polygon;if(x.zip_worldCOM&&null!=x.body){if(x.zip_worldCOM=!1,x.zip_localCOM){if(x.zip_localCOM=!1,1==x.type){var d=x.polygon;if(null==d.lverts.next.next)d.localCOMx=d.lverts.next.x,d.localCOMy=d.lverts.next.y;else if(null==d.lverts.next.next.next)d.localCOMx=d.lverts.next.x,d.localCOMy=d.lverts.next.y,d.localCOMx+=d.lverts.next.next.x,d.localCOMy+=d.lverts.next.next.y,d.localCOMx*=.5,d.localCOMy*=.5;else{d.localCOMx=0;var y=d.localCOMy=0,z=d.lverts.next,c=z,v=z=z.next;for(z=z.next;null!=z;){var m=z;y+=v.x*(m.y-c.y);var f=m.y*v.x-m.x*v.y;d.localCOMx+=(v.x+m.x)*f,d.localCOMy+=(v.y+m.y)*f,c=v,v=m,z=z.next}var b=z=d.lverts.next;y+=v.x*(b.y-c.y);var g=b.y*v.x-b.x*v.y;d.localCOMx+=(v.x+b.x)*g,d.localCOMy+=(v.y+b.y)*g,c=v;var w=z=z.next;y+=b.x*(w.y-c.y);var M=w.y*b.x-w.x*b.y;d.localCOMx+=(b.x+w.x)*M,d.localCOMy+=(b.y+w.y)*M;var C=y=1/(3*y);d.localCOMx*=C,d.localCOMy*=C}}null!=x.wrap_localCOM&&(x.wrap_localCOM.zpp_inner.x=x.localCOMx,x.wrap_localCOM.zpp_inner.y=x.localCOMy)}var k=x.body;k.zip_axis&&(k.zip_axis=!1,k.axisx=Math.sin(k.rot),k.axisy=Math.cos(k.rot)),x.worldCOMx=x.body.posx+(x.body.axisy*x.localCOMx-x.body.axisx*x.localCOMy),x.worldCOMy=x.body.posy+(x.localCOMx*x.body.axisx+x.localCOMy*x.body.axisy)}var O=t.polygon.area,P=t.polygon.worldCOMx,S=t.polygon.worldCOMy;return e.overlap=O,e.centroidx=P,e.centroidy=S,!0}if(l){r=!0;for(var A=t.polygon.edges.head;null!=A;){for(var j=A.elt,E=1e100,I=0,T=n.polygon.gverts.next;null!=T;){var N=j.gnormx*T.x+j.gnormy*T.y;N<E&&(E=N),N>=j.gprojection+co.epsilon&&(r=!(i[I]=!0)),++I,T=T.next}if(0<(E-=j.gprojection)){l=!1;break}A=A.next}if(r){var L=n.polygon;if(L.zip_worldCOM&&null!=L.body){if(L.zip_worldCOM=!1,L.zip_localCOM){if(L.zip_localCOM=!1,1==L.type){var V=L.polygon;if(null==V.lverts.next.next)V.localCOMx=V.lverts.next.x,V.localCOMy=V.lverts.next.y;else if(null==V.lverts.next.next.next)V.localCOMx=V.lverts.next.x,V.localCOMy=V.lverts.next.y,V.localCOMx+=V.lverts.next.next.x,V.localCOMy+=V.lverts.next.next.y,V.localCOMx*=.5,V.localCOMy*=.5;else{V.localCOMx=0;var D=V.localCOMy=0,F=V.lverts.next,R=F,Z=F=F.next;for(F=F.next;null!=F;){var B=F;D+=Z.x*(B.y-R.y);var G=B.y*Z.x-B.x*Z.y;V.localCOMx+=(Z.x+B.x)*G,V.localCOMy+=(Z.y+B.y)*G,R=Z,Z=B,F=F.next}var q=F=V.lverts.next;D+=Z.x*(q.y-R.y);var U=q.y*Z.x-q.x*Z.y;V.localCOMx+=(Z.x+q.x)*U,V.localCOMy+=(Z.y+q.y)*U,R=Z;var K=F=F.next;D+=q.x*(K.y-R.y);var W=K.y*q.x-K.x*q.y;V.localCOMx+=(q.x+K.x)*W,V.localCOMy+=(q.y+K.y)*W;var Y=D=1/(3*D);V.localCOMx*=Y,V.localCOMy*=Y}}null!=L.wrap_localCOM&&(L.wrap_localCOM.zpp_inner.x=L.localCOMx,L.wrap_localCOM.zpp_inner.y=L.localCOMy)}var J=L.body;J.zip_axis&&(J.zip_axis=!1,J.axisx=Math.sin(J.rot),J.axisy=Math.cos(J.rot)),L.worldCOMx=L.body.posx+(L.body.axisy*L.localCOMx-L.body.axisx*L.localCOMy),L.worldCOMy=L.body.posy+(L.localCOMx*L.body.axisx+L.localCOMy*L.body.axisy)}var X=n.polygon.area,H=n.polygon.worldCOMx,$=n.polygon.worldCOMy;return e.overlap=X,e.centroidx=H,e.centroidy=$,!0}if(l){for(;null!=vo.flowpoly.head;){var Q=vo.flowpoly.pop_unsafe();Q._inuse||(null!=Q.outer&&(Q.outer.zpp_inner=null,Q.outer=null),Q._isimmutable=null,Q._validate=null,Q._invalidate=null,Q.next=mo.zpp_pool,mo.zpp_pool=Q)}for(var nn=null,tn=!1,en=n.polygon.gverts.next,pn=0,ln=t.polygon.gverts.next,rn=0,on=0,an=t.polygon.edgeCnt;on<an;){var sn=on++;if(!p[sn]){rn=sn;break}ln=ln.next}if(null==ln){ln=t.polygon.gverts.next,tn=!0;for(var _n=0,hn=n.polygon.edgeCnt;_n<hn;){var un=_n++;if(!i[un]){pn=un;break}en=en.next}null==en?en=n.polygon.gverts.next:(vo.flowpoly.add(en),nn=vo.flowpoly.head.elt)}else vo.flowpoly.add(ln),nn=vo.flowpoly.head.elt;var xn=1;if(null==vo.flowpoly.head){for(var dn=!0,yn=n.polygon.gverts.next,zn=yn,cn=yn.next;null!=cn;){for(var vn=cn,mn=2,fn=t.polygon.gverts.next,bn=fn,gn=fn.next;null!=gn;){var wn,Mn,Cn=0,kn=zn.x-bn.x,On=zn.y-bn.y,Pn=0,Sn=vn.x-zn.x,An=0,jn=0,En=(Pn=vn.y-zn.y)*(An=gn.x-bn.x)-Sn*(jn=gn.y-bn.y);En*En>co.epsilon*co.epsilon&&((wn=(jn*kn-An*On)*(En=1/En))>co.epsilon&&wn<1-co.epsilon&&((Mn=(Pn*kn-Sn*On)*En)>co.epsilon&&Mn<1-co.epsilon&&(Cn=wn,!0)))&&Cn<mn&&(mn=Cn,ln=fn),gn=(fn=bn=gn).next}for(;;){gn=t.polygon.gverts.next;var In,Tn,Nn=0,Ln=zn.x-bn.x,Vn=zn.y-bn.y,Dn=0,Fn=vn.x-zn.x,Rn=0,Zn=0,Bn=(Dn=vn.y-zn.y)*(Rn=gn.x-bn.x)-Fn*(Zn=gn.y-bn.y);Bn*Bn>co.epsilon*co.epsilon&&((In=(Zn*Ln-Rn*Vn)*(Bn=1/Bn))>co.epsilon&&In<1-co.epsilon&&((Tn=(Dn*Ln-Fn*Vn)*Bn)>co.epsilon&&Tn<1-co.epsilon&&(Nn=In,!0)))&&Nn<mn&&(mn=Nn,ln=fn);break}if(2!=mn){var Gn,qn=zn.x+(vn.x-zn.x)*mn,Un=zn.y+(vn.y-zn.y)*mn;null==mo.zpp_pool?Gn=new mo:(Gn=mo.zpp_pool,mo.zpp_pool=Gn.next,Gn.next=null),Gn.weak=!1,Gn._immutable=!1,Gn.x=qn,Gn.y=Un,nn=Gn,vo.flowpoly.add(nn),en=yn,dn=!(tn=!0);break}zn=vn,cn=(yn=cn).next}if(dn)for(;;){for(var Kn=cn=n.polygon.gverts.next,Wn=2,Yn=t.polygon.gverts.next,Jn=Yn,Xn=Yn.next;null!=Xn;){var Hn,$n,Qn=0,nt=zn.x-Jn.x,tt=zn.y-Jn.y,et=0,it=Kn.x-zn.x,pt=0,lt=0,rt=(et=Kn.y-zn.y)*(pt=Xn.x-Jn.x)-it*(lt=Xn.y-Jn.y);rt*rt>co.epsilon*co.epsilon&&((Hn=(lt*nt-pt*tt)*(rt=1/rt))>co.epsilon&&Hn<1-co.epsilon&&(($n=(et*nt-it*tt)*rt)>co.epsilon&&$n<1-co.epsilon&&(Qn=Hn,!0)))&&Qn<Wn&&(Wn=Qn,ln=Yn),Xn=(Yn=Jn=Xn).next}for(;;){Xn=t.polygon.gverts.next;var ot,at,st=0,_t=zn.x-Jn.x,ht=zn.y-Jn.y,ut=0,xt=Kn.x-zn.x,dt=0,yt=0,zt=(ut=Kn.y-zn.y)*(dt=Xn.x-Jn.x)-xt*(yt=Xn.y-Jn.y);zt*zt>co.epsilon*co.epsilon&&((ot=(yt*_t-dt*ht)*(zt=1/zt))>co.epsilon&&ot<1-co.epsilon&&((at=(ut*_t-xt*ht)*zt)>co.epsilon&&at<1-co.epsilon&&(st=ot,!0)))&&st<Wn&&(Wn=st,ln=Yn);break}if(2==Wn)break;var ct,vt=zn.x+(Kn.x-zn.x)*Wn,mt=zn.y+(Kn.y-zn.y)*Wn;null==mo.zpp_pool?ct=new mo:(ct=mo.zpp_pool,mo.zpp_pool=ct.next,ct.next=null),ct.weak=!1,ct._immutable=!1,ct.x=vt,ct.y=mt,nn=ct,vo.flowpoly.add(nn),tn=!0,en=yn;break}xn=2}for(;;)if(tn)if(++pn,null==(en=en.next)&&(en=n.polygon.gverts.next,pn=0),i[pn]){var ft=vo.flowpoly.head.elt,bt=en,gt=ln,wt=ln.next;null==wt&&(wt=t.polygon.gverts.next);for(var Mt=-1,Ct=null,kt=0,Ot=0,Pt=wt,St=wt;;){var At,jt,Et=St,It=0,Tt=gt.x-ft.x,Nt=gt.y-ft.y,Lt=0,Vt=Et.x-gt.x,Dt=0,Ft=0,Rt=(Lt=Et.y-gt.y)*(Dt=bt.x-ft.x)-Vt*(Ft=bt.y-ft.y);if(Rt*Rt>co.epsilon*co.epsilon&&((At=(Ft*Tt-Dt*Nt)*(Rt=1/Rt))>co.epsilon&&At<1-co.epsilon&&((jt=(Lt*Tt-Vt*Nt)*Rt)>co.epsilon&&jt<1-co.epsilon&&(It=At,!0)))&&-1<=It){if(Ct=ln,kt=rn,(Ot=1)==xn){Mt=It,St=Pt;break}Mt=It}gt=Et,ln=St,++rn>=t.polygon.edgeCnt&&(rn=0),null==(St=St.next)&&(St=t.polygon.gverts.next);break}for(;St!=Pt;){var Zt,Bt,Gt=St,qt=0,Ut=gt.x-ft.x,Kt=gt.y-ft.y,Wt=0,Yt=Gt.x-gt.x,Jt=0,Xt=0,Ht=(Wt=Gt.y-gt.y)*(Jt=bt.x-ft.x)-Yt*(Xt=bt.y-ft.y);if(Ht*Ht>co.epsilon*co.epsilon&&((Zt=(Xt*Ut-Jt*Kt)*(Ht=1/Ht))>co.epsilon&&Zt<1-co.epsilon&&((Bt=(Wt*Ut-Yt*Kt)*Ht)>co.epsilon&&Bt<1-co.epsilon&&(qt=Zt,!0)))&&Mt<=qt){if(Ct=ln,kt=rn,++Ot==xn){Mt=qt;break}Mt=qt}gt=Gt,ln=St,++rn>=t.polygon.edgeCnt&&(rn=0),null==(St=St.next)&&(St=t.polygon.gverts.next)}if(null==Ct)break;var $t=Ct.next;null==$t&&($t=t.polygon.gverts.next);var Qt,ne,te,ee=Ct.x+($t.x-Ct.x)*Mt,ie=Ct.y+($t.y-Ct.y)*Mt;if(null!=nn&&(ne=Qt=0,(Qt=ee-nn.x)*Qt+(ne=ie-nn.y)*ne<co.epsilon))break;null==mo.zpp_pool?te=new mo:(te=mo.zpp_pool,mo.zpp_pool=te.next,te.next=null),te.weak=!1,te._immutable=!1,te.x=ee,te.y=ie,vo.flowpoly.add(te),null==nn&&(nn=vo.flowpoly.head.elt),ln=Ct,rn=kt,tn=!tn,xn=2}else{var pe,le,re,oe,ae=en;if(null!=nn&&(pe=ae.x,le=ae.y,oe=re=0,(re=pe-nn.x)*re+(oe=le-nn.y)*oe<co.epsilon))break;vo.flowpoly.add(ae),null==nn&&(nn=vo.flowpoly.head.elt),xn=1}else if(++rn,null==(ln=ln.next)&&(ln=t.polygon.gverts.next,rn=0),p[rn]){var se=vo.flowpoly.head.elt,_e=ln,he=en,ue=en.next;null==ue&&(ue=n.polygon.gverts.next);for(var xe=-1,de=null,ye=0,ze=0,ce=ue,ve=ue;;){var me,fe,be=ve,ge=0,we=he.x-se.x,Me=he.y-se.y,Ce=0,ke=be.x-he.x,Oe=0,Pe=0,Se=(Ce=be.y-he.y)*(Oe=_e.x-se.x)-ke*(Pe=_e.y-se.y);if(Se*Se>co.epsilon*co.epsilon&&((me=(Pe*we-Oe*Me)*(Se=1/Se))>co.epsilon&&me<1-co.epsilon&&((fe=(Ce*we-ke*Me)*Se)>co.epsilon&&fe<1-co.epsilon&&(ge=me,!0)))&&-1<=ge){if(de=en,ye=pn,(ze=1)==xn){xe=ge,ve=ce;break}xe=ge}he=be,en=ve,++pn>=n.polygon.edgeCnt&&(pn=0),null==(ve=ve.next)&&(ve=n.polygon.gverts.next);break}for(;ve!=ce;){var Ae,je,Ee=ve,Ie=0,Te=he.x-se.x,Ne=he.y-se.y,Le=0,Ve=Ee.x-he.x,De=0,Fe=0,Re=(Le=Ee.y-he.y)*(De=_e.x-se.x)-Ve*(Fe=_e.y-se.y);if(Re*Re>co.epsilon*co.epsilon&&((Ae=(Fe*Te-De*Ne)*(Re=1/Re))>co.epsilon&&Ae<1-co.epsilon&&((je=(Le*Te-Ve*Ne)*Re)>co.epsilon&&je<1-co.epsilon&&(Ie=Ae,!0)))&&xe<=Ie){if(de=en,ye=pn,++ze==xn){xe=Ie;break}xe=Ie}he=Ee,en=ve,++pn>=n.polygon.edgeCnt&&(pn=0),null==(ve=ve.next)&&(ve=n.polygon.gverts.next)}if(null==de)break;var Ze=de.next;null==Ze&&(Ze=n.polygon.gverts.next);var Be,Ge,qe,Ue=de.x+(Ze.x-de.x)*xe,Ke=de.y+(Ze.y-de.y)*xe;if(null!=nn&&(Ge=Be=0,(Be=Ue-nn.x)*Be+(Ge=Ke-nn.y)*Ge<co.epsilon))break;null==mo.zpp_pool?qe=new mo:(qe=mo.zpp_pool,mo.zpp_pool=qe.next,qe.next=null),qe.weak=!1,qe._immutable=!1,qe.x=Ue,qe.y=Ke,vo.flowpoly.add(qe),null==nn&&(nn=vo.flowpoly.head.elt),en=de,pn=ye,tn=!tn,xn=2}else{var We,Ye,Je,Xe,He=ln;if(null!=nn&&(We=He.x,Ye=He.y,Xe=Je=0,(Je=We-nn.x)*Je+(Xe=Ye-nn.y)*Xe<co.epsilon))break;vo.flowpoly.add(He),null==nn&&(nn=vo.flowpoly.head.elt),xn=1}if(null==vo.flowpoly.head||null==vo.flowpoly.head.next||null==vo.flowpoly.head.next.next)return!1;var $e=0,Qe=0,ni=0,Qe=0,ni=0,$e=0,ti=vo.flowpoly.head,ei=ti.elt,ii=(ti=ti.next).elt;for(ti=ti.next;null!=ti;){var pi=ti.elt;$e+=ii.x*(pi.y-ei.y);var li=pi.y*ii.x-pi.x*ii.y;Qe+=(ii.x+pi.x)*li,ni+=(ii.y+pi.y)*li,ei=ii,ii=pi,ti=ti.next}var ri=(ti=vo.flowpoly.head).elt;$e+=ii.x*(ri.y-ei.y);var oi=ri.y*ii.x-ri.x*ii.y;Qe+=(ii.x+ri.x)*oi,ni+=(ii.y+ri.y)*oi,ei=ii;var ai=(ti=ti.next).elt;$e+=ri.x*(ai.y-ei.y);var si=ai.y*ri.x-ai.x*ri.y;Qe+=(ri.x+ai.x)*si,ni+=(ri.y+ai.y)*si;var _i=1/(6*($e*=.5));return Qe*=_i,ni*=_i,e.overlap=-$e,e.centroidx=Qe,e.centroidy=ni,!0}return!1}return!1}for(var hi=[],ui=!0,xi=null,di=null,yi=-1e100,zi=!0,ci=t.polygon.gverts.next,vi=0,mi=t.polygon.edges.head;null!=mi;){var fi=mi.elt,bi=fi.gnormx*n.circle.worldCOMx+fi.gnormy*n.circle.worldCOMy;if(bi>fi.gprojection+n.circle.radius){zi=!1;break}bi+n.circle.radius>fi.gprojection+co.epsilon&&(ui=!1,hi[vi]=!0),yi<(bi-=fi.gprojection+n.circle.radius)&&(yi=bi,xi=fi,di=ci),ci=ci.next,++vi,mi=mi.next}if(zi){if(ui){var gi=n.circle.area,wi=n.circle.worldCOMx,Mi=n.circle.worldCOMy;return e.overlap=gi,e.centroidx=wi,e.centroidy=Mi,!0}var Ci,ki,Oi,Pi,Si,Ai,ji=null==di.next?t.polygon.gverts.next:di.next,Ei=n.circle.worldCOMy*xi.gnormx-n.circle.worldCOMx*xi.gnormy;if(Ei<=di.y*xi.gnormx-di.x*xi.gnormy?(Ci=n.circle.radius,Oi=ki=0,(ki=di.x-n.circle.worldCOMx)*ki+(Oi=di.y-n.circle.worldCOMy)*Oi<=Ci*Ci):!(Ei>=ji.y*xi.gnormx-ji.x*xi.gnormy)||(Pi=n.circle.radius,Ai=Si=0,(Si=ji.x-n.circle.worldCOMx)*Si+(Ai=ji.y-n.circle.worldCOMy)*Ai<=Pi*Pi)){for(var Ii=[],Ti=0,Ni=!0,Li=null,Vi=0,Di=t.polygon.gverts.next;null!=Di;){var Fi=Di.x,Ri=Di.y,Zi=Fi-n.circle.worldCOMx,Bi=Ri-n.circle.worldCOMy;(Ii[Ti]=Zi*Zi+Bi*Bi<=n.circle.radius*n.circle.radius)?(Vi=Ti,Li=Di):Ni=!1,++Ti,Di=Di.next}if(Ni){var Gi=t.polygon;if(Gi.zip_worldCOM&&null!=Gi.body){if(Gi.zip_worldCOM=!1,Gi.zip_localCOM){if(Gi.zip_localCOM=!1,1==Gi.type){var qi=Gi.polygon;if(null==qi.lverts.next.next)qi.localCOMx=qi.lverts.next.x,qi.localCOMy=qi.lverts.next.y;else if(null==qi.lverts.next.next.next)qi.localCOMx=qi.lverts.next.x,qi.localCOMy=qi.lverts.next.y,qi.localCOMx+=qi.lverts.next.next.x,qi.localCOMy+=qi.lverts.next.next.y,qi.localCOMx*=.5,qi.localCOMy*=.5;else{qi.localCOMx=0;var Ui=qi.localCOMy=0,Ki=qi.lverts.next,Wi=Ki,Yi=Ki=Ki.next;for(Ki=Ki.next;null!=Ki;){var Ji=Ki;Ui+=Yi.x*(Ji.y-Wi.y);var Xi=Ji.y*Yi.x-Ji.x*Yi.y;qi.localCOMx+=(Yi.x+Ji.x)*Xi,qi.localCOMy+=(Yi.y+Ji.y)*Xi,Wi=Yi,Yi=Ji,Ki=Ki.next}var Hi=Ki=qi.lverts.next;Ui+=Yi.x*(Hi.y-Wi.y);var $i=Hi.y*Yi.x-Hi.x*Yi.y;qi.localCOMx+=(Yi.x+Hi.x)*$i,qi.localCOMy+=(Yi.y+Hi.y)*$i,Wi=Yi;var Qi=Ki=Ki.next;Ui+=Hi.x*(Qi.y-Wi.y);var np=Qi.y*Hi.x-Qi.x*Hi.y;qi.localCOMx+=(Hi.x+Qi.x)*np,qi.localCOMy+=(Hi.y+Qi.y)*np;var tp=Ui=1/(3*Ui);qi.localCOMx*=tp,qi.localCOMy*=tp}}null!=Gi.wrap_localCOM&&(Gi.wrap_localCOM.zpp_inner.x=Gi.localCOMx,Gi.wrap_localCOM.zpp_inner.y=Gi.localCOMy)}var ep=Gi.body;ep.zip_axis&&(ep.zip_axis=!1,ep.axisx=Math.sin(ep.rot),ep.axisy=Math.cos(ep.rot)),Gi.worldCOMx=Gi.body.posx+(Gi.body.axisy*Gi.localCOMx-Gi.body.axisx*Gi.localCOMy),Gi.worldCOMy=Gi.body.posy+(Gi.localCOMx*Gi.body.axisx+Gi.localCOMy*Gi.body.axisy)}var ip=t.polygon.area,pp=t.polygon.worldCOMx,lp=t.polygon.worldCOMy;return e.overlap=ip,e.centroidx=pp,e.centroidy=lp,!0}for(;null!=vo.flowpoly.head;){var rp=vo.flowpoly.pop_unsafe();rp._inuse||(null!=rp.outer&&(rp.outer.zpp_inner=null,rp.outer=null),rp._isimmutable=null,rp._validate=null,rp._invalidate=null,rp.next=mo.zpp_pool,mo.zpp_pool=rp)}vo.flowsegs.clear();var op=null,ap=1;for(null==Li?(Li=t.polygon.gverts.next,ap=2):(op=Li,vo.flowpoly.add(op));0!=ap;)if(1==ap)if(null==(Li=Li.next)&&(Li=t.polygon.gverts.next),++Vi>=t.polygon.edgeCnt&&(Vi=0),Ii[Vi]){var sp=op.x,_p=op.y,hp=0,up=0;if((hp=sp-Li.x)*hp+(up=_p-Li.y)*up<co.epsilon)break;vo.flowpoly.add(Li)}else{var xp,dp=vo.flowpoly.head.elt,yp=Li,zp=0,cp=0,vp=0,mp=0,fp=(zp=yp.x-dp.x)*zp+(cp=yp.y-dp.y)*cp,bp=2*((vp=dp.x-n.circle.worldCOMx)*zp+(mp=dp.y-n.circle.worldCOMy)*cp),gp=Math.sqrt(bp*bp-4*fp*(vp*vp+mp*mp-n.circle.radius*n.circle.radius)),wp=(-bp-gp)*(fp=1/(2*fp)),Mp=wp<co.epsilon?(-bp+gp)*fp:wp,Cp=dp.x+(yp.x-dp.x)*Mp,kp=dp.y+(yp.y-dp.y)*Mp,Op=0,Pp=0;if((Op=op.x-Cp)*Op+(Pp=op.y-kp)*Pp<co.epsilon)break;null==mo.zpp_pool?xp=new mo:(xp=mo.zpp_pool,mo.zpp_pool=xp.next,xp.next=null),xp.weak=!1,xp._immutable=!1,xp.x=Cp,xp.y=kp,vo.flowpoly.add(xp),ap=2}else if(2==ap){var Sp=Li.next;null==Sp&&(Sp=t.polygon.gverts.next);for(var Ap=Li,ap=0,jp=Sp,Ep=Sp;;){var Ip=Ep,Tp=Vi+1;if(Tp==t.polygon.edgeCnt&&(Tp=0),hi[Vi]){if(Ii[Tp]){var Np,Lp=0,Vp=0,Dp=0,Fp=0,Rp=(Lp=Ip.x-Ap.x)*Lp+(Vp=Ip.y-Ap.y)*Vp,Zp=2*((Dp=Ap.x-n.circle.worldCOMx)*Lp+(Fp=Ap.y-n.circle.worldCOMy)*Vp),Bp=Math.sqrt(Zp*Zp-4*Rp*(Dp*Dp+Fp*Fp-n.circle.radius*n.circle.radius)),Gp=(-Zp-Bp)*(Rp=1/(2*Rp)),qp=Gp<co.epsilon?(-Zp+Bp)*Rp:Gp,Up=Ap.x+(Ip.x-Ap.x)*qp,Kp=Ap.y+(Ip.y-Ap.y)*qp,Wp=0,Yp=0;if((Wp=op.x-Up)*Wp+(Yp=op.y-Kp)*Yp<co.epsilon){ap=0,Ep=jp;break}null==mo.zpp_pool?Np=new mo:(Np=mo.zpp_pool,mo.zpp_pool=Np.next,Np.next=null),Np.weak=!1,Np._immutable=!1,Np.x=Up,Np.y=Kp;var Jp=Np;vo.flowsegs.add(vo.flowpoly.head.elt),vo.flowsegs.add(Jp),vo.flowpoly.add(Jp),ap=1,Ep=jp;break}var Xp=0,Hp=0,$p=0,Qp=0,nl=0,tl=0,el=($p=Ip.x-Ap.x)*$p+(Qp=Ip.y-Ap.y)*Qp,il=2*((nl=Ap.x-n.circle.worldCOMx)*$p+(tl=Ap.y-n.circle.worldCOMy)*Qp),pl=il*il-4*el*(nl*nl+tl*tl-n.circle.radius*n.circle.radius),ll=pl*pl<co.epsilon?(Xp=pl<0?10:Hp=-il/(2*el),!1):(Xp=(-il-(pl=Math.sqrt(pl)))*(el=1/(2*el)),Hp=(-il+pl)*el,!0);if(Xp<1-co.epsilon&&Hp>co.epsilon){var rl,ol,al,sl=Ap.x+(Ip.x-Ap.x)*Xp,_l=Ap.y+(Ip.y-Ap.y)*Xp;if(null!=op&&(ol=rl=0,(rl=op.x-sl)*rl+(ol=op.y-_l)*ol<co.epsilon)){ap=0,Ep=jp;break}null==mo.zpp_pool?al=new mo:(al=mo.zpp_pool,mo.zpp_pool=al.next,al.next=null),al.weak=!1,al._immutable=!1,al.x=sl,al.y=_l;var hl,ul,xl,dl=al;null!=vo.flowpoly.head&&(vo.flowsegs.add(vo.flowpoly.head.elt),vo.flowsegs.add(dl)),vo.flowpoly.add(dl),null==op&&(op=vo.flowpoly.head.elt),ll&&(xl=ul=0,ul=Ap.x+(Ip.x-Ap.x)*Hp,xl=Ap.y+(Ip.y-Ap.y)*Hp,null==mo.zpp_pool?hl=new mo:(hl=mo.zpp_pool,mo.zpp_pool=hl.next,hl.next=null),hl.weak=!1,hl._immutable=!1,hl.x=ul,hl.y=xl,vo.flowpoly.add(hl))}}Ap=Ip,Vi=Tp,null==(Ep=(Li=Ep).next)&&(Ep=t.polygon.gverts.next);break}for(;Ep!=jp;){var yl=Ep,zl=Vi+1;if(zl==t.polygon.edgeCnt&&(zl=0),hi[Vi]){if(Ii[zl]){var cl,vl=0,ml=0,fl=0,bl=0,gl=(vl=yl.x-Ap.x)*vl+(ml=yl.y-Ap.y)*ml,wl=2*((fl=Ap.x-n.circle.worldCOMx)*vl+(bl=Ap.y-n.circle.worldCOMy)*ml),Ml=Math.sqrt(wl*wl-4*gl*(fl*fl+bl*bl-n.circle.radius*n.circle.radius)),Cl=(-wl-Ml)*(gl=1/(2*gl)),kl=Cl<co.epsilon?(-wl+Ml)*gl:Cl,Ol=Ap.x+(yl.x-Ap.x)*kl,Pl=Ap.y+(yl.y-Ap.y)*kl,Sl=0,Al=0;if((Sl=op.x-Ol)*Sl+(Al=op.y-Pl)*Al<co.epsilon){ap=0;break}null==mo.zpp_pool?cl=new mo:(cl=mo.zpp_pool,mo.zpp_pool=cl.next,cl.next=null),cl.weak=!1,cl._immutable=!1,cl.x=Ol,cl.y=Pl;var jl=cl;vo.flowsegs.add(vo.flowpoly.head.elt),vo.flowsegs.add(jl),vo.flowpoly.add(jl),ap=1;break}var El=0,Il=0,Tl=0,Nl=0,Ll=0,Vl=0,Dl=(Tl=yl.x-Ap.x)*Tl+(Nl=yl.y-Ap.y)*Nl,Fl=2*((Ll=Ap.x-n.circle.worldCOMx)*Tl+(Vl=Ap.y-n.circle.worldCOMy)*Nl),Rl=Fl*Fl-4*Dl*(Ll*Ll+Vl*Vl-n.circle.radius*n.circle.radius),Zl=Rl*Rl<co.epsilon?(El=Rl<0?10:Il=-Fl/(2*Dl),!1):(El=(-Fl-(Rl=Math.sqrt(Rl)))*(Dl=1/(2*Dl)),Il=(-Fl+Rl)*Dl,!0);if(El<1-co.epsilon&&Il>co.epsilon){var Bl,Gl,ql,Ul=Ap.x+(yl.x-Ap.x)*El,Kl=Ap.y+(yl.y-Ap.y)*El;if(null!=op&&(Gl=Bl=0,(Bl=op.x-Ul)*Bl+(Gl=op.y-Kl)*Gl<co.epsilon)){ap=0;break}null==mo.zpp_pool?ql=new mo:(ql=mo.zpp_pool,mo.zpp_pool=ql.next,ql.next=null),ql.weak=!1,ql._immutable=!1,ql.x=Ul,ql.y=Kl;var Wl,Yl,Jl,Xl=ql;null!=vo.flowpoly.head&&(vo.flowsegs.add(vo.flowpoly.head.elt),vo.flowsegs.add(Xl)),vo.flowpoly.add(Xl),null==op&&(op=vo.flowpoly.head.elt),Zl&&(Jl=Yl=0,Yl=Ap.x+(yl.x-Ap.x)*Il,Jl=Ap.y+(yl.y-Ap.y)*Il,null==mo.zpp_pool?Wl=new mo:(Wl=mo.zpp_pool,mo.zpp_pool=Wl.next,Wl.next=null),Wl.weak=!1,Wl._immutable=!1,Wl.x=Yl,Wl.y=Jl,vo.flowpoly.add(Wl))}}Ap=yl,Vi=zl,null==(Ep=(Li=Ep).next)&&(Ep=t.polygon.gverts.next)}}if(null==vo.flowpoly.head)return!1;if(null==vo.flowpoly.head.next){for(var Hl=!0,$l=t.polygon.edges.head;null!=$l;){var Ql=$l.elt;if(Ql.gnormx*n.circle.worldCOMx+Ql.gnormy*n.circle.worldCOMy>Ql.gprojection){Hl=!1;break}$l=$l.next}if(Hl){var nr=n.circle.area,tr=n.circle.worldCOMx,er=n.circle.worldCOMy;return e.overlap=nr,e.centroidx=tr,e.centroidy=er,!0}return!1}var ir=0,pr=0,lr=0;if(null!=vo.flowpoly.head.next.next){var rr=0,or=0,ar=0,or=0,ar=0,rr=0,sr=vo.flowpoly.head,_r=sr.elt,hr=(sr=sr.next).elt;for(sr=sr.next;null!=sr;){var ur=sr.elt;rr+=hr.x*(ur.y-_r.y);var xr=ur.y*hr.x-ur.x*hr.y;or+=(hr.x+ur.x)*xr,ar+=(hr.y+ur.y)*xr,_r=hr,hr=ur,sr=sr.next}var dr=(sr=vo.flowpoly.head).elt;rr+=hr.x*(dr.y-_r.y);var yr=dr.y*hr.x-dr.x*hr.y;or+=(hr.x+dr.x)*yr,ar+=(hr.y+dr.y)*yr,_r=hr;var zr=(sr=sr.next).elt;rr+=dr.x*(zr.y-_r.y);var cr=zr.y*dr.x-zr.x*dr.y;or+=(dr.x+zr.x)*cr,ar+=(dr.y+zr.y)*cr;var vr=1/(6*(rr*=.5)),mr=-rr;ir+=(or*=vr)*mr,pr+=(ar*=vr)*mr,lr=0-rr}else vo.flowsegs.add(vo.flowpoly.head.elt),vo.flowsegs.add(vo.flowpoly.head.next.elt);for(;null!=vo.flowsegs.head;){var fr=vo.flowsegs.pop_unsafe(),br=vo.flowsegs.pop_unsafe(),gr=0,wr=0,gr=br.x-fr.x,wr=br.y-fr.y,Mr=1/Math.sqrt(gr*gr+wr*wr),Cr=gr*=Mr;gr=-(wr*=Mr),wr=Cr;var kr=fr.x+br.x,Or=fr.y+br.y;kr*=.5,Or*=.5;var Pr=gr*(kr-=n.circle.worldCOMx)+wr*(Or-=n.circle.worldCOMy),Sr=Pr/n.circle.radius,Ar=Math.sqrt(1-Sr*Sr),jr=Math.acos(Sr),Er=n.circle.radius*(n.circle.radius*jr-Pr*Ar),Ir=.6666666666666666*n.circle.radius*Ar*Ar*Ar/(jr-Sr*Ar);kr=n.circle.worldCOMx,Or=n.circle.worldCOMy,ir+=(kr+=gr*Ir)*Er,pr+=(Or+=wr*Ir)*Er,lr+=Er}var Tr=1/lr;return ir*=Tr,pr*=Tr,e.overlap=lr,e.centroidx=ir,e.centroidy=pr,!0}return!1}return!1}var Nr,Lr,Vr,Dr,Fr,Rr,Zr=n.circle,Br=t.circle,Gr=Br.worldCOMx-Zr.worldCOMx,qr=Br.worldCOMy-Zr.worldCOMy,Ur=Zr.radius+Br.radius,Kr=Gr*Gr+qr*qr;if(Ur*Ur<Kr)return!1;if(Kr<co.epsilon*co.epsilon)return Zr.radius<Br.radius?(Nr=Zr.area,Lr=Zr.worldCOMx,Vr=Zr.worldCOMy,e.overlap=Nr,e.centroidx=Lr,e.centroidy=Vr):(Dr=Br.area,Fr=Br.worldCOMx,Rr=Br.worldCOMy,e.overlap=Dr,e.centroidx=Fr,e.centroidy=Rr),!0;var Wr,Yr,Jr,Xr,Hr,$r,Qr,no,to,eo,io,po,lo,ro,oo,ao,so,_o,ho,uo,xo=Math.sqrt(Kr),yo=1/xo,zo=.5*(xo-(Br.radius*Br.radius-Zr.radius*Zr.radius)*yo);return zo<=-Zr.radius?(Wr=Zr.area,Yr=Zr.worldCOMx,Jr=Zr.worldCOMy,e.overlap=Wr,e.centroidx=Yr,e.centroidy=Jr):(Xr=xo-zo)<=-Br.radius?(Hr=Br.area,$r=Br.worldCOMx,Qr=Br.worldCOMy,e.overlap=Hr,e.centroidx=$r,e.centroidy=Qr):(ao=po=io=0,no=zo/Zr.radius,to=Math.sqrt(1-no*no),eo=Math.acos(no),io=Zr.radius*(Zr.radius*eo-zo*to),po=.6666666666666666*Zr.radius*to*to*to/(eo-no*to),lo=Xr/Br.radius,ro=Math.sqrt(1-lo*lo),oo=Math.acos(lo),so=io+(ao=Br.radius*(Br.radius*oo-Xr*ro)),_o=(po*io+(xo-.6666666666666666*Br.radius*ro*ro*ro/(oo-lo*ro))*ao)/so*yo,ho=Zr.worldCOMx+Gr*_o,uo=Zr.worldCOMy+qr*_o,e.overlap=so,e.centroidx=ho,e.centroidy=uo),!0},vo.prototype.__class__=vo;var gt=zpp_nape.geom.ZPP_Convex=function(){};gt.__name__=["zpp_nape","geom","ZPP_Convex"],gt.isinner=function(n,t,e){var i=n.x-t.x,p=n.y-t.y,l=e.x-t.x;return 0<=(e.y-t.y)*i-l*p},gt.optimise=function(n){var t=n.vertices,e=n.vertices;if(null!=t)for(var i=t;i.sort(),(i=i.next)!=e;);var p=n.vertices,l=n.vertices;if(null!=p)for(var r=p;;){for(var o=r,a=o.prev,s=null,_=o.diagonals.head;null!=_;){var h=_.elt;if(gt.isinner(null==_.next?o.next:_.next.elt,o,a)){for(var u=!0,x=h.prev,d=null,y=h.diagonals.head;null!=y;){var z=y.elt;if(z==o){u=gt.isinner(null==y.next?h.next:y.next.elt,h,x);break}x=z,y=(d=y).next}u?(_=o.diagonals.erase(s),h.diagonals.erase(d)):(a=h,_=(s=_).next)}else a=h,_=(s=_).next}if((r=r.next)==l)break}},gt.prototype.__class__=gt;var wt=zpp_nape.geom.ZPP_ConvexRayResult=function(){this.toiDistance=0,this.next=null,this.inner=!1,this.ray=null,this.position=null,this.convex=null,this.shape=null,this.normal=null};wt.__name__=["zpp_nape","geom","ZPP_ConvexRayResult"],wt.getRay=function(n,t,e,i){var p;null==wt.rayPool?(wt.internal=!0,(p=new Y).zpp_inner=new wt,p.zpp_inner.ray=p,wt.internal=!1):(p=wt.rayPool.ray,wt.rayPool=wt.rayPool.next,p.zpp_inner.next=null);var l=p.zpp_inner;return(l.normal=n).zpp_inner._immutable=!0,l.toiDistance=t,l.inner=e,l.shape=i,p},wt.getConvex=function(n,t,e,i){var p;null==wt.convexPool?(wt.internal=!0,(p=new B).zpp_inner=new wt,p.zpp_inner.convex=p,wt.internal=!1):(p=wt.convexPool.convex,wt.convexPool=wt.convexPool.next,p.zpp_inner.next=null);var l=p.zpp_inner;return l.normal=n,l.position=t,n.zpp_inner._immutable=!0,t.zpp_inner._immutable=!0,l.toiDistance=e,l.shape=i,p},wt.prototype.normal=null,wt.prototype.shape=null,wt.prototype.convex=null,wt.prototype.position=null,wt.prototype.ray=null,wt.prototype.inner=null,wt.prototype.next=null,wt.prototype.toiDistance=null,wt.prototype.disposed=function(){},wt.prototype.free=function(){this.normal.zpp_inner._immutable=!1;var n,t,e=this.normal,i=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Ri.poolVec2,Ri.poolVec2=e,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=mo.zpp_pool,mo.zpp_pool=i,null!=this.position&&(this.position.zpp_inner._immutable=!1,t=(n=this.position).zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=mo.zpp_pool,mo.zpp_pool=t),this.shape=null,this.toiDistance=0,null!=this.convex?(this.next=wt.convexPool,wt.convexPool=this):(this.next=wt.rayPool,wt.rayPool=this)},wt.prototype.__class__=wt;var bi=zpp_nape.geom.ZPP_CutVert=function(){this.used=!1,this.rank=0,this.parent=null,this.positive=!1,this.value=0,this.vert=null,this.posy=0,this.posx=0,this.next=null,this.prev=null};bi.__name__=["zpp_nape","geom","ZPP_CutVert"],bi.path=function(n){var t;return null==bi.zpp_pool?t=new bi:(t=bi.zpp_pool,bi.zpp_pool=t.next,t.next=null),t.vert=n,(t.parent=t).rank=0,t.used=!1,t},bi.prototype.prev=null,bi.prototype.next=null,bi.prototype.posx=null,bi.prototype.posy=null,bi.prototype.vert=null,bi.prototype.value=null,bi.prototype.positive=null,bi.prototype.parent=null,bi.prototype.rank=null,bi.prototype.used=null,bi.prototype.alloc=function(){},bi.prototype.free=function(){this.vert=null,this.parent=null},bi.prototype.__class__=bi;var gi=zpp_nape.geom.ZPP_CutInt=function(){this.path1=null,this.start=null,this.end=null,this.path0=null,this.vertex=!1,this.virtualint=!1,this.time=0,this.next=null};gi.__name__=["zpp_nape","geom","ZPP_CutInt"],gi.get=function(n,t,e,i,p,l,r){var o;return null==r&&(r=!1),null==l&&(l=!1),null==gi.zpp_pool?o=new gi:(o=gi.zpp_pool,gi.zpp_pool=o.next,o.next=null),o.virtualint=l,o.end=t,o.start=e,o.path0=i,o.path1=p,o.time=n,o.vertex=r,o},gi.prototype.next=null,gi.prototype.time=null,gi.prototype.virtualint=null,gi.prototype.vertex=null,gi.prototype.path0=null,gi.prototype.end=null,gi.prototype.start=null,gi.prototype.path1=null,gi.prototype.alloc=function(){},gi.prototype.free=function(){this.end=this.start=null,this.path0=this.path1=null},gi.prototype.__class__=gi;var wi=zpp_nape.geom.ZPP_Cutter=function(){};wi.__name__=["zpp_nape","geom","ZPP_Cutter"],wi.run=function(n,t,e,i,p,l){var r,o,a=t.zpp_inner;null!=a._validate&&a._validate(),r=t.zpp_inner.x;var s=t.zpp_inner;null!=s._validate&&s._validate(),o=t.zpp_inner.y;var _,h,u=e.zpp_inner;null!=u._validate&&u._validate(),_=e.zpp_inner.x-r;var x=e.zpp_inner;null!=x._validate&&x._validate();for(var d,y=i?0:-1/0,z=p?1:1/0,c=-(o*_-r*(h=e.zpp_inner.y-o)),v=null,m=!1,f=n;;){null==bi.zpp_pool?d=new bi:(d=bi.zpp_pool,bi.zpp_pool=d.next,d.next=null),d.vert=f,d.posx=d.vert.x,d.posy=d.vert.y,d.value=d.posy*_-d.posx*h+c,d.positive=0<d.value,0==d.value&&(m=!0);var b=d;if(null==v?v=b.prev=b.next=b:(b.prev=v,b.next=v.next,v.next.prev=b,v.next=b),v=b,(f=f.next)==n)break}if(m){var g=null,w=v;if(null!=v)for(var M=v;;){if(0!=M.value){g=M;break}if((M=M.next)==w)break}var C=_,k=h,O=1/Math.sqrt(C*C+k*k),P=C*=O;C=-(k*=O),k=P;for(var S=null,A=g;;)if(0==A.value||null!=S&&A!=S.next){var j=S.value*A.value;if(0!=j){var E,I=S.next;if(0<j)E=S.positive;else{var T=I.next,N=I.posx+T.posx,L=I.posy+T.posy,V=(N*=.5)+1e-8*C,D=(L*=.5)+1e-8*k,F=!1;if(null!=n)for(var R=n;;){var Z=R.prev;if((R.y<D&&Z.y>=D||Z.y<D&&R.y>=D)&&(R.x<=V||Z.x<=V)&&R.x+(D-R.y)/(Z.y-R.y)*(Z.x-R.x)<V&&(F=!F),(R=R.next)==n)break}E=F}var B=A;if(null!=I)for(var G=I;G.positive=E,(G=G.next)!=B;);if((A=(S=A).next)==g)break}else if((A=A.next)==g)break}else if((A=(S=A).next)==g)break;for(;;){if(0!=A.value&&(null==S||A==S.next)){A=(S=A).next;break}var q=S.value*A.value;if(0==q){A=A.next;break}var U,K=S.next;if(0<q)U=S.positive;else{var W=K.next,Y=K.posx+W.posx,J=K.posy+W.posy,X=(Y*=.5)+1e-8*C,H=(J*=.5)+1e-8*k,$=!1;if(null!=n)for(var Q=n;;){var nn=Q.prev;if((Q.y<H&&nn.y>=H||nn.y<H&&Q.y>=H)&&(Q.x<=X||nn.x<=X)&&Q.x+(H-Q.y)/(nn.y-Q.y)*(nn.x-Q.x)<X&&($=!$),(Q=Q.next)==n)break}U=$}var tn=A;if(null!=K)for(var en=K;en.positive=U,(en=en.next)!=tn;);A=(S=A).next;break}}null==wi.ints&&(wi.ints=new Mi),null==wi.paths&&(wi.paths=new Ci);var pn,ln=null,rn=v.posx,on=v.posy;null==xp.zpp_pool?pn=new xp:(pn=xp.zpp_pool,xp.zpp_pool=pn.next,pn.next=null),pn.forced=!1,pn.x=rn,pn.y=on;var an=pn;null==ln?ln=an.prev=an.next=an:(an.next=ln,an.prev=ln.prev,ln.prev.next=an,ln.prev=an);var sn,_n=ln;null==bi.zpp_pool?sn=new bi:(sn=bi.zpp_pool,bi.zpp_pool=sn.next,sn.next=null),sn.vert=ln,(sn.parent=sn).rank=0,sn.used=!1;var hn=sn;wi.paths.add(hn);for(var un=v;;){var xn,dn=un.next,yn=dn.posx,zn=dn.posy;null==xp.zpp_pool?xn=new xp:(xn=xp.zpp_pool,xp.zpp_pool=xn.next,xn.next=null),xn.forced=!1,xn.x=yn,xn.y=zn;var cn,vn,mn,fn,bn,gn,wn,Mn,Cn,kn,On,Pn,Sn,An,jn,En,In,Tn,Nn,Ln,Vn,Dn,Fn,Rn,Zn,Bn,Gn,qn,Un,Kn,Wn,Yn,Jn,Xn,Hn,$n,Qn,nt=xn;if(un.positive==dn.positive?null==ln?ln=nt.prev=nt.next=nt:(nt.next=ln,nt.prev=ln.prev,ln.prev.next=nt,ln.prev=nt):(vn=cn=0,mn=1/(mn=h*(cn=dn.posx-un.posx)-_*(vn=dn.posy-un.posy)),bn=fn=0,(gn=(vn*(fn=r-un.posx)-cn*(bn=o-un.posy))*mn)<y||z<gn?(null==gi.zpp_pool?wn=new gi:(wn=gi.zpp_pool,gi.zpp_pool=wn.next,wn.next=null),wn.virtualint=!0,wn.end=null,wn.start=null,wn.path0=null,wn.path1=null,wn.time=gn,wn.vertex=!1,wi.ints.add(wn),null==ln?ln=nt.prev=nt.next=nt:(nt.next=ln,nt.prev=ln.prev,ln.prev.next=nt,ln.prev=nt)):0==un.value?(Mn=ln.prev,ln=null,Cn=Mn.x,kn=Mn.y,null==xp.zpp_pool?On=new xp:(On=xp.zpp_pool,xp.zpp_pool=On.next,On.next=null),On.forced=!1,On.x=Cn,On.y=kn,Pn=On,null==ln?ln=Pn.prev=Pn.next=Pn:(Pn.next=ln,Pn.prev=ln.prev,ln.prev.next=Pn,ln.prev=Pn),null==ln?ln=nt.prev=nt.next=nt:(nt.next=ln,nt.prev=ln.prev,ln.prev.next=nt,ln.prev=nt),Sn=wi.paths.head.elt,null==bi.zpp_pool?An=new bi:(An=bi.zpp_pool,bi.zpp_pool=An.next,An.next=null),An.vert=ln,(An.parent=An).rank=0,An.used=!1,wi.paths.add(An),jn=wi.paths.head.elt,null==gi.zpp_pool?En=new gi:(En=gi.zpp_pool,gi.zpp_pool=En.next,En.next=null),En.virtualint=!0,En.end=Mn,En.start=ln,En.path0=Sn,En.path1=jn,En.time=gn,En.vertex=!1,wi.ints.add(En)):0==dn.value?(null==ln?ln=nt.prev=nt.next=nt:(nt.next=ln,nt.prev=ln.prev,ln.prev.next=nt,ln.prev=nt),In=ln.prev,ln=null,Tn=dn.posx,Nn=dn.posy,null==xp.zpp_pool?Ln=new xp:(Ln=xp.zpp_pool,xp.zpp_pool=Ln.next,Ln.next=null),Ln.forced=!1,Ln.x=Tn,Ln.y=Nn,Vn=Ln,null==ln?ln=Vn.prev=Vn.next=Vn:(Vn.next=ln,Vn.prev=ln.prev,ln.prev.next=Vn,ln.prev=Vn),Dn=wi.paths.head.elt,null==bi.zpp_pool?Fn=new bi:(Fn=bi.zpp_pool,bi.zpp_pool=Fn.next,Fn.next=null),Fn.vert=ln,(Fn.parent=Fn).rank=0,Fn.used=!1,wi.paths.add(Fn),Rn=wi.paths.head.elt,null==gi.zpp_pool?Zn=new gi:(Zn=gi.zpp_pool,gi.zpp_pool=Zn.next,Zn.next=null),Zn.virtualint=!0,Zn.end=In,Zn.start=ln,Zn.path0=Dn,Zn.path1=Rn,Zn.time=gn,Zn.vertex=!1,wi.ints.add(Zn)):(Bn=(h*fn-_*bn)*mn,Un=qn=0,qn=un.posx,Un=un.posy,qn+=cn*Bn,Un+=vn*Bn,null==xp.zpp_pool?Gn=new xp:(Gn=xp.zpp_pool,xp.zpp_pool=Gn.next,Gn.next=null),Gn.forced=!1,Gn.x=qn,Gn.y=Un,Kn=Gn,null==ln?ln=Kn.prev=Kn.next=Kn:(Kn.next=ln,Kn.prev=ln.prev,ln.prev.next=Kn,ln.prev=Kn),Wn=ln.prev,(ln=null)==xp.zpp_pool?Yn=new xp:(Yn=xp.zpp_pool,xp.zpp_pool=Yn.next,Yn.next=null),Yn.forced=!1,Yn.x=qn,Yn.y=Un,Jn=Yn,null==ln?ln=Jn.prev=Jn.next=Jn:(Jn.next=ln,Jn.prev=ln.prev,ln.prev.next=Jn,ln.prev=Jn),null==ln?ln=nt.prev=nt.next=nt:(nt.next=ln,nt.prev=ln.prev,ln.prev.next=nt,ln.prev=nt),Xn=wi.paths.head.elt,null==bi.zpp_pool?Hn=new bi:(Hn=bi.zpp_pool,bi.zpp_pool=Hn.next,Hn.next=null),Hn.vert=ln,(Hn.parent=Hn).rank=0,Hn.used=!1,wi.paths.add(Hn),$n=wi.paths.head.elt,null==gi.zpp_pool?Qn=new gi:(Qn=gi.zpp_pool,gi.zpp_pool=Qn.next,Qn.next=null),Qn.virtualint=!1,Qn.end=Wn,Qn.start=ln,Qn.path0=Xn,Qn.path1=$n,Qn.time=gn,Qn.vertex=!1,wi.ints.add(Qn))),(un=un.next)==v)break}var tt=ln.prev;tt.next.prev=_n.prev,_n.prev.next=tt.next,(tt.next=_n).prev=tt;var et,it,pt=wi.paths.head.elt;if(hn==hn.parent)et=hn;else{for(var lt=hn,rt=null;lt!=lt.parent;){var ot=lt.parent;lt.parent=rt,rt=lt,lt=ot}for(;null!=rt;){var at=rt.parent;rt.parent=lt,rt=at}et=lt}if(pt==pt.parent)it=pt;else{for(var st=pt,_t=null;st!=st.parent;){var ht=st.parent;st.parent=_t,_t=st,st=ht}for(;null!=_t;){var ut=_t.parent;_t.parent=st,_t=ut}it=st}et!=it&&(et.rank<it.rank?et.parent=it:et.rank>it.rank?it.parent=et:(it.parent=et).rank++);var xt=wi.ints;if(null!=xt.head&&null!=xt.head.next){for(var dt,yt,zt,ct=xt.head,vt=null,mt=null,ft=null,bt=null,gt=1;;){for(dt=0,mt=ct,vt=ct=null;null!=mt;){for(++dt,ft=mt,yt=0,zt=gt;null!=ft&&yt<gt;)++yt,ft=ft.next;for(;0<yt||0<zt&&null!=ft;)0!=yt&&(0==zt||null==ft||mt.elt.time<ft.elt.time)?(mt=(bt=mt).next,--yt):(ft=(bt=ft).next,--zt),null!=vt?vt.next=bt:ct=bt,vt=bt;mt=ft}if(vt.next=null,gt<<=1,!(1<dt))break}xt.head=ct,xt.modified=!0,xt.pushmod=!0}for(;null!=wi.ints.head;){var wt,Mt,Ct,kt,Ot=wi.ints.pop_unsafe(),Pt=wi.ints.pop_unsafe();if(Ot.virtualint||Pt.virtualint){if(Ot.virtualint&&!Pt.virtualint){var St,At,jt,Et,It,Tt,Nt,Lt,Vt,Dt,Ft,Rt,Zt,Bt,Gt,qt,Ut,Kt,Wt,Yt,Jt,Xt,Ht,$t,Qt=null!=Pt.end&&Pt.end.prev==Pt.end?((Pt.end.next=Pt.end.prev=null)!=(St=Pt.end).wrap&&(St.wrap.zpp_inner._inuse=!1,jt=(At=St.wrap).zpp_inner,At.zpp_inner.outer=null,At.zpp_inner=null,At.zpp_pool=Ri.poolVec2,Ri.poolVec2=At,null!=jt.outer&&(jt.outer.zpp_inner=null,jt.outer=null),jt._isimmutable=null,jt._validate=null,jt._invalidate=null,jt.next=mo.zpp_pool,mo.zpp_pool=jt,St.wrap=null),St.prev=St.next=null,St.next=xp.zpp_pool,xp.zpp_pool=St,null):(Et=Pt.end.prev,Pt.end.prev.next=Pt.end.next,Pt.end.next.prev=Pt.end.prev,(Pt.end.next=Pt.end.prev=null)!=(It=Pt.end).wrap&&(It.wrap.zpp_inner._inuse=!1,Nt=(Tt=It.wrap).zpp_inner,Tt.zpp_inner.outer=null,Tt.zpp_inner=null,Tt.zpp_pool=Ri.poolVec2,Ri.poolVec2=Tt,null!=Nt.outer&&(Nt.outer.zpp_inner=null,Nt.outer=null),Nt._isimmutable=null,Nt._validate=null,Nt._invalidate=null,Nt.next=mo.zpp_pool,mo.zpp_pool=Nt,It.wrap=null),It.prev=It.next=null,It.next=xp.zpp_pool,xp.zpp_pool=It,Pt.end=null,Et);if(Pt.end=Qt,Pt.vertex||(Pt.end!=Pt.path0.vert?(Pt.start.x=Pt.end.x,Pt.start.y=Pt.end.y,Lt=null!=Pt.end&&Pt.end.prev==Pt.end?((Pt.end.next=Pt.end.prev=null)!=(Vt=Pt.end).wrap&&(Vt.wrap.zpp_inner._inuse=!1,Ft=(Dt=Vt.wrap).zpp_inner,Dt.zpp_inner.outer=null,Dt.zpp_inner=null,Dt.zpp_pool=Ri.poolVec2,Ri.poolVec2=Dt,null!=Ft.outer&&(Ft.outer.zpp_inner=null,Ft.outer=null),Ft._isimmutable=null,Ft._validate=null,Ft._invalidate=null,Ft.next=mo.zpp_pool,mo.zpp_pool=Ft,Vt.wrap=null),Vt.prev=Vt.next=null,Vt.next=xp.zpp_pool,xp.zpp_pool=Vt,null):(Rt=Pt.end.prev,Pt.end.prev.next=Pt.end.next,Pt.end.next.prev=Pt.end.prev,(Pt.end.next=Pt.end.prev=null)!=(Zt=Pt.end).wrap&&(Zt.wrap.zpp_inner._inuse=!1,Gt=(Bt=Zt.wrap).zpp_inner,Bt.zpp_inner.outer=null,Bt.zpp_inner=null,Bt.zpp_pool=Ri.poolVec2,Ri.poolVec2=Bt,null!=Gt.outer&&(Gt.outer.zpp_inner=null,Gt.outer=null),Gt._isimmutable=null,Gt._validate=null,Gt._invalidate=null,Gt.next=mo.zpp_pool,mo.zpp_pool=Gt,Zt.wrap=null),Zt.prev=Zt.next=null,Zt.next=xp.zpp_pool,xp.zpp_pool=Zt,Pt.end=null,Rt),Pt.end=Lt):(qt=Pt.start.next,Pt.start.x=qt.x,Pt.start.y=qt.y,null!=qt&&qt.prev==qt?((qt.next=qt.prev=null)!=(Ut=qt).wrap&&(Ut.wrap.zpp_inner._inuse=!1,Wt=(Kt=Ut.wrap).zpp_inner,Kt.zpp_inner.outer=null,Kt.zpp_inner=null,Kt.zpp_pool=Ri.poolVec2,Ri.poolVec2=Kt,null!=Wt.outer&&(Wt.outer.zpp_inner=null,Wt.outer=null),Wt._isimmutable=null,Wt._validate=null,Wt._invalidate=null,Wt.next=mo.zpp_pool,mo.zpp_pool=Wt,Ut.wrap=null),Ut.prev=Ut.next=null,Ut.next=xp.zpp_pool,xp.zpp_pool=Ut,qt=null):(qt.prev.next=qt.next,qt.next.prev=qt.prev,(qt.next=qt.prev=null)!=(Yt=qt).wrap&&(Yt.wrap.zpp_inner._inuse=!1,Xt=(Jt=Yt.wrap).zpp_inner,Jt.zpp_inner.outer=null,Jt.zpp_inner=null,Jt.zpp_pool=Ri.poolVec2,Ri.poolVec2=Jt,null!=Xt.outer&&(Xt.outer.zpp_inner=null,Xt.outer=null),Xt._isimmutable=null,Xt._validate=null,Xt._invalidate=null,Xt.next=mo.zpp_pool,mo.zpp_pool=Xt,Yt.wrap=null),Yt.prev=Yt.next=null,Yt.next=xp.zpp_pool,xp.zpp_pool=Yt))),Pt.end.next.prev=Pt.start.prev,Pt.start.prev.next=Pt.end.next,Pt.end.next=Pt.start,Pt.start.prev=Pt.end,Pt.path0==Pt.path0.parent)Ht=Pt.path0;else{for(var ne=Pt.path0,te=null;ne!=ne.parent;){var ee=ne.parent;ne.parent=te,te=ne,ne=ee}for(;null!=te;){var ie=te.parent;te.parent=ne,te=ie}Ht=ne}if(Pt.path1==Pt.path1.parent)$t=Pt.path1;else{for(var pe=Pt.path1,le=null;pe!=pe.parent;){var re=pe.parent;pe.parent=le,le=pe,pe=re}for(;null!=le;){var oe=le.parent;le.parent=pe,le=oe}$t=pe}Ht!=$t&&(Ht.rank<$t.rank?Ht.parent=$t:Ht.rank>$t.rank?$t.parent=Ht:($t.parent=Ht).rank++)}else if(Pt.virtualint&&!Ot.virtualint){var ae,se,_e,he,ue,xe,de,ye,ze,ce,ve,me,fe,be,ge,we,Me,Ce,ke,Oe,Pe,Se,Ae,je,Ee=null!=Ot.end&&Ot.end.prev==Ot.end?((Ot.end.next=Ot.end.prev=null)!=(ae=Ot.end).wrap&&(ae.wrap.zpp_inner._inuse=!1,_e=(se=ae.wrap).zpp_inner,se.zpp_inner.outer=null,se.zpp_inner=null,se.zpp_pool=Ri.poolVec2,Ri.poolVec2=se,null!=_e.outer&&(_e.outer.zpp_inner=null,_e.outer=null),_e._isimmutable=null,_e._validate=null,_e._invalidate=null,_e.next=mo.zpp_pool,mo.zpp_pool=_e,ae.wrap=null),ae.prev=ae.next=null,ae.next=xp.zpp_pool,xp.zpp_pool=ae,null):(he=Ot.end.prev,Ot.end.prev.next=Ot.end.next,Ot.end.next.prev=Ot.end.prev,(Ot.end.next=Ot.end.prev=null)!=(ue=Ot.end).wrap&&(ue.wrap.zpp_inner._inuse=!1,de=(xe=ue.wrap).zpp_inner,xe.zpp_inner.outer=null,xe.zpp_inner=null,xe.zpp_pool=Ri.poolVec2,Ri.poolVec2=xe,null!=de.outer&&(de.outer.zpp_inner=null,de.outer=null),de._isimmutable=null,de._validate=null,de._invalidate=null,de.next=mo.zpp_pool,mo.zpp_pool=de,ue.wrap=null),ue.prev=ue.next=null,ue.next=xp.zpp_pool,xp.zpp_pool=ue,Ot.end=null,he);if(Ot.end=Ee,Ot.vertex||(Ot.end!=Ot.path0.vert?(Ot.start.x=Ot.end.x,Ot.start.y=Ot.end.y,ye=null!=Ot.end&&Ot.end.prev==Ot.end?((Ot.end.next=Ot.end.prev=null)!=(ze=Ot.end).wrap&&(ze.wrap.zpp_inner._inuse=!1,ve=(ce=ze.wrap).zpp_inner,ce.zpp_inner.outer=null,ce.zpp_inner=null,ce.zpp_pool=Ri.poolVec2,Ri.poolVec2=ce,null!=ve.outer&&(ve.outer.zpp_inner=null,ve.outer=null),ve._isimmutable=null,ve._validate=null,ve._invalidate=null,ve.next=mo.zpp_pool,mo.zpp_pool=ve,ze.wrap=null),ze.prev=ze.next=null,ze.next=xp.zpp_pool,xp.zpp_pool=ze,null):(me=Ot.end.prev,Ot.end.prev.next=Ot.end.next,Ot.end.next.prev=Ot.end.prev,(Ot.end.next=Ot.end.prev=null)!=(fe=Ot.end).wrap&&(fe.wrap.zpp_inner._inuse=!1,ge=(be=fe.wrap).zpp_inner,be.zpp_inner.outer=null,be.zpp_inner=null,be.zpp_pool=Ri.poolVec2,Ri.poolVec2=be,null!=ge.outer&&(ge.outer.zpp_inner=null,ge.outer=null),ge._isimmutable=null,ge._validate=null,ge._invalidate=null,ge.next=mo.zpp_pool,mo.zpp_pool=ge,fe.wrap=null),fe.prev=fe.next=null,fe.next=xp.zpp_pool,xp.zpp_pool=fe,Ot.end=null,me),Ot.end=ye):(we=Ot.start.next,Ot.start.x=we.x,Ot.start.y=we.y,null!=we&&we.prev==we?((we.next=we.prev=null)!=(Me=we).wrap&&(Me.wrap.zpp_inner._inuse=!1,ke=(Ce=Me.wrap).zpp_inner,Ce.zpp_inner.outer=null,Ce.zpp_inner=null,Ce.zpp_pool=Ri.poolVec2,Ri.poolVec2=Ce,null!=ke.outer&&(ke.outer.zpp_inner=null,ke.outer=null),ke._isimmutable=null,ke._validate=null,ke._invalidate=null,ke.next=mo.zpp_pool,mo.zpp_pool=ke,Me.wrap=null),Me.prev=Me.next=null,Me.next=xp.zpp_pool,xp.zpp_pool=Me,we=null):(we.prev.next=we.next,we.next.prev=we.prev,(we.next=we.prev=null)!=(Oe=we).wrap&&(Oe.wrap.zpp_inner._inuse=!1,Se=(Pe=Oe.wrap).zpp_inner,Pe.zpp_inner.outer=null,Pe.zpp_inner=null,Pe.zpp_pool=Ri.poolVec2,Ri.poolVec2=Pe,null!=Se.outer&&(Se.outer.zpp_inner=null,Se.outer=null),Se._isimmutable=null,Se._validate=null,Se._invalidate=null,Se.next=mo.zpp_pool,mo.zpp_pool=Se,Oe.wrap=null),Oe.prev=Oe.next=null,Oe.next=xp.zpp_pool,xp.zpp_pool=Oe))),Ot.end.next.prev=Ot.start.prev,Ot.start.prev.next=Ot.end.next,Ot.end.next=Ot.start,Ot.start.prev=Ot.end,Ot.path0==Ot.path0.parent)Ae=Ot.path0;else{for(var Ie=Ot.path0,Te=null;Ie!=Ie.parent;){var Ne=Ie.parent;Ie.parent=Te,Te=Ie,Ie=Ne}for(;null!=Te;){var Le=Te.parent;Te.parent=Ie,Te=Le}Ae=Ie}if(Ot.path1==Ot.path1.parent)je=Ot.path1;else{for(var Ve=Ot.path1,De=null;Ve!=Ve.parent;){var Fe=Ve.parent;Ve.parent=De,De=Ve,Ve=Fe}for(;null!=De;){var Re=De.parent;De.parent=Ve,De=Re}je=Ve}Ae!=je&&(Ae.rank<je.rank?Ae.parent=je:Ae.rank>je.rank?je.parent=Ae:(je.parent=Ae).rank++)}}else{if(Ot.end.next.prev=Pt.start.prev,Pt.start.prev.next=Ot.end.next,Ot.end.next=Pt.start,Pt.start.prev=Ot.end,Pt.end.next.prev=Ot.start.prev,Ot.start.prev.next=Pt.end.next,Pt.end.next=Ot.start,Ot.start.prev=Pt.end,Ot.path0==Ot.path0.parent)wt=Ot.path0;else{for(var Ze=Ot.path0,Be=null;Ze!=Ze.parent;){var Ge=Ze.parent;Ze.parent=Be,Be=Ze,Ze=Ge}for(;null!=Be;){var qe=Be.parent;Be.parent=Ze,Be=qe}wt=Ze}if(Pt.path1==Pt.path1.parent)Mt=Pt.path1;else{for(var Ue=Pt.path1,Ke=null;Ue!=Ue.parent;){var We=Ue.parent;Ue.parent=Ke,Ke=Ue,Ue=We}for(;null!=Ke;){var Ye=Ke.parent;Ke.parent=Ue,Ke=Ye}Mt=Ue}if(wt!=Mt&&(wt.rank<Mt.rank?wt.parent=Mt:wt.rank>Mt.rank?Mt.parent=wt:(Mt.parent=wt).rank++),Ot.path1==Ot.path1.parent)Ct=Ot.path1;else{for(var Je=Ot.path1,Xe=null;Je!=Je.parent;){var He=Je.parent;Je.parent=Xe,Xe=Je,Je=He}for(;null!=Xe;){var $e=Xe.parent;Xe.parent=Je,Xe=$e}Ct=Je}if(Pt.path0==Pt.path0.parent)kt=Pt.path0;else{for(var Qe=Pt.path0,ni=null;Qe!=Qe.parent;){var ti=Qe.parent;Qe.parent=ni,ni=Qe,Qe=ti}for(;null!=ni;){var ei=ni.parent;ni.parent=Qe,ni=ei}kt=Qe}Ct!=kt&&(Ct.rank<kt.rank?Ct.parent=kt:Ct.rank>kt.rank?kt.parent=Ct:(kt.parent=Ct).rank++)}Ot.end=Ot.start=null,Ot.path0=Ot.path1=null,Ot.next=gi.zpp_pool,gi.zpp_pool=Ot,Pt.end=Pt.start=null,Pt.path0=Pt.path1=null,Pt.next=gi.zpp_pool,gi.zpp_pool=Pt}for(var ii=null==l?new fi:l,pi=wi.paths.head;null!=pi;){var li,ri=pi.elt;if(ri==ri.parent)li=ri;else{for(var oi=ri,ai=null;oi!=oi.parent;){var si=oi.parent;oi.parent=ai,ai=oi,oi=si}for(;null!=ai;){var _i=ai.parent;ai.parent=oi,ai=_i}li=oi}if(li.used)pi=pi.next;else{li.used=!0;for(var hi,ui=li.vert,xi=!0;null!=li.vert&&(xi||ui!=li.vert);)var di,xi=!1,ui=ui.x==ui.next.x&&ui.y==ui.next.y?(ui==li.vert&&(li.vert=ui.next==ui?null:ui.next,xi=!0),null!=ui&&ui.prev==ui?ui.next=ui.prev=null:(di=ui.next,ui.prev.next=ui.next,ui.next.prev=ui.prev,ui.next=ui.prev=null,ui=null,di)):ui.next;null!=li.vert&&((hi=mi.get()).zpp_inner.vertices=li.vert,ii.zpp_inner.reverse_flag?ii.push(hi):ii.unshift(hi)),pi=pi.next}}for(;null!=wi.paths.head;){var yi=wi.paths.pop_unsafe();yi.vert=null,yi.parent=null,yi.next=bi.zpp_pool,bi.zpp_pool=yi}for(;null!=v;)var zi,ci,vi,v=null!=v&&v.prev==v?(v.next=v.prev=null,(zi=v).vert=null,zi.parent=null,zi.next=bi.zpp_pool,bi.zpp_pool=zi,null):(ci=v.next,v.prev.next=v.next,v.next.prev=v.prev,v.next=v.prev=null,(vi=v).vert=null,vi.parent=null,vi.next=bi.zpp_pool,bi.zpp_pool=vi,v=null,ci);return ii},wi.prototype.__class__=wi;var Mt=zpp_nape.geom.ZPP_Geom=function(){};Mt.__name__=["zpp_nape","geom","ZPP_Geom"],Mt.validateShape=function(n){if(1==n.type){var t=n.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var e=t.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var i=t.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var p=t.lverts.next,l=t.gverts.next;null!=l;){var r=l,o=p,p=p.next;r.x=t.body.posx+(t.body.axisy*o.x-t.body.axisx*o.y),r.y=t.body.posy+(o.x*t.body.axisx+o.y*t.body.axisy),l=l.next}}for(var a=t.edges.head,s=_=t.gverts.next,_=_.next;null!=_;){var h=_,u=a.elt,a=a.next;u.gp0=s,u.gp1=h,u.gnormx=t.body.axisy*u.lnormx-t.body.axisx*u.lnormy,u.gnormy=u.lnormx*t.body.axisx+u.lnormy*t.body.axisy,u.gprojection=t.body.posx*u.gnormx+t.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,s=h,_=_.next}var x=a.elt;x.gp0=s,x.gp1=t.gverts.next,x.gnormx=t.body.axisy*x.lnormx-t.body.axisx*x.lnormy,x.gnormy=x.lnormx*t.body.axisx+x.lnormy*t.body.axisy,x.gprojection=t.body.posx*x.gnormx+t.body.posy*x.gnormy+x.lprojection,null!=x.wrap_gnorm&&(x.wrap_gnorm.zpp_inner.x=x.gnormx,x.wrap_gnorm.zpp_inner.y=x.gnormy),x.tp0=x.gp0.y*x.gnormx-x.gp0.x*x.gnormy,x.tp1=x.gp1.y*x.gnormx-x.gp1.x*x.gnormy}}if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var d=n.circle;if(d.zip_worldCOM&&null!=d.body){if(d.zip_worldCOM=!1,d.zip_localCOM){if(d.zip_localCOM=!1,1==d.type){var y=d.polygon;if(null==y.lverts.next.next)y.localCOMx=y.lverts.next.x,y.localCOMy=y.lverts.next.y;else if(null==y.lverts.next.next.next)y.localCOMx=y.lverts.next.x,y.localCOMy=y.lverts.next.y,y.localCOMx+=y.lverts.next.next.x,y.localCOMy+=y.lverts.next.next.y,y.localCOMx*=.5,y.localCOMy*=.5;else{y.localCOMx=0;var z=y.localCOMy=0,c=y.lverts.next,v=c,m=c=c.next;for(c=c.next;null!=c;){var f=c;z+=m.x*(f.y-v.y);var b=f.y*m.x-f.x*m.y;y.localCOMx+=(m.x+f.x)*b,y.localCOMy+=(m.y+f.y)*b,v=m,m=f,c=c.next}var g=c=y.lverts.next;z+=m.x*(g.y-v.y);var w=g.y*m.x-g.x*m.y;y.localCOMx+=(m.x+g.x)*w,y.localCOMy+=(m.y+g.y)*w,v=m;var M=c=c.next;z+=g.x*(M.y-v.y);var C=M.y*g.x-M.x*g.y;y.localCOMx+=(g.x+M.x)*C,y.localCOMy+=(g.y+M.y)*C;var k=z=1/(3*z);y.localCOMx*=k,y.localCOMy*=k}}null!=d.wrap_localCOM&&(d.wrap_localCOM.zpp_inner.x=d.localCOMx,d.wrap_localCOM.zpp_inner.y=d.localCOMy)}var O=d.body;O.zip_axis&&(O.zip_axis=!1,O.axisx=Math.sin(O.rot),O.axisy=Math.cos(O.rot)),d.worldCOMx=d.body.posx+(d.body.axisy*d.localCOMx-d.body.axisx*d.localCOMy),d.worldCOMy=d.body.posy+(d.localCOMx*d.body.axisx+d.localCOMy*d.body.axisy)}var P=d.radius,S=d.radius;d.aabb.minx=d.worldCOMx-P,d.aabb.miny=d.worldCOMy-S,d.aabb.maxx=d.worldCOMx+P,d.aabb.maxy=d.worldCOMy+S}else{var A=n.polygon;if(A.zip_gverts&&null!=A.body){A.zip_gverts=!1,A.validate_lverts();var j=A.body;j.zip_axis&&(j.zip_axis=!1,j.axisx=Math.sin(j.rot),j.axisy=Math.cos(j.rot));for(var E=A.lverts.next,I=A.gverts.next;null!=I;){var T=I,N=E,E=E.next;T.x=A.body.posx+(A.body.axisy*N.x-A.body.axisx*N.y),T.y=A.body.posy+(N.x*A.body.axisx+N.y*A.body.axisy),I=I.next}}var L=A.gverts.next;A.aabb.minx=L.x,A.aabb.miny=L.y,A.aabb.maxx=L.x,A.aabb.maxy=L.y;for(var V=A.gverts.next.next;null!=V;){var D=V;D.x<A.aabb.minx&&(A.aabb.minx=D.x),D.x>A.aabb.maxx&&(A.aabb.maxx=D.x),D.y<A.aabb.miny&&(A.aabb.miny=D.y),D.y>A.aabb.maxy&&(A.aabb.maxy=D.y),V=V.next}}if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var F=n.polygon;if(null==F.lverts.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y;else if(null==F.lverts.next.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y,F.localCOMx+=F.lverts.next.next.x,F.localCOMy+=F.lverts.next.next.y,F.localCOMx*=.5,F.localCOMy*=.5;else{F.localCOMx=0;var R=F.localCOMy=0,Z=F.lverts.next,B=Z,G=Z=Z.next;for(Z=Z.next;null!=Z;){var q=Z;R+=G.x*(q.y-B.y);var U=q.y*G.x-q.x*G.y;F.localCOMx+=(G.x+q.x)*U,F.localCOMy+=(G.y+q.y)*U,B=G,G=q,Z=Z.next}var K=Z=F.lverts.next;R+=G.x*(K.y-B.y);var W=K.y*G.x-K.x*G.y;F.localCOMx+=(G.x+K.x)*W,F.localCOMy+=(G.y+K.y)*W,B=G;var Y=Z=Z.next;R+=K.x*(Y.y-B.y);var J=Y.y*K.x-Y.x*K.y;F.localCOMx+=(K.x+Y.x)*J,F.localCOMy+=(K.y+Y.y)*J;var X=R=1/(3*R);F.localCOMx*=X,F.localCOMy*=X}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var H=n.body;H.zip_axis&&(H.zip_axis=!1,H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}},Mt.prototype.__class__=Mt;var xp=zpp_nape.geom.ZPP_GeomVert=function(){this.forced=!1,this.wrap=null,this.next=null,this.prev=null,this.y=0,this.x=0};xp.__name__=["zpp_nape","geom","ZPP_GeomVert"],xp.get=function(n,t){var e;return null==xp.zpp_pool?e=new xp:(e=xp.zpp_pool,xp.zpp_pool=e.next,e.next=null),e.forced=!1,e.x=n,e.y=t,e},xp.prototype.x=null,xp.prototype.y=null,xp.prototype.prev=null,xp.prototype.next=null,xp.prototype.wrap=null,xp.prototype.forced=null,xp.prototype.free=function(){var n,t;null!=this.wrap&&(this.wrap.zpp_inner._inuse=!1,t=(n=this.wrap).zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Ri.poolVec2,Ri.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=mo.zpp_pool,mo.zpp_pool=t,this.wrap=null),this.prev=this.next=null},xp.prototype.alloc=function(){this.forced=!1},xp.prototype.wrapper=function(){var n,t,e,i,p,l,r;return null==this.wrap&&(n=this.x,t=this.y,null==Ri.poolVec2?e=new at:(e=Ri.poolVec2,Ri.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(p=e.zpp_inner)._validate&&p._validate(),e.zpp_inner.x==n&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,this.wrap=e,this.wrap.zpp_inner._inuse=!0,this.wrap.zpp_inner._invalidate=Q(this,this.modwrap),this.wrap.zpp_inner._validate=Q(this,this.getwrap)),this.wrap},xp.prototype.modwrap=function(n){this.x=n.x,this.y=n.y},xp.prototype.getwrap=function(){this.wrap.zpp_inner.x=this.x,this.wrap.zpp_inner.y=this.y},xp.prototype.__class__=xp;var Ct=zpp_nape.geom.ZPP_GeomPoly=function(n){this.vertices=null,this.outer=null,this.outer=n};Ct.__name__=["zpp_nape","geom","ZPP_GeomPoly"],Ct.prototype.outer=null,Ct.prototype.vertices=null,Ct.prototype.__class__=Ct;var kt=zpp_nape.geom.ZPP_GeomVertexIterator=function(){this.next=null,this.outer=null,this.forward=!1,this.first=!1,this.start=null,this.ptr=null,this.outer=new q};kt.__name__=["zpp_nape","geom","ZPP_GeomVertexIterator"],kt.get=function(n,t){var e;return null==kt.zpp_pool?e=new kt:(e=kt.zpp_pool,kt.zpp_pool=e.next,e.next=null),(e.outer.zpp_inner=e).ptr=n,e.forward=t,e.start=n,e.first=null!=n,e.outer},kt.prototype.ptr=null,kt.prototype.start=null,kt.prototype.first=null,kt.prototype.forward=null,kt.prototype.outer=null,kt.prototype.next=null,kt.prototype.free=function(){this.outer.zpp_inner=null,this.ptr=this.start=null},kt.prototype.alloc=function(){},kt.prototype.__class__=kt;var Ot=zpp_nape.geom.ZPP_MarchSpan=function(){this.next=null,this.out=!1,this.rank=0,this.parent=null,this.parent=this};Ot.__name__=["zpp_nape","geom","ZPP_MarchSpan"],Ot.prototype.parent=null,Ot.prototype.rank=null,Ot.prototype.out=null,Ot.prototype.next=null,Ot.prototype.free=function(){this.parent=this},Ot.prototype.alloc=function(){this.out=!1,this.rank=0},Ot.prototype.__class__=Ot;var dp=zpp_nape.geom.ZPP_MarchPair=function(){this.next=null,this.spanr=null,this.span2=null,this.span1=null,this.pd=null,this.okeyr=0,this.keyr=0,this.pr=null,this.okey2=0,this.key2=0,this.p2=null,this.okey1=0,this.key1=0,this.p1=null};dp.__name__=["zpp_nape","geom","ZPP_MarchPair"],dp.prototype.p1=null,dp.prototype.key1=null,dp.prototype.okey1=null,dp.prototype.p2=null,dp.prototype.key2=null,dp.prototype.okey2=null,dp.prototype.pr=null,dp.prototype.keyr=null,dp.prototype.okeyr=null,dp.prototype.pd=null,dp.prototype.span1=null,dp.prototype.span2=null,dp.prototype.spanr=null,dp.prototype.next=null,dp.prototype.free=function(){this.p1=this.p2=this.pr=this.pd=null,this.span1=this.span2=this.spanr=null},dp.prototype.alloc=function(){},dp.prototype.__class__=dp;var yp=zpp_nape.geom.ZPP_MarchingSquares=function(){};yp.__name__=["zpp_nape","geom","ZPP_MarchingSquares"],yp.isos=null,yp.ints=null,yp.map=null,yp.run=function(n,t,e,i,p,l,r,o,a){var s=i-t,_=l.zpp_inner;null!=_._validate&&_._validate();var h=s/l.zpp_inner.x,u=0|h,x=p-e,d=l.zpp_inner;null!=d._validate&&d._validate();var y=x/l.zpp_inner.y,z=0|y;h!=u&&++u,y!=z&&++z,o&&(null==yp.map?yp.map=new xe(u,z):yp.map.resize(u,z,null)),null==yp.isos?yp.isos=new he(u+1,z+1):yp.isos.resize(u+1,z+1,0);for(var c=0,v=z+1;c<v;){var m,f,b=c++;f=0==b?e:b<=z?(null!=(m=l.zpp_inner)._validate&&m._validate(),e+l.zpp_inner.y*b):p;for(var g=0,w=u+1;g<w;){var M,C,k=g++;C=0==k?t:k<=u?(null!=(M=l.zpp_inner)._validate&&M._validate(),t+l.zpp_inner.x*k):i;var O=yp.isos,P=n(C,f);O.list[b*O.width+k]=P}}null==yp.ints?yp.ints=new ue(u+1,1+(z<<1)):yp.ints.resize(u+1,1+(z<<1),null);var S=null;o&&(null==Ot.zpp_pool?S=new Ot:(S=Ot.zpp_pool,Ot.zpp_pool=S.next,S.next=null),S.out=!1,S.rank=0);for(var A=e,j=0,E=z;j<E;)for(var I,T=j++,N=A,L=T==z-1?p:(null!=(I=l.zpp_inner)._validate&&I._validate(),e+l.zpp_inner.y*(1+T)),A=L,V=t,D=null,F=0,R=u;F<R;){var Z,B,G,q,U,K,W,Y,J,X,H=F++,$=V,Q=H==u-1?i:(null!=(Z=l.zpp_inner)._validate&&Z._validate(),t+l.zpp_inner.x*(1+H)),V=Q,nn=yp.me.marchSquare(n,yp.isos,yp.ints,$,N,Q,L,H,T,0==H||!o,0==T||!o,H==u-1||!o,T==z-1||!o,r);null!=nn?o?(B=null!=nn.p2&&14!=nn.okey2?nn.p2:nn.p1,nn.pd=0==(128&(B==nn.p2?nn.okey2:nn.okey1))?B.prev:B.prev.prev,(G=yp.map).list[T*G.width+H]=nn,null!=D&&(K=0!=(1&(U=1&(q=nn.key1)|(192&q)>>5))?1:0,0!=(2&U)&&++K,0!=(4&U)&&++K,2<=K)?(yp.me.combLR(D,nn),nn.span1=D.spanr):(null==Ot.zpp_pool?nn.span1=new Ot:(nn.span1=Ot.zpp_pool,Ot.zpp_pool=nn.span1.next,nn.span1.next=null),(W=nn.span1).out=!1,W.rank=0,nn.span1.next=S,S=nn.span1),null!=nn.p2?(null==Ot.zpp_pool?nn.span2=new Ot:(nn.span2=Ot.zpp_pool,Ot.zpp_pool=nn.span2.next,nn.span2.next=null),(Y=nn.span2).out=!1,Y.rank=0,nn.span2.next=S,S=nn.span2,nn.spanr=nn.span2):nn.spanr=nn.span1,X=0!=(1&(J=(28&nn.keyr)>>2))?1:0,0!=(2&J)&&++X,0!=(4&J)&&++X,D=2<=X?nn:null):(yp.me.output(a,nn.p1),null!=nn.p2&&yp.me.output(a,nn.p2),nn.p1=nn.p2=nn.pr=nn.pd=null,nn.span1=nn.span2=nn.spanr=null,nn.next=dp.zpp_pool,dp.zpp_pool=nn):D=null}if(o){for(var tn=1,en=z;tn<en;)for(var pn=tn++,ln=null,rn=0,on=u;rn<on;){var an=rn++,sn=yp.map,_n=sn.list[pn*sn.width+an];if(null!=_n){var hn=7&(null!=_n.p2&&14==_n.okey2?_n.okey2:_n.okey1),un=0!=(1&hn)?1:0;if(0!=(2&hn)&&++un,0!=(4&hn)&&++un,un<2)ln=null;else{var xn=yp.map,dn=xn.list[(pn-1)*xn.width+an];if(null!=dn){var yn=(112&(null!=dn.p2&&56==dn.okey2?dn.okey2:dn.okey1))>>4,zn=0!=(1&yn)?1:0;if(0!=(2&yn)&&++zn,0!=(4&yn)&&++zn,zn<2)ln=null;else{var cn,vn,mn,fn,bn=null!=dn.p2&&56==dn.okey2?dn.span2:dn.span1,gn=null!=_n.p2&&14==_n.okey2?_n.span2:_n.span1;if(bn==bn.parent)cn=bn;else{for(var wn=bn,Mn=null;wn!=wn.parent;){var Cn=wn.parent;wn.parent=Mn,Mn=wn,wn=Cn}for(;null!=Mn;){var kn=Mn.parent;Mn.parent=wn,Mn=kn}cn=wn}if(gn==gn.parent)vn=gn;else{for(var On=gn,Pn=null;On!=On.parent;){var Sn=On.parent;On.parent=Pn,Pn=On,On=Sn}for(;null!=Pn;){var An=Pn.parent;Pn.parent=On,Pn=An}vn=On}if(cn==vn)ln!=gn&&yp.me.combUD_virtual(dn,_n);else{if(bn==bn.parent)mn=bn;else{for(var jn=bn,En=null;jn!=jn.parent;){var In=jn.parent;jn.parent=En,En=jn,jn=In}for(;null!=En;){var Tn=En.parent;En.parent=jn,En=Tn}mn=jn}if(gn==gn.parent)fn=gn;else{for(var Nn=gn,Ln=null;Nn!=Nn.parent;){var Vn=Nn.parent;Nn.parent=Ln,Ln=Nn,Nn=Vn}for(;null!=Ln;){var Dn=Ln.parent;Ln.parent=Nn,Ln=Dn}fn=Nn}mn!=fn&&(mn.rank<fn.rank?mn.parent=fn:mn.rank>fn.rank?fn.parent=mn:(fn.parent=mn).rank++),yp.me.combUD(dn,_n)}ln=0!=(4&(gn==_n.span2?_n.okey2:_n.okey1))?gn:null}}else ln=null}}else ln=null}for(var Fn=0,Rn=z;Fn<Rn;)for(var Zn=Fn++,Bn=0,Gn=u;Bn<Gn;){var qn,Un=Bn++,Kn=yp.map,Wn=Kn.list[Zn*Kn.width+Un];if(null!=Wn){if(Wn.span1==Wn.span1.parent)qn=Wn.span1;else{for(var Yn=Wn.span1,Jn=null;Yn!=Yn.parent;){var Xn=Yn.parent;Yn.parent=Jn,Jn=Yn,Yn=Xn}for(;null!=Jn;){var Hn=Jn.parent;Jn.parent=Yn,Jn=Hn}qn=Yn}if(qn.out||(qn.out=!0,yp.me.output(a,Wn.p1)),null!=Wn.p2){if(Wn.span2==Wn.span2.parent)qn=Wn.span2;else{for(var $n=Wn.span2,Qn=null;$n!=$n.parent;){var nt=$n.parent;$n.parent=Qn,Qn=$n,$n=nt}for(;null!=Qn;){var tt=Qn.parent;Qn.parent=$n,Qn=tt}qn=$n}qn.out||(qn.out=!0,yp.me.output(a,Wn.p2))}Wn.p1=Wn.p2=Wn.pr=Wn.pd=null,Wn.span1=Wn.span2=Wn.spanr=null,Wn.next=dp.zpp_pool,dp.zpp_pool=Wn;var et=yp.map;et.list[Zn*et.width+Un]=null}}for(;null!=S;){var it=S,S=it.next;(it.parent=it).next=Ot.zpp_pool,Ot.zpp_pool=it}}},yp.ISO=function(n,t,e){return n(t,e)},yp.prototype.output=function(n,t){var e;if(null==t||t.next==t||t.next==t.prev)o=!0;else{var i=0,p=t;if(null!=t)for(var l=t;;){if(i+=l.x*(l.next.y-l.prev.y),(l=l.next)==p)break}var r=.5*i,o=r*r<co.epsilon*co.epsilon}if(o)for(;null!=t;){t=null!=t&&t.prev==t?t.next=t.prev=null:(e=t.next,t.prev.next=t.next,t.next.prev=t.prev,t.next=t.prev=null,t=null,e)}else{var a=mi.get();a.zpp_inner.vertices=t,n.zpp_inner.reverse_flag?n.push(a):n.unshift(a)}},yp.prototype.linkright=function(n,t){var e=7&t;return 0==e?n:3==e?n.next.next:n.next},yp.prototype.linkleft=function(n,t){return 0==(1&t)?n.prev:n},yp.prototype.linkdown=function(n,t){return 0==(128&t)?n.prev:n.prev.prev},yp.prototype.linkup=function(n,t){return n},yp.prototype.combLR=function(n,t){var e,i,p,l=n.pr,r=7&n.okeyr,o=0==r?l:3==r?l.next.next:l.next,a=t.p1,s=0==(1&t.okey1)?a.prev:a,_=o.next,h=s.prev;0!=(4&n.keyr)?(t.pr==t.p1&&(t.pr=o.prev),t.p1=o.prev,o.prev.next=s.next,s.next.prev=o.prev,null!=(e=o).wrap&&(e.wrap.zpp_inner._inuse=!1,p=(i=e.wrap).zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Ri.poolVec2,Ri.poolVec2=i,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=mo.zpp_pool,mo.zpp_pool=p,e.wrap=null),e.prev=e.next=null,e.next=xp.zpp_pool,xp.zpp_pool=e):(o.next=s.next,s.next.prev=o);var u,x,d,y,z,c,v=s;null!=v.wrap&&(v.wrap.zpp_inner._inuse=!1,x=(u=v.wrap).zpp_inner,u.zpp_inner.outer=null,u.zpp_inner=null,u.zpp_pool=Ri.poolVec2,Ri.poolVec2=u,null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=mo.zpp_pool,mo.zpp_pool=x,v.wrap=null),v.prev=v.next=null,v.next=xp.zpp_pool,xp.zpp_pool=v,0!=(16&n.keyr)?(t.pd=_.next,_.next.prev=h.prev,h.prev.next=_.next,null!=_.wrap&&(_.wrap.zpp_inner._inuse=!1,y=(d=_.wrap).zpp_inner,d.zpp_inner.outer=null,d.zpp_inner=null,d.zpp_pool=Ri.poolVec2,Ri.poolVec2=d,null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=mo.zpp_pool,mo.zpp_pool=y,_.wrap=null),_.prev=_.next=null,_.next=xp.zpp_pool,xp.zpp_pool=_):(_.prev=h.prev,h.prev.next=_),null!=h.wrap&&(h.wrap.zpp_inner._inuse=!1,c=(z=h.wrap).zpp_inner,z.zpp_inner.outer=null,z.zpp_inner=null,z.zpp_pool=Ri.poolVec2,Ri.poolVec2=z,null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=mo.zpp_pool,mo.zpp_pool=c,h.wrap=null),h.prev=h.next=null,h.next=xp.zpp_pool,xp.zpp_pool=h},yp.prototype.combUD=function(n,t){null!=n.p2&&n.key2;var e,i,p,l,r=null!=t.p2&&14==t.key2?t.p2:t.p1,o=n.pd,a=r,s=o.prev,_=a.next;a.next=o.next,o.next.prev=a,null!=o.wrap&&(o.wrap.zpp_inner._inuse=!1,i=(e=o.wrap).zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Ri.poolVec2,Ri.poolVec2=e,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=mo.zpp_pool,mo.zpp_pool=i,o.wrap=null),o.prev=o.next=null,o.next=xp.zpp_pool,xp.zpp_pool=o,_.prev=s.prev,s.prev.next=_,s==n.p1&&(n.p1=_),null!=s.wrap&&(s.wrap.zpp_inner._inuse=!1,l=(p=s.wrap).zpp_inner,p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Ri.poolVec2,Ri.poolVec2=p,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=mo.zpp_pool,mo.zpp_pool=l,s.wrap=null),s.prev=s.next=null,s.next=xp.zpp_pool,xp.zpp_pool=s},yp.prototype.combUD_virtual=function(n,t){null!=n.p2&&n.key2;var e=null!=t.p2&&14==t.key2?t.p2:t.p1,i=n.pd;i.forced=e.forced=i.prev.forced=e.next.forced=!0},yp.prototype.combLeft=function(n){var t=1&n|(192&n)>>5,e=0!=(1&t)?1:0;return 0!=(2&t)&&++e,0!=(4&t)&&++e,2<=e},yp.prototype.combRight=function(n){var t=(28&n)>>2,e=0!=(1&t)?1:0;return 0!=(2&t)&&++e,0!=(4&t)&&++e,2<=e},yp.prototype.combUp=function(n){var t=7&n,e=0!=(1&t)?1:0;return 0!=(2&t)&&++e,0!=(4&t)&&++e,2<=e},yp.prototype.combDown=function(n){var t=(112&n)>>4,e=0!=(1&t)?1:0;return 0!=(2&t)&&++e,0!=(4&t)&&++e,2<=e},yp.prototype.comb=function(n){var t=0!=(1&n)?1:0;return 0!=(2&n)&&++t,0!=(4&n)&&++t,2<=t},yp.prototype.marchSquare=function(n,t,e,i,p,l,r,o,a,s,_,h,u,x){var d=0,y=t.list[a*t.width+o];y<0&&(d=8);var z=t.list[a*t.width+(o+1)];z<0&&(d|=4);var c=t.list[(a+1)*t.width+(o+1)];c<0&&(d|=2);var v,m=t.list[(a+1)*t.width+o];if(m<0&&(d|=1),0==d)return null;if(null==dp.zpp_pool?v=new dp:(v=dp.zpp_pool,dp.zpp_pool=v.next,v.next=null),10!=d&&5!=d){var f=yp.look_march[d];v.okey1=f;for(var b=0;b<8;){var g,w,M,C,k,O,P,S,A,j,E,I,T,N,L,V,D,F,R,Z,B,G,q,U,K,W,Y=b++;0!=(f&1<<Y)&&(j=null,0==Y?(null==xp.zpp_pool?g=new xp:(g=xp.zpp_pool,xp.zpp_pool=g.next,g.next=null),g.forced=!1,g.x=i,g.y=p,j=g,(s||_)&&(j.forced=!0)):2==Y?(null==xp.zpp_pool?w=new xp:(w=xp.zpp_pool,xp.zpp_pool=w.next,w.next=null),w.forced=!1,w.x=l,w.y=p,j=w,(h||_)&&(j.forced=!0)):4==Y?(null==xp.zpp_pool?M=new xp:(M=xp.zpp_pool,xp.zpp_pool=M.next,M.next=null),M.forced=!1,M.x=l,M.y=r,j=M,(h||u)&&(j.forced=!0)):6==Y?(null==xp.zpp_pool?C=new xp:(C=xp.zpp_pool,xp.zpp_pool=C.next,C.next=null),C.forced=!1,C.x=i,C.y=r,j=C,(s||u)&&(j.forced=!0)):1==Y?(null==(j=e.list[(a<<1)*e.width+o])?(k=this.xlerp(i,l,p,y,z,n,x),null==xp.zpp_pool?O=new xp:(O=xp.zpp_pool,xp.zpp_pool=O.next,O.next=null),O.forced=!1,O.x=k,O.y=p,j=O,e.list[(a<<1)*e.width+o]=j):(P=j.x,S=j.y,null==xp.zpp_pool?A=new xp:(A=xp.zpp_pool,xp.zpp_pool=A.next,A.next=null),A.forced=!1,A.x=P,A.y=S,j=A),_&&(j.forced=!0),j.x!=i&&j.x!=l||(j.x==i&&0!=(1&f)||j.x==l&&0!=(4&f))&&(f^=2)):5==Y?(null==(j=e.list[(2+(a<<1))*e.width+o])?(E=this.xlerp(i,l,r,m,c,n,x),null==xp.zpp_pool?I=new xp:(I=xp.zpp_pool,xp.zpp_pool=I.next,I.next=null),I.forced=!1,I.x=E,I.y=r,j=I,e.list[(2+(a<<1))*e.width+o]=j):(T=j.x,N=j.y,null==xp.zpp_pool?L=new xp:(L=xp.zpp_pool,xp.zpp_pool=L.next,L.next=null),L.forced=!1,L.x=T,L.y=N,j=L),u&&(j.forced=!0),j.x!=i&&j.x!=l||(j.x==i&&0!=(64&f)||j.x==l&&0!=(16&f))&&(f^=32)):3==Y?(null==(j=e.list[(1+(a<<1))*e.width+(o+1)])?(V=this.ylerp(p,r,l,z,c,n,x),null==xp.zpp_pool?D=new xp:(D=xp.zpp_pool,xp.zpp_pool=D.next,D.next=null),D.forced=!1,D.x=l,D.y=V,j=D,e.list[(1+(a<<1))*e.width+(o+1)]=j):(F=j.x,R=j.y,null==xp.zpp_pool?Z=new xp:(Z=xp.zpp_pool,xp.zpp_pool=Z.next,Z.next=null),Z.forced=!1,Z.x=F,Z.y=R,j=Z),h&&(j.forced=!0),j.y!=p&&j.y!=r||(j.y==p&&0!=(4&f)||j.y==r&&0!=(16&f))&&(f^=8)):(null==(j=e.list[(1+(a<<1))*e.width+o])?(B=this.ylerp(p,r,i,y,m,n,x),null==xp.zpp_pool?G=new xp:(G=xp.zpp_pool,xp.zpp_pool=G.next,G.next=null),G.forced=!1,G.x=i,G.y=B,j=G,e.list[(1+(a<<1))*e.width+o]=j):(q=j.x,U=j.y,null==xp.zpp_pool?K=new xp:(K=xp.zpp_pool,xp.zpp_pool=K.next,K.next=null),K.forced=!1,K.x=q,K.y=U,j=K),s&&(j.forced=!0),j.y!=p&&j.y!=r||(j.y==p&&0!=(1&f)||j.y==r&&0!=(64&f))&&(f^=128)),W=j,null==v.p1?v.p1=W.prev=W.next=W:(W.prev=v.p1,W.next=v.p1.next,v.p1.next.prev=W,v.p1.next=W),v.p1=W)}v.p1=v.p1.next,1!=(v.key1=f)&&4!=f&&16!=f&&64!=f&&3!=f&&12!=f&&48!=f&&192!=f&&129!=f&&6!=f&&24!=f&&96!=f&&5!=f&&20!=f&&80!=f&&65!=f&&17!=f&&68!=f||(f=0,v.key1=0,v.p1=null),0==f?v=null:(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1)}else{var J=n(.5*(i+l),.5*(p+r))<0;if(10==d)if(J){var X=187;v.okey1=187;for(var H=0;H<8;){var $,Q,nn,tn,en,pn,ln,rn,on,an,sn,_n,hn,un,xn,dn,yn,zn,cn,vn,mn,fn,bn,gn,wn,Mn,Cn=H++;0!=(X&1<<Cn)&&(an=null,0==Cn?(null==xp.zpp_pool?$=new xp:($=xp.zpp_pool,xp.zpp_pool=$.next,$.next=null),$.forced=!1,$.x=i,$.y=p,an=$,(s||_)&&(an.forced=!0)):2==Cn?(null==xp.zpp_pool?Q=new xp:(Q=xp.zpp_pool,xp.zpp_pool=Q.next,Q.next=null),Q.forced=!1,Q.x=l,Q.y=p,an=Q,(h||_)&&(an.forced=!0)):4==Cn?(null==xp.zpp_pool?nn=new xp:(nn=xp.zpp_pool,xp.zpp_pool=nn.next,nn.next=null),nn.forced=!1,nn.x=l,nn.y=r,an=nn,(h||u)&&(an.forced=!0)):6==Cn?(null==xp.zpp_pool?tn=new xp:(tn=xp.zpp_pool,xp.zpp_pool=tn.next,tn.next=null),tn.forced=!1,tn.x=i,tn.y=r,an=tn,(s||u)&&(an.forced=!0)):1==Cn?(null==(an=e.list[(a<<1)*e.width+o])?(en=this.xlerp(i,l,p,y,z,n,x),null==xp.zpp_pool?pn=new xp:(pn=xp.zpp_pool,xp.zpp_pool=pn.next,pn.next=null),pn.forced=!1,pn.x=en,pn.y=p,an=pn,e.list[(a<<1)*e.width+o]=an):(ln=an.x,rn=an.y,null==xp.zpp_pool?on=new xp:(on=xp.zpp_pool,xp.zpp_pool=on.next,on.next=null),on.forced=!1,on.x=ln,on.y=rn,an=on),_&&(an.forced=!0),an.x!=i&&an.x!=l||(an.x==i&&0!=(1&X)||an.x==l&&0!=(4&X))&&(X^=2)):5==Cn?(null==(an=e.list[(2+(a<<1))*e.width+o])?(sn=this.xlerp(i,l,r,m,c,n,x),null==xp.zpp_pool?_n=new xp:(_n=xp.zpp_pool,xp.zpp_pool=_n.next,_n.next=null),_n.forced=!1,_n.x=sn,_n.y=r,an=_n,e.list[(2+(a<<1))*e.width+o]=an):(hn=an.x,un=an.y,null==xp.zpp_pool?xn=new xp:(xn=xp.zpp_pool,xp.zpp_pool=xn.next,xn.next=null),xn.forced=!1,xn.x=hn,xn.y=un,an=xn),u&&(an.forced=!0),an.x!=i&&an.x!=l||(an.x==i&&0!=(64&X)||an.x==l&&0!=(16&X))&&(X^=32)):3==Cn?(null==(an=e.list[(1+(a<<1))*e.width+(o+1)])?(dn=this.ylerp(p,r,l,z,c,n,x),null==xp.zpp_pool?yn=new xp:(yn=xp.zpp_pool,xp.zpp_pool=yn.next,yn.next=null),yn.forced=!1,yn.x=l,yn.y=dn,an=yn,e.list[(1+(a<<1))*e.width+(o+1)]=an):(zn=an.x,cn=an.y,null==xp.zpp_pool?vn=new xp:(vn=xp.zpp_pool,xp.zpp_pool=vn.next,vn.next=null),vn.forced=!1,vn.x=zn,vn.y=cn,an=vn),h&&(an.forced=!0),an.y!=p&&an.y!=r||(an.y==p&&0!=(4&X)||an.y==r&&0!=(16&X))&&(X^=8)):(null==(an=e.list[(1+(a<<1))*e.width+o])?(mn=this.ylerp(p,r,i,y,m,n,x),null==xp.zpp_pool?fn=new xp:(fn=xp.zpp_pool,xp.zpp_pool=fn.next,fn.next=null),fn.forced=!1,fn.x=i,fn.y=mn,an=fn,e.list[(1+(a<<1))*e.width+o]=an):(bn=an.x,gn=an.y,null==xp.zpp_pool?wn=new xp:(wn=xp.zpp_pool,xp.zpp_pool=wn.next,wn.next=null),wn.forced=!1,wn.x=bn,wn.y=gn,an=wn),s&&(an.forced=!0),an.y!=p&&an.y!=r||(an.y==p&&0!=(1&X)||an.y==r&&0!=(64&X))&&(X^=128)),Mn=an,null==v.p1?v.p1=Mn.prev=Mn.next=Mn:(Mn.prev=v.p1,Mn.next=v.p1.next,v.p1.next.prev=Mn,v.p1.next=Mn),v.p1=Mn)}v.p1=v.p1.next,1!=(v.key1=X)&&4!=X&&16!=X&&64!=X&&3!=X&&12!=X&&48!=X&&192!=X&&129!=X&&6!=X&&24!=X&&96!=X&&5!=X&&20!=X&&80!=X&&65!=X&&17!=X&&68!=X||(X=0,v.key1=0,v.p1=null),0==X?v=null:(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1)}else{var kn=131;v.okey1=131;for(var On=0;On<8;){var Pn,Sn,An,jn,En,In,Tn,Nn,Ln,Vn,Dn,Fn,Rn,Zn,Bn,Gn,qn,Un,Kn,Wn,Yn,Jn,Xn,Hn,$n,Qn,nt=On++;0!=(kn&1<<nt)&&(Vn=null,0==nt?(null==xp.zpp_pool?Pn=new xp:(Pn=xp.zpp_pool,xp.zpp_pool=Pn.next,Pn.next=null),Pn.forced=!1,Pn.x=i,Pn.y=p,Vn=Pn,(s||_)&&(Vn.forced=!0)):2==nt?(null==xp.zpp_pool?Sn=new xp:(Sn=xp.zpp_pool,xp.zpp_pool=Sn.next,Sn.next=null),Sn.forced=!1,Sn.x=l,Sn.y=p,Vn=Sn,(h||_)&&(Vn.forced=!0)):4==nt?(null==xp.zpp_pool?An=new xp:(An=xp.zpp_pool,xp.zpp_pool=An.next,An.next=null),An.forced=!1,An.x=l,An.y=r,Vn=An,(h||u)&&(Vn.forced=!0)):6==nt?(null==xp.zpp_pool?jn=new xp:(jn=xp.zpp_pool,xp.zpp_pool=jn.next,jn.next=null),jn.forced=!1,jn.x=i,jn.y=r,Vn=jn,(s||u)&&(Vn.forced=!0)):1==nt?(null==(Vn=e.list[(a<<1)*e.width+o])?(En=this.xlerp(i,l,p,y,z,n,x),null==xp.zpp_pool?In=new xp:(In=xp.zpp_pool,xp.zpp_pool=In.next,In.next=null),In.forced=!1,In.x=En,In.y=p,Vn=In,e.list[(a<<1)*e.width+o]=Vn):(Tn=Vn.x,Nn=Vn.y,null==xp.zpp_pool?Ln=new xp:(Ln=xp.zpp_pool,xp.zpp_pool=Ln.next,Ln.next=null),Ln.forced=!1,Ln.x=Tn,Ln.y=Nn,Vn=Ln),_&&(Vn.forced=!0),Vn.x!=i&&Vn.x!=l||(Vn.x==i&&0!=(1&kn)||Vn.x==l&&0!=(4&kn))&&(kn^=2)):5==nt?(null==(Vn=e.list[(2+(a<<1))*e.width+o])?(Dn=this.xlerp(i,l,r,m,c,n,x),null==xp.zpp_pool?Fn=new xp:(Fn=xp.zpp_pool,xp.zpp_pool=Fn.next,Fn.next=null),Fn.forced=!1,Fn.x=Dn,Fn.y=r,Vn=Fn,e.list[(2+(a<<1))*e.width+o]=Vn):(Rn=Vn.x,Zn=Vn.y,null==xp.zpp_pool?Bn=new xp:(Bn=xp.zpp_pool,xp.zpp_pool=Bn.next,Bn.next=null),Bn.forced=!1,Bn.x=Rn,Bn.y=Zn,Vn=Bn),u&&(Vn.forced=!0),Vn.x!=i&&Vn.x!=l||(Vn.x==i&&0!=(64&kn)||Vn.x==l&&0!=(16&kn))&&(kn^=32)):3==nt?(null==(Vn=e.list[(1+(a<<1))*e.width+(o+1)])?(Gn=this.ylerp(p,r,l,z,c,n,x),null==xp.zpp_pool?qn=new xp:(qn=xp.zpp_pool,xp.zpp_pool=qn.next,qn.next=null),qn.forced=!1,qn.x=l,qn.y=Gn,Vn=qn,e.list[(1+(a<<1))*e.width+(o+1)]=Vn):(Un=Vn.x,Kn=Vn.y,null==xp.zpp_pool?Wn=new xp:(Wn=xp.zpp_pool,xp.zpp_pool=Wn.next,Wn.next=null),Wn.forced=!1,Wn.x=Un,Wn.y=Kn,Vn=Wn),h&&(Vn.forced=!0),Vn.y!=p&&Vn.y!=r||(Vn.y==p&&0!=(4&kn)||Vn.y==r&&0!=(16&kn))&&(kn^=8)):(null==(Vn=e.list[(1+(a<<1))*e.width+o])?(Yn=this.ylerp(p,r,i,y,m,n,x),null==xp.zpp_pool?Jn=new xp:(Jn=xp.zpp_pool,xp.zpp_pool=Jn.next,Jn.next=null),Jn.forced=!1,Jn.x=i,Jn.y=Yn,Vn=Jn,e.list[(1+(a<<1))*e.width+o]=Vn):(Xn=Vn.x,Hn=Vn.y,null==xp.zpp_pool?$n=new xp:($n=xp.zpp_pool,xp.zpp_pool=$n.next,$n.next=null),$n.forced=!1,$n.x=Xn,$n.y=Hn,Vn=$n),s&&(Vn.forced=!0),Vn.y!=p&&Vn.y!=r||(Vn.y==p&&0!=(1&kn)||Vn.y==r&&0!=(64&kn))&&(kn^=128)),Qn=Vn,null==v.p1?v.p1=Qn.prev=Qn.next=Qn:(Qn.prev=v.p1,Qn.next=v.p1.next,v.p1.next.prev=Qn,v.p1.next=Qn),v.p1=Qn)}if(v.p1=v.p1.next,1!=(v.key1=kn)&&4!=kn&&16!=kn&&64!=kn&&3!=kn&&12!=kn&&48!=kn&&192!=kn&&129!=kn&&6!=kn&&24!=kn&&96!=kn&&5!=kn&&20!=kn&&80!=kn&&65!=kn&&17!=kn&&68!=kn||(kn=0,v.key1=0,v.p1=null),0!=kn){var tt=56;v.okey2=56;for(var et=0;et<8;){var it,pt,lt,rt,ot,at,st,_t,ht,ut,xt,dt,yt,zt,ct,vt,mt,ft,bt,gt,wt,Mt,Ct,kt,Ot,Pt,St=et++;0!=(tt&1<<St)&&(ut=null,0==St?(null==xp.zpp_pool?it=new xp:(it=xp.zpp_pool,xp.zpp_pool=it.next,it.next=null),it.forced=!1,it.x=i,it.y=p,ut=it,(s||_)&&(ut.forced=!0)):2==St?(null==xp.zpp_pool?pt=new xp:(pt=xp.zpp_pool,xp.zpp_pool=pt.next,pt.next=null),pt.forced=!1,pt.x=l,pt.y=p,ut=pt,(h||_)&&(ut.forced=!0)):4==St?(null==xp.zpp_pool?lt=new xp:(lt=xp.zpp_pool,xp.zpp_pool=lt.next,lt.next=null),lt.forced=!1,lt.x=l,lt.y=r,ut=lt,(h||u)&&(ut.forced=!0)):6==St?(null==xp.zpp_pool?rt=new xp:(rt=xp.zpp_pool,xp.zpp_pool=rt.next,rt.next=null),rt.forced=!1,rt.x=i,rt.y=r,ut=rt,(s||u)&&(ut.forced=!0)):1==St?(null==(ut=e.list[(a<<1)*e.width+o])?(ot=this.xlerp(i,l,p,y,z,n,x),null==xp.zpp_pool?at=new xp:(at=xp.zpp_pool,xp.zpp_pool=at.next,at.next=null),at.forced=!1,at.x=ot,at.y=p,ut=at,e.list[(a<<1)*e.width+o]=ut):(st=ut.x,_t=ut.y,null==xp.zpp_pool?ht=new xp:(ht=xp.zpp_pool,xp.zpp_pool=ht.next,ht.next=null),ht.forced=!1,ht.x=st,ht.y=_t,ut=ht),_&&(ut.forced=!0),ut.x!=i&&ut.x!=l||(ut.x==i&&0!=(1&tt)||ut.x==l&&0!=(4&tt))&&(tt^=2)):5==St?(null==(ut=e.list[(2+(a<<1))*e.width+o])?(xt=this.xlerp(i,l,r,m,c,n,x),null==xp.zpp_pool?dt=new xp:(dt=xp.zpp_pool,xp.zpp_pool=dt.next,dt.next=null),dt.forced=!1,dt.x=xt,dt.y=r,ut=dt,e.list[(2+(a<<1))*e.width+o]=ut):(yt=ut.x,zt=ut.y,null==xp.zpp_pool?ct=new xp:(ct=xp.zpp_pool,xp.zpp_pool=ct.next,ct.next=null),ct.forced=!1,ct.x=yt,ct.y=zt,ut=ct),u&&(ut.forced=!0),ut.x!=i&&ut.x!=l||(ut.x==i&&0!=(64&tt)||ut.x==l&&0!=(16&tt))&&(tt^=32)):3==St?(null==(ut=e.list[(1+(a<<1))*e.width+(o+1)])?(vt=this.ylerp(p,r,l,z,c,n,x),null==xp.zpp_pool?mt=new xp:(mt=xp.zpp_pool,xp.zpp_pool=mt.next,mt.next=null),mt.forced=!1,mt.x=l,mt.y=vt,ut=mt,e.list[(1+(a<<1))*e.width+(o+1)]=ut):(ft=ut.x,bt=ut.y,null==xp.zpp_pool?gt=new xp:(gt=xp.zpp_pool,xp.zpp_pool=gt.next,gt.next=null),gt.forced=!1,gt.x=ft,gt.y=bt,ut=gt),h&&(ut.forced=!0),ut.y!=p&&ut.y!=r||(ut.y==p&&0!=(4&tt)||ut.y==r&&0!=(16&tt))&&(tt^=8)):(null==(ut=e.list[(1+(a<<1))*e.width+o])?(wt=this.ylerp(p,r,i,y,m,n,x),null==xp.zpp_pool?Mt=new xp:(Mt=xp.zpp_pool,xp.zpp_pool=Mt.next,Mt.next=null),Mt.forced=!1,Mt.x=i,Mt.y=wt,ut=Mt,e.list[(1+(a<<1))*e.width+o]=ut):(Ct=ut.x,kt=ut.y,null==xp.zpp_pool?Ot=new xp:(Ot=xp.zpp_pool,xp.zpp_pool=Ot.next,Ot.next=null),Ot.forced=!1,Ot.x=Ct,Ot.y=kt,ut=Ot),s&&(ut.forced=!0),ut.y!=p&&ut.y!=r||(ut.y==p&&0!=(1&tt)||ut.y==r&&0!=(64&tt))&&(tt^=128)),Pt=ut,null==v.p2?v.p2=Pt.prev=Pt.next=Pt:(Pt.prev=v.p2,Pt.next=v.p2.next,v.p2.next.prev=Pt,v.p2.next=Pt),v.p2=Pt)}v.p2=v.p2.next,1!=(v.key2=tt)&&4!=tt&&16!=tt&&64!=tt&&3!=tt&&12!=tt&&48!=tt&&192!=tt&&129!=tt&&6!=tt&&24!=tt&&96!=tt&&5!=tt&&20!=tt&&80!=tt&&65!=tt&&17!=tt&&68!=tt||(tt=0,v.key2=0,v.p2=null),0==tt?(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1):(v.pr=v.p2,v.okeyr=v.okey2,v.keyr=v.key2)}else{var At=56;v.okey1=56;for(var jt=0;jt<8;){var Et,It,Tt,Nt,Lt,Vt,Dt,Ft,Rt,Zt,Bt,Gt,qt,Ut,Kt,Wt,Yt,Jt,Xt,Ht,$t,Qt,ne,te,ee,ie,pe=jt++;0!=(At&1<<pe)&&(Zt=null,0==pe?(null==xp.zpp_pool?Et=new xp:(Et=xp.zpp_pool,xp.zpp_pool=Et.next,Et.next=null),Et.forced=!1,Et.x=i,Et.y=p,Zt=Et,(s||_)&&(Zt.forced=!0)):2==pe?(null==xp.zpp_pool?It=new xp:(It=xp.zpp_pool,xp.zpp_pool=It.next,It.next=null),It.forced=!1,It.x=l,It.y=p,Zt=It,(h||_)&&(Zt.forced=!0)):4==pe?(null==xp.zpp_pool?Tt=new xp:(Tt=xp.zpp_pool,xp.zpp_pool=Tt.next,Tt.next=null),Tt.forced=!1,Tt.x=l,Tt.y=r,Zt=Tt,(h||u)&&(Zt.forced=!0)):6==pe?(null==xp.zpp_pool?Nt=new xp:(Nt=xp.zpp_pool,xp.zpp_pool=Nt.next,Nt.next=null),Nt.forced=!1,Nt.x=i,Nt.y=r,Zt=Nt,(s||u)&&(Zt.forced=!0)):1==pe?(null==(Zt=e.list[(a<<1)*e.width+o])?(Lt=this.xlerp(i,l,p,y,z,n,x),null==xp.zpp_pool?Vt=new xp:(Vt=xp.zpp_pool,xp.zpp_pool=Vt.next,Vt.next=null),Vt.forced=!1,Vt.x=Lt,Vt.y=p,Zt=Vt,e.list[(a<<1)*e.width+o]=Zt):(Dt=Zt.x,Ft=Zt.y,null==xp.zpp_pool?Rt=new xp:(Rt=xp.zpp_pool,xp.zpp_pool=Rt.next,Rt.next=null),Rt.forced=!1,Rt.x=Dt,Rt.y=Ft,Zt=Rt),_&&(Zt.forced=!0),Zt.x!=i&&Zt.x!=l||(Zt.x==i&&0!=(1&At)||Zt.x==l&&0!=(4&At))&&(At^=2)):5==pe?(null==(Zt=e.list[(2+(a<<1))*e.width+o])?(Bt=this.xlerp(i,l,r,m,c,n,x),null==xp.zpp_pool?Gt=new xp:(Gt=xp.zpp_pool,xp.zpp_pool=Gt.next,Gt.next=null),Gt.forced=!1,Gt.x=Bt,Gt.y=r,Zt=Gt,e.list[(2+(a<<1))*e.width+o]=Zt):(qt=Zt.x,Ut=Zt.y,null==xp.zpp_pool?Kt=new xp:(Kt=xp.zpp_pool,xp.zpp_pool=Kt.next,Kt.next=null),Kt.forced=!1,Kt.x=qt,Kt.y=Ut,Zt=Kt),u&&(Zt.forced=!0),Zt.x!=i&&Zt.x!=l||(Zt.x==i&&0!=(64&At)||Zt.x==l&&0!=(16&At))&&(At^=32)):3==pe?(null==(Zt=e.list[(1+(a<<1))*e.width+(o+1)])?(Wt=this.ylerp(p,r,l,z,c,n,x),null==xp.zpp_pool?Yt=new xp:(Yt=xp.zpp_pool,xp.zpp_pool=Yt.next,Yt.next=null),Yt.forced=!1,Yt.x=l,Yt.y=Wt,Zt=Yt,e.list[(1+(a<<1))*e.width+(o+1)]=Zt):(Jt=Zt.x,Xt=Zt.y,null==xp.zpp_pool?Ht=new xp:(Ht=xp.zpp_pool,xp.zpp_pool=Ht.next,Ht.next=null),Ht.forced=!1,Ht.x=Jt,Ht.y=Xt,Zt=Ht),h&&(Zt.forced=!0),Zt.y!=p&&Zt.y!=r||(Zt.y==p&&0!=(4&At)||Zt.y==r&&0!=(16&At))&&(At^=8)):(null==(Zt=e.list[(1+(a<<1))*e.width+o])?($t=this.ylerp(p,r,i,y,m,n,x),null==xp.zpp_pool?Qt=new xp:(Qt=xp.zpp_pool,xp.zpp_pool=Qt.next,Qt.next=null),Qt.forced=!1,Qt.x=i,Qt.y=$t,Zt=Qt,e.list[(1+(a<<1))*e.width+o]=Zt):(ne=Zt.x,te=Zt.y,null==xp.zpp_pool?ee=new xp:(ee=xp.zpp_pool,xp.zpp_pool=ee.next,ee.next=null),ee.forced=!1,ee.x=ne,ee.y=te,Zt=ee),s&&(Zt.forced=!0),Zt.y!=p&&Zt.y!=r||(Zt.y==p&&0!=(1&At)||Zt.y==r&&0!=(64&At))&&(At^=128)),ie=Zt,null==v.p1?v.p1=ie.prev=ie.next=ie:(ie.prev=v.p1,ie.next=v.p1.next,v.p1.next.prev=ie,v.p1.next=ie),v.p1=ie)}v.p1=v.p1.next,1!=(v.key1=At)&&4!=At&&16!=At&&64!=At&&3!=At&&12!=At&&48!=At&&192!=At&&129!=At&&6!=At&&24!=At&&96!=At&&5!=At&&20!=At&&80!=At&&65!=At&&17!=At&&68!=At||(At=0,v.key1=0,v.p1=null),0==At?v=null:(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1)}}else if(J){var le=238;v.okey1=238;for(var re=0;re<8;){var oe,ae,se,_e,he,ue,xe,de,ye,ze,ce,ve,me,fe,be,ge,we,Me,Ce,ke,Oe,Pe,Se,Ae,je,Ee,Ie=re++;0!=(le&1<<Ie)&&(ze=null,0==Ie?(null==xp.zpp_pool?oe=new xp:(oe=xp.zpp_pool,xp.zpp_pool=oe.next,oe.next=null),oe.forced=!1,oe.x=i,oe.y=p,ze=oe,(s||_)&&(ze.forced=!0)):2==Ie?(null==xp.zpp_pool?ae=new xp:(ae=xp.zpp_pool,xp.zpp_pool=ae.next,ae.next=null),ae.forced=!1,ae.x=l,ae.y=p,ze=ae,(h||_)&&(ze.forced=!0)):4==Ie?(null==xp.zpp_pool?se=new xp:(se=xp.zpp_pool,xp.zpp_pool=se.next,se.next=null),se.forced=!1,se.x=l,se.y=r,ze=se,(h||u)&&(ze.forced=!0)):6==Ie?(null==xp.zpp_pool?_e=new xp:(_e=xp.zpp_pool,xp.zpp_pool=_e.next,_e.next=null),_e.forced=!1,_e.x=i,_e.y=r,ze=_e,(s||u)&&(ze.forced=!0)):1==Ie?(null==(ze=e.list[(a<<1)*e.width+o])?(he=this.xlerp(i,l,p,y,z,n,x),null==xp.zpp_pool?ue=new xp:(ue=xp.zpp_pool,xp.zpp_pool=ue.next,ue.next=null),ue.forced=!1,ue.x=he,ue.y=p,ze=ue,e.list[(a<<1)*e.width+o]=ze):(xe=ze.x,de=ze.y,null==xp.zpp_pool?ye=new xp:(ye=xp.zpp_pool,xp.zpp_pool=ye.next,ye.next=null),ye.forced=!1,ye.x=xe,ye.y=de,ze=ye),_&&(ze.forced=!0),ze.x!=i&&ze.x!=l||(ze.x==i&&0!=(1&le)||ze.x==l&&0!=(4&le))&&(le^=2)):5==Ie?(null==(ze=e.list[(2+(a<<1))*e.width+o])?(ce=this.xlerp(i,l,r,m,c,n,x),null==xp.zpp_pool?ve=new xp:(ve=xp.zpp_pool,xp.zpp_pool=ve.next,ve.next=null),ve.forced=!1,ve.x=ce,ve.y=r,ze=ve,e.list[(2+(a<<1))*e.width+o]=ze):(me=ze.x,fe=ze.y,null==xp.zpp_pool?be=new xp:(be=xp.zpp_pool,xp.zpp_pool=be.next,be.next=null),be.forced=!1,be.x=me,be.y=fe,ze=be),u&&(ze.forced=!0),ze.x!=i&&ze.x!=l||(ze.x==i&&0!=(64&le)||ze.x==l&&0!=(16&le))&&(le^=32)):3==Ie?(null==(ze=e.list[(1+(a<<1))*e.width+(o+1)])?(ge=this.ylerp(p,r,l,z,c,n,x),null==xp.zpp_pool?we=new xp:(we=xp.zpp_pool,xp.zpp_pool=we.next,we.next=null),we.forced=!1,we.x=l,we.y=ge,ze=we,e.list[(1+(a<<1))*e.width+(o+1)]=ze):(Me=ze.x,Ce=ze.y,null==xp.zpp_pool?ke=new xp:(ke=xp.zpp_pool,xp.zpp_pool=ke.next,ke.next=null),ke.forced=!1,ke.x=Me,ke.y=Ce,ze=ke),h&&(ze.forced=!0),ze.y!=p&&ze.y!=r||(ze.y==p&&0!=(4&le)||ze.y==r&&0!=(16&le))&&(le^=8)):(null==(ze=e.list[(1+(a<<1))*e.width+o])?(Oe=this.ylerp(p,r,i,y,m,n,x),null==xp.zpp_pool?Pe=new xp:(Pe=xp.zpp_pool,xp.zpp_pool=Pe.next,Pe.next=null),Pe.forced=!1,Pe.x=i,Pe.y=Oe,ze=Pe,e.list[(1+(a<<1))*e.width+o]=ze):(Se=ze.x,Ae=ze.y,null==xp.zpp_pool?je=new xp:(je=xp.zpp_pool,xp.zpp_pool=je.next,je.next=null),je.forced=!1,je.x=Se,je.y=Ae,ze=je),s&&(ze.forced=!0),ze.y!=p&&ze.y!=r||(ze.y==p&&0!=(1&le)||ze.y==r&&0!=(64&le))&&(le^=128)),Ee=ze,null==v.p1?v.p1=Ee.prev=Ee.next=Ee:(Ee.prev=v.p1,Ee.next=v.p1.next,v.p1.next.prev=Ee,v.p1.next=Ee),v.p1=Ee)}v.p1=v.p1.next,1!=(v.key1=le)&&4!=le&&16!=le&&64!=le&&3!=le&&12!=le&&48!=le&&192!=le&&129!=le&&6!=le&&24!=le&&96!=le&&5!=le&&20!=le&&80!=le&&65!=le&&17!=le&&68!=le||(le=0,v.key1=0,v.p1=null),0==le?v=null:(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1)}else{var Te=224;v.okey1=224;for(var Ne=0;Ne<8;){var Le,Ve,De,Fe,Re,Ze,Be,Ge,qe,Ue,Ke,We,Ye,Je,Xe,He,$e,Qe,ni,ti,ei,ii,pi,li,ri,oi,ai=Ne++;0!=(Te&1<<ai)&&(Ue=null,0==ai?(null==xp.zpp_pool?Le=new xp:(Le=xp.zpp_pool,xp.zpp_pool=Le.next,Le.next=null),Le.forced=!1,Le.x=i,Le.y=p,Ue=Le,(s||_)&&(Ue.forced=!0)):2==ai?(null==xp.zpp_pool?Ve=new xp:(Ve=xp.zpp_pool,xp.zpp_pool=Ve.next,Ve.next=null),Ve.forced=!1,Ve.x=l,Ve.y=p,Ue=Ve,(h||_)&&(Ue.forced=!0)):4==ai?(null==xp.zpp_pool?De=new xp:(De=xp.zpp_pool,xp.zpp_pool=De.next,De.next=null),De.forced=!1,De.x=l,De.y=r,Ue=De,(h||u)&&(Ue.forced=!0)):6==ai?(null==xp.zpp_pool?Fe=new xp:(Fe=xp.zpp_pool,xp.zpp_pool=Fe.next,Fe.next=null),Fe.forced=!1,Fe.x=i,Fe.y=r,Ue=Fe,(s||u)&&(Ue.forced=!0)):1==ai?(null==(Ue=e.list[(a<<1)*e.width+o])?(Re=this.xlerp(i,l,p,y,z,n,x),null==xp.zpp_pool?Ze=new xp:(Ze=xp.zpp_pool,xp.zpp_pool=Ze.next,Ze.next=null),Ze.forced=!1,Ze.x=Re,Ze.y=p,Ue=Ze,e.list[(a<<1)*e.width+o]=Ue):(Be=Ue.x,Ge=Ue.y,null==xp.zpp_pool?qe=new xp:(qe=xp.zpp_pool,xp.zpp_pool=qe.next,qe.next=null),qe.forced=!1,qe.x=Be,qe.y=Ge,Ue=qe),_&&(Ue.forced=!0),Ue.x!=i&&Ue.x!=l||(Ue.x==i&&0!=(1&Te)||Ue.x==l&&0!=(4&Te))&&(Te^=2)):5==ai?(null==(Ue=e.list[(2+(a<<1))*e.width+o])?(Ke=this.xlerp(i,l,r,m,c,n,x),null==xp.zpp_pool?We=new xp:(We=xp.zpp_pool,xp.zpp_pool=We.next,We.next=null),We.forced=!1,We.x=Ke,We.y=r,Ue=We,e.list[(2+(a<<1))*e.width+o]=Ue):(Ye=Ue.x,Je=Ue.y,null==xp.zpp_pool?Xe=new xp:(Xe=xp.zpp_pool,xp.zpp_pool=Xe.next,Xe.next=null),Xe.forced=!1,Xe.x=Ye,Xe.y=Je,Ue=Xe),u&&(Ue.forced=!0),Ue.x!=i&&Ue.x!=l||(Ue.x==i&&0!=(64&Te)||Ue.x==l&&0!=(16&Te))&&(Te^=32)):3==ai?(null==(Ue=e.list[(1+(a<<1))*e.width+(o+1)])?(He=this.ylerp(p,r,l,z,c,n,x),null==xp.zpp_pool?$e=new xp:($e=xp.zpp_pool,xp.zpp_pool=$e.next,$e.next=null),$e.forced=!1,$e.x=l,$e.y=He,Ue=$e,e.list[(1+(a<<1))*e.width+(o+1)]=Ue):(Qe=Ue.x,ni=Ue.y,null==xp.zpp_pool?ti=new xp:(ti=xp.zpp_pool,xp.zpp_pool=ti.next,ti.next=null),ti.forced=!1,ti.x=Qe,ti.y=ni,Ue=ti),h&&(Ue.forced=!0),Ue.y!=p&&Ue.y!=r||(Ue.y==p&&0!=(4&Te)||Ue.y==r&&0!=(16&Te))&&(Te^=8)):(null==(Ue=e.list[(1+(a<<1))*e.width+o])?(ei=this.ylerp(p,r,i,y,m,n,x),null==xp.zpp_pool?ii=new xp:(ii=xp.zpp_pool,xp.zpp_pool=ii.next,ii.next=null),ii.forced=!1,ii.x=i,ii.y=ei,Ue=ii,e.list[(1+(a<<1))*e.width+o]=Ue):(pi=Ue.x,li=Ue.y,null==xp.zpp_pool?ri=new xp:(ri=xp.zpp_pool,xp.zpp_pool=ri.next,ri.next=null),ri.forced=!1,ri.x=pi,ri.y=li,Ue=ri),s&&(Ue.forced=!0),Ue.y!=p&&Ue.y!=r||(Ue.y==p&&0!=(1&Te)||Ue.y==r&&0!=(64&Te))&&(Te^=128)),oi=Ue,null==v.p1?v.p1=oi.prev=oi.next=oi:(oi.prev=v.p1,oi.next=v.p1.next,v.p1.next.prev=oi,v.p1.next=oi),v.p1=oi)}if(v.p1=v.p1.next,1!=(v.key1=Te)&&4!=Te&&16!=Te&&64!=Te&&3!=Te&&12!=Te&&48!=Te&&192!=Te&&129!=Te&&6!=Te&&24!=Te&&96!=Te&&5!=Te&&20!=Te&&80!=Te&&65!=Te&&17!=Te&&68!=Te||(Te=0,v.key1=0,v.p1=null),0!=Te){var si=14;v.okey2=14;for(var _i=0;_i<8;){var hi,ui,xi,di,yi,zi,ci,vi,mi,fi,bi,gi,wi,Mi,Ci,ki,Oi,Pi,Si,Ai,ji,Ei,Ii,Ti,Ni,Li,Vi=_i++;0!=(si&1<<Vi)&&(fi=null,0==Vi?(null==xp.zpp_pool?hi=new xp:(hi=xp.zpp_pool,xp.zpp_pool=hi.next,hi.next=null),hi.forced=!1,hi.x=i,hi.y=p,fi=hi,(s||_)&&(fi.forced=!0)):2==Vi?(null==xp.zpp_pool?ui=new xp:(ui=xp.zpp_pool,xp.zpp_pool=ui.next,ui.next=null),ui.forced=!1,ui.x=l,ui.y=p,fi=ui,(h||_)&&(fi.forced=!0)):4==Vi?(null==xp.zpp_pool?xi=new xp:(xi=xp.zpp_pool,xp.zpp_pool=xi.next,xi.next=null),xi.forced=!1,xi.x=l,xi.y=r,fi=xi,(h||u)&&(fi.forced=!0)):6==Vi?(null==xp.zpp_pool?di=new xp:(di=xp.zpp_pool,xp.zpp_pool=di.next,di.next=null),di.forced=!1,di.x=i,di.y=r,fi=di,(s||u)&&(fi.forced=!0)):1==Vi?(null==(fi=e.list[(a<<1)*e.width+o])?(yi=this.xlerp(i,l,p,y,z,n,x),null==xp.zpp_pool?zi=new xp:(zi=xp.zpp_pool,xp.zpp_pool=zi.next,zi.next=null),zi.forced=!1,zi.x=yi,zi.y=p,fi=zi,e.list[(a<<1)*e.width+o]=fi):(ci=fi.x,vi=fi.y,null==xp.zpp_pool?mi=new xp:(mi=xp.zpp_pool,xp.zpp_pool=mi.next,mi.next=null),mi.forced=!1,mi.x=ci,mi.y=vi,fi=mi),_&&(fi.forced=!0),fi.x!=i&&fi.x!=l||(fi.x==i&&0!=(1&si)||fi.x==l&&0!=(4&si))&&(si^=2)):5==Vi?(null==(fi=e.list[(2+(a<<1))*e.width+o])?(bi=this.xlerp(i,l,r,m,c,n,x),null==xp.zpp_pool?gi=new xp:(gi=xp.zpp_pool,xp.zpp_pool=gi.next,gi.next=null),gi.forced=!1,gi.x=bi,gi.y=r,fi=gi,e.list[(2+(a<<1))*e.width+o]=fi):(wi=fi.x,Mi=fi.y,null==xp.zpp_pool?Ci=new xp:(Ci=xp.zpp_pool,xp.zpp_pool=Ci.next,Ci.next=null),Ci.forced=!1,Ci.x=wi,Ci.y=Mi,fi=Ci),u&&(fi.forced=!0),fi.x!=i&&fi.x!=l||(fi.x==i&&0!=(64&si)||fi.x==l&&0!=(16&si))&&(si^=32)):3==Vi?(null==(fi=e.list[(1+(a<<1))*e.width+(o+1)])?(ki=this.ylerp(p,r,l,z,c,n,x),null==xp.zpp_pool?Oi=new xp:(Oi=xp.zpp_pool,xp.zpp_pool=Oi.next,Oi.next=null),Oi.forced=!1,Oi.x=l,Oi.y=ki,fi=Oi,e.list[(1+(a<<1))*e.width+(o+1)]=fi):(Pi=fi.x,Si=fi.y,null==xp.zpp_pool?Ai=new xp:(Ai=xp.zpp_pool,xp.zpp_pool=Ai.next,Ai.next=null),Ai.forced=!1,Ai.x=Pi,Ai.y=Si,fi=Ai),h&&(fi.forced=!0),fi.y!=p&&fi.y!=r||(fi.y==p&&0!=(4&si)||fi.y==r&&0!=(16&si))&&(si^=8)):(null==(fi=e.list[(1+(a<<1))*e.width+o])?(ji=this.ylerp(p,r,i,y,m,n,x),null==xp.zpp_pool?Ei=new xp:(Ei=xp.zpp_pool,xp.zpp_pool=Ei.next,Ei.next=null),Ei.forced=!1,Ei.x=i,Ei.y=ji,fi=Ei,e.list[(1+(a<<1))*e.width+o]=fi):(Ii=fi.x,Ti=fi.y,null==xp.zpp_pool?Ni=new xp:(Ni=xp.zpp_pool,xp.zpp_pool=Ni.next,Ni.next=null),Ni.forced=!1,Ni.x=Ii,Ni.y=Ti,fi=Ni),s&&(fi.forced=!0),fi.y!=p&&fi.y!=r||(fi.y==p&&0!=(1&si)||fi.y==r&&0!=(64&si))&&(si^=128)),Li=fi,null==v.p2?v.p2=Li.prev=Li.next=Li:(Li.prev=v.p2,Li.next=v.p2.next,v.p2.next.prev=Li,v.p2.next=Li),v.p2=Li)}v.p2=v.p2.next,1!=(v.key2=si)&&4!=si&&16!=si&&64!=si&&3!=si&&12!=si&&48!=si&&192!=si&&129!=si&&6!=si&&24!=si&&96!=si&&5!=si&&20!=si&&80!=si&&65!=si&&17!=si&&68!=si||(si=0,v.key2=0,v.p2=null),0==si?(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1):(v.pr=v.p2,v.okeyr=v.okey2,v.keyr=v.key2)}else{var Di=14;v.okey1=14;for(var Fi=0;Fi<8;){var Ri,Zi,Bi,Gi,qi,Ui,Ki,Wi,Yi,Ji,Xi,Hi,$i,Qi,np,tp,ep,ip,pp,lp,rp,op,ap,sp,_p,hp,up=Fi++;0!=(Di&1<<up)&&(Ji=null,0==up?(null==xp.zpp_pool?Ri=new xp:(Ri=xp.zpp_pool,xp.zpp_pool=Ri.next,Ri.next=null),Ri.forced=!1,Ri.x=i,Ri.y=p,Ji=Ri,(s||_)&&(Ji.forced=!0)):2==up?(null==xp.zpp_pool?Zi=new xp:(Zi=xp.zpp_pool,xp.zpp_pool=Zi.next,Zi.next=null),Zi.forced=!1,Zi.x=l,Zi.y=p,Ji=Zi,(h||_)&&(Ji.forced=!0)):4==up?(null==xp.zpp_pool?Bi=new xp:(Bi=xp.zpp_pool,xp.zpp_pool=Bi.next,Bi.next=null),Bi.forced=!1,Bi.x=l,Bi.y=r,Ji=Bi,(h||u)&&(Ji.forced=!0)):6==up?(null==xp.zpp_pool?Gi=new xp:(Gi=xp.zpp_pool,xp.zpp_pool=Gi.next,Gi.next=null),Gi.forced=!1,Gi.x=i,Gi.y=r,Ji=Gi,(s||u)&&(Ji.forced=!0)):1==up?(null==(Ji=e.list[(a<<1)*e.width+o])?(qi=this.xlerp(i,l,p,y,z,n,x),null==xp.zpp_pool?Ui=new xp:(Ui=xp.zpp_pool,xp.zpp_pool=Ui.next,Ui.next=null),Ui.forced=!1,Ui.x=qi,Ui.y=p,Ji=Ui,e.list[(a<<1)*e.width+o]=Ji):(Ki=Ji.x,Wi=Ji.y,null==xp.zpp_pool?Yi=new xp:(Yi=xp.zpp_pool,xp.zpp_pool=Yi.next,Yi.next=null),Yi.forced=!1,Yi.x=Ki,Yi.y=Wi,Ji=Yi),_&&(Ji.forced=!0),Ji.x!=i&&Ji.x!=l||(Ji.x==i&&0!=(1&Di)||Ji.x==l&&0!=(4&Di))&&(Di^=2)):5==up?(null==(Ji=e.list[(2+(a<<1))*e.width+o])?(Xi=this.xlerp(i,l,r,m,c,n,x),null==xp.zpp_pool?Hi=new xp:(Hi=xp.zpp_pool,xp.zpp_pool=Hi.next,Hi.next=null),Hi.forced=!1,Hi.x=Xi,Hi.y=r,Ji=Hi,e.list[(2+(a<<1))*e.width+o]=Ji):($i=Ji.x,Qi=Ji.y,null==xp.zpp_pool?np=new xp:(np=xp.zpp_pool,xp.zpp_pool=np.next,np.next=null),np.forced=!1,np.x=$i,np.y=Qi,Ji=np),u&&(Ji.forced=!0),Ji.x!=i&&Ji.x!=l||(Ji.x==i&&0!=(64&Di)||Ji.x==l&&0!=(16&Di))&&(Di^=32)):3==up?(null==(Ji=e.list[(1+(a<<1))*e.width+(o+1)])?(tp=this.ylerp(p,r,l,z,c,n,x),null==xp.zpp_pool?ep=new xp:(ep=xp.zpp_pool,xp.zpp_pool=ep.next,ep.next=null),ep.forced=!1,ep.x=l,ep.y=tp,Ji=ep,e.list[(1+(a<<1))*e.width+(o+1)]=Ji):(ip=Ji.x,pp=Ji.y,null==xp.zpp_pool?lp=new xp:(lp=xp.zpp_pool,xp.zpp_pool=lp.next,lp.next=null),lp.forced=!1,lp.x=ip,lp.y=pp,Ji=lp),h&&(Ji.forced=!0),Ji.y!=p&&Ji.y!=r||(Ji.y==p&&0!=(4&Di)||Ji.y==r&&0!=(16&Di))&&(Di^=8)):(null==(Ji=e.list[(1+(a<<1))*e.width+o])?(rp=this.ylerp(p,r,i,y,m,n,x),null==xp.zpp_pool?op=new xp:(op=xp.zpp_pool,xp.zpp_pool=op.next,op.next=null),op.forced=!1,op.x=i,op.y=rp,Ji=op,e.list[(1+(a<<1))*e.width+o]=Ji):(ap=Ji.x,sp=Ji.y,null==xp.zpp_pool?_p=new xp:(_p=xp.zpp_pool,xp.zpp_pool=_p.next,_p.next=null),_p.forced=!1,_p.x=ap,_p.y=sp,Ji=_p),s&&(Ji.forced=!0),Ji.y!=p&&Ji.y!=r||(Ji.y==p&&0!=(1&Di)||Ji.y==r&&0!=(64&Di))&&(Di^=128)),hp=Ji,null==v.p1?v.p1=hp.prev=hp.next=hp:(hp.prev=v.p1,hp.next=v.p1.next,v.p1.next.prev=hp,v.p1.next=hp),v.p1=hp)}v.p1=v.p1.next,1!=(v.key1=Di)&&4!=Di&&16!=Di&&64!=Di&&3!=Di&&12!=Di&&48!=Di&&192!=Di&&129!=Di&&6!=Di&&24!=Di&&96!=Di&&5!=Di&&20!=Di&&80!=Di&&65!=Di&&17!=Di&&68!=Di||(Di=0,v.key1=0,v.p1=null),0==Di?v=null:(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1)}}}return v},yp.prototype.lerp=function(n,t,e,i){if(0==e)return n;if(0==i)return t;var p=e-i,l=p*p<co.epsilon*co.epsilon?.5:e/p;return l<0?l=0:1<l&&(l=1),n+l*(t-n)},yp.prototype.xlerp=function(n,t,e,i,p,l,r){var o,a,s;for(s=0==i?n:0==p?t:((a=(o=i-p)*o<co.epsilon*co.epsilon?.5:i/o)<0?a=0:1<a&&(a=1),n+a*(t-n));0!=r--&&n<s&&s<t;){var _,h,u=l(s,e);if(0==u)break;i*u<0?(t=s,p=u):(n=s,i=u),s=0==i?n:0==p?t:((h=(_=i-p)*_<co.epsilon*co.epsilon?.5:i/_)<0?h=0:1<h&&(h=1),n+h*(t-n))}return s},yp.prototype.ylerp=function(n,t,e,i,p,l,r){var o,a,s;for(s=0==i?n:0==p?t:((a=(o=i-p)*o<co.epsilon*co.epsilon?.5:i/o)<0?a=0:1<a&&(a=1),n+a*(t-n));0!=r--&&n<s&&s<t;){var _,h,u=l(e,s);if(0==u)break;i*u<0?(t=s,p=u):(n=s,i=u),s=0==i?n:0==p?t:((h=(_=i-p)*_<co.epsilon*co.epsilon?.5:i/_)<0?h=0:1<h&&(h=1),n+h*(t-n))}return s},yp.prototype.__class__=yp;var Pt=zpp_nape.geom.ZPP_Mat23=function(){this.next=null,this._invalidate=null,this.ty=0,this.tx=0,this.d=0,this.c=0,this.b=0,this.a=0,this.outer=null};Pt.__name__=["zpp_nape","geom","ZPP_Mat23"],Pt.get=function(){var n;return null==Pt.zpp_pool?n=new Pt:(n=Pt.zpp_pool,Pt.zpp_pool=n.next,n.next=null),n},Pt.identity=function(){var n=Pt.get();return n.setas(1,0,0,1,0,0),n},Pt.prototype.outer=null,Pt.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new pn,(n=this.outer.zpp_inner).next=Pt.zpp_pool,Pt.zpp_pool=n,this.outer.zpp_inner=this),this.outer},Pt.prototype.a=null,Pt.prototype.b=null,Pt.prototype.c=null,Pt.prototype.d=null,Pt.prototype.tx=null,Pt.prototype.ty=null,Pt.prototype._invalidate=null,Pt.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate()},Pt.prototype.set=function(n){this.setas(n.a,n.b,n.c,n.d,n.tx,n.ty)},Pt.prototype.setas=function(n,t,e,i,p,l){this.tx=p,this.ty=l,this.a=n,this.b=t,this.c=e,this.d=i},Pt.prototype.next=null,Pt.prototype.free=function(){},Pt.prototype.alloc=function(){},Pt.prototype.__class__=Pt;var St=zpp_nape.geom.ZPP_MatMN=function(n,t){this.x=null,this.n=0,this.m=0,this.outer=null,this.m=n,this.n=t,this.x=[];for(var e=0,i=n*t;e<i;)++e,this.x.push(0)};St.__name__=["zpp_nape","geom","ZPP_MatMN"],St.prototype.outer=null,St.prototype.m=null,St.prototype.n=null,St.prototype.x=null,St.prototype.__class__=St;var At=zpp_nape.geom.ZPP_Monotone=function(){};At.__name__=["zpp_nape","geom","ZPP_Monotone"],At.bisector=function(n){var t,e=n.prev,i=n.next,p=n.x-e.x,l=n.y-e.y,r=i.x-n.x,o=i.y-n.y;null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=-l-o,t.y=p+r;var a=t,s=1/Math.sqrt(a.x*a.x+a.y*a.y);return a.x*=s,a.y*=s,o*p-r*l<0&&(a.x=-a.x,a.y=-a.y),a},At.below=function(n,t){if(n.y<t.y)return!0;if(n.y>t.y)return!1;if(n.x<t.x)return!0;if(n.x>t.x)return!1;var e=At.bisector(n),i=At.bisector(t);e.x+=n.x,e.y+=n.y,i.x+=t.x,i.y+=t.y;var p=e.x<i.x||e.x==i.x&&e.y<i.y;return null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=mo.zpp_pool,mo.zpp_pool=e,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=mo.zpp_pool,mo.zpp_pool=i,p},At.above=function(n,t){return At.below(t,n)},At.left_vertex=function(n){var t=n.prev;return t.y>n.y||t.y==n.y&&n.next.y<n.y},At.isMonotone=function(n){var t=n,e=n,i=n.next;if(null!=i)for(var p=i;;){if(p.y<t.y&&(t=p),p.y>e.y&&(e=p),(p=p.next)==n)break}var l=!0,r=t;if(e!=t.next){var o=t.next,a=e;if(null!=o)for(var s=o;;){var _=s;if(_.y<r.y){l=!1;break}if(r=_,(s=s.next)==a)break}}if(!l)return!1;if(e!=(r=t).prev){var h=t.prev,u=e;if(null!=h)for(var x=h;;){var d=x;if(d.y<r.y){l=!1;break}if(r=d,(x=x.prev)==u)break}}return l},At.sharedPPoly=null,At.getShared=function(){return null==At.sharedPPoly&&(At.sharedPPoly=new Et),At.sharedPPoly},At.decompose=function(n,t){if(null==t?t=new Et(n):t.init(n),null==t.vertices)return t;null==At.queue&&(At.queue=new ge);var e=t.vertices,i=t.vertices;if(null!=e)for(var p=e;;){var l=p;At.queue.add(l);var r=l.next.x-l.x,o=l.next.y-l.y,a=l.prev.x-l.x,s=0<(l.prev.y-l.y)*r-a*o;if(l.type=At.below(l.prev,l)?At.below(l.next,l)?s?0:3:4:At.below(l,l.next)?s?1:2:4,(p=p.next)==i)break}var _=At.queue;if(null!=_.head&&null!=_.head.next){for(var h,u,x,d=_.head,y=null,z=null,c=null,v=null,m=1;;){for(h=0,z=d,y=d=null;null!=z;){for(++h,c=z,u=0,x=m;null!=c&&u<m;)++u,c=c.next;for(;0<u||0<x&&null!=c;)0!=u&&(0==x||null==c||At.above(z.elt,c.elt))?(z=(v=z).next,--u):(c=(v=c).next,--x),null!=y?y.next=v:d=v,y=v;z=c}if(y.next=null,m<<=1,!(1<h))break}_.head=d,_.modified=!0,_.pushmod=!0}for(null==At.edges&&(null==Gi.zpp_pool?At.edges=new Gi:(At.edges=Gi.zpp_pool,Gi.zpp_pool=At.edges.next,At.edges.next=null),At.edges.lt=jt.edge_lt,At.edges.swapped=jt.edge_swap);null!=At.queue.head;){var f=At.queue.pop_unsafe();switch(f.type){case 0:(f.helper=f).node=At.edges.insert(f);break;case 1:var b=f.prev;2==b.helper.type&&t.add_diagonal(f,b.helper),At.edges.remove_node(b.node);break;case 2:var g=f.prev;2==g.helper.type&&t.add_diagonal(f,g.helper),At.edges.remove_node(g.node);var w=null;if(!At.edges.empty()){for(var M=At.edges.parent;null!=M.prev;)M=M.prev;for(;null!=M;){var C=M.data;if(!jt.vert_lt(C,f)){w=C;break}if(null!=M.next)for(M=M.next;null!=M.prev;)M=M.prev;else{for(;null!=M.parent&&M==M.parent.next;)M=M.parent;M=M.parent}}}var k=w;null!=k&&(2==k.helper.type&&t.add_diagonal(f,k.helper),k.helper=f);break;case 3:var O=null;if(!At.edges.empty()){for(var P=At.edges.parent;null!=P.prev;)P=P.prev;for(;null!=P;){var S=P.data;if(!jt.vert_lt(S,f)){O=S;break}if(null!=P.next)for(P=P.next;null!=P.prev;)P=P.prev;else{for(;null!=P.parent&&P==P.parent.next;)P=P.parent;P=P.parent}}}var A=O;null!=A&&(t.add_diagonal(f,A.helper),A.helper=f),f.node=At.edges.insert(f),f.helper=f;break;case 4:var j=f.prev;if(At.left_vertex(f))2==j.helper.type&&t.add_diagonal(f,j.helper),At.edges.remove_node(j.node),f.node=At.edges.insert(f),f.helper=f;else{var E=null;if(!At.edges.empty()){for(var I=At.edges.parent;null!=I.prev;)I=I.prev;for(;null!=I;){var T=I.data;if(!jt.vert_lt(T,f)){E=T;break}if(null!=I.next)for(I=I.next;null!=I.prev;)I=I.prev;else{for(;null!=I.parent&&I==I.parent.next;)I=I.parent;I=I.parent}}}var N=E;2==N.helper.type&&t.add_diagonal(f,N.helper),N.helper=f}}}return t},At.prototype.__class__=At;var jt=zpp_nape.geom.ZPP_PartitionVertex=function(){this.node=null,this.prev=null,this.next=null,this.rightchain=!1,this.helper=null,this.type=0,this.diagonals=null,this.forced=!1,this.y=0,this.x=0,this.mag=0,this.id=0,this.id=jt.nextId++,this.diagonals=new ge};jt.__name__=["zpp_nape","geom","ZPP_PartitionVertex"],jt.get=function(n){var t;return null==jt.zpp_pool?t=new jt:(t=jt.zpp_pool,jt.zpp_pool=t.next,t.next=null),t.x=n.x,t.y=n.y,t},jt.rightdistance=function(n,t){var e=n.next.y>n.y,i=n.next.x-n.x,p=n.next.y-n.y,l=t.x-n.x;return(e?-1:1)*((t.y-n.y)*i-l*p)},jt.vert_lt=function(n,t){if(t==n||t==n.next)return!0;if(n.y!=n.next.y)return jt.rightdistance(n,t)<=0;var e=n.x,i=n.next.x;return(e<i?e:i)<=t.x},jt.edge_swap=function(n,t){var e=n.node;n.node=t.node,t.node=e},jt.edge_lt=function(n,t){if(n==t&&n.next==t.next)return!1;if(n==t.next)return!jt.vert_lt(n,t);if(t==n.next)return jt.vert_lt(t,n);if(n.y==n.next.y){if(t.y!=t.next.y)return 0<jt.rightdistance(t,n)||0<jt.rightdistance(t,n.next);var e=n.x,i=n.next.x,p=i<e?e:i,l=t.x,r=t.next.x;return(r<l?l:r)<p}var o=jt.rightdistance(n,t),a=jt.rightdistance(n,t.next);if(0==o&&0==a){var s=n.x,_=n.next.x,h=_<s?s:_,u=t.x,x=t.next.x;return(x<u?u:x)<h}if(0<=o*a)return o<0||a<0;var d=jt.rightdistance(t,n),y=jt.rightdistance(t,n.next);return 0<=d*y&&(0<d||0<y)},jt.prototype.id=null,jt.prototype.mag=null,jt.prototype.x=null,jt.prototype.y=null,jt.prototype.forced=null,jt.prototype.diagonals=null,jt.prototype.type=null,jt.prototype.helper=null,jt.prototype.rightchain=null,jt.prototype.next=null,jt.prototype.prev=null,jt.prototype.alloc=function(){},jt.prototype.free=function(){this.helper=null},jt.prototype.copy=function(){var n;return null==jt.zpp_pool?n=new jt:(n=jt.zpp_pool,jt.zpp_pool=n.next,n.next=null),n.x=this.x,n.y=this.y,n.forced=this.forced,n},jt.prototype.sort=function(){var n=0,t=0,e=0;n=this.prev.x-this.x,t=this.prev.y-this.y,e=this.next.x-this.x;var i=(this.next.y-this.y)*n-e*t,p=0<i?-1:0==i?0:1,l=this.diagonals;if(null!=l.head&&null!=l.head.next){for(var r,o,a,s,_,h,u,x,d,y,z,c=l.head,v=null,m=null,f=null,b=null,g=1;;){for(r=0,m=c,v=c=null;null!=m;){for(++r,f=m,o=0,a=g;null!=f&&o<g;)++o,f=f.next;for(;0<o||0<a&&null!=f;){0!=o&&(0==a||null==f||(1==p?(n=m.elt.x-this.x,t=m.elt.y-this.y,e=f.elt.x-this.x,1==(0<(s=(f.elt.y-this.y)*n-e*t)?-1:0==s?0:1)):(n=this.prev.x-this.x,t=this.prev.y-this.y,e=m.elt.x-this.x,h=0<(_=(m.elt.y-this.y)*n-e*t)?-1:0==_?0:1,n=this.prev.x-this.x,t=this.prev.y-this.y,e=f.elt.x-this.x,h*(x=0<(u=(f.elt.y-this.y)*n-e*t)?-1:0==u?0:1)==1||h*x==0&&(1==h||1==x)?(n=m.elt.x-this.x,t=m.elt.y-this.y,e=f.elt.x-this.x,1==(0<(d=(f.elt.y-this.y)*n-e*t)?-1:0==d?0:1)):-1==h||-1==x?-1==x:0!=h||0!=x||(n=this.x-this.prev.x,t=this.y-this.prev.y,y=n*(e=m.elt.x-this.x)+t*(m.elt.y-this.y),z=n*(e=f.elt.x-this.x)+t*(f.elt.y-this.y),y<0&&0<z||!(z<0&&0<y)))))?(m=(b=m).next,--o):(f=(b=f).next,--a),null!=v?v.next=b:c=b,v=b}m=f}if(v.next=null,g<<=1,!(1<r))break}l.head=c,l.modified=!0,l.pushmod=!0}},jt.prototype.node=null,jt.prototype.__class__=jt;var Et=zpp_nape.geom.ZPP_PartitionedPoly=function(n){this.next=null,this.vertices=null,this.init(n)};Et.__name__=["zpp_nape","geom","ZPP_PartitionedPoly"],Et.sharedPPList=null,Et.getSharedPP=function(){return null==Et.sharedPPList&&(Et.sharedPPList=new Me),Et.sharedPPList},Et.sharedGVList=null,Et.getShared=function(){return null==Et.sharedGVList&&(Et.sharedGVList=new Ce),Et.sharedGVList},Et.prototype.vertices=null,Et.prototype.eq=function(n,t){var e=n.x,i=n.y,p=0,l=0;return(p=e-t.x)*p+(l=i-t.y)*l<co.epsilon*co.epsilon},Et.prototype.next=null,Et.prototype.alloc=function(){},Et.prototype.free=function(){},Et.prototype.init=function(n){if(null!=n){var t=0;if(null!=n)for(var e=n;;){if(t+=e.x*(e.next.y-e.prev.y),(e=e.next)==n)break}for(var i=0<.5*t,p=n;;){var l,r,o,a,s=i?(null==jt.zpp_pool?l=new jt:(l=jt.zpp_pool,jt.zpp_pool=l.next,l.next=null),l.x=p.x,l.y=p.y,r=l,null==this.vertices?this.vertices=r.prev=r.next=r:(r.prev=this.vertices,r.next=this.vertices.next,this.vertices.next.prev=r,this.vertices.next=r),r):(null==jt.zpp_pool?o=new jt:(o=jt.zpp_pool,jt.zpp_pool=o.next,o.next=null),o.x=p.x,o.y=p.y,a=o,null==this.vertices?this.vertices=a.prev=a.next=a:(a.next=this.vertices,a.prev=this.vertices.prev,this.vertices.prev.next=a,this.vertices.prev=a),a);if(this.vertices=s,this.vertices.forced=p.forced,(p=p.next)==n)break}this.remove_collinear_vertices()}},Et.prototype.remove_collinear_vertices=function(){for(var n,t=this.vertices,e=!0;e||t!=this.vertices;){var i,p,l,e=!1;if(this.eq(t,t.next)){if(t==this.vertices&&(this.vertices=t.next,e=!0),t.forced&&(t.next.forced=!0),null==(t=null!=t&&t.prev==t?(t.next=t.prev=null,(i=t).helper=null,i.next=jt.zpp_pool,jt.zpp_pool=i,null):(p=t.next,t.prev.next=t.next,t.next.prev=t.prev,t.next=t.prev=null,(l=t).helper=null,l.next=jt.zpp_pool,jt.zpp_pool=l,t=null,p))){this.vertices=null;break}}else t=t.next}if(null==this.vertices)return!0;for(;;){for(n=!1,t=this.vertices,e=!0;e||t!=this.vertices;){e=!1;var r,o,a,s=t.prev,_=t.x-s.x,h=t.y-s.y,u=t.next.x-t.x,x=(t.next.y-t.y)*_-u*h;if(x*x>=co.epsilon*co.epsilon)t=t.next;else if(t==this.vertices&&(this.vertices=t.next,e=!0),n=!0,null==(t=null!=t&&t.prev==t?(t.next=t.prev=null,(r=t).helper=null,r.next=jt.zpp_pool,jt.zpp_pool=r,null):(o=t.next,t.prev.next=t.next,t.next.prev=t.prev,t.next=t.prev=null,(a=t).helper=null,a.next=jt.zpp_pool,jt.zpp_pool=a,t=null,o))){n=!1,this.vertices=null;break}}if(!n)break}return null==this.vertices},Et.prototype.add_diagonal=function(n,t){n.diagonals.add(t),t.diagonals.add(n),n.forced=t.forced=!0},Et.prototype.extract_partitions=function(n){if(null==n&&(n=new Me),null!=this.vertices){var t=this.vertices,e=this.vertices;if(null!=t)for(var i=t;i.sort(),(i=i.next)!=e;);for(this.pull_partitions(this.vertices,n);null!=this.vertices;){var p,l,r,o=null!=this.vertices&&this.vertices.prev==this.vertices?(this.vertices.next=this.vertices.prev=null,(p=this.vertices).helper=null,p.next=jt.zpp_pool,jt.zpp_pool=p,this.vertices=null):(l=this.vertices.next,this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null,(r=this.vertices).helper=null,r.next=jt.zpp_pool,jt.zpp_pool=r,this.vertices=null,l);this.vertices=o}for(var a=null,s=n.head;null!=s;)s.elt.remove_collinear_vertices()?n.erase(a):s=(a=s).next}return n},Et.prototype.pull_partitions=function(n,t){var e;null==Et.zpp_pool?e=new Et:(e=Et.zpp_pool,Et.zpp_pool=e.next,e.next=null);for(var i,p=n;;){null==jt.zpp_pool?i=new jt:(i=jt.zpp_pool,jt.zpp_pool=i.next,i.next=null),i.x=p.x,i.y=p.y,i.forced=p.forced;var l=i;if(null==e.vertices?e.vertices=l.prev=l.next=l:(l.prev=e.vertices,l.next=e.vertices.next,e.vertices.next.prev=l,e.vertices.next=l),e.vertices=l,e.vertices.forced=p.forced,null!=p.diagonals.head){var r=p.diagonals,o=r.head.elt;if(r.pop(),o==n)break;p=this.pull_partitions(p,t)}else p=p.next;if(p==n)break}var a=0,s=e.vertices,_=e.vertices;if(null!=s)for(var h=s;;){if(a+=h.x*(h.next.y-h.prev.y),(h=h.next)==_)break}return.5*a!=0&&t.add(e),p},Et.prototype.extract=function(n){if(null==n&&(n=new Ce),null!=this.vertices){var t=this.vertices,e=this.vertices;if(null!=t)for(var i=t;i.sort(),(i=i.next)!=e;);for(this.pull(this.vertices,n);null!=this.vertices;){var p,l,r,o=null!=this.vertices&&this.vertices.prev==this.vertices?(this.vertices.next=this.vertices.prev=null,(p=this.vertices).helper=null,p.next=jt.zpp_pool,jt.zpp_pool=p,this.vertices=null):(l=this.vertices.next,this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null,(r=this.vertices).helper=null,r.next=jt.zpp_pool,jt.zpp_pool=r,this.vertices=null,l);this.vertices=o}}return n},Et.prototype.pull=function(n,t){for(var e=null,i=n;;){var p,l=i.x,r=i.y;null==xp.zpp_pool?p=new xp:(p=xp.zpp_pool,xp.zpp_pool=p.next,p.next=null),p.forced=!1,p.x=l,p.y=r;var o=p;if(null==e?e=o.prev=o.next=o:(o.prev=e,o.next=e.next,e.next.prev=o,e.next=o),(e=o).forced=i.forced,null!=i.diagonals.head){var a=i.diagonals,s=a.head.elt;if(a.pop(),s==n)break;i=this.pull(i,t)}else i=i.next;if(i==n)break}var _=0,h=e;if(null!=e)for(var u=e;;){if(_+=u.x*(u.next.y-u.prev.y),(u=u.next)==h)break}var x=.5*_;if(x*x>=co.epsilon*co.epsilon){for(var d,y=e,z=!0;z||y!=e;){z=!1;var c,v=y.x,m=y.y,f=0,b=0;if((f=v-y.next.x)*f+(b=m-y.next.y)*b<co.epsilon*co.epsilon){if(y==e&&(e=y.next,z=!0),y.forced&&(y.next.forced=!0),null==(y=null!=y&&y.prev==y?y.next=y.prev=null:(c=y.next,y.prev.next=y.next,y.next.prev=y.prev,y.next=y.prev=null,y=null,c))){e=null;break}}else y=y.next}if(null!=e)for(;;){for(y=e,z=!(d=!1);z||y!=e;){z=!1;var g,w=y.prev,M=y.x-w.x,C=y.y-w.y,k=y.next.x-y.x,O=(y.next.y-y.y)*M-k*C;if(O*O>=co.epsilon*co.epsilon)y=y.next;else if(y==e&&(e=y.next,z=!0),d=!0,null==(y=null!=y&&y.prev==y?y.next=y.prev=null:(g=y.next,y.prev.next=y.next,y.next.prev=y.prev,y.next=y.prev=null,y=null,g))){d=!1,e=null;break}}if(!d)break}null!=e&&t.add(e)}return i},Et.prototype.__class__=Et;var It=zpp_nape.geom.ZPP_Ray=function(){var n,t,e,i,p,l,r,o,a,s;this.zip_dir=!1,this.absnormaly=0,this.absnormalx=0,this.normaly=0,this.normalx=0,this.idiry=0,this.idirx=0,this.diry=0,this.dirx=0,this.originy=0,this.originx=0,this.userData=null,this.maxdist=0,this.direction=null,(this.origin=null)==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),0==n.zpp_inner.x&&(null!=(i=n.zpp_inner)._validate&&i._validate(),0==n.zpp_inner.y)||(n.zpp_inner.x=0,n.zpp_inner.y=0,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.origin=n,this.origin.zpp_inner._invalidate=Q(this,this.origin_invalidate),null==Ri.poolVec2?l=new at:(l=Ri.poolVec2,Ri.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner?(null==mo.zpp_pool?r=new mo:(r=mo.zpp_pool,mo.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=0,r.y=0,l.zpp_inner=r,l.zpp_inner.outer=l):(null!=(o=l.zpp_inner)._validate&&o._validate(),0==l.zpp_inner.x&&(null!=(a=l.zpp_inner)._validate&&a._validate(),0==l.zpp_inner.y)||(l.zpp_inner.x=0,l.zpp_inner.y=0,null!=(s=l.zpp_inner)._invalidate&&s._invalidate(s))),l.zpp_inner.weak=!1,this.direction=l,this.direction.zpp_inner._invalidate=Q(this,this.direction_invalidate),this.originx=0,this.originy=0,this.dirx=0,this.diry=0,this.zip_dir=!1};It.__name__=["zpp_nape","geom","ZPP_Ray"],It.prototype.origin=null,It.prototype.direction=null,It.prototype.maxdist=null,It.prototype.userData=null,It.prototype.originx=null,It.prototype.originy=null,It.prototype.dirx=null,It.prototype.diry=null,It.prototype.idirx=null,It.prototype.idiry=null,It.prototype.normalx=null,It.prototype.normaly=null,It.prototype.absnormalx=null,It.prototype.absnormaly=null,It.prototype.origin_invalidate=function(n){this.originx=n.x,this.originy=n.y},It.prototype.direction_invalidate=function(n){this.dirx=n.x,this.diry=n.y,this.zip_dir=!0},It.prototype.zip_dir=null,It.prototype.invalidate_dir=function(){this.zip_dir=!0},It.prototype.validate_dir=function(){var n,t,e;this.zip_dir&&(this.zip_dir=!1,n=1/Math.sqrt(this.dirx*this.dirx+this.diry*this.diry),this.dirx*=n,this.diry*=n,this.idirx=1/this.dirx,this.idiry=1/this.diry,this.normalx=-this.diry,this.normaly=this.dirx,t=this.normalx,this.absnormalx=t<0?-t:t,e=this.normaly,this.absnormaly=e<0?-e:e)},It.prototype.rayAABB=function(){var n,t,e,i=this.originx,p=i,l=this.originy,r=l;return this.maxdist>=1/0?(0<this.dirx?p=1/0:this.dirx<0&&(p=-1/0),0<this.diry?r=1/0:this.diry<0&&(r=-1/0)):(p+=this.maxdist*this.dirx,r+=this.maxdist*this.diry),p<i&&(n=i,i=p,p=n),r<l&&(t=l,l=r,r=t),null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.minx=i,e.miny=l,e.maxx=p,e.maxy=r,e},It.prototype.aabbtest=function(n){var t=this.normalx*(this.originx-.5*(n.minx+n.maxx))+this.normaly*(this.originy-.5*(n.miny+n.maxy));return(t<0?-t:t)<.5*this.absnormalx*(n.maxx-n.minx)+.5*this.absnormaly*(n.maxy-n.miny)},It.prototype.aabbsect=function(n){var t=this.originx>=n.minx&&this.originx<=n.maxx,e=this.originy>=n.miny&&this.originy<=n.maxy;if(t&&e)return 0;for(var i=-1;!(0<=this.dirx&&this.originx>=n.maxx||this.dirx<=0&&this.originx<=n.minx||0<=this.diry&&this.originy>=n.maxy||this.diry<=0&&this.originy<=n.miny);){if(0<this.dirx){var p=(n.minx-this.originx)*this.idirx;if(0<=p&&p<=this.maxdist){var l=this.originy+p*this.diry;if(l>=n.miny&&l<=n.maxy){i=p;break}}}else if(this.dirx<0){var r=(n.maxx-this.originx)*this.idirx;if(0<=r&&r<=this.maxdist){var o=this.originy+r*this.diry;if(o>=n.miny&&o<=n.maxy){i=r;break}}}if(0<this.diry){var a=(n.miny-this.originy)*this.idiry;if(0<=a&&a<=this.maxdist){var s=this.originx+a*this.dirx;if(s>=n.minx&&s<=n.maxx){i=a;break}}}else if(this.diry<0){var _=(n.maxy-this.originy)*this.idiry;if(0<=_&&_<=this.maxdist){var h=this.originx+_*this.dirx;if(h>=n.minx&&h<=n.maxx){i=_;break}}}break}return i},It.prototype.circlesect=function(n,t,e){if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var i=n.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var p=i.localCOMy=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var y=n.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var z=this.originx-n.worldCOMx,c=this.originy-n.worldCOMy,v=this.dirx*this.dirx+this.diry*this.diry,m=2*(z*this.dirx+c*this.diry),f=z*z+c*c-n.radius*n.radius,b=m*m-4*v*f;if(0==b){var g=-m/2*v;if((!t||0<f)&&0<g&&g<e&&g<=this.maxdist){var w=0,M=0,w=this.originx,M=this.originy;w+=this.dirx*g,M+=this.diry*g,w-=n.worldCOMx,M-=n.worldCOMy;var C,k,O,P,S,A=1/Math.sqrt(w*w+M*M);return w*=A,M*=A,f<=0&&(w=-w,M=-M),null==Ri.poolVec2?C=new at:(C=Ri.poolVec2,Ri.poolVec2=C.zpp_pool,C.zpp_pool=null),null==C.zpp_inner?(null==mo.zpp_pool?k=new mo:(k=mo.zpp_pool,mo.zpp_pool=k.next,k.next=null),k.weak=!1,k._immutable=!1,k.x=w,k.y=M,C.zpp_inner=k,C.zpp_inner.outer=C):(null!=(O=C.zpp_inner)._validate&&O._validate(),C.zpp_inner.x==w&&(null!=(P=C.zpp_inner)._validate&&P._validate(),C.zpp_inner.y==M)||(C.zpp_inner.x=w,C.zpp_inner.y=M,null!=(S=C.zpp_inner)._invalidate&&S._invalidate(S))),C.zpp_inner.weak=!1,wt.getRay(C,g,f<=0,n.outer)}return null}var j=(-m-(b=Math.sqrt(b)))*(v=1/(2*v)),E=(-m+b)*v;if(0<j){if(j<e&&j<=this.maxdist){var I=this.originx,T=this.originy;I+=this.dirx*j,T+=this.diry*j,I-=n.worldCOMx,T-=n.worldCOMy;var N,L,V,D,F,R=1/Math.sqrt(I*I+T*T);return I*=R,T*=R,null==Ri.poolVec2?N=new at:(N=Ri.poolVec2,Ri.poolVec2=N.zpp_pool,N.zpp_pool=null),null==N.zpp_inner?(null==mo.zpp_pool?L=new mo:(L=mo.zpp_pool,mo.zpp_pool=L.next,L.next=null),L.weak=!1,L._immutable=!1,L.x=I,L.y=T,N.zpp_inner=L,N.zpp_inner.outer=N):(null!=(V=N.zpp_inner)._validate&&V._validate(),N.zpp_inner.x==I&&(null!=(D=N.zpp_inner)._validate&&D._validate(),N.zpp_inner.y==T)||(N.zpp_inner.x=I,N.zpp_inner.y=T,null!=(F=N.zpp_inner)._invalidate&&F._invalidate(F))),N.zpp_inner.weak=!1,wt.getRay(N,j,!1,n.outer)}return null}if(0<E&&t){if(E<e&&E<=this.maxdist){var Z=this.originx,B=this.originy;Z+=this.dirx*E,B+=this.diry*E,Z-=n.worldCOMx,B-=n.worldCOMy;var G,q,U,K,W,Y=1/Math.sqrt(Z*Z+B*B);return Z=-(Z*=Y),B=-(B*=Y),null==Ri.poolVec2?G=new at:(G=Ri.poolVec2,Ri.poolVec2=G.zpp_pool,G.zpp_pool=null),null==G.zpp_inner?(null==mo.zpp_pool?q=new mo:(q=mo.zpp_pool,mo.zpp_pool=q.next,q.next=null),q.weak=!1,q._immutable=!1,q.x=Z,q.y=B,G.zpp_inner=q,G.zpp_inner.outer=G):(null!=(U=G.zpp_inner)._validate&&U._validate(),G.zpp_inner.x==Z&&(null!=(K=G.zpp_inner)._validate&&K._validate(),G.zpp_inner.y==B)||(G.zpp_inner.x=Z,G.zpp_inner.y=B,null!=(W=G.zpp_inner)._invalidate&&W._invalidate(W))),G.zpp_inner.weak=!1,wt.getRay(G,E,!0,n.outer)}return null}return null},It.prototype.circlesect2=function(n,t,e){if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var i=n.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var p=i.localCOMy=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var y=n.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var z=this.originx-n.worldCOMx,c=this.originy-n.worldCOMy,v=this.dirx*this.dirx+this.diry*this.diry,m=2*(z*this.dirx+c*this.diry),f=z*z+c*c-n.radius*n.radius,b=m*m-4*v*f;if(0==b){var g=-m/2*v;if((!t||0<f)&&0<g&&g<=this.maxdist){var w=0,M=0,w=this.originx,M=this.originy;w+=this.dirx*g,M+=this.diry*g,w-=n.worldCOMx,M-=n.worldCOMy;var C,k,O,P,S,A=1/Math.sqrt(w*w+M*M);w*=A,M*=A,f<=0&&(w=-w,M=-M),null==Ri.poolVec2?C=new at:(C=Ri.poolVec2,Ri.poolVec2=C.zpp_pool,C.zpp_pool=null),null==C.zpp_inner?(null==mo.zpp_pool?k=new mo:(k=mo.zpp_pool,mo.zpp_pool=k.next,k.next=null),k.weak=!1,k._immutable=!1,k.x=w,k.y=M,C.zpp_inner=k,C.zpp_inner.outer=C):(null!=(O=C.zpp_inner)._validate&&O._validate(),C.zpp_inner.x==w&&(null!=(P=C.zpp_inner)._validate&&P._validate(),C.zpp_inner.y==M)||(C.zpp_inner.x=w,C.zpp_inner.y=M,null!=(S=C.zpp_inner)._invalidate&&S._invalidate(S))),C.zpp_inner.weak=!1;for(var j=wt.getRay(C,g,f<=0,n.outer),E=null,I=e.zpp_inner.inner.head;null!=I&&!(j.zpp_inner.toiDistance<I.elt.zpp_inner.toiDistance);)I=(E=I).next;var T,N=e.zpp_inner.inner;null==yi.zpp_pool?T=new yi:(T=yi.zpp_pool,yi.zpp_pool=T.next,T.next=null),T.elt=j;var L=T;null==E?(L.next=N.head,N.head=L):(L.next=E.next,E.next=L),N.pushmod=N.modified=!0,N.length++}}else{var V=(-m-(b=Math.sqrt(b)))*(v=1/(2*v)),D=(-m+b)*v;if(0<V&&V<=this.maxdist){var F=this.originx,R=this.originy;F+=this.dirx*V,R+=this.diry*V,F-=n.worldCOMx,R-=n.worldCOMy;var Z,B,G,q,U,K=1/Math.sqrt(F*F+R*R);F*=K,R*=K,null==Ri.poolVec2?Z=new at:(Z=Ri.poolVec2,Ri.poolVec2=Z.zpp_pool,Z.zpp_pool=null),null==Z.zpp_inner?(null==mo.zpp_pool?B=new mo:(B=mo.zpp_pool,mo.zpp_pool=B.next,B.next=null),B.weak=!1,B._immutable=!1,B.x=F,B.y=R,Z.zpp_inner=B,Z.zpp_inner.outer=Z):(null!=(G=Z.zpp_inner)._validate&&G._validate(),Z.zpp_inner.x==F&&(null!=(q=Z.zpp_inner)._validate&&q._validate(),Z.zpp_inner.y==R)||(Z.zpp_inner.x=F,Z.zpp_inner.y=R,null!=(U=Z.zpp_inner)._invalidate&&U._invalidate(U))),Z.zpp_inner.weak=!1;for(var W=wt.getRay(Z,V,!1,n.outer),Y=null,J=e.zpp_inner.inner.head;null!=J&&!(W.zpp_inner.toiDistance<J.elt.zpp_inner.toiDistance);)J=(Y=J).next;var X,H=e.zpp_inner.inner;null==yi.zpp_pool?X=new yi:(X=yi.zpp_pool,yi.zpp_pool=X.next,X.next=null),X.elt=W;var $=X;null==Y?($.next=H.head,H.head=$):($.next=Y.next,Y.next=$),H.pushmod=H.modified=!0,H.length++}if(0<D&&D<=this.maxdist&&t){var Q=this.originx,nn=this.originy;Q+=this.dirx*D,nn+=this.diry*D,Q-=n.worldCOMx,nn-=n.worldCOMy;var tn,en,pn,ln,rn,on=1/Math.sqrt(Q*Q+nn*nn);Q=-(Q*=on),nn=-(nn*=on),null==Ri.poolVec2?tn=new at:(tn=Ri.poolVec2,Ri.poolVec2=tn.zpp_pool,tn.zpp_pool=null),null==tn.zpp_inner?(null==mo.zpp_pool?en=new mo:(en=mo.zpp_pool,mo.zpp_pool=en.next,en.next=null),en.weak=!1,en._immutable=!1,en.x=Q,en.y=nn,tn.zpp_inner=en,tn.zpp_inner.outer=tn):(null!=(pn=tn.zpp_inner)._validate&&pn._validate(),tn.zpp_inner.x==Q&&(null!=(ln=tn.zpp_inner)._validate&&ln._validate(),tn.zpp_inner.y==nn)||(tn.zpp_inner.x=Q,tn.zpp_inner.y=nn,null!=(rn=tn.zpp_inner)._invalidate&&rn._invalidate(rn))),tn.zpp_inner.weak=!1;for(var an=wt.getRay(tn,D,!0,n.outer),sn=null,_n=e.zpp_inner.inner.head;null!=_n&&!(an.zpp_inner.toiDistance<_n.elt.zpp_inner.toiDistance);)_n=(sn=_n).next;var hn,un=e.zpp_inner.inner;null==yi.zpp_pool?hn=new yi:(hn=yi.zpp_pool,yi.zpp_pool=hn.next,hn.next=null),hn.elt=an;var xn=hn;null==sn?(xn.next=un.head,un.head=xn):(xn.next=sn.next,sn.next=xn),un.pushmod=un.modified=!0,un.length++}}},It.prototype.polysect=function(n,t,e){for(var i=e,p=null,l=n.edges.head,r=n.gverts.next,o=r,a=r.next;null!=a;){var s,_,h,u,x,d,y,z=l.elt;(t||z.gnormx*this.dirx+z.gnormy*this.diry<0)&&(_=s=0,s=a.x-o.x,_=a.y-o.y,u=h=0,h=o.x-this.originx,u=o.y-this.originy,(x=_*this.dirx-s*this.diry)*x>co.epsilon&&(0<(d=(_*h-s*u)*(x=1/x))&&d<i&&d<=this.maxdist&&((y=(this.diry*h-this.dirx*u)*x)>-co.epsilon&&y<1+co.epsilon&&(i=d,p=l.elt)))),l=l.next,a=(o=a).next}for(;;){a=n.gverts.next;var c,v,m,f,b,g,w,M=l.elt;(t||M.gnormx*this.dirx+M.gnormy*this.diry<0)&&(v=c=0,c=a.x-o.x,v=a.y-o.y,f=m=0,m=o.x-this.originx,f=o.y-this.originy,(b=v*this.dirx-c*this.diry)*b>co.epsilon&&(0<(g=(v*m-c*f)*(b=1/b))&&g<i&&g<=this.maxdist&&((w=(this.diry*m-this.dirx*f)*b)>-co.epsilon&&w<1+co.epsilon&&(i=g,p=l.elt)))),l=l.next;break}if(null==p)return null;var C,k,O,P,S,A=0,j=0,A=p.gnormx,j=p.gnormy,E=0<A*this.dirx+j*this.diry;return E&&(A=-A,j=-j),null==Ri.poolVec2?C=new at:(C=Ri.poolVec2,Ri.poolVec2=C.zpp_pool,C.zpp_pool=null),null==C.zpp_inner?(null==mo.zpp_pool?k=new mo:(k=mo.zpp_pool,mo.zpp_pool=k.next,k.next=null),k.weak=!1,k._immutable=!1,k.x=A,k.y=j,C.zpp_inner=k,C.zpp_inner.outer=C):(null!=(O=C.zpp_inner)._validate&&O._validate(),C.zpp_inner.x==A&&(null!=(P=C.zpp_inner)._validate&&P._validate(),C.zpp_inner.y==j)||(C.zpp_inner.x=A,C.zpp_inner.y=j,null!=(S=C.zpp_inner)._invalidate&&S._invalidate(S))),C.zpp_inner.weak=!1,wt.getRay(C,i,E,n.outer)},It.prototype.polysect2=function(n,t,e){for(var i=1/0,p=-1,l=null,r=null,o=n.edges.head,a=n.gverts.next,s=a,_=a.next;null!=_;){var h,u,x,d,y,z,c,v=o.elt;(t||v.gnormx*this.dirx+v.gnormy*this.diry<0)&&(u=h=0,h=_.x-s.x,u=_.y-s.y,d=x=0,x=s.x-this.originx,d=s.y-this.originy,(y=u*this.dirx-h*this.diry)*y>co.epsilon&&(0<(z=(u*x-h*d)*(y=1/y))&&z<=this.maxdist&&(z<i||p<z)&&((c=(this.diry*x-this.dirx*d)*y)>-co.epsilon&&c<1+co.epsilon&&(z<i&&(i=z,l=o.elt),p<z&&(p=z,r=o.elt))))),o=o.next,_=(s=_).next}for(;;){_=n.gverts.next;var m,f,b,g,w,M,C,k=o.elt;(t||k.gnormx*this.dirx+k.gnormy*this.diry<0)&&(f=m=0,m=_.x-s.x,f=_.y-s.y,g=b=0,b=s.x-this.originx,g=s.y-this.originy,(w=f*this.dirx-m*this.diry)*w>co.epsilon&&(0<(M=(f*b-m*g)*(w=1/w))&&M<=this.maxdist&&(M<i||p<M)&&((C=(this.diry*b-this.dirx*g)*w)>-co.epsilon&&C<1+co.epsilon&&(M<i&&(i=M,l=o.elt),p<M&&(p=M,r=o.elt))))),o=o.next;break}if(null!=l){var O,P,S,A,j,E=0,I=0,E=l.gnormx,I=l.gnormy,T=0<E*this.dirx+I*this.diry;T&&(E=-E,I=-I),null==Ri.poolVec2?O=new at:(O=Ri.poolVec2,Ri.poolVec2=O.zpp_pool,O.zpp_pool=null),null==O.zpp_inner?(null==mo.zpp_pool?P=new mo:(P=mo.zpp_pool,mo.zpp_pool=P.next,P.next=null),P.weak=!1,P._immutable=!1,P.x=E,P.y=I,O.zpp_inner=P,O.zpp_inner.outer=O):(null!=(S=O.zpp_inner)._validate&&S._validate(),O.zpp_inner.x==E&&(null!=(A=O.zpp_inner)._validate&&A._validate(),O.zpp_inner.y==I)||(O.zpp_inner.x=E,O.zpp_inner.y=I,null!=(j=O.zpp_inner)._invalidate&&j._invalidate(j))),O.zpp_inner.weak=!1;for(var N=wt.getRay(O,i,T,n.outer),L=null,V=e.zpp_inner.inner.head;null!=V&&!(N.zpp_inner.toiDistance<V.elt.zpp_inner.toiDistance);)V=(L=V).next;var D,F=e.zpp_inner.inner;null==yi.zpp_pool?D=new yi:(D=yi.zpp_pool,yi.zpp_pool=D.next,D.next=null),D.elt=N;var R=D;null==L?(R.next=F.head,F.head=R):(R.next=L.next,L.next=R),F.pushmod=F.modified=!0,F.length++}if(null!=r&&l!=r){var Z,B,G,q,U,K=0,W=0,K=r.gnormx,W=r.gnormy,Y=0<K*this.dirx+W*this.diry;Y&&(K=-K,W=-W),null==Ri.poolVec2?Z=new at:(Z=Ri.poolVec2,Ri.poolVec2=Z.zpp_pool,Z.zpp_pool=null),null==Z.zpp_inner?(null==mo.zpp_pool?B=new mo:(B=mo.zpp_pool,mo.zpp_pool=B.next,B.next=null),B.weak=!1,B._immutable=!1,B.x=K,B.y=W,Z.zpp_inner=B,Z.zpp_inner.outer=Z):(null!=(G=Z.zpp_inner)._validate&&G._validate(),Z.zpp_inner.x==K&&(null!=(q=Z.zpp_inner)._validate&&q._validate(),Z.zpp_inner.y==W)||(Z.zpp_inner.x=K,Z.zpp_inner.y=W,null!=(U=Z.zpp_inner)._invalidate&&U._invalidate(U))),Z.zpp_inner.weak=!1;for(var J=wt.getRay(Z,p,Y,n.outer),X=null,H=e.zpp_inner.inner.head;null!=H&&!(J.zpp_inner.toiDistance<H.elt.zpp_inner.toiDistance);)H=(X=H).next;var $,Q=e.zpp_inner.inner;null==yi.zpp_pool?$=new yi:($=yi.zpp_pool,yi.zpp_pool=$.next,$.next=null),$.elt=J;var nn=$;null==X?(nn.next=Q.head,Q.head=nn):(nn.next=X.next,X.next=nn),Q.pushmod=Q.modified=!0,Q.length++}},It.prototype.__class__=It;var Tt=zpp_nape.geom.ZPP_SimpleVert=function(){this.node=null,this.next=null,this.id=0,this.links=null,this.y=0,this.x=0,this.forced=!1,this.id=Sn.ZPP_SimpleVert(),null==Ui.zpp_pool?this.links=new Ui:(this.links=Ui.zpp_pool,Ui.zpp_pool=this.links.next,this.links.next=null),this.links.lt=Tt.less_xy};Tt.__name__=["zpp_nape","geom","ZPP_SimpleVert"],Tt.less_xy=function(n,t){return n.y<t.y||n.y==t.y&&n.x<t.x},Tt.swap_nodes=function(n,t){var e=n.node;n.node=t.node,t.node=e},Tt.get=function(n,t){var e;return null==Tt.zpp_pool?e=new Tt:(e=Tt.zpp_pool,Tt.zpp_pool=e.next,e.next=null),e.x=n,e.y=t,e},Tt.prototype.forced=null,Tt.prototype.x=null,Tt.prototype.y=null,Tt.prototype.links=null,Tt.prototype.id=null,Tt.prototype.next=null,Tt.prototype.node=null,Tt.prototype.free=function(){this.links.clear(),this.node=null,this.forced=!1},Tt.prototype.alloc=function(){},Tt.prototype.__class__=Tt;var Nt=zpp_nape.geom.ZPP_SimpleSeg=function(){this.node=null,this.prev=null,this.next=null,this.id=0,this.vertices=null,this.right=null,this.left=null,this.id=Sn.ZPP_SimpleSeg(),null==Ui.zpp_pool?this.vertices=new Ui:(this.vertices=Ui.zpp_pool,Ui.zpp_pool=this.vertices.next,this.vertices.next=null),this.vertices.lt=Q(this,this.less_xy)};Nt.__name__=["zpp_nape","geom","ZPP_SimpleSeg"],Nt.get=function(n,t){var e;return null==Nt.zpp_pool?e=new Nt:(e=Nt.zpp_pool,Nt.zpp_pool=e.next,e.next=null),e.left=n,e.right=t,e.vertices.insert(n),e.vertices.insert(t),e},Nt.prototype.left=null,Nt.prototype.right=null,Nt.prototype.vertices=null,Nt.prototype.id=null,Nt.prototype.next=null,Nt.prototype.free=function(){this.left=this.right=null,this.prev=null,this.node=null,this.vertices.clear()},Nt.prototype.alloc=function(){},Nt.prototype.prev=null,Nt.prototype.node=null,Nt.prototype.less_xy=function(n,t){return n.x<t.x||n.x==t.x&&n.y<t.y},Nt.prototype.__class__=Nt;var Lt=zpp_nape.geom.ZPP_SimpleEvent=function(){this.next=null,this.node=null,this.segment2=null,this.segment=null,this.vertex=null,this.type=0};Lt.__name__=["zpp_nape","geom","ZPP_SimpleEvent"],Lt.swap_nodes=function(n,t){var e=n.node;n.node=t.node,t.node=e},Lt.less_xy=function(n,t){return n.vertex.x<t.vertex.x||!(n.vertex.x>t.vertex.x)&&(n.vertex.y<t.vertex.y||!(n.vertex.y>t.vertex.y)&&n.type<t.type)},Lt.get=function(n){var t;return null==Lt.zpp_pool?t=new Lt:(t=Lt.zpp_pool,Lt.zpp_pool=t.next,t.next=null),t.vertex=n,t},Lt.prototype.type=null,Lt.prototype.vertex=null,Lt.prototype.segment=null,Lt.prototype.segment2=null,Lt.prototype.node=null,Lt.prototype.next=null,Lt.prototype.free=function(){this.vertex=null,this.segment=this.segment2=null,this.node=null},Lt.prototype.alloc=function(){},Lt.prototype.__class__=Lt;var Vt=zpp_nape.geom.ZPP_SimpleSweep=function(){this.tree=null,this.sweepx=0,null==Ki.zpp_pool?this.tree=new Ki:(this.tree=Ki.zpp_pool,Ki.zpp_pool=this.tree.next,this.tree.next=null),this.tree.lt=Q(this,this.edge_lt),this.tree.swapped=Q(this,this.swap_nodes)};Vt.__name__=["zpp_nape","geom","ZPP_SimpleSweep"],Vt.prototype.sweepx=null,Vt.prototype.tree=null,Vt.prototype.swap_nodes=function(n,t){var e=n.node;n.node=t.node,t.node=e},Vt.prototype.edge_lt=function(n,t){var e=0,i=0,p=0,l=0;if(n.left==t.left&&n.right==t.right)return!1;if(n.left==t.right)return n.left.x==n.right.x?n.left.y<n.right.y?n.left.y>t.left.y:n.right.y>t.left.y:(a=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.left.x-n.left.x,l=t.left.y-n.left.y,(a?i*p-e*l:l*e-p*i)<0);if(n.right==t.left){var r=t.left.x==t.right.x?t.left.y<t.right.y?t.left.y>n.left.y:t.right.y>n.left.y:(a=t.right.x<t.left.x,e=t.right.x-t.left.x,i=t.right.y-t.left.y,p=n.left.x-t.left.x,l=n.left.y-t.left.y,(a?i*p-e*l:l*e-p*i)<0);return!r}if(n.left==t.left)return n.left.x==n.right.x?n.left.y<n.right.y?n.left.y>t.right.y:n.right.y>t.right.y:(a=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.right.x-n.left.x,l=t.right.y-n.left.y,(a?i*p-e*l:l*e-p*i)<0);if(n.right==t.right)return n.left.x==n.right.x?n.left.y<n.right.y?n.left.y>t.left.y:n.right.y>t.left.y:(a=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.left.x-n.left.x,l=t.left.y-n.left.y,(a?i*p-e*l:l*e-p*i)<0);if(n.left.x==n.right.x){if(t.left.x==t.right.x)return(n.left.y<n.right.y?n.right:n.left).y>(t.left.y<t.right.y?t.right:t.left).y;a=t.right.x<t.left.x,e=t.right.x-t.left.x,i=t.right.y-t.left.y,p=n.left.x-t.left.x,l=n.left.y-t.left.y;var o=a?i*p-e*l:l*e-p*i,a=t.right.x<t.left.x,e=t.right.x-t.left.x,i=t.right.y-t.left.y,p=n.right.x-t.left.x,l=n.right.y-t.left.y;return 0<=o*(a?i*p-e*l:l*e-p*i)?0<=o:this.sweepx>=n.left.x}if(t.left.x==t.right.x){a=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.left.x-n.left.x,l=t.left.y-n.left.y;var s=a?i*p-e*l:l*e-p*i;return a=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.right.x-n.left.x,l=t.right.y-n.left.y,0<=s*(a?i*p-e*l:l*e-p*i)?s<0:this.sweepx<t.left.x}a=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.left.x-n.left.x,l=t.left.y-n.left.y;var _=(a?i*p-e*l:l*e-p*i)<0;if(a=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.right.x-n.left.x,l=t.right.y-n.left.y,_==(a?i*p-e*l:l*e-p*i)<0)return _;a=t.right.x<t.left.x,e=t.right.x-t.left.x,i=t.right.y-t.left.y,p=n.left.x-t.left.x,l=n.left.y-t.left.y;var h=0<=(a?i*p-e*l:l*e-p*i);return a=t.right.x<t.left.x,e=t.right.x-t.left.x,i=t.right.y-t.left.y,p=n.right.x-t.left.x,l=n.right.y-t.left.y,h==0<=(a?i*p-e*l:l*e-p*i)?h:(this.sweepx-n.left.x)/(n.right.x-n.left.x)*(n.right.y-n.left.y)+n.left.y>(this.sweepx-t.left.x)/(t.right.x-t.left.x)*(t.right.y-t.left.y)+t.left.y},Vt.prototype.clear=function(){this.tree.clear()},Vt.prototype.add=function(n){n.node=this.tree.insert(n);var t=this.tree.successor_node(n.node),e=this.tree.predecessor_node(n.node);return null!=t&&(n.next=t.data,t.data.prev=n),null!=e&&(n.prev=e.data,e.data.next=n),n},Vt.prototype.remove=function(n){var t=this.tree.successor_node(n.node),e=this.tree.predecessor_node(n.node);null!=t&&(t.data.prev=n.prev),null!=e&&(e.data.next=n.next),this.tree.remove_node(n.node),n.node=null},Vt.prototype.intersect=function(n,t){if(null==n||null==t)return!1;if(n.left==t.left||n.left==t.right||n.right==t.left||n.right==t.right)return!1;var e=(t.left.x-n.left.x)*(n.right.y-n.left.y)-(n.right.x-n.left.x)*(t.left.y-n.left.y),i=(t.right.x-n.left.x)*(n.right.y-n.left.y)-(n.right.x-n.left.x)*(t.right.y-n.left.y);if(0<e*i)return!1;var p=(n.left.x-t.left.x)*(t.right.y-t.left.y)-(t.right.x-t.left.x)*(n.left.y-t.left.y),l=(n.right.x-t.left.x)*(t.right.y-t.left.y)-(t.right.x-t.left.x)*(n.right.y-t.left.y);return!(0<p*l)},Vt.prototype.intersection=function(n,t){if(null==n||null==t)return null;if(n.left==t.left||n.left==t.right||n.right==t.left||n.right==t.right)return null;var e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=0,l=t.right.x-t.left.x,r=(p=t.right.y-t.left.y)*e-l*i;if(0==r)return null;r=1/r;var o=0,a=0,s=(p*(o=t.left.x-n.left.x)-l*(a=t.left.y-n.left.y))*r;if(s<0||1<s)return null;var _,h,u,x,d,y=(i*o-e*a)*r;if(y<0||1<y)return null;_=0==y||1==y||0==s||1==s?0==y?t.left:1==y?t.right:0==s?n.left:n.right:(h=.5*(n.left.x+e*s+t.left.x+l*y),u=.5*(n.left.y+i*s+t.left.y+p*y),null==Tt.zpp_pool?x=new Tt:(x=Tt.zpp_pool,Tt.zpp_pool=x.next,x.next=null),x.x=h,x.y=u,x),null==Lt.zpp_pool?d=new Lt:(d=Lt.zpp_pool,Lt.zpp_pool=d.next,d.next=null),d.vertex=_;var z=d;return z.type=0,z.segment=n,z.segment2=t,z},Vt.prototype.__class__=Vt;var Dt=zpp_nape.geom.ZPP_Simple=function(){};Dt.__name__=["zpp_nape","geom","ZPP_Simple"],Dt.decompose=function(n,t){null==Dt.sweep&&(Dt.sweep=new Vt,Dt.inthash=new ye),null==Dt.vertices&&(null==Ui.zpp_pool?Dt.vertices=new Ui:(Dt.vertices=Ui.zpp_pool,Ui.zpp_pool=Dt.vertices.next,Dt.vertices.next=null),Dt.vertices.lt=Tt.less_xy,Dt.vertices.swapped=Tt.swap_nodes),null==Dt.queue&&(null==Wi.zpp_pool?Dt.queue=new Wi:(Dt.queue=Wi.zpp_pool,Wi.zpp_pool=Dt.queue.next,Dt.queue.next=null),Dt.queue.lt=Lt.less_xy,Dt.queue.swapped=Lt.swap_nodes);var e,i=null,p=null;if(null!=n)for(var l=n;;){var r,o=l.x,a=l.y;null==Tt.zpp_pool?r=new Tt:(r=Tt.zpp_pool,Tt.zpp_pool=r.next,r.next=null),r.x=o,r.y=a;for(var s=r,_=Dt.vertices.parent;null!=_;)if(Dt.vertices.lt(s,_.data))_=_.prev;else{if(!Dt.vertices.lt(_.data,s))break;_=_.next}var h,u,x,d,y,z,c=_;if(null!=c?((h=s).links.clear(),h.node=null,h.forced=!1,h.next=Tt.zpp_pool,Tt.zpp_pool=h,s=c.data):s.node=Dt.vertices.insert(s),null!=p&&(null==Lt.zpp_pool?u=new Lt:(u=Lt.zpp_pool,Lt.zpp_pool=u.next,u.next=null),u.vertex=p,x=u,null==Lt.zpp_pool?d=new Lt:(d=Lt.zpp_pool,Lt.zpp_pool=d.next,d.next=null),d.vertex=s,y=d,z=Lt.less_xy(x,y)?(x.type=1,y.type=2,Nt.get(p,s)):(x.type=2,y.type=1,Nt.get(s,p)),x.segment=y.segment=z,Dt.queue.insert(x),Dt.queue.insert(y),p.links.insert(s),s.links.insert(p)),p=s,null==i&&(i=s),(l=l.next)==n)break}null==Lt.zpp_pool?e=new Lt:(e=Lt.zpp_pool,Lt.zpp_pool=e.next,e.next=null),e.vertex=p;var v,m=e;null==Lt.zpp_pool?v=new Lt:(v=Lt.zpp_pool,Lt.zpp_pool=v.next,v.next=null),v.vertex=i;var f=v,b=Lt.less_xy(m,f)?(m.type=1,f.type=2,Nt.get(p,i)):(m.type=2,f.type=1,Nt.get(i,p));for(m.segment=f.segment=b,Dt.queue.insert(m),Dt.queue.insert(f),p.links.insert(i),i.links.insert(p),null==Dt.ints&&(null==Wi.zpp_pool?Dt.ints=new Wi:(Dt.ints=Wi.zpp_pool,Wi.zpp_pool=Dt.ints.next,Dt.ints.next=null),Dt.ints.lt=Lt.less_xy);!Dt.queue.empty();){var g=Dt.queue.pop_front();if(Dt.sweep.sweepx=g.vertex.x,1==g.type){var w=g.segment;if(Dt.sweep.add(w),null!=w.next&&null!=w&&!(w.next.id<w.id?Dt.inthash.has(w.next.id,w.id):Dt.inthash.has(w.id,w.next.id))){var M=Dt.sweep.intersection(w.next,w);if(null!=M)if(M.vertex.x>=Dt.sweep.sweepx){for(var C=Dt.queue.parent;null!=C;)if(Dt.queue.lt(M,C.data))C=C.prev;else{if(!Dt.queue.lt(C.data,M))break;C=C.next}if(null==C){for(var k=Dt.ints.parent;null!=k;)if(Dt.ints.lt(M,k.data))k=k.prev;else{if(!Dt.ints.lt(k.data,M))break;k=k.next}var O,P,S,A,j,E,I,T,N,L=k;null!=L?((O=M.vertex).links.clear(),O.node=null,O.forced=!1,O.next=Tt.zpp_pool,Tt.zpp_pool=O,M.vertex=L.data.vertex,L.data=M,Dt.queue.insert(M)):(Dt.queue.insert(M),Dt.ints.insert(M)),w.next.id<w.id?(P=w.next.id,S=w.id,null==de.zpp_pool?A=new de:(A=de.zpp_pool,de.zpp_pool=A.next,A.next=null),A.id=P,A.di=S,(j=A).value=!0,Dt.inthash.add(j)):(E=w.id,I=w.next.id,null==de.zpp_pool?T=new de:(T=de.zpp_pool,de.zpp_pool=T.next,T.next=null),T.id=E,T.di=I,(N=T).value=!0,Dt.inthash.add(N))}else{var V=M.vertex;V.links.clear(),V.node=null,V.forced=!1,V.next=Tt.zpp_pool,Tt.zpp_pool=V,M.vertex=null,M.segment=M.segment2=null,M.node=null,M.next=Lt.zpp_pool,Lt.zpp_pool=M}}else{var D=M.vertex;D.links.clear(),D.node=null,D.forced=!1,D.next=Tt.zpp_pool,Tt.zpp_pool=D,M.vertex=null,M.segment=M.segment2=null,M.node=null,M.next=Lt.zpp_pool,Lt.zpp_pool=M}}if(null!=w&&null!=w.prev&&!(w.id<w.prev.id?Dt.inthash.has(w.id,w.prev.id):Dt.inthash.has(w.prev.id,w.id))){var F=Dt.sweep.intersection(w,w.prev);if(null!=F)if(F.vertex.x>=Dt.sweep.sweepx){for(var R=Dt.queue.parent;null!=R;)if(Dt.queue.lt(F,R.data))R=R.prev;else{if(!Dt.queue.lt(R.data,F))break;R=R.next}if(null==R){for(var Z=Dt.ints.parent;null!=Z;)if(Dt.ints.lt(F,Z.data))Z=Z.prev;else{if(!Dt.ints.lt(Z.data,F))break;Z=Z.next}var B,G,q,U,K,W,Y,J,X,H=Z;null!=H?((B=F.vertex).links.clear(),B.node=null,B.forced=!1,B.next=Tt.zpp_pool,Tt.zpp_pool=B,F.vertex=H.data.vertex,H.data=F,Dt.queue.insert(F)):(Dt.queue.insert(F),Dt.ints.insert(F)),w.id<w.prev.id?(G=w.id,q=w.prev.id,null==de.zpp_pool?U=new de:(U=de.zpp_pool,de.zpp_pool=U.next,U.next=null),U.id=G,U.di=q,(K=U).value=!0,Dt.inthash.add(K)):(W=w.prev.id,Y=w.id,null==de.zpp_pool?J=new de:(J=de.zpp_pool,de.zpp_pool=J.next,J.next=null),J.id=W,J.di=Y,(X=J).value=!0,Dt.inthash.add(X))}else{var $=F.vertex;$.links.clear(),$.node=null,$.forced=!1,$.next=Tt.zpp_pool,Tt.zpp_pool=$,F.vertex=null,F.segment=F.segment2=null,F.node=null,F.next=Lt.zpp_pool,Lt.zpp_pool=F}}else{var Q=F.vertex;Q.links.clear(),Q.node=null,Q.forced=!1,Q.next=Tt.zpp_pool,Tt.zpp_pool=Q,F.vertex=null,F.segment=F.segment2=null,F.node=null,F.next=Lt.zpp_pool,Lt.zpp_pool=F}}}else if(2==g.type){var nn=g.segment;if(null!=nn.node){var tn=nn.next,en=nn.prev;if(Dt.sweep.remove(nn),nn.left=nn.right=null,nn.prev=null,nn.node=null,nn.vertices.clear(),nn.next=Nt.zpp_pool,Nt.zpp_pool=nn,null!=tn&&null!=en&&!(tn.id<en.id?Dt.inthash.has(tn.id,en.id):Dt.inthash.has(en.id,tn.id))){var pn=Dt.sweep.intersection(tn,en);if(null!=pn)if(pn.vertex.x>=Dt.sweep.sweepx){for(var ln=Dt.queue.parent;null!=ln;)if(Dt.queue.lt(pn,ln.data))ln=ln.prev;else{if(!Dt.queue.lt(ln.data,pn))break;ln=ln.next}if(null==ln){for(var rn=Dt.ints.parent;null!=rn;)if(Dt.ints.lt(pn,rn.data))rn=rn.prev;else{if(!Dt.ints.lt(rn.data,pn))break;rn=rn.next}var on,an,sn,_n,hn,un,xn,dn,yn,zn=rn;null!=zn?((on=pn.vertex).links.clear(),on.node=null,on.forced=!1,on.next=Tt.zpp_pool,Tt.zpp_pool=on,pn.vertex=zn.data.vertex,zn.data=pn,Dt.queue.insert(pn)):(Dt.queue.insert(pn),Dt.ints.insert(pn)),tn.id<en.id?(an=tn.id,sn=en.id,null==de.zpp_pool?_n=new de:(_n=de.zpp_pool,de.zpp_pool=_n.next,_n.next=null),_n.id=an,_n.di=sn,(hn=_n).value=!0,Dt.inthash.add(hn)):(un=en.id,xn=tn.id,null==de.zpp_pool?dn=new de:(dn=de.zpp_pool,de.zpp_pool=dn.next,dn.next=null),dn.id=un,dn.di=xn,(yn=dn).value=!0,Dt.inthash.add(yn))}else{var cn=pn.vertex;cn.links.clear(),cn.node=null,cn.forced=!1,cn.next=Tt.zpp_pool,Tt.zpp_pool=cn,pn.vertex=null,pn.segment=pn.segment2=null,pn.node=null,pn.next=Lt.zpp_pool,Lt.zpp_pool=pn}}else{var vn=pn.vertex;vn.links.clear(),vn.node=null,vn.forced=!1,vn.next=Tt.zpp_pool,Tt.zpp_pool=vn,pn.vertex=null,pn.segment=pn.segment2=null,pn.node=null,pn.next=Lt.zpp_pool,Lt.zpp_pool=pn}}}}else{var mn,fn=g.vertex,bn=null==fn.node,gn=g.segment,wn=g.segment2;wn.next!=gn&&(mn=gn,gn=wn,wn=mn);for(var Mn=gn.vertices.parent;null!=Mn;)if(gn.vertices.lt(fn,Mn.data))Mn=Mn.prev;else{if(!gn.vertices.lt(Mn.data,fn))break;Mn=Mn.next}for(var Cn=null==Mn,kn=wn.vertices.parent;null!=kn;)if(wn.vertices.lt(fn,kn.data))kn=kn.prev;else{if(!wn.vertices.lt(kn.data,fn))break;kn=kn.next}var On,Pn,Sn,An,jn,En,In,Tn,Nn=null==kn;if(Cn&&(On=gn.vertices.insert(fn),Pn=fn==gn.left?fn:gn.vertices.predecessor_node(On).data,Sn=fn==gn.right?fn:gn.vertices.successor_node(On).data,Pn.links.remove(Sn),fn!=Pn&&Pn.links.insert(fn),Sn.links.remove(Pn),fn!=Sn&&Sn.links.insert(fn),fn!=Pn&&fn.links.insert(Pn),fn!=Sn&&fn.links.insert(Sn)),Nn&&(An=wn.vertices.insert(fn),jn=fn==wn.left?fn:wn.vertices.predecessor_node(An).data,En=fn==wn.right?fn:wn.vertices.successor_node(An).data,jn.links.remove(En),fn!=jn&&jn.links.insert(fn),En.links.remove(jn),fn!=En&&En.links.insert(fn),fn!=jn&&fn.links.insert(jn),fn!=En&&fn.links.insert(En)),bn&&(fn.node=Dt.vertices.insert(fn)),fn.forced=!0,bn&&(In=gn.node,Tn=wn.node,In.data=wn,(Tn.data=gn).node=Tn,wn.node=In,wn.next=gn.next,gn.next=wn,gn.prev=wn.prev,null!=(wn.prev=gn).prev&&(gn.prev.next=gn),null!=wn.next&&(wn.next.prev=wn)),null!=wn.next&&null!=wn&&!(wn.next.id<wn.id?Dt.inthash.has(wn.next.id,wn.id):Dt.inthash.has(wn.id,wn.next.id))){var Ln=Dt.sweep.intersection(wn.next,wn);if(null!=Ln)if(Ln.vertex.x>=Dt.sweep.sweepx){for(var Vn=Dt.queue.parent;null!=Vn;)if(Dt.queue.lt(Ln,Vn.data))Vn=Vn.prev;else{if(!Dt.queue.lt(Vn.data,Ln))break;Vn=Vn.next}if(null==Vn){for(var Dn=Dt.ints.parent;null!=Dn;)if(Dt.ints.lt(Ln,Dn.data))Dn=Dn.prev;else{if(!Dt.ints.lt(Dn.data,Ln))break;Dn=Dn.next}var Fn,Rn,Zn,Bn,Gn,qn,Un,Kn,Wn,Yn=Dn;null!=Yn?((Fn=Ln.vertex).links.clear(),Fn.node=null,Fn.forced=!1,Fn.next=Tt.zpp_pool,Tt.zpp_pool=Fn,Ln.vertex=Yn.data.vertex,Yn.data=Ln,Dt.queue.insert(Ln)):(Dt.queue.insert(Ln),Dt.ints.insert(Ln)),wn.next.id<wn.id?(Rn=wn.next.id,Zn=wn.id,null==de.zpp_pool?Bn=new de:(Bn=de.zpp_pool,de.zpp_pool=Bn.next,Bn.next=null),Bn.id=Rn,Bn.di=Zn,(Gn=Bn).value=!0,Dt.inthash.add(Gn)):(qn=wn.id,Un=wn.next.id,null==de.zpp_pool?Kn=new de:(Kn=de.zpp_pool,de.zpp_pool=Kn.next,Kn.next=null),Kn.id=qn,Kn.di=Un,(Wn=Kn).value=!0,Dt.inthash.add(Wn))}else{var Jn=Ln.vertex;Jn.links.clear(),Jn.node=null,Jn.forced=!1,Jn.next=Tt.zpp_pool,Tt.zpp_pool=Jn,Ln.vertex=null,Ln.segment=Ln.segment2=null,Ln.node=null,Ln.next=Lt.zpp_pool,Lt.zpp_pool=Ln}}else{var Xn=Ln.vertex;Xn.links.clear(),Xn.node=null,Xn.forced=!1,Xn.next=Tt.zpp_pool,Tt.zpp_pool=Xn,Ln.vertex=null,Ln.segment=Ln.segment2=null,Ln.node=null,Ln.next=Lt.zpp_pool,Lt.zpp_pool=Ln}}if(null!=gn&&null!=gn.prev&&!(gn.id<gn.prev.id?Dt.inthash.has(gn.id,gn.prev.id):Dt.inthash.has(gn.prev.id,gn.id))){var Hn=Dt.sweep.intersection(gn,gn.prev);if(null!=Hn)if(Hn.vertex.x>=Dt.sweep.sweepx){for(var $n=Dt.queue.parent;null!=$n;)if(Dt.queue.lt(Hn,$n.data))$n=$n.prev;else{if(!Dt.queue.lt($n.data,Hn))break;$n=$n.next}if(null==$n){for(var Qn=Dt.ints.parent;null!=Qn;)if(Dt.ints.lt(Hn,Qn.data))Qn=Qn.prev;else{if(!Dt.ints.lt(Qn.data,Hn))break;Qn=Qn.next}var nt,tt,et,it,pt,lt,rt,ot,at,st=Qn;null!=st?((nt=Hn.vertex).links.clear(),nt.node=null,nt.forced=!1,nt.next=Tt.zpp_pool,Tt.zpp_pool=nt,Hn.vertex=st.data.vertex,st.data=Hn,Dt.queue.insert(Hn)):(Dt.queue.insert(Hn),Dt.ints.insert(Hn)),gn.id<gn.prev.id?(tt=gn.id,et=gn.prev.id,null==de.zpp_pool?it=new de:(it=de.zpp_pool,de.zpp_pool=it.next,it.next=null),it.id=tt,it.di=et,(pt=it).value=!0,Dt.inthash.add(pt)):(lt=gn.prev.id,rt=gn.id,null==de.zpp_pool?ot=new de:(ot=de.zpp_pool,de.zpp_pool=ot.next,ot.next=null),ot.id=lt,ot.di=rt,(at=ot).value=!0,Dt.inthash.add(at))}else{var _t=Hn.vertex;_t.links.clear(),_t.node=null,_t.forced=!1,_t.next=Tt.zpp_pool,Tt.zpp_pool=_t,Hn.vertex=null,Hn.segment=Hn.segment2=null,Hn.node=null,Hn.next=Lt.zpp_pool,Lt.zpp_pool=Hn}}else{var ht=Hn.vertex;ht.links.clear(),ht.node=null,ht.forced=!1,ht.next=Tt.zpp_pool,Tt.zpp_pool=ht,Hn.vertex=null,Hn.segment=Hn.segment2=null,Hn.node=null,Hn.next=Lt.zpp_pool,Lt.zpp_pool=Hn}}Dt.ints.remove(g)}g.vertex=null,g.segment=g.segment2=null,g.node=null,g.next=Lt.zpp_pool,Lt.zpp_pool=g}for(var ut=0,xt=Dt.inthash.table.length;ut<xt;){var dt=ut++,yt=Dt.inthash.table[dt];if(null!=yt){for(;null!=yt;){var zt=yt.hnext;yt.hnext=null;var ct=yt;ct.next=de.zpp_pool,de.zpp_pool=ct,yt=zt}Dt.inthash.table[dt]=null}}for(null==t&&(t=new Ce);!Dt.vertices.empty();)Dt.clip_polygon(Dt.vertices,t);return t},Dt.clip_polygon=function(n,t){var e=null,i=n.first(),p=i,l=i.links.parent,r=null==l.prev?l.next:l.prev,o=l.data,a=r.data,s=i.x-o.x,_=i.y-o.y,h=a.x-i.x;(a.y-i.y)*s-h*_<0&&(a=o);var u,x=i.x,d=i.y;null==xp.zpp_pool?u=new xp:(u=xp.zpp_pool,xp.zpp_pool=u.next,u.next=null),u.forced=!1,u.x=x,u.y=d;var y,z=u;for(null==e?e=z.prev=z.next=z:(z.prev=e,z.next=e.next,e.next.prev=z,e.next=z),(e=z).forced=i.forced;;){if(i.links.remove(a),a.links.remove(i),a==p){i.links.empty()&&(n.remove(i),(y=i).links.clear(),y.node=null,y.forced=!1,y.next=Tt.zpp_pool,Tt.zpp_pool=y);break}var c,v=a.x,m=a.y;null==xp.zpp_pool?c=new xp:(c=xp.zpp_pool,xp.zpp_pool=c.next,c.next=null),c.forced=!1,c.x=v,c.y=m;var f,b=c;if(null==e?e=b.prev=b.next=b:(b.prev=e,b.next=e.next,e.next.prev=b,e.next=b),(e=b).forced=a.forced,a.links.singular()){i.links.empty()&&(n.remove(i),(f=i).links.clear(),f.node=null,f.forced=!1,f.next=Tt.zpp_pool,Tt.zpp_pool=f),a=(i=a).links.parent.data}else{var g,w=null,M=0;if(!a.links.empty()){for(var C=a.links.parent;null!=C.prev;)C=C.prev;for(;null!=C;){var k,O,P,S,A,j,E,I,T,N,L=C.data;if(null==w?(w=L,O=k=0,k=a.x-i.x,O=a.y-i.y,P=0,P=L.x-a.x,M=(L.y-a.y)*k-P*O):(A=S=0,S=a.x-i.x,A=a.y-i.y,j=0,j=L.x-a.x,0<(E=(L.y-a.y)*S-j*A)&&M<=0?(w=L,M=E):0<=M*E&&(T=I=0,I=a.x-L.x,T=a.y-L.y,N=0,N=w.x-a.x,0<(w.y-a.y)*I-N*T&&(w=L,M=E))),null!=C.next)for(C=C.next;null!=C.prev;)C=C.prev;else{for(;null!=C.parent&&C==C.parent.next;)C=C.parent;C=C.parent}}}i.links.empty()&&(n.remove(i),(g=i).links.clear(),g.node=null,g.forced=!1,g.next=Tt.zpp_pool,Tt.zpp_pool=g),i=a,a=w}}n.remove(p),p.links.clear(),p.node=null,p.forced=!1,p.next=Tt.zpp_pool,Tt.zpp_pool=p,t.add(e)},Dt.isSimple=function(n){null==Dt.sweep&&(Dt.sweep=new Vt,Dt.inthash=new ye);var t=Dt.list_vertices;if(null==t&&(t=Dt.list_vertices=new ke),null!=n)for(var e=n;;){var i,p=e.x,l=e.y;if(null==Tt.zpp_pool?i=new Tt:(i=Tt.zpp_pool,Tt.zpp_pool=i.next,i.next=null),i.x=p,i.y=l,t.add(i),(e=e.next)==n)break}var r=Dt.list_queue;null==r&&(r=Dt.list_queue=new Oe);for(var o=(a=t.head).elt,a=a.next;null!=a;){var s,_=a.elt;null==Lt.zpp_pool?s=new Lt:(s=Lt.zpp_pool,Lt.zpp_pool=s.next,s.next=null),s.vertex=o;var h,u=r.add(s);null==Lt.zpp_pool?h=new Lt:(h=Lt.zpp_pool,Lt.zpp_pool=h.next,h.next=null),h.vertex=_;var x=r.add(h),d=Lt.less_xy(u,x)?(u.type=1,x.type=2,Nt.get(o,_)):(u.type=2,x.type=1,Nt.get(_,o));u.segment=x.segment=d,o=_,a=a.next}var y,z=t.head.elt;null==Lt.zpp_pool?y=new Lt:(y=Lt.zpp_pool,Lt.zpp_pool=y.next,y.next=null),y.vertex=o;var c,v=r.add(y);null==Lt.zpp_pool?c=new Lt:(c=Lt.zpp_pool,Lt.zpp_pool=c.next,c.next=null),c.vertex=z;var m=r.add(c),f=Lt.less_xy(v,m)?(v.type=1,m.type=2,Nt.get(o,z)):(v.type=2,m.type=1,Nt.get(z,o));v.segment=m.segment=f;var b=r;if(null!=b.head&&null!=b.head.next){for(var g,w,M,C=b.head,k=null,O=null,P=null,S=null,A=1;;){for(g=0,O=C,k=C=null;null!=O;){for(++g,P=O,w=0,M=A;null!=P&&w<A;)++w,P=P.next;for(;0<w||0<M&&null!=P;)0!=w&&(0==M||null==P||Lt.less_xy(O.elt,P.elt))?(O=(S=O).next,--w):(P=(S=P).next,--M),null!=k?k.next=S:C=S,k=S;O=P}if(k.next=null,A<<=1,!(1<g))break}b.head=C,b.modified=!0,b.pushmod=!0}for(var j=!0;null!=r.head;){var E=r.pop_unsafe(),I=E.segment;if(1==E.type){if(Dt.sweep.add(I),Dt.sweep.intersect(I,I.next)||Dt.sweep.intersect(I,I.prev)){j=!1;break}}else if(2==E.type){if(Dt.sweep.intersect(I.prev,I.next)){j=!1;break}Dt.sweep.remove(I),I.left=I.right=null,I.prev=null,I.node=null,I.vertices.clear(),I.next=Nt.zpp_pool,Nt.zpp_pool=I}E.vertex=null,E.segment=E.segment2=null,E.node=null,E.next=Lt.zpp_pool,Lt.zpp_pool=E}for(;null!=r.head;){var T,N=r.pop_unsafe();2==N.type&&((T=N.segment).left=T.right=null,T.prev=null,T.node=null,T.vertices.clear(),T.next=Nt.zpp_pool,Nt.zpp_pool=T),N.vertex=null,N.segment=N.segment2=null,N.node=null,N.next=Lt.zpp_pool,Lt.zpp_pool=N}for(Dt.sweep.clear();null!=t.head;){var L=t.pop_unsafe();L.links.clear(),L.node=null,L.forced=!1,L.next=Tt.zpp_pool,Tt.zpp_pool=L}return j},Dt.prototype.__class__=Dt;var Ft=zpp_nape.geom.ZPP_SimplifyV=function(){this.forced=!1,this.flag=!1,this.prev=null,this.next=null,this.y=0,this.x=0};Ft.__name__=["zpp_nape","geom","ZPP_SimplifyV"],Ft.get=function(n){var t;return null==Ft.zpp_pool?t=new Ft:(t=Ft.zpp_pool,Ft.zpp_pool=t.next,t.next=null),t.x=n.x,t.y=n.y,t.flag=!1,t},Ft.prototype.x=null,Ft.prototype.y=null,Ft.prototype.next=null,Ft.prototype.prev=null,Ft.prototype.flag=null,Ft.prototype.forced=null,Ft.prototype.free=function(){},Ft.prototype.alloc=function(){},Ft.prototype.__class__=Ft;var Rt=zpp_nape.geom.ZPP_SimplifyP=function(){this.max=null,this.min=null,this.next=null};Rt.__name__=["zpp_nape","geom","ZPP_SimplifyP"],Rt.get=function(n,t){var e;return null==Rt.zpp_pool?e=new Rt:(e=Rt.zpp_pool,Rt.zpp_pool=e.next,e.next=null),e.min=n,e.max=t,e},Rt.prototype.next=null,Rt.prototype.min=null,Rt.prototype.max=null,Rt.prototype.free=function(){this.min=this.max=null},Rt.prototype.alloc=function(){},Rt.prototype.__class__=Rt;var Zt=zpp_nape.geom.ZPP_Simplify=function(){};Zt.__name__=["zpp_nape","geom","ZPP_Simplify"],Zt.lessval=function(n,t){return n.x-t.x+(n.y-t.y)},Zt.less=function(n,t){return n.x-t.x+(n.y-t.y)<0},Zt.distance=function(n,t,e){var i=e.x-t.x,p=e.y-t.y,l=0,r=0,l=n.x-t.x,r=n.y-t.y;if(i*i+p*p==0)return l*l+r*r;var o=(l*i+r*p)/(i*i+p*p);if(o<=0)return l*l+r*r;if(1<=o){var a=n.x,s=n.y,_=0,h=0;return(_=a-e.x)*_+(h=s-e.y)*h}return(l-=i*o)*l+(r-=p*o)*r},Zt.simplify=function(n,t){var e=null,i=null,p=null;t*=t,null==Zt.stack&&(Zt.stack=new we);for(var l,r,o,a,s,_,h,u,x,d,y=null,z=null,c=n;;){null==Ft.zpp_pool?l=new Ft:(l=Ft.zpp_pool,Ft.zpp_pool=l.next,l.next=null),l.x=c.x,l.y=c.y,l.flag=!1;var v,m=l;if(m.forced=c.forced,m.forced&&(m.flag=!0,null!=y?(null==Rt.zpp_pool?v=new Rt:(v=Rt.zpp_pool,Rt.zpp_pool=v.next,v.next=null),v.min=y,v.max=m,Zt.stack.add(v)):z=m,y=m),null==e?e=m.prev=m.next=m:(m.prev=e,m.next=e.next,e.next.prev=m,e.next=m),e=m,null==i?p=i=m:(m.x-i.x+(m.y-i.y)<0&&(i=m),p.x-m.x+(p.y-m.y)<0&&(p=m)),(c=c.next)==n)break}for(null==Zt.stack.head?null==z?(i.flag=p.flag=!0,null==Rt.zpp_pool?r=new Rt:(r=Rt.zpp_pool,Rt.zpp_pool=r.next,r.next=null),r.min=i,r.max=p,Zt.stack.add(r),null==Rt.zpp_pool?o=new Rt:(o=Rt.zpp_pool,Rt.zpp_pool=o.next,o.next=null),o.min=p,o.max=i,Zt.stack.add(o)):((a=i.x-z.x+(i.y-z.y))<0&&(a=-a),(s=p.x-z.x+(p.y-z.y))<0&&(s=-s),s<a?(i.flag=z.flag=!0,null==Rt.zpp_pool?_=new Rt:(_=Rt.zpp_pool,Rt.zpp_pool=_.next,_.next=null),_.min=i,_.max=z,Zt.stack.add(_),null==Rt.zpp_pool?h=new Rt:(h=Rt.zpp_pool,Rt.zpp_pool=h.next,h.next=null),h.min=z,h.max=i,Zt.stack.add(h)):(p.flag=z.flag=!0,null==Rt.zpp_pool?u=new Rt:(u=Rt.zpp_pool,Rt.zpp_pool=u.next,u.next=null),u.min=p,u.max=z,Zt.stack.add(u),null==Rt.zpp_pool?x=new Rt:(x=Rt.zpp_pool,Rt.zpp_pool=x.next,x.next=null),x.min=z,x.max=p,Zt.stack.add(x))):(null==Rt.zpp_pool?d=new Rt:(d=Rt.zpp_pool,Rt.zpp_pool=d.next,d.next=null),d.min=y,d.max=z,Zt.stack.add(d));null!=Zt.stack.head;){var f=Zt.stack.pop_unsafe(),b=f.min,g=f.max;f.min=f.max=null,f.next=Rt.zpp_pool,Rt.zpp_pool=f;for(var w,M,C=t,k=null,O=b.next;O!=g;){var P=Zt.distance(O,b,g);C<P&&(C=P,k=O),O=O.next}null!=k&&(k.flag=!0,null==Rt.zpp_pool?w=new Rt:(w=Rt.zpp_pool,Rt.zpp_pool=w.next,w.next=null),w.min=b,w.max=k,Zt.stack.add(w),null==Rt.zpp_pool?M=new Rt:(M=Rt.zpp_pool,Rt.zpp_pool=M.next,M.next=null),M.min=k,M.max=g,Zt.stack.add(M))}for(var S,A,j,E,I,T,N,L=null;null!=e;){e.flag&&(S=e.x,A=e.y,null==xp.zpp_pool?j=new xp:(j=xp.zpp_pool,xp.zpp_pool=j.next,j.next=null),j.forced=!1,j.x=S,j.y=A,E=j,null==L?L=E.prev=E.next=E:(E.prev=L,E.next=L.next,L.next.prev=E,L.next=E),(L=E).forced=e.forced),e=null!=e&&e.prev==e?(e.next=e.prev=null,(I=e).next=Ft.zpp_pool,Ft.zpp_pool=I,null):(T=e.next,e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null,(N=e).next=Ft.zpp_pool,Ft.zpp_pool=N,e=null,T)}return L},Zt.prototype.__class__=Zt;var qt=zpp_nape.geom.ZPP_ToiEvent=function(){this.kinematic=!1,this.failed=!1,this.slipped=!1,this.axis=null,this.c2=null,this.c1=null,this.frozen2=!1,this.frozen1=!1,this.arbiter=null,this.s2=null,this.s1=null,this.toi=0,this.next=null,this.c1=new mo,this.c2=new mo,this.axis=new mo};qt.__name__=["zpp_nape","geom","ZPP_ToiEvent"],qt.prototype.next=null,qt.prototype.alloc=function(){this.failed=!1,this.s1=this.s2=null,this.arbiter=null},qt.prototype.free=function(){},qt.prototype.toi=null,qt.prototype.s1=null,qt.prototype.s2=null,qt.prototype.arbiter=null,qt.prototype.frozen1=null,qt.prototype.frozen2=null,qt.prototype.c1=null,qt.prototype.c2=null,qt.prototype.axis=null,qt.prototype.slipped=null,qt.prototype.failed=null,qt.prototype.kinematic=null,qt.prototype.__class__=qt;var Ut=zpp_nape.geom.ZPP_SweepDistance=function(){};Ut.__name__=["zpp_nape","geom","ZPP_SweepDistance"],Ut.dynamicSweep=function(n,t,e,i,p){null==p&&(p=!1);var l=n.s1,r=n.s2,o=l.body,a=r.body,s=a.velx-o.velx,_=a.vely-o.vely,h=o.angvel;h<0&&(h=-h);var u=a.angvel;u<0&&(u=-u);var x=l.sweepCoef*h+r.sweepCoef*u;if(!p&&!n.kinematic&&s*s+_*_<co.dynamicSweepLinearThreshold*co.dynamicSweepLinearThreshold&&x<co.dynamicSweepAngularThreshold)return n.toi=-1,void(n.failed=!0);for(var d=n.c1,y=n.c2,z=n.axis,c=e,v=0;;){var m,f,b,g,w,M=c*t,C=M-o.sweepTime;if(0!=C&&(o.sweepTime=M,o.posx+=o.velx*C,o.posy+=o.vely*C,0!=o.angvel&&(m=o.sweep_angvel*C,o.rot+=m,1e-4<m*m?(o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot)):(g=1-(f=m*m)*f/8,w=((b=1-.5*f)*o.axisx+m*o.axisy)*g,o.axisy=(b*o.axisy-m*o.axisx)*g,o.axisx=w))),0==l.type)l.worldCOMx=o.posx+(o.axisy*l.localCOMx-o.axisx*l.localCOMy),l.worldCOMy=o.posy+(l.localCOMx*o.axisx+l.localCOMy*o.axisy);else{for(var k=l.polygon,O=k.lverts.next,P=k.gverts.next;null!=P;){var S=P,A=O,O=O.next;S.x=o.posx+(o.axisy*A.x-o.axisx*A.y),S.y=o.posy+(A.x*o.axisx+A.y*o.axisy),P=P.next}for(var j=k.edges.head,E=I=k.gverts.next,I=I.next;null!=I;){var T=I,N=j.elt,j=j.next;N.gnormx=o.axisy*N.lnormx-o.axisx*N.lnormy,N.gnormy=N.lnormx*o.axisx+N.lnormy*o.axisy,N.gprojection=o.posx*N.gnormx+o.posy*N.gnormy+N.lprojection,N.tp0=E.y*N.gnormx-E.x*N.gnormy,N.tp1=T.y*N.gnormx-T.x*N.gnormy,E=T,I=I.next}var L=k.gverts.next,V=j.elt;V.gnormx=o.axisy*V.lnormx-o.axisx*V.lnormy,V.gnormy=V.lnormx*o.axisx+V.lnormy*o.axisy,V.gprojection=o.posx*V.gnormx+o.posy*V.gnormy+V.lprojection,V.tp0=E.y*V.gnormx-E.x*V.gnormy,V.tp1=L.y*V.gnormx-L.x*V.gnormy}var D,F,R,Z,B,G=c*t,q=G-a.sweepTime;if(0!=q&&(a.sweepTime=G,a.posx+=a.velx*q,a.posy+=a.vely*q,0!=a.angvel&&(D=a.sweep_angvel*q,a.rot+=D,1e-4<D*D?(a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)):(Z=1-(F=D*D)*F/8,B=((R=1-.5*F)*a.axisx+D*a.axisy)*Z,a.axisy=(R*a.axisy-D*a.axisx)*Z,a.axisx=B))),0==r.type)r.worldCOMx=a.posx+(a.axisy*r.localCOMx-a.axisx*r.localCOMy),r.worldCOMy=a.posy+(r.localCOMx*a.axisx+r.localCOMy*a.axisy);else{for(var U=r.polygon,K=U.lverts.next,W=U.gverts.next;null!=W;){var Y=W,J=K,K=K.next;Y.x=a.posx+(a.axisy*J.x-a.axisx*J.y),Y.y=a.posy+(J.x*a.axisx+J.y*a.axisy),W=W.next}for(var X=U.edges.head,H=$=U.gverts.next,$=$.next;null!=$;){var Q=$,nn=X.elt,X=X.next;nn.gnormx=a.axisy*nn.lnormx-a.axisx*nn.lnormy,nn.gnormy=nn.lnormx*a.axisx+nn.lnormy*a.axisy,nn.gprojection=a.posx*nn.gnormx+a.posy*nn.gnormy+nn.lprojection,nn.tp0=H.y*nn.gnormx-H.x*nn.gnormy,nn.tp1=Q.y*nn.gnormx-Q.x*nn.gnormy,H=Q,$=$.next}var tn=U.gverts.next,en=X.elt;en.gnormx=a.axisy*en.lnormx-a.axisx*en.lnormy,en.gnormy=en.lnormx*a.axisx+en.lnormy*a.axisy,en.gprojection=a.posx*en.gnormx+a.posy*en.gnormy+en.lprojection,en.tp0=H.y*en.gnormx-H.x*en.gnormy,en.tp1=tn.y*en.gnormx-tn.x*en.gnormy}var pn=l,ln=r,rn=d,on=y;if(0==l.type&&0==r.type){var an,sn,_n,hn=l.circle,un=r.circle,xn=0,dn=0,xn=un.worldCOMx-hn.worldCOMx,dn=un.worldCOMy-hn.worldCOMy,yn=Math.sqrt(xn*xn+dn*dn),zn=yn-(hn.radius+un.radius);zn<1e100&&(0==yn?(xn=1,dn=0):(xn*=an=1/yn,dn*=an),sn=hn.radius,d.x=hn.worldCOMx+xn*sn,d.y=hn.worldCOMy+dn*sn,_n=-un.radius,y.x=un.worldCOMx+xn*_n,y.y=un.worldCOMy+dn*_n,z.x=xn,z.y=dn),oe=zn}else{var cn=!1;if(0==l.type&&1==r.type&&(pn=r,ln=l,rn=y,on=d,cn=!0),1==pn.type&&0==ln.type){for(var vn,mn,fn,bn,gn,wn,Mn,Cn,kn,On,Pn,Sn,An,jn,En,In=pn.polygon,Tn=ln.circle,Nn=-1e100,Ln=null,Vn=In.edges.head;null!=Vn;){var Dn=Vn.elt,Fn=Dn.gnormx*Tn.worldCOMx+Dn.gnormy*Tn.worldCOMy-Dn.gprojection-Tn.radius;if(1e100<Fn){Nn=Fn;break}0<Fn?Nn<Fn&&(Nn=Fn,Ln=Dn):Nn<0&&Nn<Fn&&(Nn=Fn,Ln=Dn),Vn=Vn.next}Nn<1e100&&(vn=Ln.gp0,mn=Ln.gp1,(fn=Tn.worldCOMy*Ln.gnormx-Tn.worldCOMx*Ln.gnormy)<=vn.y*Ln.gnormx-vn.x*Ln.gnormy?(gn=bn=0,bn=Tn.worldCOMx-vn.x,gn=Tn.worldCOMy-vn.y,(Nn=(wn=Math.sqrt(bn*bn+gn*gn))-Tn.radius)<1e100&&(0==wn?(bn=1,gn=0):(bn*=Mn=1/wn,gn*=Mn),rn.x=vn.x+0*bn,rn.y=vn.y+0*gn,Cn=-Tn.radius,on.x=Tn.worldCOMx+bn*Cn,on.y=Tn.worldCOMy+gn*Cn,z.x=bn,z.y=gn)):fn>=mn.y*Ln.gnormx-mn.x*Ln.gnormy?(On=kn=0,kn=Tn.worldCOMx-mn.x,On=Tn.worldCOMy-mn.y,(Nn=(Pn=Math.sqrt(kn*kn+On*On))-Tn.radius)<1e100&&(0==Pn?(kn=1,On=0):(kn*=Sn=1/Pn,On*=Sn),rn.x=mn.x+0*kn,rn.y=mn.y+0*On,An=-Tn.radius,on.x=Tn.worldCOMx+kn*An,on.y=Tn.worldCOMy+On*An,z.x=kn,z.y=On)):(jn=-Tn.radius,on.x=Tn.worldCOMx+Ln.gnormx*jn,on.y=Tn.worldCOMy+Ln.gnormy*jn,En=-Nn,rn.x=on.x+Ln.gnormx*En,rn.y=on.y+Ln.gnormy*En,z.x=Ln.gnormx,z.y=Ln.gnormy)),cn&&(z.x=-z.x,z.y=-z.y),oe=Nn}else{for(var Rn=pn.polygon,Zn=ln.polygon,Bn=-1e100,Gn=null,qn=null,Un=0,Kn=Rn.edges.head;null!=Kn;){for(var Wn=Kn.elt,Yn=1e100,Jn=Zn.gverts.next;null!=Jn;){var Xn=Wn.gnormx*Jn.x+Wn.gnormy*Jn.y;Xn<Yn&&(Yn=Xn),Jn=Jn.next}if(1e100<(Yn-=Wn.gprojection)){Bn=Yn;break}0<Yn?Bn<Yn&&(Bn=Yn,Gn=Wn,Un=1):Bn<0&&Bn<Yn&&(Bn=Yn,Gn=Wn,Un=1),Kn=Kn.next}if(Bn<1e100){for(var Hn,$n,Qn,nt=Zn.edges.head;null!=nt;){for(var tt=nt.elt,et=1e100,it=Rn.gverts.next;null!=it;){var pt=tt.gnormx*it.x+tt.gnormy*it.y;pt<et&&(et=pt),it=it.next}if(1e100<(et-=tt.gprojection)){Bn=et;break}0<et?Bn<et&&(Bn=et,qn=tt,Un=2):Bn<0&&Bn<et&&(Bn=et,qn=tt,Un=2),nt=nt.next}if(Bn<1e100){1==Un?(Hn=Zn,$n=Gn):(Hn=Rn,$n=qn,Qn=rn,rn=on,on=Qn,cn=!cn);for(var lt,rt,ot,at,st,_t,ht,ut,xt,dt,yt,zt,ct,vt,mt,ft,bt,gt,wt,Mt,Ct,kt,Ot,Pt,St,At,jt,Et,It,Tt,Nt,Lt,Vt,Dt,Ft,Rt,Zt,Bt,Gt,qt,Ut,Kt,Wt,Yt,Jt,Xt,Ht,$t,Qt,ne,te,ee,ie,pe,le,re,oe,ae=null,se=1e100,_e=Hn.edges.head;null!=_e;){var he=_e.elt,ue=$n.gnormx*he.gnormx+$n.gnormy*he.gnormy;ue<se&&(se=ue,ae=he),_e=_e.next}cn?(z.x=-$n.gnormx,z.y=-$n.gnormy):(z.x=$n.gnormx,z.y=$n.gnormy),oe=0<=Bn?(lt=$n.gp0,rt=$n.gp1,ot=ae.gp0,at=ae.gp1,ut=ht=_t=st=0,xt=1/((st=rt.x-lt.x)*st+(_t=rt.y-lt.y)*_t),dt=1/((ht=at.x-ot.x)*ht+(ut=at.y-ot.y)*ut),(yt=-(st*(lt.x-ot.x)+_t*(lt.y-ot.y))*xt)<0?yt=0:1<yt&&(yt=1),(zt=-(st*(lt.x-at.x)+_t*(lt.y-at.y))*xt)<0?zt=0:1<zt&&(zt=1),(ct=-(ht*(ot.x-lt.x)+ut*(ot.y-lt.y))*dt)<0?ct=0:1<ct&&(ct=1),(vt=-(ht*(ot.x-rt.x)+ut*(ot.y-rt.y))*dt)<0?vt=0:1<vt&&(vt=1),ft=mt=0,mt=lt.x+st*yt,ft=lt.y+_t*yt,gt=bt=0,bt=lt.x+st*zt,gt=lt.y+_t*zt,Mt=wt=0,wt=ot.x+ht*ct,Mt=ot.y+ut*ct,kt=Ct=0,Ct=ot.x+ht*vt,kt=ot.y+ut*vt,Rt=Ft=Vt=Lt=Tt=It=jt=At=Pt=Ot=0,Zt=null,(St=(Ot=mt-ot.x)*Ot+(Pt=ft-ot.y)*Pt)<(Et=(At=bt-at.x)*At+(jt=gt-at.y)*jt)?(Ft=mt,Rt=ft,Zt=ot):(Ft=bt,Rt=gt,Zt=at,St=Et),Gt=Bt=0,qt=null,(Nt=(It=wt-lt.x)*It+(Tt=Mt-lt.y)*Tt)<(Dt=(Lt=Ct-rt.x)*Lt+(Vt=kt-rt.y)*Vt)?(Bt=wt,Gt=Mt,qt=lt):(Bt=Ct,Gt=kt,qt=rt,Nt=Dt),0!=(Bn=St<Nt?(rn.x=Ft,rn.y=Rt,on.x=Zt.x,on.y=Zt.y,Math.sqrt(St)):(on.x=Bt,on.y=Gt,rn.x=qt.x,rn.y=qt.y,Math.sqrt(Nt)))&&(z.x=on.x-rn.x,z.y=on.y-rn.y,Ut=1/Bn,z.x*=Ut,z.y*=Ut,cn&&(z.x=-z.x,z.y=-z.y)),Bn):(Wt=Kt=0,Kt=ae.gp0.x,Wt=ae.gp0.y,Ht=Xt=Jt=Yt=0,Xt=(Yt=ae.gp1.x)-Kt,Ht=(Jt=ae.gp1.y)-Wt,$t=$n.gnormy*Kt-$n.gnormx*Wt,ne=1/((Qt=$n.gnormy*Yt-$n.gnormx*Jt)-$t),(te=(-$n.tp1-$t)*ne)>co.epsilon&&(Kt+=Xt*te,Wt+=Ht*te),(ee=(-$n.tp0-Qt)*ne)<-co.epsilon&&(Yt+=Xt*ee,Jt+=Ht*ee),(ie=Kt*$n.gnormx+Wt*$n.gnormy-$n.gprojection)<(pe=Yt*$n.gnormx+Jt*$n.gnormy-$n.gprojection)?(on.x=Kt,on.y=Wt,le=-ie,rn.x=on.x+$n.gnormx*le,rn.y=on.y+$n.gnormy*le,ie):(on.x=Yt,on.y=Jt,re=-pe,rn.x=on.x+$n.gnormx*re,rn.y=on.y+$n.gnormy*re,pe))}else oe=1e100}else oe=1e100}}var xe=oe+i,de=s*z.x+_*z.y;if(xe<co.distanceThresholdCCD){if(p)break;var ye=d.x-o.posx,ze=d.y-o.posy,ce=y.x-a.posx,ve=y.y-a.posy,me=de-o.sweep_angvel*(z.y*ye-z.x*ze)+a.sweep_angvel*(z.y*ce-z.x*ve);if(0<me&&(n.slipped=!0),me<=0||xe<.5*co.distanceThresholdCCD)break}var fe=(x-de)*t;if(fe<=0){c=-1;break}var be=xe/fe;if(be<1e-6&&(be=1e-6),1<=(c+=be)){var ge,we,Me,Ce,ke,Oe=(c=1)*t,Pe=Oe-o.sweepTime;if(0!=Pe&&(o.sweepTime=Oe,o.posx+=o.velx*Pe,o.posy+=o.vely*Pe,0!=o.angvel&&(ge=o.sweep_angvel*Pe,o.rot+=ge,1e-4<ge*ge?(o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot)):(Ce=1-(we=ge*ge)*we/8,ke=((Me=1-.5*we)*o.axisx+ge*o.axisy)*Ce,o.axisy=(Me*o.axisy-ge*o.axisx)*Ce,o.axisx=ke))),0==l.type)l.worldCOMx=o.posx+(o.axisy*l.localCOMx-o.axisx*l.localCOMy),l.worldCOMy=o.posy+(l.localCOMx*o.axisx+l.localCOMy*o.axisy);else{for(var Se=l.polygon,Ae=Se.lverts.next,je=Se.gverts.next;null!=je;){var Ee=je,Ie=Ae,Ae=Ae.next;Ee.x=o.posx+(o.axisy*Ie.x-o.axisx*Ie.y),Ee.y=o.posy+(Ie.x*o.axisx+Ie.y*o.axisy),je=je.next}for(var Te=Se.edges.head,Ne=Le=Se.gverts.next,Le=Le.next;null!=Le;){var Ve=Le,De=Te.elt,Te=Te.next;De.gnormx=o.axisy*De.lnormx-o.axisx*De.lnormy,De.gnormy=De.lnormx*o.axisx+De.lnormy*o.axisy,De.gprojection=o.posx*De.gnormx+o.posy*De.gnormy+De.lprojection,De.tp0=Ne.y*De.gnormx-Ne.x*De.gnormy,De.tp1=Ve.y*De.gnormx-Ve.x*De.gnormy,Ne=Ve,Le=Le.next}var Fe=Se.gverts.next,Re=Te.elt;Re.gnormx=o.axisy*Re.lnormx-o.axisx*Re.lnormy,Re.gnormy=Re.lnormx*o.axisx+Re.lnormy*o.axisy,Re.gprojection=o.posx*Re.gnormx+o.posy*Re.gnormy+Re.lprojection,Re.tp0=Ne.y*Re.gnormx-Ne.x*Re.gnormy,Re.tp1=Fe.y*Re.gnormx-Fe.x*Re.gnormy}var Ze,Be,Ge,qe,Ue,Ke=c*t,We=Ke-a.sweepTime;if(0!=We&&(a.sweepTime=Ke,a.posx+=a.velx*We,a.posy+=a.vely*We,0!=a.angvel&&(Ze=a.sweep_angvel*We,a.rot+=Ze,1e-4<Ze*Ze?(a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)):(qe=1-(Be=Ze*Ze)*Be/8,Ue=((Ge=1-.5*Be)*a.axisx+Ze*a.axisy)*qe,a.axisy=(Ge*a.axisy-Ze*a.axisx)*qe,a.axisx=Ue))),0==r.type)r.worldCOMx=a.posx+(a.axisy*r.localCOMx-a.axisx*r.localCOMy),r.worldCOMy=a.posy+(r.localCOMx*a.axisx+r.localCOMy*a.axisy);else{for(var Ye=r.polygon,Je=Ye.lverts.next,Xe=Ye.gverts.next;null!=Xe;){var He=Xe,$e=Je,Je=Je.next;He.x=a.posx+(a.axisy*$e.x-a.axisx*$e.y),He.y=a.posy+($e.x*a.axisx+$e.y*a.axisy),Xe=Xe.next}for(var Qe=Ye.edges.head,ni=ti=Ye.gverts.next,ti=ti.next;null!=ti;){var ei=ti,ii=Qe.elt,Qe=Qe.next;ii.gnormx=a.axisy*ii.lnormx-a.axisx*ii.lnormy,ii.gnormy=ii.lnormx*a.axisx+ii.lnormy*a.axisy,ii.gprojection=a.posx*ii.gnormx+a.posy*ii.gnormy+ii.lprojection,ii.tp0=ni.y*ii.gnormx-ni.x*ii.gnormy,ii.tp1=ei.y*ii.gnormx-ei.x*ii.gnormy,ni=ei,ti=ti.next}var pi=Ye.gverts.next,li=Qe.elt;li.gnormx=a.axisy*li.lnormx-a.axisx*li.lnormy,li.gnormy=li.lnormx*a.axisx+li.lnormy*a.axisy,li.gprojection=a.posx*li.gnormx+a.posy*li.gnormy+li.lprojection,li.tp0=ni.y*li.gnormx-ni.x*li.gnormy,li.tp1=pi.y*li.gnormx-pi.x*li.gnormy}var ri=l,oi=r,ai=d,si=y;if(0==l.type&&0==r.type){var _i,hi,ui,xi=l.circle,di=r.circle,yi=0,zi=0,yi=di.worldCOMx-xi.worldCOMx,zi=di.worldCOMy-xi.worldCOMy,ci=Math.sqrt(yi*yi+zi*zi),vi=ci-(xi.radius+di.radius);vi<1e100&&(0==ci?(yi=1,zi=0):(yi*=_i=1/ci,zi*=_i),hi=xi.radius,d.x=xi.worldCOMx+yi*hi,d.y=xi.worldCOMy+zi*hi,ui=-di.radius,y.x=di.worldCOMx+yi*ui,y.y=di.worldCOMy+zi*ui,z.x=yi,z.y=zi),sl=vi}else{var mi=!1;if(0==l.type&&1==r.type&&(ri=r,oi=l,ai=y,si=d,mi=!0),1==ri.type&&0==oi.type){for(var fi,bi,gi,wi,Mi,Ci,ki,Oi,Pi,Si,Ai,ji,Ei,Ii,Ti,Ni=ri.polygon,Li=oi.circle,Vi=-1e100,Di=null,Fi=Ni.edges.head;null!=Fi;){var Ri=Fi.elt,Zi=Ri.gnormx*Li.worldCOMx+Ri.gnormy*Li.worldCOMy-Ri.gprojection-Li.radius;if(1e100<Zi){Vi=Zi;break}0<Zi?Vi<Zi&&(Vi=Zi,Di=Ri):Vi<0&&Vi<Zi&&(Vi=Zi,Di=Ri),Fi=Fi.next}Vi<1e100&&(fi=Di.gp0,bi=Di.gp1,(gi=Li.worldCOMy*Di.gnormx-Li.worldCOMx*Di.gnormy)<=fi.y*Di.gnormx-fi.x*Di.gnormy?(Mi=wi=0,wi=Li.worldCOMx-fi.x,Mi=Li.worldCOMy-fi.y,(Vi=(Ci=Math.sqrt(wi*wi+Mi*Mi))-Li.radius)<1e100&&(0==Ci?(wi=1,Mi=0):(wi*=ki=1/Ci,Mi*=ki),ai.x=fi.x+0*wi,ai.y=fi.y+0*Mi,Oi=-Li.radius,si.x=Li.worldCOMx+wi*Oi,si.y=Li.worldCOMy+Mi*Oi,z.x=wi,z.y=Mi)):gi>=bi.y*Di.gnormx-bi.x*Di.gnormy?(Si=Pi=0,Pi=Li.worldCOMx-bi.x,Si=Li.worldCOMy-bi.y,(Vi=(Ai=Math.sqrt(Pi*Pi+Si*Si))-Li.radius)<1e100&&(0==Ai?(Pi=1,Si=0):(Pi*=ji=1/Ai,Si*=ji),ai.x=bi.x+0*Pi,ai.y=bi.y+0*Si,Ei=-Li.radius,si.x=Li.worldCOMx+Pi*Ei,si.y=Li.worldCOMy+Si*Ei,z.x=Pi,z.y=Si)):(Ii=-Li.radius,si.x=Li.worldCOMx+Di.gnormx*Ii,si.y=Li.worldCOMy+Di.gnormy*Ii,Ti=-Vi,ai.x=si.x+Di.gnormx*Ti,ai.y=si.y+Di.gnormy*Ti,z.x=Di.gnormx,z.y=Di.gnormy)),mi&&(z.x=-z.x,z.y=-z.y),sl=Vi}else{for(var Bi=ri.polygon,Gi=oi.polygon,qi=-1e100,Ui=null,Ki=null,Wi=0,Yi=Bi.edges.head;null!=Yi;){for(var Ji=Yi.elt,Xi=1e100,Hi=Gi.gverts.next;null!=Hi;){var $i=Ji.gnormx*Hi.x+Ji.gnormy*Hi.y;$i<Xi&&(Xi=$i),Hi=Hi.next}if(1e100<(Xi-=Ji.gprojection)){qi=Xi;break}0<Xi?qi<Xi&&(qi=Xi,Ui=Ji,Wi=1):qi<0&&qi<Xi&&(qi=Xi,Ui=Ji,Wi=1),Yi=Yi.next}if(qi<1e100){for(var Qi,np,tp,ep=Gi.edges.head;null!=ep;){for(var ip=ep.elt,pp=1e100,lp=Bi.gverts.next;null!=lp;){var rp=ip.gnormx*lp.x+ip.gnormy*lp.y;rp<pp&&(pp=rp),lp=lp.next}if(1e100<(pp-=ip.gprojection)){qi=pp;break}0<pp?qi<pp&&(qi=pp,Ki=ip,Wi=2):qi<0&&qi<pp&&(qi=pp,Ki=ip,Wi=2),ep=ep.next}if(qi<1e100){1==Wi?(Qi=Gi,np=Ui):(Qi=Bi,np=Ki,tp=ai,ai=si,si=tp,mi=!mi);for(var op,ap,sp,_p,hp,up,xp,dp,yp,zp,cp,vp,mp,fp,bp,gp,wp,Mp,Cp,kp,Op,Pp,Sp,Ap,jp,Ep,Ip,Tp,Np,Lp,Vp,Dp,Fp,Rp,Zp,Bp,Gp,qp,Up,Kp,Wp,Yp,Jp,Xp,Hp,$p,Qp,nl,tl,el,il,pl,ll,rl,ol,al,sl,_l=null,hl=1e100,ul=Qi.edges.head;null!=ul;){var xl=ul.elt,dl=np.gnormx*xl.gnormx+np.gnormy*xl.gnormy;dl<hl&&(hl=dl,_l=xl),ul=ul.next}mi?(z.x=-np.gnormx,z.y=-np.gnormy):(z.x=np.gnormx,z.y=np.gnormy),sl=0<=qi?(op=np.gp0,ap=np.gp1,sp=_l.gp0,_p=_l.gp1,dp=xp=up=hp=0,yp=1/((hp=ap.x-op.x)*hp+(up=ap.y-op.y)*up),zp=1/((xp=_p.x-sp.x)*xp+(dp=_p.y-sp.y)*dp),(cp=-(hp*(op.x-sp.x)+up*(op.y-sp.y))*yp)<0?cp=0:1<cp&&(cp=1),(vp=-(hp*(op.x-_p.x)+up*(op.y-_p.y))*yp)<0?vp=0:1<vp&&(vp=1),(mp=-(xp*(sp.x-op.x)+dp*(sp.y-op.y))*zp)<0?mp=0:1<mp&&(mp=1),(fp=-(xp*(sp.x-ap.x)+dp*(sp.y-ap.y))*zp)<0?fp=0:1<fp&&(fp=1),gp=bp=0,bp=op.x+hp*cp,gp=op.y+up*cp,Mp=wp=0,wp=op.x+hp*vp,Mp=op.y+up*vp,kp=Cp=0,Cp=sp.x+xp*mp,kp=sp.y+dp*mp,Pp=Op=0,Op=sp.x+xp*fp,Pp=sp.y+dp*fp,Bp=Zp=Fp=Dp=Lp=Np=Ip=Ep=Ap=Sp=0,Gp=null,(jp=(Sp=bp-sp.x)*Sp+(Ap=gp-sp.y)*Ap)<(Tp=(Ep=wp-_p.x)*Ep+(Ip=Mp-_p.y)*Ip)?(Zp=bp,Bp=gp,Gp=sp):(Zp=wp,Bp=Mp,Gp=_p,jp=Tp),Up=qp=0,Kp=null,(Vp=(Np=Cp-op.x)*Np+(Lp=kp-op.y)*Lp)<(Rp=(Dp=Op-ap.x)*Dp+(Fp=Pp-ap.y)*Fp)?(qp=Cp,Up=kp,Kp=op):(qp=Op,Up=Pp,Kp=ap,Vp=Rp),0!=(qi=jp<Vp?(ai.x=Zp,ai.y=Bp,si.x=Gp.x,si.y=Gp.y,Math.sqrt(jp)):(si.x=qp,si.y=Up,ai.x=Kp.x,ai.y=Kp.y,Math.sqrt(Vp)))&&(z.x=si.x-ai.x,z.y=si.y-ai.y,Wp=1/qi,z.x*=Wp,z.y*=Wp,mi&&(z.x=-z.x,z.y=-z.y)),qi):(Jp=Yp=0,Yp=_l.gp0.x,Jp=_l.gp0.y,Qp=$p=Hp=Xp=0,$p=(Xp=_l.gp1.x)-Yp,Qp=(Hp=_l.gp1.y)-Jp,nl=np.gnormy*Yp-np.gnormx*Jp,el=1/((tl=np.gnormy*Xp-np.gnormx*Hp)-nl),(il=(-np.tp1-nl)*el)>co.epsilon&&(Yp+=$p*il,Jp+=Qp*il),(pl=(-np.tp0-tl)*el)<-co.epsilon&&(Xp+=$p*pl,Hp+=Qp*pl),(ll=Yp*np.gnormx+Jp*np.gnormy-np.gprojection)<(rl=Xp*np.gnormx+Hp*np.gnormy-np.gprojection)?(si.x=Yp,si.y=Jp,ol=-ll,ai.x=si.x+np.gnormx*ol,ai.y=si.y+np.gnormy*ol,ll):(si.x=Xp,si.y=Hp,al=-rl,ai.x=si.x+np.gnormx*al,ai.y=si.y+np.gnormy*al,rl))}else sl=1e100}else sl=1e100}}var yl=sl+i,zl=s*z.x+_*z.y;if(yl<co.distanceThresholdCCD){if(p)break;var cl=d.x-o.posx,vl=d.y-o.posy,ml=y.x-a.posx,fl=y.y-a.posy,bl=zl-o.sweep_angvel*(z.y*cl-z.x*vl)+a.sweep_angvel*(z.y*ml-z.x*fl);if(0<bl&&(n.slipped=!0),bl<=0||yl<.5*co.distanceThresholdCCD)break}c=-1;break}if(40<=++v){i<xe&&(n.failed=!0);break}}n.toi=c},Ut.staticSweep=function(n,t,e,i){var p=n.s1,l=n.s2,r=p.body,o=-r.velx,a=-r.vely,s=r.sweep_angvel;s<0&&(s=-s);for(var _=p.sweepCoef*s,h=n.c1,u=n.c2,x=n.axis,d=e,y=0;;){var z,c,v,m,f,b=d*t,g=b-r.sweepTime;if(0!=g&&(r.sweepTime=b,r.posx+=r.velx*g,r.posy+=r.vely*g,0!=r.angvel&&(z=r.sweep_angvel*g,r.rot+=z,1e-4<z*z?(r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot)):(m=1-(c=z*z)*c/8,f=((v=1-.5*c)*r.axisx+z*r.axisy)*m,r.axisy=(v*r.axisy-z*r.axisx)*m,r.axisx=f))),0==p.type)p.worldCOMx=r.posx+(r.axisy*p.localCOMx-r.axisx*p.localCOMy),p.worldCOMy=r.posy+(p.localCOMx*r.axisx+p.localCOMy*r.axisy);else{for(var w=p.polygon,M=w.lverts.next,C=w.gverts.next;null!=C;){var k=C,O=M,M=M.next;k.x=r.posx+(r.axisy*O.x-r.axisx*O.y),k.y=r.posy+(O.x*r.axisx+O.y*r.axisy),C=C.next}for(var P=w.edges.head,S=A=w.gverts.next,A=A.next;null!=A;){var j=A,E=P.elt,P=P.next;E.gnormx=r.axisy*E.lnormx-r.axisx*E.lnormy,E.gnormy=E.lnormx*r.axisx+E.lnormy*r.axisy,E.gprojection=r.posx*E.gnormx+r.posy*E.gnormy+E.lprojection,E.tp0=S.y*E.gnormx-S.x*E.gnormy,E.tp1=j.y*E.gnormx-j.x*E.gnormy,S=j,A=A.next}var I=w.gverts.next,T=P.elt;T.gnormx=r.axisy*T.lnormx-r.axisx*T.lnormy,T.gnormy=T.lnormx*r.axisx+T.lnormy*r.axisy,T.gprojection=r.posx*T.gnormx+r.posy*T.gnormy+T.lprojection,T.tp0=S.y*T.gnormx-S.x*T.gnormy,T.tp1=I.y*T.gnormx-I.x*T.gnormy}var N=p,L=l,V=h,D=u;if(0==p.type&&0==l.type){var F,R,Z,B=p.circle,G=l.circle,q=0,U=0,q=G.worldCOMx-B.worldCOMx,U=G.worldCOMy-B.worldCOMy,K=Math.sqrt(q*q+U*U),W=K-(B.radius+G.radius);W<1e100&&(0==K?(q=1,U=0):(q*=F=1/K,U*=F),R=B.radius,h.x=B.worldCOMx+q*R,h.y=B.worldCOMy+U*R,Z=-G.radius,u.x=G.worldCOMx+q*Z,u.y=G.worldCOMy+U*Z,x.x=q,x.y=U),Ft=W}else{var Y=!1;if(0==p.type&&1==l.type&&(N=l,L=p,V=u,D=h,Y=!0),1==N.type&&0==L.type){for(var J,X,H,$,Q,nn,tn,en,pn,ln,rn,on,an,sn,_n,hn=N.polygon,un=L.circle,xn=-1e100,dn=null,yn=hn.edges.head;null!=yn;){var zn=yn.elt,cn=zn.gnormx*un.worldCOMx+zn.gnormy*un.worldCOMy-zn.gprojection-un.radius;if(1e100<cn){xn=cn;break}0<cn?xn<cn&&(xn=cn,dn=zn):xn<0&&xn<cn&&(xn=cn,dn=zn),yn=yn.next}xn<1e100&&(J=dn.gp0,X=dn.gp1,(H=un.worldCOMy*dn.gnormx-un.worldCOMx*dn.gnormy)<=J.y*dn.gnormx-J.x*dn.gnormy?(Q=$=0,$=un.worldCOMx-J.x,Q=un.worldCOMy-J.y,(xn=(nn=Math.sqrt($*$+Q*Q))-un.radius)<1e100&&(0==nn?($=1,Q=0):($*=tn=1/nn,Q*=tn),V.x=J.x+0*$,V.y=J.y+0*Q,en=-un.radius,D.x=un.worldCOMx+$*en,D.y=un.worldCOMy+Q*en,x.x=$,x.y=Q)):H>=X.y*dn.gnormx-X.x*dn.gnormy?(ln=pn=0,pn=un.worldCOMx-X.x,ln=un.worldCOMy-X.y,(xn=(rn=Math.sqrt(pn*pn+ln*ln))-un.radius)<1e100&&(0==rn?(pn=1,ln=0):(pn*=on=1/rn,ln*=on),V.x=X.x+0*pn,V.y=X.y+0*ln,an=-un.radius,D.x=un.worldCOMx+pn*an,D.y=un.worldCOMy+ln*an,x.x=pn,x.y=ln)):(sn=-un.radius,D.x=un.worldCOMx+dn.gnormx*sn,D.y=un.worldCOMy+dn.gnormy*sn,_n=-xn,V.x=D.x+dn.gnormx*_n,V.y=D.y+dn.gnormy*_n,x.x=dn.gnormx,x.y=dn.gnormy)),Y&&(x.x=-x.x,x.y=-x.y),Ft=xn}else{for(var vn=N.polygon,mn=L.polygon,fn=-1e100,bn=null,gn=null,wn=0,Mn=vn.edges.head;null!=Mn;){for(var Cn=Mn.elt,kn=1e100,On=mn.gverts.next;null!=On;){var Pn=Cn.gnormx*On.x+Cn.gnormy*On.y;Pn<kn&&(kn=Pn),On=On.next}if(1e100<(kn-=Cn.gprojection)){fn=kn;break}0<kn?fn<kn&&(fn=kn,bn=Cn,wn=1):fn<0&&fn<kn&&(fn=kn,bn=Cn,wn=1),Mn=Mn.next}if(fn<1e100){for(var Sn,An,jn,En=mn.edges.head;null!=En;){for(var In=En.elt,Tn=1e100,Nn=vn.gverts.next;null!=Nn;){var Ln=In.gnormx*Nn.x+In.gnormy*Nn.y;Ln<Tn&&(Tn=Ln),Nn=Nn.next}if(1e100<(Tn-=In.gprojection)){fn=Tn;break}0<Tn?fn<Tn&&(fn=Tn,gn=In,wn=2):fn<0&&fn<Tn&&(fn=Tn,gn=In,wn=2),En=En.next}if(fn<1e100){1==wn?(Sn=mn,An=bn):(Sn=vn,An=gn,jn=V,V=D,D=jn,Y=!Y);for(var Vn,Dn,Fn,Rn,Zn,Bn,Gn,qn,Un,Kn,Wn,Yn,Jn,Xn,Hn,$n,Qn,nt,tt,et,it,pt,lt,rt,ot,at,st,_t,ht,ut,xt,dt,yt,zt,ct,vt,mt,ft,bt,gt,wt,Mt,Ct,kt,Ot,Pt,St,At,jt,Et,It,Tt,Nt,Lt,Vt,Dt,Ft,Rt=null,Zt=1e100,Bt=Sn.edges.head;null!=Bt;){var Gt=Bt.elt,qt=An.gnormx*Gt.gnormx+An.gnormy*Gt.gnormy;qt<Zt&&(Zt=qt,Rt=Gt),Bt=Bt.next}Y?(x.x=-An.gnormx,x.y=-An.gnormy):(x.x=An.gnormx,x.y=An.gnormy),Ft=0<=fn?(Vn=An.gp0,Dn=An.gp1,Fn=Rt.gp0,Rn=Rt.gp1,qn=Gn=Bn=Zn=0,Un=1/((Zn=Dn.x-Vn.x)*Zn+(Bn=Dn.y-Vn.y)*Bn),Kn=1/((Gn=Rn.x-Fn.x)*Gn+(qn=Rn.y-Fn.y)*qn),(Wn=-(Zn*(Vn.x-Fn.x)+Bn*(Vn.y-Fn.y))*Un)<0?Wn=0:1<Wn&&(Wn=1),(Yn=-(Zn*(Vn.x-Rn.x)+Bn*(Vn.y-Rn.y))*Un)<0?Yn=0:1<Yn&&(Yn=1),(Jn=-(Gn*(Fn.x-Vn.x)+qn*(Fn.y-Vn.y))*Kn)<0?Jn=0:1<Jn&&(Jn=1),(Xn=-(Gn*(Fn.x-Dn.x)+qn*(Fn.y-Dn.y))*Kn)<0?Xn=0:1<Xn&&(Xn=1),$n=Hn=0,Hn=Vn.x+Zn*Wn,$n=Vn.y+Bn*Wn,nt=Qn=0,Qn=Vn.x+Zn*Yn,nt=Vn.y+Bn*Yn,et=tt=0,tt=Fn.x+Gn*Jn,et=Fn.y+qn*Jn,pt=it=0,it=Fn.x+Gn*Xn,pt=Fn.y+qn*Xn,vt=ct=yt=dt=ut=ht=st=at=rt=lt=0,mt=null,(ot=(lt=Hn-Fn.x)*lt+(rt=$n-Fn.y)*rt)<(_t=(at=Qn-Rn.x)*at+(st=nt-Rn.y)*st)?(ct=Hn,vt=$n,mt=Fn):(ct=Qn,vt=nt,mt=Rn,ot=_t),bt=ft=0,gt=null,(xt=(ht=tt-Vn.x)*ht+(ut=et-Vn.y)*ut)<(zt=(dt=it-Dn.x)*dt+(yt=pt-Dn.y)*yt)?(ft=tt,bt=et,gt=Vn):(ft=it,bt=pt,gt=Dn,xt=zt),0!=(fn=ot<xt?(V.x=ct,V.y=vt,D.x=mt.x,D.y=mt.y,Math.sqrt(ot)):(D.x=ft,D.y=bt,V.x=gt.x,V.y=gt.y,Math.sqrt(xt)))&&(x.x=D.x-V.x,x.y=D.y-V.y,wt=1/fn,x.x*=wt,x.y*=wt,Y&&(x.x=-x.x,x.y=-x.y)),fn):(Ct=Mt=0,Mt=Rt.gp0.x,Ct=Rt.gp0.y,St=Pt=Ot=kt=0,Pt=(kt=Rt.gp1.x)-Mt,St=(Ot=Rt.gp1.y)-Ct,At=An.gnormy*Mt-An.gnormx*Ct,Et=1/((jt=An.gnormy*kt-An.gnormx*Ot)-At),(It=(-An.tp1-At)*Et)>co.epsilon&&(Mt+=Pt*It,Ct+=St*It),(Tt=(-An.tp0-jt)*Et)<-co.epsilon&&(kt+=Pt*Tt,Ot+=St*Tt),(Nt=Mt*An.gnormx+Ct*An.gnormy-An.gprojection)<(Lt=kt*An.gnormx+Ot*An.gnormy-An.gprojection)?(D.x=Mt,D.y=Ct,Vt=-Nt,V.x=D.x+An.gnormx*Vt,V.y=D.y+An.gnormy*Vt,Nt):(D.x=kt,D.y=Ot,Dt=-Lt,V.x=D.x+An.gnormx*Dt,V.y=D.y+An.gnormy*Dt,Lt))}else Ft=1e100}else Ft=1e100}}var Ut=Ft+i,Kt=o*x.x+a*x.y;if(Ut<co.distanceThresholdCCD){var Wt=h.x-r.posx,Yt=h.y-r.posy,Jt=Kt-r.sweep_angvel*(x.y*Wt-x.x*Yt);if(0<Jt&&(n.slipped=!0),Jt<=0||Ut<.5*co.distanceThresholdCCD)break}var Xt=(_-Kt)*t;if(Xt<=0){d=-1;break}var Ht=Ut/Xt;if(Ht<1e-6&&(Ht=1e-6),1<=(d+=Ht)){var $t,Qt,ne,te,ee,ie=(d=1)*t,pe=ie-r.sweepTime;if(0!=pe&&(r.sweepTime=ie,r.posx+=r.velx*pe,r.posy+=r.vely*pe,0!=r.angvel&&($t=r.sweep_angvel*pe,r.rot+=$t,1e-4<$t*$t?(r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot)):(te=1-(Qt=$t*$t)*Qt/8,ee=((ne=1-.5*Qt)*r.axisx+$t*r.axisy)*te,r.axisy=(ne*r.axisy-$t*r.axisx)*te,r.axisx=ee))),0==p.type)p.worldCOMx=r.posx+(r.axisy*p.localCOMx-r.axisx*p.localCOMy),p.worldCOMy=r.posy+(p.localCOMx*r.axisx+p.localCOMy*r.axisy);else{for(var le=p.polygon,re=le.lverts.next,oe=le.gverts.next;null!=oe;){var ae=oe,se=re,re=re.next;ae.x=r.posx+(r.axisy*se.x-r.axisx*se.y),ae.y=r.posy+(se.x*r.axisx+se.y*r.axisy),oe=oe.next}for(var _e=le.edges.head,he=ue=le.gverts.next,ue=ue.next;null!=ue;){var xe=ue,de=_e.elt,_e=_e.next;de.gnormx=r.axisy*de.lnormx-r.axisx*de.lnormy,de.gnormy=de.lnormx*r.axisx+de.lnormy*r.axisy,de.gprojection=r.posx*de.gnormx+r.posy*de.gnormy+de.lprojection,de.tp0=he.y*de.gnormx-he.x*de.gnormy,de.tp1=xe.y*de.gnormx-xe.x*de.gnormy,he=xe,ue=ue.next}var ye=le.gverts.next,ze=_e.elt;ze.gnormx=r.axisy*ze.lnormx-r.axisx*ze.lnormy,ze.gnormy=ze.lnormx*r.axisx+ze.lnormy*r.axisy,ze.gprojection=r.posx*ze.gnormx+r.posy*ze.gnormy+ze.lprojection,ze.tp0=he.y*ze.gnormx-he.x*ze.gnormy,ze.tp1=ye.y*ze.gnormx-ye.x*ze.gnormy}var ce=p,ve=l,me=h,fe=u;if(0==p.type&&0==l.type){var be,ge,we,Me=p.circle,Ce=l.circle,ke=0,Oe=0,ke=Ce.worldCOMx-Me.worldCOMx,Oe=Ce.worldCOMy-Me.worldCOMy,Pe=Math.sqrt(ke*ke+Oe*Oe),Se=Pe-(Me.radius+Ce.radius);Se<1e100&&(0==Pe?(ke=1,Oe=0):(ke*=be=1/Pe,Oe*=be),ge=Me.radius,h.x=Me.worldCOMx+ke*ge,h.y=Me.worldCOMy+Oe*ge,we=-Ce.radius,u.x=Ce.worldCOMx+ke*we,u.y=Ce.worldCOMy+Oe*we,x.x=ke,x.y=Oe),fp=Se}else{var Ae=!1;if(0==p.type&&1==l.type&&(ce=l,ve=p,me=u,fe=h,Ae=!0),1==ce.type&&0==ve.type){for(var je,Ee,Ie,Te,Ne,Le,Ve,De,Fe,Re,Ze,Be,Ge,qe,Ue,Ke=ce.polygon,We=ve.circle,Ye=-1e100,Je=null,Xe=Ke.edges.head;null!=Xe;){var He=Xe.elt,$e=He.gnormx*We.worldCOMx+He.gnormy*We.worldCOMy-He.gprojection-We.radius;if(1e100<$e){Ye=$e;break}0<$e?Ye<$e&&(Ye=$e,Je=He):Ye<0&&Ye<$e&&(Ye=$e,Je=He),Xe=Xe.next}Ye<1e100&&(je=Je.gp0,Ee=Je.gp1,(Ie=We.worldCOMy*Je.gnormx-We.worldCOMx*Je.gnormy)<=je.y*Je.gnormx-je.x*Je.gnormy?(Ne=Te=0,Te=We.worldCOMx-je.x,Ne=We.worldCOMy-je.y,(Ye=(Le=Math.sqrt(Te*Te+Ne*Ne))-We.radius)<1e100&&(0==Le?(Te=1,Ne=0):(Te*=Ve=1/Le,Ne*=Ve),me.x=je.x+0*Te,me.y=je.y+0*Ne,De=-We.radius,fe.x=We.worldCOMx+Te*De,fe.y=We.worldCOMy+Ne*De,x.x=Te,x.y=Ne)):Ie>=Ee.y*Je.gnormx-Ee.x*Je.gnormy?(Re=Fe=0,Fe=We.worldCOMx-Ee.x,Re=We.worldCOMy-Ee.y,(Ye=(Ze=Math.sqrt(Fe*Fe+Re*Re))-We.radius)<1e100&&(0==Ze?(Fe=1,Re=0):(Fe*=Be=1/Ze,Re*=Be),me.x=Ee.x+0*Fe,me.y=Ee.y+0*Re,Ge=-We.radius,fe.x=We.worldCOMx+Fe*Ge,fe.y=We.worldCOMy+Re*Ge,x.x=Fe,x.y=Re)):(qe=-We.radius,fe.x=We.worldCOMx+Je.gnormx*qe,fe.y=We.worldCOMy+Je.gnormy*qe,Ue=-Ye,me.x=fe.x+Je.gnormx*Ue,me.y=fe.y+Je.gnormy*Ue,x.x=Je.gnormx,x.y=Je.gnormy)),Ae&&(x.x=-x.x,x.y=-x.y),fp=Ye}else{for(var Qe=ce.polygon,ni=ve.polygon,ti=-1e100,ei=null,ii=null,pi=0,li=Qe.edges.head;null!=li;){for(var ri=li.elt,oi=1e100,ai=ni.gverts.next;null!=ai;){var si=ri.gnormx*ai.x+ri.gnormy*ai.y;si<oi&&(oi=si),ai=ai.next}if(1e100<(oi-=ri.gprojection)){ti=oi;break}0<oi?ti<oi&&(ti=oi,ei=ri,pi=1):ti<0&&ti<oi&&(ti=oi,ei=ri,pi=1),li=li.next}if(ti<1e100){for(var _i,hi,ui,xi=ni.edges.head;null!=xi;){for(var di=xi.elt,yi=1e100,zi=Qe.gverts.next;null!=zi;){var ci=di.gnormx*zi.x+di.gnormy*zi.y;ci<yi&&(yi=ci),zi=zi.next}if(1e100<(yi-=di.gprojection)){ti=yi;break}0<yi?ti<yi&&(ti=yi,ii=di,pi=2):ti<0&&ti<yi&&(ti=yi,ii=di,pi=2),xi=xi.next}if(ti<1e100){1==pi?(_i=ni,hi=ei):(_i=Qe,hi=ii,ui=me,me=fe,fe=ui,Ae=!Ae);for(var vi,mi,fi,bi,gi,wi,Mi,Ci,ki,Oi,Pi,Si,Ai,ji,Ei,Ii,Ti,Ni,Li,Vi,Di,Fi,Ri,Zi,Bi,Gi,qi,Ui,Ki,Wi,Yi,Ji,Xi,Hi,$i,Qi,np,tp,ep,ip,pp,lp,rp,op,ap,sp,_p,hp,up,xp,dp,yp,zp,cp,vp,mp,fp,bp=null,gp=1e100,wp=_i.edges.head;null!=wp;){var Mp=wp.elt,Cp=hi.gnormx*Mp.gnormx+hi.gnormy*Mp.gnormy;Cp<gp&&(gp=Cp,bp=Mp),wp=wp.next}Ae?(x.x=-hi.gnormx,x.y=-hi.gnormy):(x.x=hi.gnormx,x.y=hi.gnormy),fp=0<=ti?(vi=hi.gp0,mi=hi.gp1,fi=bp.gp0,bi=bp.gp1,Ci=Mi=wi=gi=0,ki=1/((gi=mi.x-vi.x)*gi+(wi=mi.y-vi.y)*wi),Oi=1/((Mi=bi.x-fi.x)*Mi+(Ci=bi.y-fi.y)*Ci),(Pi=-(gi*(vi.x-fi.x)+wi*(vi.y-fi.y))*ki)<0?Pi=0:1<Pi&&(Pi=1),(Si=-(gi*(vi.x-bi.x)+wi*(vi.y-bi.y))*ki)<0?Si=0:1<Si&&(Si=1),(Ai=-(Mi*(fi.x-vi.x)+Ci*(fi.y-vi.y))*Oi)<0?Ai=0:1<Ai&&(Ai=1),(ji=-(Mi*(fi.x-mi.x)+Ci*(fi.y-mi.y))*Oi)<0?ji=0:1<ji&&(ji=1),Ii=Ei=0,Ei=vi.x+gi*Pi,Ii=vi.y+wi*Pi,Ni=Ti=0,Ti=vi.x+gi*Si,Ni=vi.y+wi*Si,Vi=Li=0,Li=fi.x+Mi*Ai,Vi=fi.y+Ci*Ai,Fi=Di=0,Di=fi.x+Mi*ji,Fi=fi.y+Ci*ji,Qi=$i=Xi=Ji=Wi=Ki=qi=Gi=Zi=Ri=0,np=null,(Bi=(Ri=Ei-fi.x)*Ri+(Zi=Ii-fi.y)*Zi)<(Ui=(Gi=Ti-bi.x)*Gi+(qi=Ni-bi.y)*qi)?($i=Ei,Qi=Ii,np=fi):($i=Ti,Qi=Ni,np=bi,Bi=Ui),ep=tp=0,ip=null,(Yi=(Ki=Li-vi.x)*Ki+(Wi=Vi-vi.y)*Wi)<(Hi=(Ji=Di-mi.x)*Ji+(Xi=Fi-mi.y)*Xi)?(tp=Li,ep=Vi,ip=vi):(tp=Di,ep=Fi,ip=mi,Yi=Hi),0!=(ti=Bi<Yi?(me.x=$i,me.y=Qi,fe.x=np.x,fe.y=np.y,Math.sqrt(Bi)):(fe.x=tp,fe.y=ep,me.x=ip.x,me.y=ip.y,Math.sqrt(Yi)))&&(x.x=fe.x-me.x,x.y=fe.y-me.y,pp=1/ti,x.x*=pp,x.y*=pp,Ae&&(x.x=-x.x,x.y=-x.y)),ti):(rp=lp=0,lp=bp.gp0.x,rp=bp.gp0.y,_p=sp=ap=op=0,sp=(op=bp.gp1.x)-lp,_p=(ap=bp.gp1.y)-rp,hp=hi.gnormy*lp-hi.gnormx*rp,xp=1/((up=hi.gnormy*op-hi.gnormx*ap)-hp),(dp=(-hi.tp1-hp)*xp)>co.epsilon&&(lp+=sp*dp,rp+=_p*dp),(yp=(-hi.tp0-up)*xp)<-co.epsilon&&(op+=sp*yp,ap+=_p*yp),(zp=lp*hi.gnormx+rp*hi.gnormy-hi.gprojection)<(cp=op*hi.gnormx+ap*hi.gnormy-hi.gprojection)?(fe.x=lp,fe.y=rp,vp=-zp,me.x=fe.x+hi.gnormx*vp,me.y=fe.y+hi.gnormy*vp,zp):(fe.x=op,fe.y=ap,mp=-cp,me.x=fe.x+hi.gnormx*mp,me.y=fe.y+hi.gnormy*mp,cp))}else fp=1e100}else fp=1e100}}var kp=fp+i,Op=o*x.x+a*x.y;if(kp<co.distanceThresholdCCD){var Pp=h.x-r.posx,Sp=h.y-r.posy,Ap=Op-r.sweep_angvel*(x.y*Pp-x.x*Sp);if(0<Ap&&(n.slipped=!0),Ap<=0||kp<.5*co.distanceThresholdCCD)break}d=-1;break}if(40<=++y){i<Ut&&(n.failed=!0);break}}n.toi=d},Ut.distanceBody=function(n,t,e,i){var p,l,r;null==mo.zpp_pool?p=new mo:(p=mo.zpp_pool,mo.zpp_pool=p.next,p.next=null),p.weak=!1,null==mo.zpp_pool?l=new mo:(l=mo.zpp_pool,mo.zpp_pool=l.next,l.next=null),l.weak=!1,null==mo.zpp_pool?r=new mo:(r=mo.zpp_pool,mo.zpp_pool=r.next,r.next=null),r.weak=!1;for(var o=1e100,a=n.shapes.head;null!=a;){for(var s=a.elt,_=t.shapes.head;null!=_;){var h=_.elt,u=s,x=h,d=p,y=l;if(0==s.type&&0==h.type){var z,c,v,m=s.circle,f=h.circle,b=0,g=0,b=f.worldCOMx-m.worldCOMx,g=f.worldCOMy-m.worldCOMy,w=Math.sqrt(b*b+g*g),M=w-(m.radius+f.radius);M<o&&(0==w?(b=1,g=0):(b*=z=1/w,g*=z),c=m.radius,d.x=m.worldCOMx+b*c,d.y=m.worldCOMy+g*c,v=-f.radius,y.x=f.worldCOMx+b*v,y.y=f.worldCOMy+g*v,r.x=b,r.y=g),ct=M}else{var C,k=!1;if(0==s.type&&1==h.type&&(u=h,x=s,C=d,d=y,y=C,k=!0),1==u.type&&0==x.type){for(var O,P,S,A,j,E,I,T,N,L,V,D,F,R,Z,B=u.polygon,G=x.circle,q=-1e100,U=null,K=B.edges.head;null!=K;){var W=K.elt,Y=W.gnormx*G.worldCOMx+W.gnormy*G.worldCOMy-W.gprojection-G.radius;if(o<Y){q=Y;break}0<Y?q<Y&&(q=Y,U=W):q<0&&q<Y&&(q=Y,U=W),K=K.next}q<o&&(O=U.gp0,P=U.gp1,(S=G.worldCOMy*U.gnormx-G.worldCOMx*U.gnormy)<=O.y*U.gnormx-O.x*U.gnormy?(j=A=0,A=G.worldCOMx-O.x,j=G.worldCOMy-O.y,(q=(E=Math.sqrt(A*A+j*j))-G.radius)<o&&(0==E?(A=1,j=0):(A*=I=1/E,j*=I),d.x=O.x+0*A,d.y=O.y+0*j,T=-G.radius,y.x=G.worldCOMx+A*T,y.y=G.worldCOMy+j*T,r.x=A,r.y=j)):S>=P.y*U.gnormx-P.x*U.gnormy?(L=N=0,N=G.worldCOMx-P.x,L=G.worldCOMy-P.y,(q=(V=Math.sqrt(N*N+L*L))-G.radius)<o&&(0==V?(N=1,L=0):(N*=D=1/V,L*=D),d.x=P.x+0*N,d.y=P.y+0*L,F=-G.radius,y.x=G.worldCOMx+N*F,y.y=G.worldCOMy+L*F,r.x=N,r.y=L)):(R=-G.radius,y.x=G.worldCOMx+U.gnormx*R,y.y=G.worldCOMy+U.gnormy*R,Z=-q,d.x=y.x+U.gnormx*Z,d.y=y.y+U.gnormy*Z,r.x=U.gnormx,r.y=U.gnormy)),k&&(r.x=-r.x,r.y=-r.y),ct=q}else{for(var J=u.polygon,X=x.polygon,H=-1e100,$=null,Q=null,nn=0,tn=J.edges.head;null!=tn;){for(var en=tn.elt,pn=1e100,ln=X.gverts.next;null!=ln;){var rn=en.gnormx*ln.x+en.gnormy*ln.y;rn<pn&&(pn=rn),ln=ln.next}if(o<(pn-=en.gprojection)){H=pn;break}0<pn?H<pn&&(H=pn,$=en,nn=1):H<0&&H<pn&&(H=pn,$=en,nn=1),tn=tn.next}if(H<o){for(var on,an,sn,_n=X.edges.head;null!=_n;){for(var hn=_n.elt,un=1e100,xn=J.gverts.next;null!=xn;){var dn=hn.gnormx*xn.x+hn.gnormy*xn.y;dn<un&&(un=dn),xn=xn.next}if(o<(un-=hn.gprojection)){H=un;break}0<un?H<un&&(H=un,Q=hn,nn=2):H<0&&H<un&&(H=un,Q=hn,nn=2),_n=_n.next}if(H<o){1==nn?(on=X,an=$):(on=J,an=Q,sn=d,d=y,y=sn,k=!k);for(var yn,zn,cn,vn,mn,fn,bn,gn,wn,Mn,Cn,kn,On,Pn,Sn,An,jn,En,In,Tn,Nn,Ln,Vn,Dn,Fn,Rn,Zn,Bn,Gn,qn,Un,Kn,Wn,Yn,Jn,Xn,Hn,$n,Qn,nt,tt,et,it,pt,lt,rt,ot,at,st,_t,ht,ut,xt,dt,yt,zt,ct,vt=null,mt=1e100,ft=on.edges.head;null!=ft;){var bt=ft.elt,gt=an.gnormx*bt.gnormx+an.gnormy*bt.gnormy;gt<mt&&(mt=gt,vt=bt),ft=ft.next}k?(r.x=-an.gnormx,r.y=-an.gnormy):(r.x=an.gnormx,r.y=an.gnormy),ct=0<=H?(yn=an.gp0,zn=an.gp1,cn=vt.gp0,vn=vt.gp1,gn=bn=fn=mn=0,wn=1/((mn=zn.x-yn.x)*mn+(fn=zn.y-yn.y)*fn),Mn=1/((bn=vn.x-cn.x)*bn+(gn=vn.y-cn.y)*gn),(Cn=-(mn*(yn.x-cn.x)+fn*(yn.y-cn.y))*wn)<0?Cn=0:1<Cn&&(Cn=1),(kn=-(mn*(yn.x-vn.x)+fn*(yn.y-vn.y))*wn)<0?kn=0:1<kn&&(kn=1),(On=-(bn*(cn.x-yn.x)+gn*(cn.y-yn.y))*Mn)<0?On=0:1<On&&(On=1),(Pn=-(bn*(cn.x-zn.x)+gn*(cn.y-zn.y))*Mn)<0?Pn=0:1<Pn&&(Pn=1),An=Sn=0,Sn=yn.x+mn*Cn,An=yn.y+fn*Cn,En=jn=0,jn=yn.x+mn*kn,En=yn.y+fn*kn,Tn=In=0,In=cn.x+bn*On,Tn=cn.y+gn*On,Ln=Nn=0,Nn=cn.x+bn*Pn,Ln=cn.y+gn*Pn,Xn=Jn=Wn=Kn=qn=Gn=Zn=Rn=Dn=Vn=0,Hn=null,(Fn=(Vn=Sn-cn.x)*Vn+(Dn=An-cn.y)*Dn)<(Bn=(Rn=jn-vn.x)*Rn+(Zn=En-vn.y)*Zn)?(Jn=Sn,Xn=An,Hn=cn):(Jn=jn,Xn=En,Hn=vn,Fn=Bn),Qn=$n=0,nt=null,(Un=(Gn=In-yn.x)*Gn+(qn=Tn-yn.y)*qn)<(Yn=(Kn=Nn-zn.x)*Kn+(Wn=Ln-zn.y)*Wn)?($n=In,Qn=Tn,nt=yn):($n=Nn,Qn=Ln,nt=zn,Un=Yn),0!=(H=Fn<Un?(d.x=Jn,d.y=Xn,y.x=Hn.x,y.y=Hn.y,Math.sqrt(Fn)):(y.x=$n,y.y=Qn,d.x=nt.x,d.y=nt.y,Math.sqrt(Un)))&&(r.x=y.x-d.x,r.y=y.y-d.y,tt=1/H,r.x*=tt,r.y*=tt,k&&(r.x=-r.x,r.y=-r.y)),H):(it=et=0,et=vt.gp0.x,it=vt.gp0.y,ot=rt=lt=pt=0,rt=(pt=vt.gp1.x)-et,ot=(lt=vt.gp1.y)-it,at=an.gnormy*et-an.gnormx*it,_t=1/((st=an.gnormy*pt-an.gnormx*lt)-at),(ht=(-an.tp1-at)*_t)>co.epsilon&&(et+=rt*ht,it+=ot*ht),(ut=(-an.tp0-st)*_t)<-co.epsilon&&(pt+=rt*ut,lt+=ot*ut),(xt=et*an.gnormx+it*an.gnormy-an.gprojection)<(dt=pt*an.gnormx+lt*an.gnormy-an.gprojection)?(y.x=et,y.y=it,yt=-xt,d.x=y.x+an.gnormx*yt,d.y=y.y+an.gnormy*yt,xt):(y.x=pt,y.y=lt,zt=-dt,d.x=y.x+an.gnormx*zt,d.y=y.y+an.gnormy*zt,dt))}else ct=o}else ct=o}}ct<o&&(o=ct,e.x=p.x,e.y=p.y,i.x=l.x,i.y=l.y),_=_.next}a=a.next}var wt=p;null!=wt.outer&&(wt.outer.zpp_inner=null,wt.outer=null),wt._isimmutable=null,wt._validate=null,wt._invalidate=null,wt.next=mo.zpp_pool,mo.zpp_pool=wt;var Mt=l;null!=Mt.outer&&(Mt.outer.zpp_inner=null,Mt.outer=null),Mt._isimmutable=null,Mt._validate=null,Mt._invalidate=null,Mt.next=mo.zpp_pool,mo.zpp_pool=Mt;var Ct=r;return null!=Ct.outer&&(Ct.outer.zpp_inner=null,Ct.outer=null),Ct._isimmutable=null,Ct._validate=null,Ct._invalidate=null,Ct.next=mo.zpp_pool,mo.zpp_pool=Ct,o},Ut.distance=function(n,t,e,i,p,l){if(null==l&&(l=1e100),0==n.type&&0==t.type){var r,o,a,s=n.circle,_=t.circle,h=0,u=0,h=_.worldCOMx-s.worldCOMx,u=_.worldCOMy-s.worldCOMy,x=Math.sqrt(h*h+u*u),d=x-(s.radius+_.radius);return d<l&&(0==x?(h=1,u=0):(h*=r=1/x,u*=r),o=s.radius,e.x=s.worldCOMx+h*o,e.y=s.worldCOMy+u*o,a=-_.radius,i.x=_.worldCOMx+h*a,i.y=_.worldCOMy+u*a,p.x=h,p.y=u),d}var y,z,c=!1;if(0==n.type&&1==t.type&&(y=n,n=t,t=y,z=e,e=i,i=z,c=!0),1==n.type&&0==t.type){for(var v,m,f,b,g,w,M,C,k,O,P,S,A,j,E,I=n.polygon,T=t.circle,N=-1e100,L=null,V=I.edges.head;null!=V;){var D=V.elt,F=D.gnormx*T.worldCOMx+D.gnormy*T.worldCOMy-D.gprojection-T.radius;if(l<F){N=F;break}0<F?N<F&&(N=F,L=D):N<0&&N<F&&(N=F,L=D),V=V.next}return N<l&&(v=L.gp0,m=L.gp1,(f=T.worldCOMy*L.gnormx-T.worldCOMx*L.gnormy)<=v.y*L.gnormx-v.x*L.gnormy?(g=b=0,b=T.worldCOMx-v.x,g=T.worldCOMy-v.y,(N=(w=Math.sqrt(b*b+g*g))-T.radius)<l&&(0==w?(b=1,g=0):(b*=M=1/w,g*=M),e.x=v.x+0*b,e.y=v.y+0*g,C=-T.radius,i.x=T.worldCOMx+b*C,i.y=T.worldCOMy+g*C,p.x=b,p.y=g)):f>=m.y*L.gnormx-m.x*L.gnormy?(O=k=0,k=T.worldCOMx-m.x,O=T.worldCOMy-m.y,(N=(P=Math.sqrt(k*k+O*O))-T.radius)<l&&(0==P?(k=1,O=0):(k*=S=1/P,O*=S),e.x=m.x+0*k,e.y=m.y+0*O,A=-T.radius,i.x=T.worldCOMx+k*A,i.y=T.worldCOMy+O*A,p.x=k,p.y=O)):(j=-T.radius,i.x=T.worldCOMx+L.gnormx*j,i.y=T.worldCOMy+L.gnormy*j,E=-N,e.x=i.x+L.gnormx*E,e.y=i.y+L.gnormy*E,p.x=L.gnormx,p.y=L.gnormy)),c&&(p.x=-p.x,p.y=-p.y),N}for(var R=n.polygon,Z=t.polygon,B=-1e100,G=null,q=null,U=0,K=R.edges.head;null!=K;){for(var W=K.elt,Y=1e100,J=Z.gverts.next;null!=J;){var X=W.gnormx*J.x+W.gnormy*J.y;X<Y&&(Y=X),J=J.next}if(l<(Y-=W.gprojection)){B=Y;break}0<Y?B<Y&&(B=Y,G=W,U=1):B<0&&B<Y&&(B=Y,G=W,U=1),K=K.next}if(B<l){for(var H,$,Q,nn=Z.edges.head;null!=nn;){for(var tn=nn.elt,en=1e100,pn=R.gverts.next;null!=pn;){var ln=tn.gnormx*pn.x+tn.gnormy*pn.y;ln<en&&(en=ln),pn=pn.next}if(l<(en-=tn.gprojection)){B=en;break}0<en?B<en&&(B=en,q=tn,U=2):B<0&&B<en&&(B=en,q=tn,U=2),nn=nn.next}if(B<l){1==U?(H=Z,$=G):(H=R,$=q,Q=e,e=i,i=Q,c=!c);for(var rn=null,on=1e100,an=H.edges.head;null!=an;){var sn=an.elt,_n=$.gnormx*sn.gnormx+$.gnormy*sn.gnormy;_n<on&&(on=_n,rn=sn),an=an.next}if(c?(p.x=-$.gnormx,p.y=-$.gnormy):(p.x=$.gnormx,p.y=$.gnormy),0<=B){var hn=$.gp0,un=$.gp1,xn=rn.gp0,dn=rn.gp1,yn=0,zn=0,cn=0,vn=0,mn=1/((yn=un.x-hn.x)*yn+(zn=un.y-hn.y)*zn),fn=1/((cn=dn.x-xn.x)*cn+(vn=dn.y-xn.y)*vn),bn=-(yn*(hn.x-xn.x)+zn*(hn.y-xn.y))*mn,gn=-(yn*(hn.x-dn.x)+zn*(hn.y-dn.y))*mn,wn=-(cn*(xn.x-hn.x)+vn*(xn.y-hn.y))*fn,Mn=-(cn*(xn.x-un.x)+vn*(xn.y-un.y))*fn;bn<0?bn=0:1<bn&&(bn=1),gn<0?gn=0:1<gn&&(gn=1),wn<0?wn=0:1<wn&&(wn=1),Mn<0?Mn=0:1<Mn&&(Mn=1);var Cn=hn.x+yn*bn,kn=hn.y+zn*bn,On=hn.x+yn*gn,Pn=hn.y+zn*gn,Sn=xn.x+cn*wn,An=xn.y+vn*wn,jn=xn.x+cn*Mn,En=xn.y+vn*Mn,In=0,Tn=0,Nn=(In=Cn-xn.x)*In+(Tn=kn-xn.y)*Tn,Ln=0,Vn=0,Dn=(Ln=On-dn.x)*Ln+(Vn=Pn-dn.y)*Vn,Fn=0,Rn=0,Zn=(Fn=Sn-hn.x)*Fn+(Rn=An-hn.y)*Rn,Bn=0,Gn=0,qn=(Bn=jn-un.x)*Bn+(Gn=En-un.y)*Gn,Un=0,Kn=0,Wn=null;Nn<Dn?(Un=Cn,Kn=kn,Wn=xn):(Un=On,Kn=Pn,Wn=dn,Nn=Dn);var Yn,Jn=0,Xn=0,Hn=null;return Zn<qn?(Jn=Sn,Xn=An,Hn=hn):(Jn=jn,Xn=En,Hn=un,Zn=qn),0!=(B=Nn<Zn?(e.x=Un,e.y=Kn,i.x=Wn.x,i.y=Wn.y,Math.sqrt(Nn)):(i.x=Jn,i.y=Xn,e.x=Hn.x,e.y=Hn.y,Math.sqrt(Zn)))&&(p.x=i.x-e.x,p.y=i.y-e.y,Yn=1/B,p.x*=Yn,p.y*=Yn,c&&(p.x=-p.x,p.y=-p.y)),B}var $n=0,Qn=0,$n=rn.gp0.x,Qn=rn.gp0.y,nt=0,tt=0,et=(nt=rn.gp1.x)-$n,it=(tt=rn.gp1.y)-Qn,pt=$.gnormy*$n-$.gnormx*Qn,lt=$.gnormy*nt-$.gnormx*tt,rt=1/(lt-pt),ot=(-$.tp1-pt)*rt;ot>co.epsilon&&($n+=et*ot,Qn+=it*ot);var at=(-$.tp0-lt)*rt;at<-co.epsilon&&(nt+=et*at,tt+=it*at);var st=$n*$.gnormx+Qn*$.gnormy-$.gprojection,_t=nt*$.gnormx+tt*$.gnormy-$.gprojection;if(st<_t){i.x=$n,i.y=Qn;var ht=-st;return e.x=i.x+$.gnormx*ht,e.y=i.y+$.gnormy*ht,st}i.x=nt,i.y=tt;var ut=-_t;return e.x=i.x+$.gnormx*ut,e.y=i.y+$.gnormy*ut,_t}return l}return l},Ut.prototype.__class__=Ut;var Bt=zpp_nape.geom.ZPP_PartitionPair=function(){this.node=null,this.di=0,this.id=0,this.b=null,this.a=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null};Bt.__name__=["zpp_nape","geom","ZPP_PartitionPair"],Bt.get=function(n,t){var e;return null==Bt.zpp_pool?e=new Bt:(e=Bt.zpp_pool,Bt.zpp_pool=e.next,e.next=null),e.a=n,e.b=t,n.id<t.id?(e.id=n.id,e.di=t.id):(e.id=t.id,e.di=n.id),e},Bt.edge_swap=function(n,t){var e=n.node;n.node=t.node,t.node=e},Bt.edge_lt=function(n,t){return!(n.id>=t.id)||n.id==t.id&&n.di<t.di},Bt.prototype.next=null,Bt.prototype.elem=function(){return this},Bt.prototype.begin=function(){return this.next},Bt.prototype._inuse=null,Bt.prototype.modified=null,Bt.prototype.pushmod=null,Bt.prototype.length=null,Bt.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},Bt.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Bt.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Bt.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},Bt.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},Bt.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},Bt.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Bt.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Bt.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},Bt.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},Bt.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Bt.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Bt.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Bt.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Bt.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},Bt.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},Bt.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Bt.prototype.clear=function(){},Bt.prototype.inlined_clear=function(){},Bt.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},Bt.prototype.empty=function(){return null==this.next},Bt.prototype.size=function(){return this.length},Bt.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},Bt.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},Bt.prototype.front=function(){return this.next},Bt.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},Bt.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},Bt.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t:null},Bt.prototype.free=function(){this.a=this.b=null,this.node=null},Bt.prototype.alloc=function(){},Bt.prototype.a=null,Bt.prototype.b=null,Bt.prototype.id=null,Bt.prototype.di=null,Bt.prototype.node=null,Bt.prototype.__class__=Bt;var Gt=zpp_nape.geom.ZPP_Triangular=function(){};Gt.__name__=["zpp_nape","geom","ZPP_Triangular"],Gt.lt=function(n,t){return n.y<t.y||n.y==t.y&&n.x<t.x},Gt.right_turn=function(n,t,e){var i=e.x-t.x,p=e.y-t.y,l=t.x-n.x;return(t.y-n.y)*i-l*p},Gt.delaunay=function(n,t,e,i){var p=0,l=0,r=0,p=e.x-t.x,l=e.y-t.y,r=t.x-n.x,o=0<=(t.y-n.y)*p-r*l||(p=i.x-e.x,l=i.y-e.y,r=e.x-t.x,0<=(e.y-t.y)*p-r*l),a=!!o||(p=n.x-i.x,l=n.y-i.y,r=i.x-e.x,0<=(i.y-e.y)*p-r*l),s=!!a||(p=t.x-n.x,l=t.y-n.y,r=n.x-i.x,0<=(n.y-i.y)*p-r*l);return!!s||0<t.x*(e.y*i.mag-e.mag*i.y)-e.x*(t.y*i.mag-t.mag*i.y)+i.x*(t.y*e.mag-t.mag*e.y)-(n.x*(e.y*i.mag-e.mag*i.y)-e.x*(n.y*i.mag-n.mag*i.y)+i.x*(n.y*e.mag-n.mag*e.y))+(n.x*(t.y*i.mag-t.mag*i.y)-t.x*(n.y*i.mag-n.mag*i.y)+i.x*(n.y*t.mag-n.mag*t.y))-(n.x*(t.y*e.mag-t.mag*e.y)-t.x*(n.y*e.mag-n.mag*e.y)+e.x*(n.y*t.mag-n.mag*t.y))},Gt.optimise=function(n){var t,e=n.vertices,i=n.vertices;if(null!=e)for(var p=e;;){var l=p;if(l.sort(),l.mag=l.x*l.x+l.y*l.y,(p=p.next)==i)break}null==Gt.edgeSet&&(null==qi.zpp_pool?Gt.edgeSet=new qi:(Gt.edgeSet=qi.zpp_pool,qi.zpp_pool=Gt.edgeSet.next,Gt.edgeSet.next=null),Gt.edgeSet.lt=Bt.edge_lt,Gt.edgeSet.swapped=Bt.edge_swap),null==Bt.zpp_pool?t=new Bt:(t=Bt.zpp_pool,Bt.zpp_pool=t.next,t.next=null);var r=n.vertices,o=n.vertices;if(null!=r)for(var a=r;;){var s=a,_=s.next;s.diagonals.reverse();for(var h=s.diagonals.head;null!=h;){var u,x,d=h.elt;d.id<s.id?(_=d,h=h.next):(Gt.delaunay(s,_,d,null==h.next?s.prev:h.next.elt)||(null==Bt.zpp_pool?u=new Bt:(u=Bt.zpp_pool,Bt.zpp_pool=u.next,u.next=null),u.a=s,u.b=d,s.id<d.id?(u.id=s.id,u.di=d.id):(u.id=d.id,u.di=s.id),x=u,t.add(x),x.node=Gt.edgeSet.insert(x)),_=d,h=h.next)}if((a=a.next)==o)break}for(;null!=t.next;){for(var y=t.pop_unsafe(),z=y.a,c=y.b,v=z.next,m=null,f=z.diagonals.head;null!=f;){var b=f.elt;if(b==c){m=null==(f=f.next)?z.prev:f.elt;break}v=b,f=f.next}if(z.diagonals.remove(c),c.diagonals.remove(z),c==v.next)v.diagonals.add(m);else for(var g=v.diagonals.head;null!=g;){if(g.elt==c){v.diagonals.insert(g,m);break}g=g.next}if(z==m.next)m.diagonals.add(v);else for(var w=m.diagonals.head;null!=w;){if(w.elt==z){m.diagonals.insert(w,v);break}w=w.next}Gt.edgeSet.remove_node(y.node),y.a=y.b=null,y.node=null,y.next=Bt.zpp_pool,Bt.zpp_pool=y}var M=t;M.a=M.b=null,M.node=null,M.next=Bt.zpp_pool,Bt.zpp_pool=M},Gt.triangulate=function(n){var t=n.vertices,e=n.vertices,i=n.vertices.next,p=n.vertices;if(null!=i)for(var l=i;;){if((l.y<t.y||l.y==t.y&&l.x<t.x)&&(t=l),(e.y<l.y||e.y==l.y&&e.x<l.x)&&(e=l),(l=l.next)==p)break}null==Gt.queue&&(Gt.queue=new ge);var r=e.prev,o=e.next;for(Gt.queue.add(e);r!=t||o!=t;)r==t||o!=t&&(r.y<o.y||r.y==o.y&&r.x<o.x)?(Gt.queue.add(o),o.rightchain=!1,o=o.next):(Gt.queue.add(r),r.rightchain=!0,r=r.prev);Gt.queue.add(t),null==Gt.stack&&(Gt.stack=new ge),Gt.stack.add(Gt.queue.pop_unsafe());var a=Gt.queue.pop_unsafe();for(Gt.stack.add(a);;){var s=Gt.queue.pop_unsafe();if(null==Gt.queue.head)break;if(s.rightchain!=Gt.stack.head.elt.rightchain){for(;;){var _=Gt.stack.pop_unsafe();if(null==Gt.stack.head)break;n.add_diagonal(_,s)}Gt.stack.add(a)}else{for(var h=Gt.stack.pop_unsafe();null!=Gt.stack.head;){var u=Gt.stack.head.elt,x=s.x-h.x,d=s.y-h.y,y=h.x-u.x,z=(h.y-u.y)*x-y*d;if(s.rightchain&&0<=z||!s.rightchain&&z<=0)break;n.add_diagonal(u,s),h=u,Gt.stack.pop()}Gt.stack.add(h)}Gt.stack.add(s),a=s}if(null!=Gt.stack.head)for(Gt.stack.pop();null!=Gt.stack.head;){var c=Gt.stack.pop_unsafe();if(null==Gt.stack.head)break;n.add_diagonal(e,c)}return n},Gt.prototype.__class__=Gt;var mo=zpp_nape.geom.ZPP_Vec2=function(){this.y=0,this.x=0,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.weak=!1,this.outer=null,this._isimmutable=null,this._immutable=!1,this._validate=null,this._invalidate=null};mo.__name__=["zpp_nape","geom","ZPP_Vec2"],mo.get=function(n,t,e){var i;return null==e&&(e=!1),null==mo.zpp_pool?i=new mo:(i=mo.zpp_pool,mo.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=e,i.x=n,i.y=t,i},mo.prototype._invalidate=null,mo.prototype._validate=null,mo.prototype.validate=function(){null!=this._validate&&this._validate()},mo.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate(this)},mo.prototype._immutable=null,mo.prototype._isimmutable=null,mo.prototype.immutable=function(){},mo.prototype.outer=null,mo.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new at,null!=(n=this.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=mo.zpp_pool,mo.zpp_pool=n,this.outer.zpp_inner=this),this.outer},mo.prototype.weak=null,mo.prototype.free=function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this._isimmutable=null,this._validate=null,this._invalidate=null},mo.prototype.alloc=function(){this.weak=!1},mo.prototype.next=null,mo.prototype.elem=function(){return this},mo.prototype.begin=function(){return this.next},mo.prototype._inuse=null,mo.prototype.modified=null,mo.prototype.pushmod=null,mo.prototype.length=null,mo.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},mo.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},mo.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},mo.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},mo.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},mo.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},mo.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},mo.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},mo.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},mo.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},mo.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},mo.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},mo.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},mo.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},mo.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},mo.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},mo.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},mo.prototype.clear=function(){},mo.prototype.inlined_clear=function(){},mo.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},mo.prototype.empty=function(){return null==this.next},mo.prototype.size=function(){return this.length},mo.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},mo.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},mo.prototype.front=function(){return this.next},mo.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},mo.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},mo.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t:null},mo.prototype.x=null,mo.prototype.y=null,mo.prototype.copy=function(){var n,t=this.x,e=this.y;return null==mo.zpp_pool?n=new mo:(n=mo.zpp_pool,mo.zpp_pool=n.next,n.next=null),n.weak=!1,n._immutable=!1,n.x=t,n.y=e,n},mo.prototype.toString=function(){return"{ x: "+this.x+" y: "+this.y+" }"},mo.prototype.__class__=mo;var Kt=zpp_nape.geom.ZPP_Vec3=function(){this._validate=null,this.immutable=!1,this.z=0,this.y=0,this.x=0,this.outer=null,this.immutable=!1,this._validate=null};Kt.__name__=["zpp_nape","geom","ZPP_Vec3"],Kt.prototype.outer=null,Kt.prototype.x=null,Kt.prototype.y=null,Kt.prototype.z=null,Kt.prototype.immutable=null,Kt.prototype._validate=null,Kt.prototype.validate=function(){null!=this._validate&&this._validate()},Kt.prototype.__class__=Kt;var Wt=zpp_nape.geom.ZPP_VecMath=function(){};Wt.__name__=["zpp_nape","geom","ZPP_VecMath"],Wt.vec_dsq=function(n,t,e,i){var p=0,l=0;return(p=n-e)*p+(l=t-i)*l},Wt.vec_distance=function(n,t,e,i){var p=n-e,l=t-i;return Math.sqrt(p*p+l*l)},Wt.prototype.__class__=Wt;var Zl=zpp_nape.phys.ZPP_Interactor=function(){this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.group=null,this.cbsets=null,this.icompound=null,this.ibody=null,this.ishape=null,this.userData=null,this.id=0,this.outer_i=null,this.id=Sn.Interactor(),this.cbsets=new ze,this.cbTypes=new Rn};Zl.__name__=["zpp_nape","phys","ZPP_Interactor"],Zl.get=function(n,t){for(var e=n.id<t.id?n.id:t.id,i=n.id<t.id?t.id:n.id,p=null,l=(n.cbsets.length<t.cbsets.length?n.cbsets:t.cbsets).head;null!=l;){var r=l.elt;if(r.id==e&&r.di==i){p=r;break}l=l.next}return p},Zl.int_callback=function(n,t,e){var i,p,l=n.int1,r=n.int2,o=t.options1,a=l.cbTypes;!(!o.nonemptyintersection(a,o.includes)||o.nonemptyintersection(a,o.excludes))&&(i=t.options2,p=r.cbTypes,!!i.nonemptyintersection(p,i.includes)&&!i.nonemptyintersection(p,i.excludes))?(e.int1=l,e.int2=r):(e.int1=r,e.int2=l)},Zl.prototype.outer_i=null,Zl.prototype.id=null,Zl.prototype.userData=null,Zl.prototype.ishape=null,Zl.prototype.ibody=null,Zl.prototype.icompound=null,Zl.prototype.isShape=function(){return null!=this.ishape},Zl.prototype.isBody=function(){return null!=this.ibody},Zl.prototype.isCompound=function(){return null!=this.icompound},Zl.prototype.__iaddedToSpace=function(){null!=this.group&&this.group.interactors.add(this);for(var n=this.cbTypes.head;null!=n;)n.elt.interactors.add(this),n=n.next;this.alloc_cbSet()},Zl.prototype.__iremovedFromSpace=function(){null!=this.group&&this.group.interactors.remove(this);for(var n=this.cbTypes.head;null!=n;)n.elt.interactors.remove(this),n=n.next;this.dealloc_cbSet()},Zl.prototype.wake=function(){var n;null!=this.ishape?null!=(n=this.ishape.body)&&null!=n.space&&n.space.non_inlined_wake(n):null!=this.ibody?null!=this.ibody.space&&this.ibody.space.non_inlined_wake(this.ibody):null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound)},Zl.prototype.cbsets=null,Zl.prototype.getSpace=function(){return null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space},Zl.prototype.group=null,Zl.prototype.cbTypes=null,Zl.prototype.cbSet=null,Zl.prototype.wrap_cbTypes=null,Zl.prototype.setupcbTypes=function(){this.wrap_cbTypes=Si.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=Q(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=Q(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0},Zl.prototype.wrap_cbTypes_subber=function(n){var t,e=n.zpp_inner;this.cbTypes.has(e)&&(null!=(t=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space)&&(this.dealloc_cbSet(),e.interactors.remove(this)),this.cbTypes.remove(e),null!=t&&(this.alloc_cbSet(),this.wake()))},Zl.prototype.wrap_cbTypes_adder=function(n){return this.insert_cbtype(n.zpp_inner),!1},Zl.prototype.insert_cbtype=function(n){if(!this.cbTypes.has(n)){var t=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=t&&(this.dealloc_cbSet(),n.interactors.add(this));for(var e=null,i=this.cbTypes.head;null!=i&&!(n.id<i.elt.id);)i=(e=i).next;var p,l=this.cbTypes;null==Ze.zpp_pool?p=new Ze:(p=Ze.zpp_pool,Ze.zpp_pool=p.next,p.next=null),p.elt=n;var r=p;null==e?(r.next=l.head,l.head=r):(r.next=e.next,e.next=r),l.pushmod=l.modified=!0,l.length++,null!=t&&(this.alloc_cbSet(),this.wake())}},Zl.prototype.alloc_cbSet=function(){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=(this.cbSet=n.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.interactors.add(this),this.cbSet.validate(),n.freshInteractorType(this))},Zl.prototype.dealloc_cbSet=function(){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;if(null!=this.cbSet){if(this.cbSet.interactors.remove(this),n.nullInteractorType(this),0==--this.cbSet.count){n.cbsets.remove(this.cbSet);var t=this.cbSet;for(t.listeners.clear(),t.zip_listeners=!0,t.bodylisteners.clear(),t.zip_bodylisteners=!0,t.conlisteners.clear(),t.zip_conlisteners=!0;null!=t.cbTypes.head;)t.cbTypes.pop_unsafe().cbsets.remove(t);t.next=Tl.zpp_pool,Tl.zpp_pool=t}this.cbSet=null}},Zl.prototype.setGroup=function(n){var t;this.group!=n&&((t=null!=(null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space))&&null!=this.group&&this.group.interactors.remove(this),this.group=n,t&&null!=n&&n.interactors.add(this),t&&(null!=this.ishape?this.ishape.body.wake():null!=this.ibody?this.ibody.wake():this.icompound.wake()))},Zl.prototype.immutable_midstep=function(n){null==this.ibody&&(null!=this.ishape?this.ishape.__immutable_midstep(n):this.icompound.__imutable_midstep(n))},Zl.prototype.lookup_group=function(){for(var n=this;null!=n&&null==n.group;)n=null!=n.ishape?n.ishape.body:null!=n.icompound?n.icompound.compound:n.ibody.compound;return null==n?null:n.group},Zl.prototype.copyto=function(n){n.zpp_inner_i.group=this.group;var t=this.outer_i;null==t.zpp_inner_i.wrap_cbTypes&&t.zpp_inner_i.setupcbTypes();var e=t.zpp_inner_i.wrap_cbTypes;e.zpp_inner.valmod();for(var i=qn.get(e);;){i.zpp_inner.zpp_inner.valmod();var p=i.zpp_inner;p.zpp_inner.valmod(),p.zpp_inner.zip_length&&(p.zpp_inner.zip_length=!1,p.zpp_inner.user_length=p.zpp_inner.inner.length);var l=p.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<l||(i.zpp_next=qn.zpp_pool,(qn.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);null==n.zpp_inner_i.wrap_cbTypes&&n.zpp_inner_i.setupcbTypes();var o=n.zpp_inner_i.wrap_cbTypes;o.zpp_inner.reverse_flag?o.push(r):o.unshift(r)}null!=this.userData&&(n.zpp_inner_i.userData=x.copy(this.userData))},Zl.prototype.__class__=Zl;var Yt=zpp_nape.phys.ZPP_Body=function(){var n;this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_aabb=!1,this.aabb=null,this.norotate=!1,this.sinertia=0,this.iinertia=0,this.cinertia=0,this.zip_inertia=!1,this.inertia=0,this.inertiaMode=0,this.zip_gravMassScale=!1,this.gravMassScale=0,this.gravMassMode=0,this.zip_gravMass=!1,this.gravMass=0,this.nomove=!1,this.cmass=0,this.smass=0,this.imass=0,this.massMode=0,this.zip_mass=!1,this.mass=0,this.zip_axis=!1,this.axisy=0,this.axisx=0,this.rot=0,this.pre_rot=0,this.kinangvel=0,this.torque=0,this.angvel=0,this.wrapcvel=null,this.wrap_svel=null,this.svely=0,this.svelx=0,this.wrap_kinvel=null,this.kinvely=0,this.kinvelx=0,this.wrap_force=null,this.forcey=0,this.forcex=0,this.wrap_vel=null,this.vely=0,this.velx=0,this.wrap_pos=null,this.posy=0,this.posx=0,this.pre_posy=0,this.pre_posx=0,this.disableCCD=!1,this.bulletEnabled=!1,this.bullet=!1,this.sweepRadius=0,this.sweepFrozen=!1,this.sweep_angvel=0,this.sweepTime=0,this.graph_depth=0,this.component=null,this.wrap_constraints=null,this.constraints=null,this.wrap_arbiters=null,this.arbiters=null,this.space=null,this.wrap_shapes=null,this.shapes=null,this.compound=null,this.type=0,this.world=!1,this.outer=null,Zl.call(this),(this.ibody=this).world=!1,this.bulletEnabled=!1,this.sweepTime=0,this.sweep_angvel=0,this.norotate=this.nomove=!1,this.disableCCD=!1,this.posx=0,this.posy=0,this.rot=0,this.axisx=0,this.axisy=1,this.svelx=0,this.svely=0,this.velx=0,this.vely=0,this.kinvelx=0,this.kinvely=0,this.forcex=0,this.forcey=0,this.torque=this.angvel=this.kinangvel=0,this.pre_posx=1/0,this.pre_posy=1/0,this.pre_rot=1/0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.zip_aabb=!0,null==Al.zpp_pool?n=new Al:(n=Al.zpp_pool,Al.zpp_pool=n.next,n.next=null),n.minx=0,n.miny=0,n.maxx=0,n.maxy=0,this.aabb=n,this.aabb._immutable=!0,this.aabb._validate=Q(this,this.aabb_validate),this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.arbiters=new fe,this.constraints=new In,this.shapes=new ce,this.wrap_shapes=Ni.get(this.shapes),this.wrap_shapes.zpp_inner.adder=Q(this,this.shapes_adder),this.wrap_shapes.zpp_inner.subber=Q(this,this.shapes_subber),this.wrap_shapes.zpp_inner._invalidate=Q(this,this.shapes_invalidate),this.kinematicDelaySleep=!1};Yt.__name__=["zpp_nape","phys","ZPP_Body"],Yt.__super__=Zl,Yt.prototype=Object.create(Zl.prototype),Yt.bodysetlt=function(n,t){return n.id<t.id},Yt.__static=function(){null==Ll.BodyType_STATIC&&(Ll.internal=!0,Ll.BodyType_STATIC=new rn,Ll.internal=!1);var n=new ln(Ll.BodyType_STATIC),t=n.zpp_inner;return t.world=!0,t.wrap_shapes.zpp_inner.immutable=!0,t.smass=t.imass=t.cmass=t.mass=t.gravMass=0,t.sinertia=t.iinertia=t.cinertia=t.inertia=0,t.cbTypes.clear(),n},Yt.prototype.outer=null,Yt.prototype.world=null,Yt.prototype.type=null,Yt.prototype.isStatic=function(){return 1==this.type},Yt.prototype.isDynamic=function(){return 2==this.type},Yt.prototype.isKinematic=function(){return 3==this.type},Yt.prototype.invalidate_type=function(){this.invalidate_mass(),this.invalidate_inertia()},Yt.prototype.compound=null,Yt.prototype.shapes=null,Yt.prototype.wrap_shapes=null,Yt.prototype.invalidate_shapes=function(){this.zip_aabb=!0,this.zip_localCOM=!0,this.zip_worldCOM=!0,this.invalidate_mass(),this.invalidate_inertia()},Yt.prototype.space=null,Yt.prototype.arbiters=null,Yt.prototype.wrap_arbiters=null,Yt.prototype.constraints=null,Yt.prototype.wrap_constraints=null,Yt.prototype.component=null,Yt.prototype.graph_depth=null,Yt.prototype.init_bodysetlist=function(){null==Yt.bodyset&&(Yt.bodyset=new Zi,Yt.bodyset.lt=Yt.bodysetlt,Yt.bodystack=new ve)},Yt.prototype.connectedBodies_cont=function(n){Yt.bodyset.try_insert_bool(n.zpp_inner)&&(Yt.bodystack.add(n.zpp_inner),n.zpp_inner.graph_depth=Yt.cur_graph_depth+1)},Yt.prototype.connectedBodies=function(n,t){null==Yt.bodyset&&(Yt.bodyset=new Zi,Yt.bodyset.lt=Yt.bodysetlt,Yt.bodystack=new ve);var e=null==t?new tn:t;for(Yt.bodystack.add(this),Yt.bodyset.insert(this),this.graph_depth=0;null!=Yt.bodystack.head;){var i=Yt.bodystack.pop_unsafe();if(i.graph_depth!=n){Yt.cur_graph_depth=i.graph_depth;for(var p=i.constraints.head;null!=p;)p.elt.outer.visitBodies(Q(this,this.connectedBodies_cont)),p=p.next}}var l=Yt.bodyset;if(null!=l.parent){for(var r,o,a,s,_=l.parent;null!=_;){_=null!=_.prev?_.prev:null!=_.next?_.next:((r=_.data)!=this&&(o=r.outer,e.zpp_inner.reverse_flag?e.push(o):e.unshift(o)),null!=(a=_.parent)&&(_==a.prev?a.prev=null:a.next=null,_.parent=null),(s=_).data=null,s.lt=null,s.swapped=null,s.next=Zi.zpp_pool,Zi.zpp_pool=s,a)}l.parent=null}return e},Yt.prototype.interactingBodies=function(n,t,e){null==Yt.bodyset&&(Yt.bodyset=new Zi,Yt.bodyset.lt=Yt.bodysetlt,Yt.bodystack=new ve);var i=null==e?new tn:e;for(Yt.bodyset.insert(this),Yt.bodystack.add(this),this.graph_depth=0;null!=Yt.bodystack.head;){var p=Yt.bodystack.pop_unsafe();if(p.graph_depth!=t)for(var l=p.arbiters.head;null!=l;){var r,o=l.elt;0!=(o.type&n)&&(r=o.b1==p?o.b2:o.b1,Yt.bodyset.try_insert_bool(r)&&(Yt.bodystack.add(r),r.graph_depth=p.graph_depth+1)),l=l.next}}var a=Yt.bodyset;if(null!=a.parent){for(var s,_,h,u,x=a.parent;null!=x;){x=null!=x.prev?x.prev:null!=x.next?x.next:((s=x.data)!=this&&(_=s.outer,i.zpp_inner.reverse_flag?i.push(_):i.unshift(_)),null!=(h=x.parent)&&(x==h.prev?h.prev=null:h.next=null,x.parent=null),(u=x).data=null,u.lt=null,u.swapped=null,u.next=Zi.zpp_pool,Zi.zpp_pool=u,h)}a.parent=null}return i},Yt.prototype.atRest=function(n){if(2!=this.type)return this.component.sleeping;var t,e,i,p,l,r,o,a,s,_=co.linearSleepThreshold;return _*=_,!(this.velx*this.velx+this.vely*this.vely>_)&&(t=this.posx,e=this.posy,s=a=0,!(.25*_*n*n<(a=t-this.pre_posx)*a+(s=e-this.pre_posy)*s)&&(p=i=0,l=(i=this.aabb.maxx-this.aabb.minx)*i+(p=this.aabb.maxy-this.aabb.miny)*p,r=co.angularSleepThreshold,r*=r,!(4*this.angvel*this.angvel*l>r)&&!(r*n*n<(o=this.rot-this.pre_rot)*o*l)))||(this.component.waket=this.space.stamp),this.component.waket+co.sleepDelay<this.space.stamp},Yt.prototype.refreshArbiters=function(){for(var n=this.arbiters.head;null!=n;)n.elt.invalidated=!0,n=n.next},Yt.prototype.sweepTime=null,Yt.prototype.sweep_angvel=null,Yt.prototype.sweepFrozen=null,Yt.prototype.sweepRadius=null,Yt.prototype.bullet=null,Yt.prototype.bulletEnabled=null,Yt.prototype.disableCCD=null,Yt.prototype.sweepIntegrate=function(n){var t,e,i,p,l,r=n-this.sweepTime;0!=r&&(this.sweepTime=n,this.posx+=this.velx*r,this.posy+=this.vely*r,0!=this.angvel&&(t=this.sweep_angvel*r,this.rot+=t,1e-4<t*t?(this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)):(p=1-(e=t*t)*e/8,l=((i=1-.5*e)*this.axisx+t*this.axisy)*p,this.axisy=(i*this.axisy-t*this.axisx)*p,this.axisx=l)))},Yt.prototype.sweepValidate=function(n){if(0==n.type)n.worldCOMx=this.posx+(this.axisy*n.localCOMx-this.axisx*n.localCOMy),n.worldCOMy=this.posy+(n.localCOMx*this.axisx+n.localCOMy*this.axisy);else{for(var t=n.polygon,e=t.lverts.next,i=t.gverts.next;null!=i;){var p=i,l=e,e=e.next;p.x=this.posx+(this.axisy*l.x-this.axisx*l.y),p.y=this.posy+(l.x*this.axisx+l.y*this.axisy),i=i.next}for(var r=t.edges.head,o=a=t.gverts.next,a=a.next;null!=a;){var s=a,_=r.elt,r=r.next;_.gnormx=this.axisy*_.lnormx-this.axisx*_.lnormy,_.gnormy=_.lnormx*this.axisx+_.lnormy*this.axisy,_.gprojection=this.posx*_.gnormx+this.posy*_.gnormy+_.lprojection,_.tp0=o.y*_.gnormx-o.x*_.gnormy,_.tp1=s.y*_.gnormx-s.x*_.gnormy,o=s,a=a.next}var h=t.gverts.next,u=r.elt;u.gnormx=this.axisy*u.lnormx-this.axisx*u.lnormy,u.gnormy=u.lnormx*this.axisx+u.lnormy*this.axisy,u.gprojection=this.posx*u.gnormx+this.posy*u.gnormy+u.lprojection,u.tp0=o.y*u.gnormx-o.x*u.gnormy,u.tp1=h.y*u.gnormx-h.x*u.gnormy}},Yt.prototype.pre_posx=null,Yt.prototype.pre_posy=null,Yt.prototype.posx=null,Yt.prototype.posy=null,Yt.prototype.wrap_pos=null,Yt.prototype.velx=null,Yt.prototype.vely=null,Yt.prototype.wrap_vel=null,Yt.prototype.forcex=null,Yt.prototype.forcey=null,Yt.prototype.wrap_force=null,Yt.prototype.kinvelx=null,Yt.prototype.kinvely=null,Yt.prototype.wrap_kinvel=null,Yt.prototype.svelx=null,Yt.prototype.svely=null,Yt.prototype.wrap_svel=null,Yt.prototype.invalidate_pos=function(){for(var n=this.shapes.head;null!=n;){var t=n.elt;1==t.type&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0},Yt.prototype.pos_invalidate=function(n){if(this.immutable_midstep("Body::position"),this.posx!=n.x||this.posy!=n.y){this.posx=n.x,this.posy=n.y;for(var t=this.shapes.head;null!=t;){var e=t.elt;1==e.type&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),t=t.next}this.zip_worldCOM=!0,this.wake()}},Yt.prototype.pos_validate=function(){this.wrap_pos.zpp_inner.x=this.posx,this.wrap_pos.zpp_inner.y=this.posy},Yt.prototype.vel_invalidate=function(n){this.velx=n.x,this.vely=n.y,this.wake()},Yt.prototype.vel_validate=function(){this.wrap_vel.zpp_inner.x=this.velx,this.wrap_vel.zpp_inner.y=this.vely},Yt.prototype.kinvel_invalidate=function(n){this.kinvelx=n.x,this.kinvely=n.y,this.wake()},Yt.prototype.kinvel_validate=function(){this.wrap_kinvel.zpp_inner.x=this.kinvelx,this.wrap_kinvel.zpp_inner.y=this.kinvely},Yt.prototype.svel_invalidate=function(n){this.svelx=n.x,this.svely=n.y,this.wake()},Yt.prototype.svel_validate=function(){this.wrap_svel.zpp_inner.x=this.svelx,this.wrap_svel.zpp_inner.y=this.svely},Yt.prototype.force_invalidate=function(n){this.forcex=n.x,this.forcey=n.y,this.wake()},Yt.prototype.force_validate=function(){this.wrap_force.zpp_inner.x=this.forcex,this.wrap_force.zpp_inner.y=this.forcey},Yt.prototype.setupPosition=function(){var n,t,e,i,p,l=this.posx,r=this.posy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_pos=n,this.wrap_pos.zpp_inner._inuse=!0,this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=Q(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=Q(this,this.pos_validate))},Yt.prototype.setupVelocity=function(){var n,t,e,i,p,l=this.velx,r=this.vely;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_vel=n,this.wrap_vel.zpp_inner._inuse=!0,this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=Q(this,this.vel_invalidate),this.wrap_vel.zpp_inner._validate=Q(this,this.vel_validate))},Yt.prototype.setupkinvel=function(){var n,t,e,i,p,l=this.kinvelx,r=this.kinvely;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_kinvel=n,this.wrap_kinvel.zpp_inner._inuse=!0,this.world?this.wrap_kinvel.zpp_inner._immutable=!0:(this.wrap_kinvel.zpp_inner._invalidate=Q(this,this.kinvel_invalidate),this.wrap_kinvel.zpp_inner._validate=Q(this,this.kinvel_validate))},Yt.prototype.setupsvel=function(){var n,t,e,i,p,l=this.svelx,r=this.svely;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_svel=n,this.wrap_svel.zpp_inner._inuse=!0,this.world?this.wrap_svel.zpp_inner._immutable=!0:(this.wrap_svel.zpp_inner._invalidate=Q(this,this.svel_invalidate),this.wrap_svel.zpp_inner._validate=Q(this,this.svel_validate))},Yt.prototype.setupForce=function(){var n,t,e,i,p,l=this.forcex,r=this.forcey;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_force=n,this.wrap_force.zpp_inner._inuse=!0,this.world?this.wrap_force.zpp_inner._immutable=!0:(this.wrap_force.zpp_inner._invalidate=Q(this,this.force_invalidate),this.wrap_force.zpp_inner._validate=Q(this,this.force_validate))},Yt.prototype.cvel_validate=function(){this.wrapcvel.zpp_inner.x=this.velx+this.kinvelx,this.wrapcvel.zpp_inner.y=this.vely+this.kinvely,this.wrapcvel.zpp_inner.z=this.angvel+this.kinangvel},Yt.prototype.wrapcvel=null,Yt.prototype.setup_cvel=function(){this.wrapcvel=X.get(),this.wrapcvel.zpp_inner.immutable=!0,this.wrapcvel.zpp_inner._validate=Q(this,this.cvel_validate)},Yt.prototype.angvel=null,Yt.prototype.torque=null,Yt.prototype.kinangvel=null,Yt.prototype.pre_rot=null,Yt.prototype.rot=null,Yt.prototype.invalidate_rot=function(){this.zip_axis=!0;for(var n=this.shapes.head;null!=n;){var t=n.elt;1==t.type&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0},Yt.prototype.axisx=null,Yt.prototype.axisy=null,Yt.prototype.zip_axis=null,Yt.prototype.validate_axis=function(){this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot))},Yt.prototype.quick_validate_axis=function(){this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)},Yt.prototype.delta_rot=function(n){var t,e,i,p;this.rot+=n,1e-4<n*n?(this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)):(i=1-(t=n*n)*t/8,p=((e=1-.5*t)*this.axisx+n*this.axisy)*i,this.axisy=(e*this.axisy-n*this.axisx)*i,this.axisx=p)},Yt.prototype.kinematicDelaySleep=null,Yt.prototype.mass=null,Yt.prototype.zip_mass=null,Yt.prototype.massMode=null,Yt.prototype.imass=null,Yt.prototype.smass=null,Yt.prototype.cmass=null,Yt.prototype.nomove=null,Yt.prototype.invalidate_mass=function(){this.zip_mass=!0,this.invalidate_gravMass()},Yt.prototype.validate_mass=function(){if(this.zip_mass||(this.massMode,0)){if(this.zip_mass=!1,0==this.massMode){this.cmass=0;for(var n=this.shapes.head;null!=n;){var t=n.elt;t.refmaterial.density=t.material.density,t.validate_area_inertia(),this.cmass+=t.area*t.material.density,n=n.next}}2!=this.type||this.nomove?(this.mass=1/0,this.imass=this.smass=0):(this.mass=this.cmass,this.imass=this.smass=1/this.mass)}},Yt.prototype.gravMass=null,Yt.prototype.zip_gravMass=null,Yt.prototype.gravMassMode=null,Yt.prototype.gravMassScale=null,Yt.prototype.zip_gravMassScale=null,Yt.prototype.invalidate_gravMass=function(){1!=this.gravMassMode&&(this.zip_gravMass=!0),2!=this.gravMassMode&&(this.zip_gravMassScale=!0),this.wake()},Yt.prototype.validate_gravMass=function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),0==this.gravMassMode?(this.validate_mass(),this.gravMass=this.cmass):2==this.gravMassMode&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},Yt.prototype.invalidate_gravMassScale=function(){2!=this.gravMassMode?this.zip_gravMassScale=!0:this.invalidate_gravMass()},Yt.prototype.validate_gravMassScale=function(){this.zip_gravMassScale&&(this.zip_gravMassScale=!1,0==this.gravMassMode?this.gravMassScale=1:1==this.gravMassMode&&(this.validate_mass(),this.gravMassScale=this.gravMass/this.cmass))},Yt.prototype.inertiaMode=null,Yt.prototype.inertia=null,Yt.prototype.zip_inertia=null,Yt.prototype.cinertia=null,Yt.prototype.iinertia=null,Yt.prototype.sinertia=null,Yt.prototype.norotate=null,Yt.prototype.invalidate_inertia=function(){this.zip_inertia=!0,this.wake()},Yt.prototype.validate_inertia=function(){if(this.zip_inertia||(this.inertiaMode,0)){if(this.zip_inertia=!1,0==this.inertiaMode){this.cinertia=0;for(var n=this.shapes.head;null!=n;){var t=n.elt;t.refmaterial.density=t.material.density,t.validate_area_inertia(),this.cinertia+=t.inertia*t.area*t.material.density,n=n.next}}2!=this.type||this.norotate?(this.inertia=1/0,this.sinertia=this.iinertia=0):(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia)}},Yt.prototype.invalidate_wake=function(){this.wake()},Yt.prototype.aabb=null,Yt.prototype.zip_aabb=null,Yt.prototype.validate_aabb=function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var n=this.shapes.head;null!=n;){var t=n.elt;if(t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var e=t.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var p=i.localCOMy=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var y=e.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var z=e.radius,c=e.radius;e.aabb.minx=e.worldCOMx-z,e.aabb.miny=e.worldCOMy-c,e.aabb.maxx=e.worldCOMx+z,e.aabb.maxy=e.worldCOMy+c}else{var v=t.polygon;if(v.zip_gverts&&null!=v.body){v.zip_gverts=!1,v.validate_lverts();var m=v.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot));for(var f=v.lverts.next,b=v.gverts.next;null!=b;){var g=b,w=f,f=f.next;g.x=v.body.posx+(v.body.axisy*w.x-v.body.axisx*w.y),g.y=v.body.posy+(w.x*v.body.axisx+w.y*v.body.axisy),b=b.next}}var M=v.gverts.next;v.aabb.minx=M.x,v.aabb.miny=M.y,v.aabb.maxx=M.x,v.aabb.maxy=M.y;for(var C=v.gverts.next.next;null!=C;){var k=C;k.x<v.aabb.minx&&(v.aabb.minx=k.x),k.x>v.aabb.maxx&&(v.aabb.maxx=k.x),k.y<v.aabb.miny&&(v.aabb.miny=k.y),k.y>v.aabb.maxy&&(v.aabb.maxy=k.y),C=C.next}}var O=this.aabb,P=t.aabb;P.minx<O.minx&&(O.minx=P.minx),P.maxx>O.maxx&&(O.maxx=P.maxx),P.miny<O.miny&&(O.miny=P.miny),P.maxy>O.maxy&&(O.maxy=P.maxy),n=n.next}}},Yt.prototype.invalidate_aabb=function(){this.zip_aabb=!0},Yt.prototype.localCOMx=null,Yt.prototype.localCOMy=null,Yt.prototype.zip_localCOM=null,Yt.prototype.worldCOMx=null,Yt.prototype.worldCOMy=null,Yt.prototype.zip_worldCOM=null,Yt.prototype.wrap_localCOM=null,Yt.prototype.wrap_worldCOM=null,Yt.prototype.invalidate_localCOM=function(){this.zip_localCOM=!0,this.zip_worldCOM=!0},Yt.prototype.invalidate_worldCOM=function(){this.zip_worldCOM=!0},Yt.prototype.validate_localCOM=function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var n,t=0,e=0,i=0,p=this.shapes.head;null!=p;){var l=p.elt;if(l.zip_localCOM){if(l.zip_localCOM=!1,1==l.type){var r=l.polygon;if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y,r.localCOMx+=r.lverts.next.next.x,r.localCOMy+=r.lverts.next.next.y,r.localCOMx*=.5,r.localCOMy*=.5;else{r.localCOMx=0;var o=r.localCOMy=0,a=r.lverts.next,s=a,_=a=a.next;for(a=a.next;null!=a;){var h=a;o+=_.x*(h.y-s.y);var u=h.y*_.x-h.x*_.y;r.localCOMx+=(_.x+h.x)*u,r.localCOMy+=(_.y+h.y)*u,s=_,_=h,a=a.next}var x=a=r.lverts.next;o+=_.x*(x.y-s.y);var d=x.y*_.x-x.x*_.y;r.localCOMx+=(_.x+x.x)*d,r.localCOMy+=(_.y+x.y)*d,s=_;var y=a=a.next;o+=x.x*(y.y-s.y);var z=y.y*x.x-y.x*x.y;r.localCOMx+=(x.x+y.x)*z,r.localCOMy+=(x.y+y.y)*z;var c=o=1/(3*o);r.localCOMx*=c,r.localCOMy*=c}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}l.validate_area_inertia();var v=l.area*l.material.density;t+=l.localCOMx*v,e+=l.localCOMy*v,i+=l.area*l.material.density,p=p.next}0!=i&&(n=1/i,this.localCOMx=t*n,this.localCOMy=e*n),null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy),this.zip_mass&&0==this.massMode&&(this.zip_mass=!1,this.cmass=i,2==this.type?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=1/0,this.imass=this.smass=0))}},Yt.prototype.validate_worldCOM=function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)),this.worldCOMx=this.posx+(this.axisy*this.localCOMx-this.axisx*this.localCOMy),this.worldCOMy=this.posy+(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},Yt.prototype.getlocalCOM=function(){this.validate_localCOM()},Yt.prototype.getworldCOM=function(){this.validate_worldCOM()},Yt.prototype.__immutable_midstep=function(n){},Yt.prototype.clear=function(){for(;null!=this.shapes.head;){var n=this.shapes.pop_unsafe();n.removedFromBody(),n.body=null}this.invalidate_shapes(),this.pre_posx=0,this.pre_posy=0,this.posx=0,this.posy=0,this.velx=0,this.vely=0,this.forcex=0,this.forcey=0,this.kinvelx=0,this.kinvely=0,this.svelx=0,this.svely=0,this.angvel=this.torque=this.kinangvel=this.pre_rot=this.rot=0;for(var t=this.shapes.head;null!=t;){var e=t.elt;1==e.type&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),t=t.next}this.zip_worldCOM=!0,this.zip_axis=!0;for(var i=this.shapes.head;null!=i;){var p=i.elt;1==p.type&&(p.polygon.invalidate_gverts(),p.polygon.invalidate_gaxi()),p.invalidate_worldCOM(),i=i.next}this.zip_worldCOM=!0,this.axisx=0,this.axisy=1,this.zip_axis=!1,this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.norotate=!1,this.nomove=!1},Yt.prototype.aabb_validate=function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var n=this.shapes.head;null!=n;){var t=n.elt;if(t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var e=t.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var p=i.localCOMy=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var y=e.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var z=e.radius,c=e.radius;e.aabb.minx=e.worldCOMx-z,e.aabb.miny=e.worldCOMy-c,e.aabb.maxx=e.worldCOMx+z,e.aabb.maxy=e.worldCOMy+c}else{var v=t.polygon;if(v.zip_gverts&&null!=v.body){v.zip_gverts=!1,v.validate_lverts();var m=v.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot));for(var f=v.lverts.next,b=v.gverts.next;null!=b;){var g=b,w=f,f=f.next;g.x=v.body.posx+(v.body.axisy*w.x-v.body.axisx*w.y),g.y=v.body.posy+(w.x*v.body.axisx+w.y*v.body.axisy),b=b.next}}var M=v.gverts.next;v.aabb.minx=M.x,v.aabb.miny=M.y,v.aabb.maxx=M.x,v.aabb.maxy=M.y;for(var C=v.gverts.next.next;null!=C;){var k=C;k.x<v.aabb.minx&&(v.aabb.minx=k.x),k.x>v.aabb.maxx&&(v.aabb.maxx=k.x),k.y<v.aabb.miny&&(v.aabb.miny=k.y),k.y>v.aabb.maxy&&(v.aabb.maxy=k.y),C=C.next}}var O=this.aabb,P=t.aabb;P.minx<O.minx&&(O.minx=P.minx),P.maxx>O.maxx&&(O.maxx=P.maxx),P.miny<O.miny&&(O.miny=P.miny),P.maxy>O.maxy&&(O.maxy=P.maxy),n=n.next}}},Yt.prototype.shapes_adder=function(n){return n.zpp_inner.body!=this&&(null!=n.zpp_inner.body&&n.zpp_inner.body.wrap_shapes.remove(n),n.zpp_inner.body=this,n.zpp_inner.addedToBody(),null!=this.space&&(t=this.space,(i=(e=n.zpp_inner).body).world||(i.component.waket=t.stamp+(t.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&t.really_wake(i,!1)),t.bphase.insert(e),e.addedToSpace()),1==n.zpp_inner.type&&(n.zpp_inner.polygon.invalidate_gaxi(),n.zpp_inner.polygon.invalidate_gverts()),!0);var t,e,i},Yt.prototype.shapes_subber=function(n){null!=this.space&&this.space.removed_shape(n.zpp_inner),n.zpp_inner.body=null,n.zpp_inner.removedFromBody()},Yt.prototype.shapes_invalidate=function(n){this.invalidate_shapes()},Yt.prototype.addedToSpace=function(){null==re.zpp_pool?this.component=new re:(this.component=re.zpp_pool,re.zpp_pool=this.component.next,this.component.next=null),this.component.isBody=!0,(this.component.body=this).__iaddedToSpace()},Yt.prototype.removedFromSpace=function(){for(;null!=this.arbiters.head;){var n=this.arbiters.pop_unsafe();if(n.cleared=!0,n.b2==this)for(var t,e,i=n.b1.arbiters,p=null,l=i.head;null!=l;){if(l.elt==n){null==p?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=p.next).next,null==(p.next=e)&&(i.pushmod=!0));var r=t;r.elt=null,r.next=Gl.zpp_pool,Gl.zpp_pool=r,i.modified=!0,i.length--,i.pushmod=!0;break}l=(p=l).next}if(n.b1==this)for(var o,a,s=n.b2.arbiters,_=null,h=s.head;null!=h;){if(h.elt==n){null==_?(a=(o=s.head).next,s.head=a,null==s.head&&(s.pushmod=!0)):(a=(o=_.next).next,null==(_.next=a)&&(s.pushmod=!0));var u=o;u.elt=null,u.next=Gl.zpp_pool,Gl.zpp_pool=u,s.modified=!0,s.length--,s.pushmod=!0;break}h=(_=h).next}null!=n.pair&&(n.pair.arb=null,n.pair=null),n.active=!1,this.space.f_arbiters.modified=!0}var x=this.component;x.body=null,x.constraint=null,x.next=re.zpp_pool,re.zpp_pool=x,this.component=null,this.__iremovedFromSpace()},Yt.prototype.copy=function(){var n=(new ln).zpp_inner;n.type=this.type,n.bulletEnabled=this.bulletEnabled,n.disableCCD=this.disableCCD;for(var t=this.shapes.head;null!=t;){var e=n.outer.zpp_inner.wrap_shapes,i=t.elt.outer.copy();e.zpp_inner.reverse_flag?e.push(i):e.unshift(i),t=t.next}if(n.posx=this.posx,n.posy=this.posy,n.velx=this.velx,n.vely=this.vely,n.forcex=this.forcex,n.forcey=this.forcey,n.rot=this.rot,n.angvel=this.angvel,n.torque=this.torque,n.kinvelx=this.kinvelx,n.kinvely=this.kinvely,n.kinangvel=this.kinangvel,n.svelx=this.svelx,n.svely=this.svely,this.zip_axis){n.zip_axis=!0;for(var p=n.shapes.head;null!=p;){var l=p.elt;1==l.type&&(l.polygon.invalidate_gverts(),l.polygon.invalidate_gaxi()),l.invalidate_worldCOM(),p=p.next}n.zip_worldCOM=!0}else n.axisx=this.axisx,n.axisy=this.axisy;return n.rot=this.rot,n.massMode=this.massMode,n.gravMassMode=this.gravMassMode,n.inertiaMode=this.inertiaMode,n.norotate=this.norotate,n.nomove=this.nomove,n.cmass=this.cmass,n.cinertia=this.cinertia,this.zip_mass?n.invalidate_mass():n.mass=this.mass,this.zip_gravMass?n.invalidate_gravMass():n.gravMass=this.gravMass,this.zip_gravMassScale?n.invalidate_gravMassScale():n.gravMassScale=this.gravMassScale,this.zip_inertia?n.invalidate_inertia():n.inertia=this.inertia,this.zip_aabb?n.zip_aabb=!0:(n.aabb.minx=this.aabb.minx,n.aabb.miny=this.aabb.miny,n.aabb.maxx=this.aabb.maxx,n.aabb.maxy=this.aabb.maxy),this.zip_localCOM?(n.zip_localCOM=!0,n.zip_worldCOM=!0):(n.localCOMx=this.localCOMx,n.localCOMy=this.localCOMy),this.zip_worldCOM?n.zip_worldCOM=!0:(n.worldCOMx=this.worldCOMx,n.worldCOMy=this.worldCOMy),this.copyto(n.outer),n.outer},Yt.prototype.__class__=Yt;var Jt=zpp_nape.phys.ZPP_Compound=function(){this.space=null,this.compound=null,this.depth=0,this.wrap_compounds=null,this.wrap_constraints=null,this.wrap_bodies=null,this.compounds=null,this.constraints=null,this.bodies=null,this.outer=null,Zl.call(this),(this.icompound=this).depth=1,this.bodies=new ve,this.wrap_bodies=vi.get(this.bodies),this.wrap_bodies.zpp_inner.adder=Q(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=Q(this,this.bodies_subber),this.constraints=new In,this.wrap_constraints=ci.get(this.constraints),this.wrap_constraints.zpp_inner.adder=Q(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=Q(this,this.constraints_subber),this.compounds=new me,this.wrap_compounds=Oi.get(this.compounds),this.wrap_compounds.zpp_inner.adder=Q(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=Q(this,this.compounds_subber)};Jt.__name__=["zpp_nape","phys","ZPP_Compound"],Jt.__super__=Zl,Jt.prototype=Object.create(Zl.prototype),Jt.prototype.outer=null,Jt.prototype.bodies=null,Jt.prototype.constraints=null,Jt.prototype.compounds=null,Jt.prototype.wrap_bodies=null,Jt.prototype.wrap_constraints=null,Jt.prototype.wrap_compounds=null,Jt.prototype.depth=null,Jt.prototype.compound=null,Jt.prototype.space=null,Jt.prototype.__imutable_midstep=function(n){},Jt.prototype.addedToSpace=function(){this.__iaddedToSpace()},Jt.prototype.removedFromSpace=function(){this.__iremovedFromSpace()},Jt.prototype.breakApart=function(){for(null!=this.space&&(this.__iremovedFromSpace(),this.space.nullInteractorType(this)),null!=this.compound?this.compound.compounds.remove(this):null!=this.space&&this.space.compounds.remove(this);null!=this.bodies.head;){var n=this.bodies.pop_unsafe();null!=(n.compound=this.compound)?this.compound.bodies.add(n):null!=this.space&&this.space.bodies.add(n),null!=this.space&&this.space.freshInteractorType(n)}for(;null!=this.constraints.head;){var t=this.constraints.pop_unsafe();null!=(t.compound=this.compound)?this.compound.constraints.add(t):null!=this.space&&this.space.constraints.add(t)}for(;null!=this.compounds.head;){var e=this.compounds.pop_unsafe();null!=(e.compound=this.compound)?this.compound.compounds.add(e):null!=this.space&&this.space.compounds.add(e),null!=this.space&&this.space.freshInteractorType(e)}this.compound=null,this.space=null},Jt.prototype.bodies_adder=function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_bodies.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_bodies.remove(n),null!=(n.zpp_inner.compound=this).space&&this.space.addBody(n.zpp_inner),!0)},Jt.prototype.bodies_subber=function(n){(n.zpp_inner.compound=null)!=this.space&&this.space.remBody(n.zpp_inner)},Jt.prototype.constraints_adder=function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_constraints.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_constraints.remove(n),null!=(n.zpp_inner.compound=this).space&&this.space.addConstraint(n.zpp_inner),!0)},Jt.prototype.constraints_subber=function(n){(n.zpp_inner.compound=null)!=this.space&&this.space.remConstraint(n.zpp_inner)},Jt.prototype.compounds_adder=function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_compounds.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_compounds.remove(n),n.zpp_inner.compound=this,n.zpp_inner.depth=this.depth+1,null!=this.space&&this.space.addCompound(n.zpp_inner),!0)},Jt.prototype.compounds_subber=function(n){n.zpp_inner.compound=null,n.zpp_inner.depth=1,null!=this.space&&this.space.remCompound(n.zpp_inner)},Jt.prototype.copy=function(n,t){var e=null==n;null==n&&(n=[]),null==t&&(t=[]);for(var i=new en,p=this.compounds.head;null!=p;){var l,r=p.elt.copy(n,t);r.zpp_inner.immutable_midstep("Compound::compound"),(null==r.zpp_inner.compound?null:r.zpp_inner.compound.outer)!=i&&(null!=(null==r.zpp_inner.compound?null:r.zpp_inner.compound.outer)&&(null==r.zpp_inner.compound?null:r.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(r),null!=i&&((l=i.zpp_inner.wrap_compounds).zpp_inner.reverse_flag?l.push(r):l.unshift(r))),p=p.next}for(var o=this.bodies.head;null!=o;){var a,s=o.elt,_=s.outer.copy();n.push(lt.dict(s.id,_)),(null==_.zpp_inner.compound?null:_.zpp_inner.compound.outer)!=i&&(null!=(null==_.zpp_inner.compound?null:_.zpp_inner.compound.outer)&&(null==_.zpp_inner.compound?null:_.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(_),null!=i&&((a=i.zpp_inner.wrap_bodies).zpp_inner.reverse_flag?a.push(_):a.unshift(_))),o=o.next}for(var h=this.constraints.head;null!=h;){var u,x=h.elt.copy(n,t);(null==x.zpp_inner.compound?null:x.zpp_inner.compound.outer)!=i&&(null!=(null==x.zpp_inner.compound?null:x.zpp_inner.compound.outer)&&(null==x.zpp_inner.compound?null:x.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(x),null!=i&&((u=i.zpp_inner.wrap_constraints).zpp_inner.reverse_flag?u.push(x):u.unshift(x))),h=h.next}if(e)for(;0<t.length;)for(var d=t.pop(),y=0;y<n.length;){var z=n[y];if(++y,z.id==d.id){d.cb(z.bc);break}}return this.copyto(i),i},Jt.prototype.__class__=Jt;var Xt=zpp_nape.phys.ZPP_FluidProperties=function(){this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.density=0,this.viscosity=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ce,this.density=this.viscosity=1,this.wrap_gravity=null,this.gravityx=0,this.gravityy=0};Xt.__name__=["zpp_nape","phys","ZPP_FluidProperties"],Xt.prototype.next=null,Xt.prototype.userData=null,Xt.prototype.outer=null,Xt.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new an,(n=this.outer.zpp_inner).outer=null,n.next=Xt.zpp_pool,Xt.zpp_pool=n,this.outer.zpp_inner=this),this.outer},Xt.prototype.free=function(){this.outer=null},Xt.prototype.alloc=function(){},Xt.prototype.shapes=null,Xt.prototype.wrap_shapes=null,Xt.prototype.feature_cons=function(){this.shapes=new ce},Xt.prototype.addShape=function(n){this.shapes.add(n)},Xt.prototype.remShape=function(n){this.shapes.remove(n)},Xt.prototype.copy=function(){var n;return null==Xt.zpp_pool?n=new Xt:(n=Xt.zpp_pool,Xt.zpp_pool=n.next,n.next=null),n.viscosity=this.viscosity,n.density=this.density,n},Xt.prototype.viscosity=null,Xt.prototype.density=null,Xt.prototype.gravityx=null,Xt.prototype.gravityy=null,Xt.prototype.wrap_gravity=null,Xt.prototype.gravity_invalidate=function(n){this.gravityx=n.x,this.gravityy=n.y,this.invalidate()},Xt.prototype.gravity_validate=function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},Xt.prototype.getgravity=function(){var n,t,e,i,p,l=this.gravityx,r=this.gravityy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_gravity=n,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=Q(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=Q(this,this.gravity_validate)},Xt.prototype.invalidate=function(){for(var n=this.shapes.head;null!=n;)n.elt.invalidate_fluidprops(),n=n.next},Xt.prototype.__class__=Xt;var Ht=zpp_nape.phys.ZPP_Material=function(){this.rollingFriction=0,this.elasticity=0,this.density=0,this.staticFriction=0,this.dynamicFriction=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ce,this.elasticity=0,this.dynamicFriction=1,this.staticFriction=2,this.density=.001,this.rollingFriction=.01};Ht.__name__=["zpp_nape","phys","ZPP_Material"],Ht.prototype.next=null,Ht.prototype.userData=null,Ht.prototype.outer=null,Ht.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new xn,(n=this.outer.zpp_inner).outer=null,n.next=Ht.zpp_pool,Ht.zpp_pool=n,this.outer.zpp_inner=this),this.outer},Ht.prototype.free=function(){this.outer=null},Ht.prototype.alloc=function(){},Ht.prototype.shapes=null,Ht.prototype.wrap_shapes=null,Ht.prototype.feature_cons=function(){this.shapes=new ce},Ht.prototype.addShape=function(n){this.shapes.add(n)},Ht.prototype.remShape=function(n){this.shapes.remove(n)},Ht.prototype.dynamicFriction=null,Ht.prototype.staticFriction=null,Ht.prototype.density=null,Ht.prototype.elasticity=null,Ht.prototype.rollingFriction=null,Ht.prototype.copy=function(){var n=new Ht;return n.dynamicFriction=this.dynamicFriction,n.staticFriction=this.staticFriction,n.density=this.density,n.elasticity=this.elasticity,n.rollingFriction=this.rollingFriction,n},Ht.prototype.set=function(n){this.dynamicFriction=n.dynamicFriction,this.staticFriction=n.staticFriction,this.density=n.density,this.elasticity=n.elasticity,this.rollingFriction=n.rollingFriction},Ht.prototype.invalidate=function(n){for(var t=this.shapes.head;null!=t;)t.elt.invalidate_material(n),t=t.next},Ht.prototype.__class__=Ht;var $t=zpp_nape.shape.ZPP_Shape=function(n){var t;this.zip_aabb=!1,this.aabb=null,this.pairs=null,this.node=null,this.sweep=null,this.sensorEnabled=!1,this.fluidEnabled=!1,this.fluidProperties=null,this.filter=null,this.material=null,this.refmaterial=null,this.polygon=null,this.circle=null,this.sweepCoef=0,this.zip_sweepRadius=!1,this.sweepRadius=0,this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_angDrag=!1,this.angDrag=0,this.inertia=0,this.zip_area_inertia=!1,this.area=0,this.type=0,this.body=null,this.outer=null,Zl.call(this),this.pairs=new Pe,(this.ishape=this).type=n,null==Al.zpp_pool?t=new Al:(t=Al.zpp_pool,Al.zpp_pool=t.next,t.next=null),t.minx=0,t.miny=0,t.maxx=0,t.maxy=0,this.aabb=t,this.aabb._immutable=!0,this.aabb._validate=Q(this,this.aabb_validate),this.zip_area_inertia=this.zip_angDrag=this.zip_localCOM=this.zip_sweepRadius=!0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.fluidEnabled=!1,this.sensorEnabled=!1,this.fluidProperties=null,this.body=null,this.refmaterial=new Ht,this.sweepRadius=this.sweepCoef=0};$t.__name__=["zpp_nape","shape","ZPP_Shape"],$t.__super__=Zl,$t.prototype=Object.create(Zl.prototype),$t.prototype.outer=null,$t.prototype.body=null,$t.prototype.type=null,$t.prototype.isCircle=function(){return 0==this.type},$t.prototype.isPolygon=function(){return 1==this.type},$t.prototype.area=null,$t.prototype.zip_area_inertia=null,$t.prototype.inertia=null,$t.prototype.angDrag=null,$t.prototype.zip_angDrag=null,$t.prototype.localCOMx=null,$t.prototype.localCOMy=null,$t.prototype.zip_localCOM=null,$t.prototype.worldCOMx=null,$t.prototype.worldCOMy=null,$t.prototype.zip_worldCOM=null,$t.prototype.wrap_localCOM=null,$t.prototype.wrap_worldCOM=null,$t.prototype.sweepRadius=null,$t.prototype.zip_sweepRadius=null,$t.prototype.sweepCoef=null,$t.prototype.invalidate_sweepRadius=function(){this.zip_sweepRadius=!0},$t.prototype.validate_sweepRadius=function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,0==this.type?this.circle.__validate_sweepRadius():this.polygon.__validate_sweepRadius())},$t.prototype.circle=null,$t.prototype.polygon=null,$t.prototype.refmaterial=null,$t.prototype.material=null,$t.prototype.filter=null,$t.prototype.fluidProperties=null,$t.prototype.fluidEnabled=null,$t.prototype.sensorEnabled=null,$t.prototype.sweep=null,$t.prototype.node=null,$t.prototype.pairs=null,$t.prototype.clear=function(){0==this.type?this.circle.__clear():this.polygon.__clear()},$t.prototype.aabb=null,$t.prototype.zip_aabb=null,$t.prototype.validate_aabb=function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var n=this.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var t=n.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i;e+=l.x*(r.y-p.y);var o=r.y*l.x-r.x*l.y;t.localCOMx+=(l.x+r.x)*o,t.localCOMy+=(l.y+r.y)*o,p=l,l=r,i=i.next}var a=i=t.lverts.next;e+=l.x*(a.y-p.y);var s=a.y*l.x-a.x*l.y;t.localCOMx+=(l.x+a.x)*s,t.localCOMy+=(l.y+a.y)*s,p=l;var _=i=i.next;e+=a.x*(_.y-p.y);var h=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*h,t.localCOMy+=(a.y+_.y)*h;var u=e=1/(3*e);t.localCOMx*=u,t.localCOMy*=u}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var x=n.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var d=n.radius,y=n.radius;n.aabb.minx=n.worldCOMx-d,n.aabb.miny=n.worldCOMy-y,n.aabb.maxx=n.worldCOMx+d,n.aabb.maxy=n.worldCOMy+y}else{var z=this.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var c=z.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var v=z.lverts.next,m=z.gverts.next;null!=m;){var f=m,b=v,v=v.next;f.x=z.body.posx+(z.body.axisy*b.x-z.body.axisx*b.y),f.y=z.body.posy+(b.x*z.body.axisx+b.y*z.body.axisy),m=m.next}}var g=z.gverts.next;z.aabb.minx=g.x,z.aabb.miny=g.y,z.aabb.maxx=g.x,z.aabb.maxy=g.y;for(var w=z.gverts.next.next;null!=w;){var M=w;M.x<z.aabb.minx&&(z.aabb.minx=M.x),M.x>z.aabb.maxx&&(z.aabb.maxx=M.x),M.y<z.aabb.miny&&(z.aabb.miny=M.y),M.y>z.aabb.maxy&&(z.aabb.maxy=M.y),w=w.next}}},$t.prototype.force_validate_aabb=function(){if(0==this.type){var n=this.circle;n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy),n.aabb.minx=n.worldCOMx-n.radius,n.aabb.miny=n.worldCOMy-n.radius,n.aabb.maxx=n.worldCOMx+n.radius,n.aabb.maxy=n.worldCOMy+n.radius}else{var t=this.polygon,e=t.lverts.next,i=t.gverts.next,p=e;e=e.next,i.x=t.body.posx+(t.body.axisy*p.x-t.body.axisx*p.y),i.y=t.body.posy+(p.x*t.body.axisx+p.y*t.body.axisy),t.aabb.minx=i.x,t.aabb.miny=i.y,t.aabb.maxx=i.x,t.aabb.maxy=i.y;for(var l=t.gverts.next.next;null!=l;){var r=l,o=e,e=e.next;r.x=t.body.posx+(t.body.axisy*o.x-t.body.axisx*o.y),r.y=t.body.posy+(o.x*t.body.axisx+o.y*t.body.axisy),r.x<t.aabb.minx&&(t.aabb.minx=r.x),r.x>t.aabb.maxx&&(t.aabb.maxx=r.x),r.y<t.aabb.miny&&(t.aabb.miny=r.y),r.y>t.aabb.maxy&&(t.aabb.maxy=r.y),l=l.next}}},$t.prototype.invalidate_aabb=function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},$t.prototype.validate_area_inertia=function(){this.zip_area_inertia&&(this.zip_area_inertia=!1,0==this.type?this.circle.__validate_area_inertia():this.polygon.__validate_area_inertia())},$t.prototype.validate_angDrag=function(){!this.zip_angDrag&&this.refmaterial.dynamicFriction==this.material.dynamicFriction||(this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,0==this.type?this.circle.__validate_angDrag():this.polygon.__validate_angDrag())},$t.prototype.validate_localCOM=function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var t=n.localCOMy=0,e=n.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e;t+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,e=e.next}var o=e=n.lverts.next;t+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=e=e.next;t+=o.x*(s.y-i.y);var _=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*_,n.localCOMy+=(o.y+s.y)*_;var h=t=1/(3*t);n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},$t.prototype.validate_worldCOM=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var t=n.localCOMy=0,e=n.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e;t+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,e=e.next}var o=e=n.lverts.next;t+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=e=e.next;t+=o.x*(s.y-i.y);var _=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*_,n.localCOMy+=(o.y+s.y)*_;var h=t=1/(3*t);n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}},$t.prototype.getworldCOM=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var t=n.localCOMy=0,e=n.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e;t+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,e=e.next}var o=e=n.lverts.next;t+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=e=e.next;t+=o.x*(s.y-i.y);var _=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*_,n.localCOMy+=(o.y+s.y)*_;var h=t=1/(3*t);n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy},$t.prototype.invalidate_area_inertia=function(){var n;this.zip_area_inertia=!0,null!=this.body&&((n=this.body).zip_localCOM=!0,n.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia())},$t.prototype.invalidate_angDrag=function(){this.zip_angDrag=!0},$t.prototype.invalidate_localCOM=function(){var n;this.zip_localCOM=!0,this.invalidate_area_inertia(),0==this.type&&(this.zip_sweepRadius=!0),this.invalidate_angDrag(),this.invalidate_worldCOM(),null!=this.body&&((n=this.body).zip_localCOM=!0,n.zip_worldCOM=!0)},$t.prototype.invalidate_worldCOM=function(){this.zip_worldCOM=!0,this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},$t.prototype.invalidate_material=function(n){var t;0!=(n&Ht.WAKE)&&this.wake(),0!=(n&Ht.ARBITERS)&&null!=this.body&&this.body.refreshArbiters(),0!=(n&Ht.PROPS)&&null!=this.body&&((t=this.body).zip_localCOM=!0,t.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()),0!=(n&Ht.ANGDRAG)&&this.invalidate_angDrag(),this.refmaterial.set(this.material)},$t.prototype.invalidate_filter=function(){this.wake()},$t.prototype.invalidate_fluidprops=function(){this.fluidEnabled&&this.wake()},$t.prototype.aabb_validate=function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var n=this.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var t=n.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i;e+=l.x*(r.y-p.y);var o=r.y*l.x-r.x*l.y;t.localCOMx+=(l.x+r.x)*o,t.localCOMy+=(l.y+r.y)*o,p=l,l=r,i=i.next}var a=i=t.lverts.next;e+=l.x*(a.y-p.y);var s=a.y*l.x-a.x*l.y;t.localCOMx+=(l.x+a.x)*s,t.localCOMy+=(l.y+a.y)*s,p=l;var _=i=i.next;e+=a.x*(_.y-p.y);var h=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*h,t.localCOMy+=(a.y+_.y)*h;var u=e=1/(3*e);t.localCOMx*=u,t.localCOMy*=u}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var x=n.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var d=n.radius,y=n.radius;n.aabb.minx=n.worldCOMx-d,n.aabb.miny=n.worldCOMy-y,n.aabb.maxx=n.worldCOMx+d,n.aabb.maxy=n.worldCOMy+y}else{var z=this.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var c=z.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var v=z.lverts.next,m=z.gverts.next;null!=m;){var f=m,b=v,v=v.next;f.x=z.body.posx+(z.body.axisy*b.x-z.body.axisx*b.y),f.y=z.body.posy+(b.x*z.body.axisx+b.y*z.body.axisy),m=m.next}}var g=z.gverts.next;z.aabb.minx=g.x,z.aabb.miny=g.y,z.aabb.maxx=g.x,z.aabb.maxy=g.y;for(var w=z.gverts.next.next;null!=w;){var M=w;M.x<z.aabb.minx&&(z.aabb.minx=M.x),M.x>z.aabb.maxx&&(z.aabb.maxx=M.x),M.y<z.aabb.miny&&(z.aabb.miny=M.y),M.y>z.aabb.maxy&&(z.aabb.maxy=M.y),w=w.next}}},$t.prototype.setMaterial=function(n){this.material!=n&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},$t.prototype.setFilter=function(n){this.filter!=n&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),this.filter=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.wake())},$t.prototype.setFluid=function(n){this.fluidProperties!=n&&(null!=this.body&&null!=this.body.space&&null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this),this.fluidProperties=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.fluidEnabled&&this.wake())},$t.prototype.__immutable_midstep=function(n){},$t.prototype.addedToBody=function(){this.invalidate_worldCOM(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},$t.prototype.removedFromBody=function(){},$t.prototype.addedToSpace=function(){this.__iaddedToSpace(),this.material.shapes.add(this),this.filter.shapes.add(this),null!=this.fluidProperties&&this.fluidProperties.shapes.add(this)},$t.prototype.removedFromSpace=function(){this.__iremovedFromSpace(),this.material.shapes.remove(this),this.filter.shapes.remove(this),null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this)},$t.prototype.copy=function(){var n=null,n=0==this.type?this.circle.__copy():this.polygon.__copy();this.zip_area_inertia?n.invalidate_area_inertia():(n.area=this.area,n.inertia=this.inertia),this.zip_sweepRadius?n.zip_sweepRadius=!0:(n.sweepRadius=this.sweepRadius,n.sweepCoef=this.sweepCoef),this.zip_angDrag?n.invalidate_angDrag():n.angDrag=this.angDrag,this.zip_aabb?(n.zip_aabb=!0,null!=n.body&&(n.body.zip_aabb=!0)):(n.aabb.minx=this.aabb.minx,n.aabb.miny=this.aabb.miny,n.aabb.maxx=this.aabb.maxx,n.aabb.maxy=this.aabb.maxy);var t=n.material;t.outer=null,t.next=Ht.zpp_pool,Ht.zpp_pool=t;var e=n.filter;return e.outer=null,e.next=vt.zpp_pool,vt.zpp_pool=e,n.material=this.material,n.filter=this.filter,null!=this.fluidProperties&&(n.fluidProperties=this.fluidProperties),n.fluidEnabled=this.fluidEnabled,n.sensorEnabled=this.sensorEnabled,null!=this.userData&&(n.userData=x.copy(this.userData)),this.copyto(n.outer),n.outer},$t.prototype.__class__=$t;var Qt=zpp_nape.shape.ZPP_Circle=function(){this.radius=0,this.outer_zn=null,$t.call(this,0),(this.circle=this).zip_localCOM=!1};Qt.__name__=["zpp_nape","shape","ZPP_Circle"],Qt.__super__=$t,Qt.prototype=Object.create($t.prototype),Qt.prototype.outer_zn=null,Qt.prototype.radius=null,Qt.prototype.__clear=function(){},Qt.prototype.invalidate_radius=function(){this.invalidate_area_inertia(),this.invalidate_angDrag(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),null!=this.body&&this.body.wake()},Qt.prototype.localCOM_validate=function(){this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy},Qt.prototype.localCOM_invalidate=function(n){this.localCOMx=n.x,this.localCOMy=n.y,this.invalidate_localCOM(),null!=this.body&&this.body.wake()},Qt.prototype.setupLocalCOM=function(){var n,t,e,i,p,l=this.localCOMx,r=this.localCOMy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_localCOM=n,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=Q(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=Q(this,this.localCOM_invalidate)},Qt.prototype.__validate_aabb=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var t=n.localCOMy=0,e=n.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e;t+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,e=e.next}var o=e=n.lverts.next;t+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=e=e.next;t+=o.x*(s.y-i.y);var _=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*_,n.localCOMy+=(o.y+s.y)*_;var h=t=1/(3*t);n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}var x=this.radius,d=this.radius;this.aabb.minx=this.worldCOMx-x,this.aabb.miny=this.worldCOMy-d,this.aabb.maxx=this.worldCOMx+x,this.aabb.maxy=this.worldCOMy+d},Qt.prototype._force_validate_aabb=function(){this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy),this.aabb.minx=this.worldCOMx-this.radius,this.aabb.miny=this.worldCOMy-this.radius,this.aabb.maxx=this.worldCOMx+this.radius,this.aabb.maxy=this.worldCOMy+this.radius},Qt.prototype.__validate_sweepRadius=function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy),this.sweepRadius=this.sweepCoef+this.radius},Qt.prototype.__validate_area_inertia=function(){var n=this.radius*this.radius;this.area=n*Math.PI,this.inertia=.5*n+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},Qt.prototype.__validate_angDrag=function(){var n=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,t=this.radius*this.radius;this.angDrag=(n+2*t)*(this.material.dynamicFriction*co.fluidAngularDragFriction)+.5*co.fluidAngularDrag*(1+co.fluidVacuumDrag)*n,this.angDrag/=2*(n+.5*t)},Qt.prototype.__scale=function(n,t){var e=((n<0?-n:n)+(t<0?-t:t))/2;this.radius*=e<0?-e:e,this.invalidate_radius(),0<this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy&&(this.localCOMx*=n,this.localCOMy*=t,this.invalidate_localCOM())},Qt.prototype.__translate=function(n,t){this.localCOMx+=n,this.localCOMy+=t,this.invalidate_localCOM()},Qt.prototype.__rotate=function(n,t){var e,i;0<this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy&&(i=e=0,e=t*this.localCOMx-n*this.localCOMy,i=this.localCOMx*n+this.localCOMy*t,this.localCOMx=e,this.localCOMy=i,this.invalidate_localCOM())},Qt.prototype.__transform=function(n){var t=n.zpp_inner.a*n.zpp_inner.d-n.zpp_inner.b*n.zpp_inner.c;t<0&&(t=-t),this.radius*=Math.sqrt(t);var e=n.zpp_inner.a*this.localCOMx+n.zpp_inner.b*this.localCOMy+n.zpp_inner.tx;this.localCOMy=n.zpp_inner.c*this.localCOMx+n.zpp_inner.d*this.localCOMy+n.zpp_inner.ty,this.localCOMx=e,this.invalidate_radius(),this.invalidate_localCOM()},Qt.prototype.__copy=function(){var n=new dn(this.radius).zpp_inner_zn;return n.localCOMx=this.localCOMx,n.localCOMy=this.localCOMy,n.zip_localCOM=!1,n},Qt.prototype.__class__=Qt;var ne=zpp_nape.shape.ZPP_Edge=function(){this.tp1=0,this.tp0=0,this.gp1=null,this.lp1=null,this.gp0=null,this.lp0=null,this.gprojection=0,this.lprojection=0,this.length=0,this.wrap_gnorm=null,this.gnormy=0,this.gnormx=0,this.wrap_lnorm=null,this.lnormy=0,this.lnormx=0,this.outer=null,this.polygon=null,this.next=null,this.lnormx=0,this.lnormy=0,this.gnormx=0,this.gnormy=0,this.length=0,this.lprojection=0,this.gprojection=0};ne.__name__=["zpp_nape","shape","ZPP_Edge"],ne.prototype.next=null,ne.prototype.free=function(){this.polygon=null},ne.prototype.alloc=function(){},ne.prototype.polygon=null,ne.prototype.outer=null,ne.prototype.wrapper=function(){return null==this.outer&&(ne.internal=!0,this.outer=new yn,ne.internal=!1,this.outer.zpp_inner=this),this.outer},ne.prototype.lnormx=null,ne.prototype.lnormy=null,ne.prototype.wrap_lnorm=null,ne.prototype.gnormx=null,ne.prototype.gnormy=null,ne.prototype.wrap_gnorm=null,ne.prototype.length=null,ne.prototype.lprojection=null,ne.prototype.gprojection=null,ne.prototype.lp0=null,ne.prototype.gp0=null,ne.prototype.lp1=null,ne.prototype.gp1=null,ne.prototype.tp0=null,ne.prototype.tp1=null,ne.prototype.lnorm_validate=function(){this.polygon.validate_laxi(),this.wrap_lnorm.zpp_inner.x=this.lnormx,this.wrap_lnorm.zpp_inner.y=this.lnormy},ne.prototype.gnorm_validate=function(){var n=this.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var t=n.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var e=n.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i,i=i.next;l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}for(var o=n.edges.head,a=s=n.gverts.next,s=s.next;null!=s;){var _=s,h=o.elt,o=o.next;h.gp0=a,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=_,s=s.next}var u=o.elt;u.gp0=a,u.gp1=n.gverts.next,u.gnormx=n.body.axisy*u.lnormx-n.body.axisx*u.lnormy,u.gnormy=u.lnormx*n.body.axisx+u.lnormy*n.body.axisy,u.gprojection=n.body.posx*u.gnormx+n.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}this.wrap_gnorm.zpp_inner.x=this.gnormx,this.wrap_gnorm.zpp_inner.y=this.gnormy},ne.prototype.getlnorm=function(){var n,t,e,i,p,l=this.lnormx,r=this.lnormy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_lnorm=n,this.wrap_lnorm.zpp_inner._immutable=!0,this.wrap_lnorm.zpp_inner._validate=Q(this,this.lnorm_validate)},ne.prototype.getgnorm=function(){var n,t,e,i,p,l=this.gnormx,r=this.gnormy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_gnorm=n,this.wrap_gnorm.zpp_inner._immutable=!0,this.wrap_gnorm.zpp_inner._validate=Q(this,this.gnorm_validate)},ne.prototype.__class__=ne;var te=zpp_nape.shape.ZPP_Polygon=function(){this.zip_sanitation=!1,this.zip_valid=!1,this.zip_gaxi=!1,this.zip_gverts=!1,this.zip_laxi=!1,this.zip_lverts=!1,this.reverse_flag=!1,this.edgeCnt=0,this.wrap_edges=null,this.edges=null,this.wrap_gverts=null,this.gverts=null,this.wrap_lverts=null,this.lverts=null,this.outer_zn=null,$t.call(this,1),(this.polygon=this).lverts=new mo,this.gverts=new mo,this.edges=new Se,this.edgeCnt=0};te.__name__=["zpp_nape","shape","ZPP_Polygon"],te.__super__=$t,te.prototype=Object.create($t.prototype),te.prototype.outer_zn=null,te.prototype.lverts=null,te.prototype.wrap_lverts=null,te.prototype.gverts=null,te.prototype.wrap_gverts=null,te.prototype.edges=null,te.prototype.wrap_edges=null,te.prototype.edgeCnt=null,te.prototype.reverse_flag=null,te.prototype.__clear=function(){},te.prototype.lverts_pa_invalidate=function(n){this.invalidate_lverts()},te.prototype.gverts_pa_validate=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var t=this.lverts.next,e=this.gverts.next;null!=e;){var i=e,p=t,t=t.next;i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),e=e.next}}},te.prototype.lverts_post_adder=function(n){n.zpp_inner._invalidate=Q(this,this.lverts_pa_invalidate);for(var t,e=null,i=null,p=this.lverts.next;null!=p&&p!=n.zpp_inner;)e=null==e?this.gverts.next:e.next,i=null==i?this.edges.head:i.next,p=p.next;null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!0,t.x=0,t.y=0;var l,r,o,a=t;this.gverts.insert(e,a),null!=this.lverts.next.next&&(null==this.lverts.next.next.next?(null==ne.zpp_pool?l=new ne:(l=ne.zpp_pool,ne.zpp_pool=l.next,l.next=null),(l.polygon=this).edges.add(l),null==ne.zpp_pool?r=new ne:(r=ne.zpp_pool,ne.zpp_pool=r.next,r.next=null),(r.polygon=this).edges.add(r),this.edgeCnt+=2):(null==ne.zpp_pool?o=new ne:(o=ne.zpp_pool,ne.zpp_pool=o.next,o.next=null),(o.polygon=this).edges.insert(i,o),this.edgeCnt++)),a._validate=Q(this,this.gverts_pa_validate)},te.prototype.lverts_subber=function(n){this.cleanup_lvert(n.zpp_inner)},te.prototype.lverts_invalidate=function(n){this.invalidate_lverts()},te.prototype.lverts_validate=function(){this.validate_lverts()},te.prototype.gverts_validate=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var t=this.lverts.next,e=this.gverts.next;null!=e;){var i=e,p=t,t=t.next;i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),e=e.next}}},te.prototype.edges_validate=function(){this.validate_lverts()},te.prototype.getlverts=function(){this.wrap_lverts=zi.get(this.lverts),this.wrap_lverts.zpp_inner.post_adder=Q(this,this.lverts_post_adder),this.wrap_lverts.zpp_inner.subber=Q(this,this.lverts_subber),this.wrap_lverts.zpp_inner._invalidate=Q(this,this.lverts_invalidate),this.wrap_lverts.zpp_inner._validate=Q(this,this.lverts_validate),this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},te.prototype.getgverts=function(){this.wrap_gverts=zi.get(this.gverts,!0),this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_gverts.zpp_inner._validate=Q(this,this.gverts_validate)},te.prototype.getedges=function(){this.wrap_edges=Ti.get(this.edges,!0),this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_edges.zpp_inner._validate=Q(this,this.edges_validate)},te.prototype.zip_lverts=null,te.prototype.invalidate_lverts=function(){this.invalidate_laxi(),this.invalidate_area_inertia(),this.invalidate_angDrag(),this.invalidate_localCOM(),this.invalidate_gverts(),this.zip_lverts=!0,this.zip_valid=!0,this.zip_sanitation=!0,null!=this.body&&this.body.wake()},te.prototype.zip_laxi=null,te.prototype.invalidate_laxi=function(){this.invalidate_gaxi(),this.zip_sweepRadius=!0,this.zip_laxi=!0},te.prototype.zip_gverts=null,te.prototype.invalidate_gverts=function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),this.zip_gverts=!0},te.prototype.zip_gaxi=null,te.prototype.invalidate_gaxi=function(){this.zip_gaxi=!0},te.prototype.zip_valid=null,te.prototype.validation=null,te.prototype.valid=function(){if(this.zip_valid){if(this.zip_valid=!1,this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real()),this.lverts.length<3)return null==Ll.ValidationResult_DEGENERATE&&(Ll.internal=!0,Ll.ValidationResult_DEGENERATE=new wn,Ll.internal=!1),this.validation=Ll.ValidationResult_DEGENERATE;if(this.validate_lverts(),this.validate_area_inertia(),this.area<co.epsilon)return null==Ll.ValidationResult_DEGENERATE&&(Ll.internal=!0,Ll.ValidationResult_DEGENERATE=new wn,Ll.internal=!1),this.validation=Ll.ValidationResult_DEGENERATE;var n=!1,t=!1,e=!0,i=this.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i,o=r.x-l.x,a=r.y-l.y,s=l.x-p.x,_=(l.y-p.y)*o-s*a;if(_>co.epsilon?t=!0:_<-co.epsilon&&(n=!0),t&&n){e=!1;break}p=l,l=r,i=i.next}if(e){for(var h=i=this.lverts.next;;){var u=h.x-l.x,x=h.y-l.y,d=l.x-p.x,y=(l.y-p.y)*u-d*x;if(y>co.epsilon?t=!0:y<-co.epsilon&&(n=!0),t&&n){e=!1;break}break}if(e){p=l,l=h;for(var z=i=i.next;;){var c=z.x-h.x,v=z.y-h.y,m=h.x-p.x,f=(h.y-p.y)*c-m*v;if(f>co.epsilon?t=!0:f<-co.epsilon&&(n=!0),t&&n)break;break}}}if(t&&n)return null==Ll.ValidationResult_CONCAVE&&(Ll.internal=!0,Ll.ValidationResult_CONCAVE=new wn,Ll.internal=!1),this.validation=Ll.ValidationResult_CONCAVE;for(var b=!0,g=!0,w=M=this.lverts.next,M=M.next;null!=M;){var C=M;if(!b){g=!1;break}for(var k=!0,O=P=this.lverts.next,P=P.next;null!=P;){var S=P;if(w!=O&&w!=S&&C!=O&&C!=S){var A=w.x-O.x,j=w.y-O.y,E=0,I=C.x-w.x,T=0,N=0,L=(E=C.y-w.y)*(T=S.x-O.x)-I*(N=S.y-O.y);if(L*L>co.epsilon){var V=(N*A-T*j)*(L=1/L);if(V>co.epsilon&&V<1-co.epsilon){var D=(E*A-I*j)*L;if(D>co.epsilon&&D<1-co.epsilon){k=b=!1;break}}}O=S,P=P.next}else O=S,P=P.next}if(k)for(;;){var F=this.lverts.next;if(w==O||w==F||C==O||C==F)break;var R=w.x-O.x,Z=w.y-O.y,B=0,G=C.x-w.x,q=0,U=0,K=(B=C.y-w.y)*(q=F.x-O.x)-G*(U=F.y-O.y);if(K*K>co.epsilon){var W=(U*R-q*Z)*(K=1/K);if(W>co.epsilon&&W<1-co.epsilon){var Y=(B*R-G*Z)*K;if(Y>co.epsilon&&Y<1-co.epsilon){b=!1;break}}}break}w=C,M=M.next}if(g)for(;;){var J=this.lverts.next;if(!b)break;for(var X=!0,H=$=this.lverts.next,$=$.next;null!=$;){var Q=$;if(w!=H&&w!=Q&&J!=H&&J!=Q){var nn=w.x-H.x,tn=w.y-H.y,en=0,pn=J.x-w.x,ln=0,rn=0,on=(en=J.y-w.y)*(ln=Q.x-H.x)-pn*(rn=Q.y-H.y);if(on*on>co.epsilon){var an=(rn*nn-ln*tn)*(on=1/on);if(an>co.epsilon&&an<1-co.epsilon){var sn=(en*nn-pn*tn)*on;if(sn>co.epsilon&&sn<1-co.epsilon){X=b=!1;break}}}H=Q,$=$.next}else H=Q,$=$.next}if(X)for(;;){var _n=this.lverts.next;if(w==H||w==_n||J==H||J==_n)break;var hn=w.x-H.x,un=w.y-H.y,xn=0,dn=J.x-w.x,yn=0,zn=0,cn=(xn=J.y-w.y)*(yn=_n.x-H.x)-dn*(zn=_n.y-H.y);if(cn*cn>co.epsilon){var vn=(zn*hn-yn*un)*(cn=1/cn);if(vn>co.epsilon&&vn<1-co.epsilon){var mn=(xn*hn-dn*un)*cn;if(mn>co.epsilon&&mn<1-co.epsilon){b=!1;break}}}break}break}return b?(null==Ll.ValidationResult_VALID&&(Ll.internal=!0,Ll.ValidationResult_VALID=new wn,Ll.internal=!1),this.validation=Ll.ValidationResult_VALID):(null==Ll.ValidationResult_SELF_INTERSECTING&&(Ll.internal=!0,Ll.ValidationResult_SELF_INTERSECTING=new wn,Ll.internal=!1),this.validation=Ll.ValidationResult_SELF_INTERSECTING)}return this.validation},te.prototype.validate_lverts=function(){this.zip_lverts&&(this.zip_lverts=!1,2<this.lverts.length&&(this.validate_area_inertia(),this.area<0&&(this.reverse_vertices(),this.area=-this.area)))},te.prototype.cleanup_lvert=function(n){for(var t=null,e=null,i=this.lverts.next;null!=i&&i!=n;)t=null==t?this.gverts.next:t.next,e=null==e?this.edges.head:e.next,i=i.next;var p=null==t?this.gverts.next:t.next;this.gverts.erase(t);var l,r,o,a,s=p;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=mo.zpp_pool,mo.zpp_pool=s,2==this.edgeCnt?((l=this.edges.pop_unsafe()).polygon=null,l.next=ne.zpp_pool,ne.zpp_pool=l,(r=this.edges.pop_unsafe()).polygon=null,r.next=ne.zpp_pool,ne.zpp_pool=r,this.edgeCnt=0):0!=this.edgeCnt&&(o=null==e?this.edges.head.elt:e.next.elt,this.edges.erase(e),(a=o).polygon=null,a.next=ne.zpp_pool,ne.zpp_pool=a,this.edgeCnt--)},te.prototype.zip_sanitation=null,te.prototype.splice_collinear=function(){this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real())},te.prototype.splice_collinear_real=function(){if(null!=this.lverts.next&&null!=this.lverts.next.next&&null!=this.lverts.next.next.next){for(var n,t=null,e=this.lverts.next;null!=e;)var i=null==e.next?this.lverts.next:e.next,p=e.x,l=e.y,r=0,o=0,e=(r=p-i.x)*r+(o=l-i.y)*o<co.epsilon*co.epsilon?(this.cleanup_lvert(e),this.lverts.erase(t)):(t=e).next;if(null!=this.lverts.next)for(;;){n=!1;for(var a=this.lverts.next;null!=a;)var s=null==a.next?this.lverts.next:a.next,_=null==s.next?this.lverts.next:s.next,h=s.x-a.x,u=s.y-a.y,x=_.x-s.x,d=(_.y-s.y)*h-x*u,a=(d*d>=co.epsilon*co.epsilon||(this.cleanup_lvert(s),this.lverts.erase(null==a.next?null:a),n=!0),a.next);if(!n)break}}},te.prototype.reverse_vertices=function(){this.lverts.reverse(),this.gverts.reverse(),this.edges.reverse(),this.edges.insert(this.edges.iterator_at(this.edgeCnt-1),this.edges.pop_unsafe()),this.reverse_flag=!this.reverse_flag,null!=this.wrap_lverts&&(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},te.prototype.validate_laxi=function(){if(this.zip_laxi){this.zip_laxi=!1,this.validate_lverts();for(var n=this.edges.head,t=e=this.lverts.next,e=e.next;null!=e;){var i=e,p=n.elt,n=n.next;p.lp0=t,p.lp1=i;var l=t.x-i.x,r=t.y-i.y,o=Math.sqrt(l*l+r*r),a=1/(p.length=o),s=l*=a;l=-(r*=a),r=s,p.lprojection=l*t.x+r*t.y,p.lnormx=l,p.lnormy=r,null!=p.wrap_lnorm&&(p.wrap_lnorm.zpp_inner.x=l,p.wrap_lnorm.zpp_inner.y=r),t=i,e=e.next}var _=this.lverts.next,h=n.elt;h.lp0=t,h.lp1=_;var u=t.x-_.x,x=t.y-_.y,d=Math.sqrt(u*u+x*x),y=1/(h.length=d),z=u*=y;u=-(x*=y),x=z,h.lprojection=u*t.x+x*t.y,h.lnormx=u,h.lnormy=x,null!=h.wrap_lnorm&&(h.wrap_lnorm.zpp_inner.x=u,h.wrap_lnorm.zpp_inner.y=x)}},te.prototype.validate_gverts=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var t=this.lverts.next,e=this.gverts.next;null!=e;){var i=e,p=t,t=t.next;i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),e=e.next}}},te.prototype.validate_gaxi=function(){if(this.zip_gaxi&&null!=this.body){this.zip_gaxi=!1,this.validate_laxi();var n=this.body;if(n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)),this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var t=this.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var e=this.lverts.next,i=this.gverts.next;null!=i;){var p=i,l=e,e=e.next;p.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),p.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),i=i.next}}for(var r=this.edges.head,o=a=this.gverts.next,a=a.next;null!=a;){var s=a,_=r.elt,r=r.next;_.gp0=o,_.gp1=s,_.gnormx=this.body.axisy*_.lnormx-this.body.axisx*_.lnormy,_.gnormy=_.lnormx*this.body.axisx+_.lnormy*this.body.axisy,_.gprojection=this.body.posx*_.gnormx+this.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,o=s,a=a.next}var h=r.elt;h.gp0=o,h.gp1=this.gverts.next,h.gnormx=this.body.axisy*h.lnormx-this.body.axisx*h.lnormy,h.gnormy=h.lnormx*this.body.axisx+h.lnormy*this.body.axisy,h.gprojection=this.body.posx*h.gnormx+this.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy}},te.prototype.__validate_aabb=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var t=this.lverts.next,e=this.gverts.next;null!=e;){var i=e,p=t,t=t.next;i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),e=e.next}}var l=this.gverts.next;this.aabb.minx=l.x,this.aabb.miny=l.y,this.aabb.maxx=l.x,this.aabb.maxy=l.y;for(var r=this.gverts.next.next;null!=r;){var o=r;o.x<this.aabb.minx&&(this.aabb.minx=o.x),o.x>this.aabb.maxx&&(this.aabb.maxx=o.x),o.y<this.aabb.miny&&(this.aabb.miny=o.y),o.y>this.aabb.maxy&&(this.aabb.maxy=o.y),r=r.next}},te.prototype._force_validate_aabb=function(){var n=this.lverts.next,t=this.gverts.next,e=n;n=n.next,t.x=this.body.posx+(this.body.axisy*e.x-this.body.axisx*e.y),t.y=this.body.posy+(e.x*this.body.axisx+e.y*this.body.axisy),this.aabb.minx=t.x,this.aabb.miny=t.y,this.aabb.maxx=t.x,this.aabb.maxy=t.y;for(var i=this.gverts.next.next;null!=i;){var p=i,l=n,n=n.next;p.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),p.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),p.x<this.aabb.minx&&(this.aabb.minx=p.x),p.x>this.aabb.maxx&&(this.aabb.maxx=p.x),p.y<this.aabb.miny&&(this.aabb.miny=p.y),p.y>this.aabb.maxy&&(this.aabb.maxy=p.y),i=i.next}},te.prototype.__validate_sweepRadius=function(){var n=0,t=0;this.validate_laxi();for(var e=this.lverts.next;null!=e;){var i=e.x*e.x+e.y*e.y;n<i&&(n=i),e=e.next}for(var p=this.edges.head;null!=p;){var l=p.elt;if(l.lprojection<t&&(t=l.lprojection)<0)break;p=p.next}t<0&&(t=0),this.sweepRadius=Math.sqrt(n),this.sweepCoef=this.sweepRadius-t},te.prototype.__validate_area_inertia=function(){if(null==this.lverts.next||null==this.lverts.next.next||null==this.lverts.next.next.next)this.area=0,this.inertia=0;else{var n=this.area=0,t=0,e=this.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e,r=p.y*i.x-p.x*i.y;n+=r*(p.x*p.x+p.y*p.y+(p.x*i.x+p.y*i.y)+(i.x*i.x+i.y*i.y)),t+=r,this.area+=p.x*(l.y-i.y),i=p,p=l,e=e.next}var o=e=this.lverts.next,a=p.y*i.x-p.x*i.y;n+=a*(p.x*p.x+p.y*p.y+(p.x*i.x+p.y*i.y)+(i.x*i.x+i.y*i.y)),t+=a,this.area+=p.x*(o.y-i.y),i=p,e=e.next;var s=o.y*i.x-o.x*i.y;n+=s*(o.x*o.x+o.y*o.y+(o.x*i.x+o.y*i.y)+(i.x*i.x+i.y*i.y)),t+=s,this.area+=o.x*(e.y-i.y),this.inertia=n/(6*t),this.area*=.5,this.area<0&&(this.area=-this.area,this.reverse_vertices())}},te.prototype.__validate_angDrag=function(){this.validate_area_inertia(),this.validate_laxi();for(var n=0,t=this.edges.head,e=0,i=this.lverts.next,p=i,l=i.next;null!=l;){var r=t.elt,t=t.next;e+=r.length;var o=l.x-p.x,a=l.y-p.y;n+=r.length*co.fluidAngularDragFriction*this.material.dynamicFriction*r.lprojection*r.lprojection;var s,_,h,u,x,d,y,z,c,v,m=-(p.y*r.lnormx-p.x*r.lnormy)/(a*r.lnormx-o*r.lnormy);0<m&&(s=1<m?1:m,h=_=0,_=p.x,h=p.y,_+=o*s,h+=a*s,u=r.lnormy*p.x-r.lnormx*p.y,n+=((x=r.lnormy*_-r.lnormx*h)*x*x-u*u*u)/(3*(x-u))*s*r.length*co.fluidAngularDrag),m<1&&(d=m<0?0:m,z=y=0,y=p.x,z=p.y,y+=o*d,z+=a*d,c=r.lnormy*y-r.lnormx*z,n+=((v=r.lnormy*l.x-r.lnormx*l.y)*v*v-c*c*c)/(3*(v-c))*co.fluidVacuumDrag*(1-d)*r.length*co.fluidAngularDrag),l=(p=l).next}for(;;){l=this.lverts.next;var f=t.elt;t=t.next,e+=f.length;var b=l.x-p.x,g=l.y-p.y;n+=f.length*co.fluidAngularDragFriction*this.material.dynamicFriction*f.lprojection*f.lprojection;var w,M,C,k,O,P,S,A,j,E,I=-(p.y*f.lnormx-p.x*f.lnormy)/(g*f.lnormx-b*f.lnormy);0<I&&(w=1<I?1:I,C=M=0,M=p.x,C=p.y,M+=b*w,C+=g*w,k=f.lnormy*p.x-f.lnormx*p.y,n+=((O=f.lnormy*M-f.lnormx*C)*O*O-k*k*k)/(3*(O-k))*w*f.length*co.fluidAngularDrag),I<1&&(P=I<0?0:I,A=S=0,S=p.x,A=p.y,S+=b*P,A+=g*P,j=f.lnormy*S-f.lnormx*A,n+=((E=f.lnormy*l.x-f.lnormx*l.y)*E*E-j*j*j)/(3*(E-j))*co.fluidVacuumDrag*(1-P)*f.length*co.fluidAngularDrag);break}this.angDrag=n/(this.inertia*e)},te.prototype.__validate_localCOM=function(){if(null==this.lverts.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;else if(null==this.lverts.next.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y,this.localCOMx+=this.lverts.next.next.x,this.localCOMy+=this.lverts.next.next.y,this.localCOMx*=.5,this.localCOMy*=.5;else{this.localCOMx=0;var n=this.localCOMy=0,t=this.lverts.next,e=t,i=t=t.next;for(t=t.next;null!=t;){var p=t;n+=i.x*(p.y-e.y);var l=p.y*i.x-p.x*i.y;this.localCOMx+=(i.x+p.x)*l,this.localCOMy+=(i.y+p.y)*l,e=i,i=p,t=t.next}var r=t=this.lverts.next;n+=i.x*(r.y-e.y);var o=r.y*i.x-r.x*i.y;this.localCOMx+=(i.x+r.x)*o,this.localCOMy+=(i.y+r.y)*o,e=i;var a=t=t.next;n+=r.x*(a.y-e.y);var s=a.y*r.x-a.x*r.y;this.localCOMx+=(r.x+a.x)*s,this.localCOMy+=(r.y+a.y)*s;var _=n=1/(3*n);this.localCOMx*=_,this.localCOMy*=_}},te.prototype.localCOM_validate=function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var t=n.localCOMy=0,e=n.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e;t+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,e=e.next}var o=e=n.lverts.next;t+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=e=e.next;t+=o.x*(s.y-i.y);var _=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*_,n.localCOMy+=(o.y+s.y)*_;var h=t=1/(3*t);n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},te.prototype.localCOM_invalidate=function(n){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var t=this.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i;e+=l.x*(r.y-p.y);var o=r.y*l.x-r.x*l.y;t.localCOMx+=(l.x+r.x)*o,t.localCOMy+=(l.y+r.y)*o,p=l,l=r,i=i.next}var a=i=t.lverts.next;e+=l.x*(a.y-p.y);var s=a.y*l.x-a.x*l.y;t.localCOMx+=(l.x+a.x)*s,t.localCOMy+=(l.y+a.y)*s,p=l;var _=i=i.next;e+=a.x*(_.y-p.y);var h=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*h,t.localCOMy+=(a.y+_.y)*h;var u=e=1/(3*e);t.localCOMx*=u,t.localCOMy*=u}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}for(var x=n.x-this.localCOMx,d=n.y-this.localCOMy,y=this.lverts.next;null!=y;){var z=y;z.x+=x,z.y+=d,y=y.next}this.invalidate_lverts()},te.prototype.setupLocalCOM=function(){var n,t,e,i,p,l=this.localCOMx,r=this.localCOMy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_localCOM=n,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=Q(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=Q(this,this.localCOM_invalidate)},te.prototype.__translate=function(n,t){for(var e=this.lverts.next;null!=e;){var i=e;i.x+=n,i.y+=t,e=e.next}this.invalidate_lverts()},te.prototype.__scale=function(n,t){for(var e=this.lverts.next;null!=e;){var i=e;i.x*=n,i.y*=t,e=e.next}this.invalidate_lverts()},te.prototype.__rotate=function(n,t){for(var e=this.lverts.next;null!=e;){var i=e,p=t*i.x-n*i.y,l=i.x*n+i.y*t;i.x=p,i.y=l,e=e.next}this.invalidate_lverts()},te.prototype.__transform=function(n){for(var t=this.lverts.next;null!=t;){var e=t,i=n.zpp_inner.a*e.x+n.zpp_inner.b*e.y+n.zpp_inner.tx;e.y=n.zpp_inner.c*e.x+n.zpp_inner.d*e.y+n.zpp_inner.ty,e.x=i,t=t.next}this.invalidate_lverts()},te.prototype.__copy=function(){var n=this.outer_zn;return null==n.zpp_inner_zn.wrap_lverts&&n.zpp_inner_zn.getlverts(),new fn(n.zpp_inner_zn.wrap_lverts).zpp_inner_zn},te.prototype.__class__=te;var ee=zpp_nape.space.ZPP_Broadphase=function(){this.circShape=null,this.matrix=null,this.aabbShape=null,this.dynab=null,this.sweep=null,this.is_sweep=!1,this.space=null};ee.__name__=["zpp_nape","space","ZPP_Broadphase"],ee.prototype.space=null,ee.prototype.is_sweep=null,ee.prototype.sweep=null,ee.prototype.dynab=null,ee.prototype.insert=function(n){this.is_sweep?this.sweep.__insert(n):this.dynab.__insert(n)},ee.prototype.remove=function(n){this.is_sweep?this.sweep.__remove(n):this.dynab.__remove(n)},ee.prototype.sync=function(n){if(this.is_sweep){if(!this.sweep.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var t=n.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var e=t.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0;var i=e.localCOMy=0,p=e.lverts.next,l=p,r=p=p.next;for(p=p.next;null!=p;){var o=p;i+=r.x*(o.y-l.y);var a=o.y*r.x-o.x*r.y;e.localCOMx+=(r.x+o.x)*a,e.localCOMy+=(r.y+o.y)*a,l=r,r=o,p=p.next}var s=p=e.lverts.next;i+=r.x*(s.y-l.y);var _=s.y*r.x-s.x*r.y;e.localCOMx+=(r.x+s.x)*_,e.localCOMy+=(r.y+s.y)*_,l=r;var h=p=p.next;i+=s.x*(h.y-l.y);var u=h.y*s.x-h.x*s.y;e.localCOMx+=(s.x+h.x)*u,e.localCOMy+=(s.y+h.y)*u;var x=i=1/(3*i);e.localCOMx*=x,e.localCOMy*=x}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var d=t.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var y=t.radius,z=t.radius;t.aabb.minx=t.worldCOMx-y,t.aabb.miny=t.worldCOMy-z,t.aabb.maxx=t.worldCOMx+y,t.aabb.maxy=t.worldCOMy+z}else{var c=n.polygon;if(c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var v=c.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot));for(var m=c.lverts.next,f=c.gverts.next;null!=f;){var b=f,g=m,m=m.next;b.x=c.body.posx+(c.body.axisy*g.x-c.body.axisx*g.y),b.y=c.body.posy+(g.x*c.body.axisx+g.y*c.body.axisy),f=f.next}}var w=c.gverts.next;c.aabb.minx=w.x,c.aabb.miny=w.y,c.aabb.maxx=w.x,c.aabb.maxy=w.y;for(var M=c.gverts.next.next;null!=M;){var C=M;C.x<c.aabb.minx&&(c.aabb.minx=C.x),C.x>c.aabb.maxx&&(c.aabb.maxx=C.x),C.y<c.aabb.miny&&(c.aabb.miny=C.y),C.y>c.aabb.maxy&&(c.aabb.maxy=C.y),M=M.next}}}else{var k,O,P=this.dynab,S=n.node;if(!S.synced){if(!P.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var A=n.circle;if(A.zip_worldCOM&&null!=A.body){if(A.zip_worldCOM=!1,A.zip_localCOM){if(A.zip_localCOM=!1,1==A.type){var j=A.polygon;if(null==j.lverts.next.next)j.localCOMx=j.lverts.next.x,j.localCOMy=j.lverts.next.y;else if(null==j.lverts.next.next.next)j.localCOMx=j.lverts.next.x,j.localCOMy=j.lverts.next.y,j.localCOMx+=j.lverts.next.next.x,j.localCOMy+=j.lverts.next.next.y,j.localCOMx*=.5,j.localCOMy*=.5;else{j.localCOMx=0;var E=j.localCOMy=0,I=j.lverts.next,T=I,N=I=I.next;for(I=I.next;null!=I;){var L=I;E+=N.x*(L.y-T.y);var V=L.y*N.x-L.x*N.y;j.localCOMx+=(N.x+L.x)*V,j.localCOMy+=(N.y+L.y)*V,T=N,N=L,I=I.next}var D=I=j.lverts.next;E+=N.x*(D.y-T.y);var F=D.y*N.x-D.x*N.y;j.localCOMx+=(N.x+D.x)*F,j.localCOMy+=(N.y+D.y)*F,T=N;var R=I=I.next;E+=D.x*(R.y-T.y);var Z=R.y*D.x-R.x*D.y;j.localCOMx+=(D.x+R.x)*Z,j.localCOMy+=(D.y+R.y)*Z;var B=E=1/(3*E);j.localCOMx*=B,j.localCOMy*=B}}null!=A.wrap_localCOM&&(A.wrap_localCOM.zpp_inner.x=A.localCOMx,A.wrap_localCOM.zpp_inner.y=A.localCOMy)}var G=A.body;G.zip_axis&&(G.zip_axis=!1,G.axisx=Math.sin(G.rot),G.axisy=Math.cos(G.rot)),A.worldCOMx=A.body.posx+(A.body.axisy*A.localCOMx-A.body.axisx*A.localCOMy),A.worldCOMy=A.body.posy+(A.localCOMx*A.body.axisx+A.localCOMy*A.body.axisy)}var q=A.radius,U=A.radius;A.aabb.minx=A.worldCOMx-q,A.aabb.miny=A.worldCOMy-U,A.aabb.maxx=A.worldCOMx+q,A.aabb.maxy=A.worldCOMy+U}else{var K=n.polygon;if(K.zip_gverts&&null!=K.body){K.zip_gverts=!1,K.validate_lverts();var W=K.body;W.zip_axis&&(W.zip_axis=!1,W.axisx=Math.sin(W.rot),W.axisy=Math.cos(W.rot));for(var Y=K.lverts.next,J=K.gverts.next;null!=J;){var X=J,H=Y,Y=Y.next;X.x=K.body.posx+(K.body.axisy*H.x-K.body.axisx*H.y),X.y=K.body.posy+(H.x*K.body.axisx+H.y*K.body.axisy),J=J.next}}var $=K.gverts.next;K.aabb.minx=$.x,K.aabb.miny=$.y,K.aabb.maxx=$.x,K.aabb.maxy=$.y;for(var Q=K.gverts.next.next;null!=Q;){var nn=Q;nn.x<K.aabb.minx&&(K.aabb.minx=nn.x),nn.x>K.aabb.maxx&&(K.aabb.maxx=nn.x),nn.y<K.aabb.miny&&(K.aabb.miny=nn.y),nn.y>K.aabb.maxy&&(K.aabb.maxy=nn.y),Q=Q.next}}(S.dyn!=(1!=n.body.type&&!n.body.component.sleeping)||(k=S.aabb,!((O=n.aabb).minx>=k.minx&&O.miny>=k.miny&&O.maxx<=k.maxx&&O.maxy<=k.maxy)))&&(S.synced=!0,S.snext=P.syncs,P.syncs=S)}}},ee.prototype.broadphase=function(n,t){},ee.prototype.clear=function(){},ee.prototype.shapesUnderPoint=function(n,t,e,i){return null},ee.prototype.bodiesUnderPoint=function(n,t,e,i){return null},ee.prototype.aabbShape=null,ee.prototype.matrix=null,ee.prototype.updateAABBShape=function(n){var t,e,i,p,l,r,o,a,s,_,h,u,x,d,y,z,c;null==this.aabbShape?(null==Ll.BodyType_STATIC&&(Ll.internal=!0,Ll.BodyType_STATIC=new rn,Ll.internal=!1),t=new ln(Ll.BodyType_STATIC).zpp_inner.wrap_shapes,e=this.aabbShape=new fn(fn.rect(n.minx,n.miny,n.maxx-n.minx,n.maxy-n.miny)),t.zpp_inner.reverse_flag?t.push(e):t.unshift(e)):(i=this.aabbShape.zpp_inner.aabb,p=(n.maxx-n.minx)/(i.maxx-i.minx),l=(n.maxy-n.miny)/(i.maxy-i.miny),null==this.matrix&&(this.matrix=new pn),(r=this.matrix).zpp_inner.a=p,null!=(o=r.zpp_inner)._invalidate&&o._invalidate(),a=this.matrix,(s=this.matrix).zpp_inner.c=0,null!=(_=s.zpp_inner)._invalidate&&_._invalidate(),a.zpp_inner.b=s.zpp_inner.c,null!=(h=a.zpp_inner)._invalidate&&h._invalidate(),(u=this.matrix).zpp_inner.d=l,null!=(x=u.zpp_inner)._invalidate&&x._invalidate(),(d=this.matrix).zpp_inner.tx=n.minx-p*i.minx,null!=(y=d.zpp_inner)._invalidate&&y._invalidate(),(z=this.matrix).zpp_inner.ty=n.miny-l*i.miny,null!=(c=z.zpp_inner)._invalidate&&c._invalidate(),this.aabbShape.transform(this.matrix));var v=this.aabbShape.zpp_inner;if(v.zip_aabb&&null!=v.body)if(v.zip_aabb=!1,0==v.type){var m=v.circle;if(m.zip_worldCOM&&null!=m.body){if(m.zip_worldCOM=!1,m.zip_localCOM){if(m.zip_localCOM=!1,1==m.type){var f=m.polygon;if(null==f.lverts.next.next)f.localCOMx=f.lverts.next.x,f.localCOMy=f.lverts.next.y;else if(null==f.lverts.next.next.next)f.localCOMx=f.lverts.next.x,f.localCOMy=f.lverts.next.y,f.localCOMx+=f.lverts.next.next.x,f.localCOMy+=f.lverts.next.next.y,f.localCOMx*=.5,f.localCOMy*=.5;else{f.localCOMx=0;var b=f.localCOMy=0,g=f.lverts.next,w=g,M=g=g.next;for(g=g.next;null!=g;){var C=g;b+=M.x*(C.y-w.y);var k=C.y*M.x-C.x*M.y;f.localCOMx+=(M.x+C.x)*k,f.localCOMy+=(M.y+C.y)*k,w=M,M=C,g=g.next}var O=g=f.lverts.next;b+=M.x*(O.y-w.y);var P=O.y*M.x-O.x*M.y;f.localCOMx+=(M.x+O.x)*P,f.localCOMy+=(M.y+O.y)*P,w=M;var S=g=g.next;b+=O.x*(S.y-w.y);var A=S.y*O.x-S.x*O.y;f.localCOMx+=(O.x+S.x)*A,f.localCOMy+=(O.y+S.y)*A;var j=b=1/(3*b);f.localCOMx*=j,f.localCOMy*=j}}null!=m.wrap_localCOM&&(m.wrap_localCOM.zpp_inner.x=m.localCOMx,m.wrap_localCOM.zpp_inner.y=m.localCOMy)}var E=m.body;E.zip_axis&&(E.zip_axis=!1,E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot)),m.worldCOMx=m.body.posx+(m.body.axisy*m.localCOMx-m.body.axisx*m.localCOMy),m.worldCOMy=m.body.posy+(m.localCOMx*m.body.axisx+m.localCOMy*m.body.axisy)}var I=m.radius,T=m.radius;m.aabb.minx=m.worldCOMx-I,m.aabb.miny=m.worldCOMy-T,m.aabb.maxx=m.worldCOMx+I,m.aabb.maxy=m.worldCOMy+T}else{var N=v.polygon;if(N.zip_gverts&&null!=N.body){N.zip_gverts=!1,N.validate_lverts();var L=N.body;L.zip_axis&&(L.zip_axis=!1,L.axisx=Math.sin(L.rot),L.axisy=Math.cos(L.rot));for(var V=N.lverts.next,D=N.gverts.next;null!=D;){var F=D,R=V,V=V.next;F.x=N.body.posx+(N.body.axisy*R.x-N.body.axisx*R.y),F.y=N.body.posy+(R.x*N.body.axisx+R.y*N.body.axisy),D=D.next}}var Z=N.gverts.next;N.aabb.minx=Z.x,N.aabb.miny=Z.y,N.aabb.maxx=Z.x,N.aabb.maxy=Z.y;for(var B=N.gverts.next.next;null!=B;){var G=B;G.x<N.aabb.minx&&(N.aabb.minx=G.x),G.x>N.aabb.maxx&&(N.aabb.maxx=G.x),G.y<N.aabb.miny&&(N.aabb.miny=G.y),G.y>N.aabb.maxy&&(N.aabb.maxy=G.y),B=B.next}}var q=this.aabbShape.zpp_inner.polygon;if(q.zip_gaxi&&null!=q.body){q.zip_gaxi=!1,q.validate_laxi();var U=q.body;if(U.zip_axis&&(U.zip_axis=!1,U.axisx=Math.sin(U.rot),U.axisy=Math.cos(U.rot)),q.zip_gverts&&null!=q.body){q.zip_gverts=!1,q.validate_lverts();var K=q.body;K.zip_axis&&(K.zip_axis=!1,K.axisx=Math.sin(K.rot),K.axisy=Math.cos(K.rot));for(var W=q.lverts.next,Y=q.gverts.next;null!=Y;){var J=Y,X=W,W=W.next;J.x=q.body.posx+(q.body.axisy*X.x-q.body.axisx*X.y),J.y=q.body.posy+(X.x*q.body.axisx+X.y*q.body.axisy),Y=Y.next}}for(var H=q.edges.head,$=Q=q.gverts.next,Q=Q.next;null!=Q;){var nn=Q,tn=H.elt,H=H.next;tn.gp0=$,tn.gp1=nn,tn.gnormx=q.body.axisy*tn.lnormx-q.body.axisx*tn.lnormy,tn.gnormy=tn.lnormx*q.body.axisx+tn.lnormy*q.body.axisy,tn.gprojection=q.body.posx*tn.gnormx+q.body.posy*tn.gnormy+tn.lprojection,null!=tn.wrap_gnorm&&(tn.wrap_gnorm.zpp_inner.x=tn.gnormx,tn.wrap_gnorm.zpp_inner.y=tn.gnormy),tn.tp0=tn.gp0.y*tn.gnormx-tn.gp0.x*tn.gnormy,tn.tp1=tn.gp1.y*tn.gnormx-tn.gp1.x*tn.gnormy,$=nn,Q=Q.next}var en=H.elt;en.gp0=$,en.gp1=q.gverts.next,en.gnormx=q.body.axisy*en.lnormx-q.body.axisx*en.lnormy,en.gnormy=en.lnormx*q.body.axisx+en.lnormy*q.body.axisy,en.gprojection=q.body.posx*en.gnormx+q.body.posy*en.gnormy+en.lprojection,null!=en.wrap_gnorm&&(en.wrap_gnorm.zpp_inner.x=en.gnormx,en.wrap_gnorm.zpp_inner.y=en.gnormy),en.tp0=en.gp0.y*en.gnormx-en.gp0.x*en.gnormy,en.tp1=en.gp1.y*en.gnormx-en.gp1.x*en.gnormy}},ee.prototype.shapesInAABB=function(n,t,e,i,p){return null},ee.prototype.bodiesInAABB=function(n,t,e,i,p){return null},ee.prototype.circShape=null,ee.prototype.updateCircShape=function(n,t,e){var i,p,l,r,o,a,s,_,h,u,x,d,y,z,c,v,m,f,b,g,w;null==this.circShape?(null==Ll.BodyType_STATIC&&(Ll.internal=!0,Ll.BodyType_STATIC=new rn,Ll.internal=!1),i=new ln(Ll.BodyType_STATIC).zpp_inner.wrap_shapes,null==Ri.poolVec2?p=new at:(p=Ri.poolVec2,Ri.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==mo.zpp_pool?l=new mo:(l=mo.zpp_pool,mo.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=t,p.zpp_inner=l,p.zpp_inner.outer=p):(null!=(r=p.zpp_inner)._validate&&r._validate(),p.zpp_inner.x==n&&(null!=(o=p.zpp_inner)._validate&&o._validate(),p.zpp_inner.y==t)||(p.zpp_inner.x=n,p.zpp_inner.y=t,null!=(a=p.zpp_inner)._invalidate&&a._invalidate(a))),p.zpp_inner.weak=!1,s=this.circShape=new dn(e,p),i.zpp_inner.reverse_flag?i.push(s):i.unshift(s)):(h=e/(_=this.circShape.zpp_inner.circle).radius,null==this.matrix&&(this.matrix=new pn),u=this.matrix,(x=this.matrix).zpp_inner.d=h,null!=(d=x.zpp_inner)._invalidate&&d._invalidate(),u.zpp_inner.a=x.zpp_inner.d,null!=(y=u.zpp_inner)._invalidate&&y._invalidate(),z=this.matrix,(c=this.matrix).zpp_inner.c=0,null!=(v=c.zpp_inner)._invalidate&&v._invalidate(),z.zpp_inner.b=c.zpp_inner.c,null!=(m=z.zpp_inner)._invalidate&&m._invalidate(),(f=this.matrix).zpp_inner.tx=n-h*_.localCOMx,null!=(b=f.zpp_inner)._invalidate&&b._invalidate(),(g=this.matrix).zpp_inner.ty=t-h*_.localCOMy,null!=(w=g.zpp_inner)._invalidate&&w._invalidate(),this.circShape.transform(this.matrix));var M=this.circShape.zpp_inner;if(M.zip_aabb&&null!=M.body)if(M.zip_aabb=!1,0==M.type){var C=M.circle;if(C.zip_worldCOM&&null!=C.body){if(C.zip_worldCOM=!1,C.zip_localCOM){if(C.zip_localCOM=!1,1==C.type){var k=C.polygon;if(null==k.lverts.next.next)k.localCOMx=k.lverts.next.x,k.localCOMy=k.lverts.next.y;else if(null==k.lverts.next.next.next)k.localCOMx=k.lverts.next.x,k.localCOMy=k.lverts.next.y,k.localCOMx+=k.lverts.next.next.x,k.localCOMy+=k.lverts.next.next.y,k.localCOMx*=.5,k.localCOMy*=.5;else{k.localCOMx=0;var O=k.localCOMy=0,P=k.lverts.next,S=P,A=P=P.next;for(P=P.next;null!=P;){var j=P;O+=A.x*(j.y-S.y);var E=j.y*A.x-j.x*A.y;k.localCOMx+=(A.x+j.x)*E,k.localCOMy+=(A.y+j.y)*E,S=A,A=j,P=P.next}var I=P=k.lverts.next;O+=A.x*(I.y-S.y);var T=I.y*A.x-I.x*A.y;k.localCOMx+=(A.x+I.x)*T,k.localCOMy+=(A.y+I.y)*T,S=A;var N=P=P.next;O+=I.x*(N.y-S.y);var L=N.y*I.x-N.x*I.y;k.localCOMx+=(I.x+N.x)*L,k.localCOMy+=(I.y+N.y)*L;var V=O=1/(3*O);k.localCOMx*=V,k.localCOMy*=V}}null!=C.wrap_localCOM&&(C.wrap_localCOM.zpp_inner.x=C.localCOMx,C.wrap_localCOM.zpp_inner.y=C.localCOMy)}var D=C.body;D.zip_axis&&(D.zip_axis=!1,D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot)),C.worldCOMx=C.body.posx+(C.body.axisy*C.localCOMx-C.body.axisx*C.localCOMy),C.worldCOMy=C.body.posy+(C.localCOMx*C.body.axisx+C.localCOMy*C.body.axisy)}var F=C.radius,R=C.radius;C.aabb.minx=C.worldCOMx-F,C.aabb.miny=C.worldCOMy-R,C.aabb.maxx=C.worldCOMx+F,C.aabb.maxy=C.worldCOMy+R}else{var Z=M.polygon;if(Z.zip_gverts&&null!=Z.body){Z.zip_gverts=!1,Z.validate_lverts();var B=Z.body;B.zip_axis&&(B.zip_axis=!1,B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot));for(var G=Z.lverts.next,q=Z.gverts.next;null!=q;){var U=q,K=G,G=G.next;U.x=Z.body.posx+(Z.body.axisy*K.x-Z.body.axisx*K.y),U.y=Z.body.posy+(K.x*Z.body.axisx+K.y*Z.body.axisy),q=q.next}}var W=Z.gverts.next;Z.aabb.minx=W.x,Z.aabb.miny=W.y,Z.aabb.maxx=W.x,Z.aabb.maxy=W.y;for(var Y=Z.gverts.next.next;null!=Y;){var J=Y;J.x<Z.aabb.minx&&(Z.aabb.minx=J.x),J.x>Z.aabb.maxx&&(Z.aabb.maxx=J.x),J.y<Z.aabb.miny&&(Z.aabb.miny=J.y),J.y>Z.aabb.maxy&&(Z.aabb.maxy=J.y),Y=Y.next}}},ee.prototype.shapesInCircle=function(n,t,e,i,p,l){return null},ee.prototype.bodiesInCircle=function(n,t,e,i,p,l){return null},ee.prototype.validateShape=function(n){if(1==n.type){var t=n.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var e=t.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var i=t.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var p=t.lverts.next,l=t.gverts.next;null!=l;){var r=l,o=p,p=p.next;r.x=t.body.posx+(t.body.axisy*o.x-t.body.axisx*o.y),r.y=t.body.posy+(o.x*t.body.axisx+o.y*t.body.axisy),l=l.next}}for(var a=t.edges.head,s=_=t.gverts.next,_=_.next;null!=_;){var h=_,u=a.elt,a=a.next;u.gp0=s,u.gp1=h,u.gnormx=t.body.axisy*u.lnormx-t.body.axisx*u.lnormy,u.gnormy=u.lnormx*t.body.axisx+u.lnormy*t.body.axisy,u.gprojection=t.body.posx*u.gnormx+t.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,s=h,_=_.next}var x=a.elt;x.gp0=s,x.gp1=t.gverts.next,x.gnormx=t.body.axisy*x.lnormx-t.body.axisx*x.lnormy,x.gnormy=x.lnormx*t.body.axisx+x.lnormy*t.body.axisy,x.gprojection=t.body.posx*x.gnormx+t.body.posy*x.gnormy+x.lprojection,null!=x.wrap_gnorm&&(x.wrap_gnorm.zpp_inner.x=x.gnormx,x.wrap_gnorm.zpp_inner.y=x.gnormy),x.tp0=x.gp0.y*x.gnormx-x.gp0.x*x.gnormy,x.tp1=x.gp1.y*x.gnormx-x.gp1.x*x.gnormy}}if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var d=n.circle;if(d.zip_worldCOM&&null!=d.body){if(d.zip_worldCOM=!1,d.zip_localCOM){if(d.zip_localCOM=!1,1==d.type){var y=d.polygon;if(null==y.lverts.next.next)y.localCOMx=y.lverts.next.x,y.localCOMy=y.lverts.next.y;else if(null==y.lverts.next.next.next)y.localCOMx=y.lverts.next.x,y.localCOMy=y.lverts.next.y,y.localCOMx+=y.lverts.next.next.x,y.localCOMy+=y.lverts.next.next.y,y.localCOMx*=.5,y.localCOMy*=.5;else{y.localCOMx=0;var z=y.localCOMy=0,c=y.lverts.next,v=c,m=c=c.next;for(c=c.next;null!=c;){var f=c;z+=m.x*(f.y-v.y);var b=f.y*m.x-f.x*m.y;y.localCOMx+=(m.x+f.x)*b,y.localCOMy+=(m.y+f.y)*b,v=m,m=f,c=c.next}var g=c=y.lverts.next;z+=m.x*(g.y-v.y);var w=g.y*m.x-g.x*m.y;y.localCOMx+=(m.x+g.x)*w,y.localCOMy+=(m.y+g.y)*w,v=m;var M=c=c.next;z+=g.x*(M.y-v.y);var C=M.y*g.x-M.x*g.y;y.localCOMx+=(g.x+M.x)*C,y.localCOMy+=(g.y+M.y)*C;var k=z=1/(3*z);y.localCOMx*=k,y.localCOMy*=k}}null!=d.wrap_localCOM&&(d.wrap_localCOM.zpp_inner.x=d.localCOMx,d.wrap_localCOM.zpp_inner.y=d.localCOMy)}var O=d.body;O.zip_axis&&(O.zip_axis=!1,O.axisx=Math.sin(O.rot),O.axisy=Math.cos(O.rot)),d.worldCOMx=d.body.posx+(d.body.axisy*d.localCOMx-d.body.axisx*d.localCOMy),d.worldCOMy=d.body.posy+(d.localCOMx*d.body.axisx+d.localCOMy*d.body.axisy)}var P=d.radius,S=d.radius;d.aabb.minx=d.worldCOMx-P,d.aabb.miny=d.worldCOMy-S,d.aabb.maxx=d.worldCOMx+P,d.aabb.maxy=d.worldCOMy+S}else{var A=n.polygon;if(A.zip_gverts&&null!=A.body){A.zip_gverts=!1,A.validate_lverts();var j=A.body;j.zip_axis&&(j.zip_axis=!1,j.axisx=Math.sin(j.rot),j.axisy=Math.cos(j.rot));for(var E=A.lverts.next,I=A.gverts.next;null!=I;){var T=I,N=E,E=E.next;T.x=A.body.posx+(A.body.axisy*N.x-A.body.axisx*N.y),T.y=A.body.posy+(N.x*A.body.axisx+N.y*A.body.axisy),I=I.next}}var L=A.gverts.next;A.aabb.minx=L.x,A.aabb.miny=L.y,A.aabb.maxx=L.x,A.aabb.maxy=L.y;for(var V=A.gverts.next.next;null!=V;){var D=V;D.x<A.aabb.minx&&(A.aabb.minx=D.x),D.x>A.aabb.maxx&&(A.aabb.maxx=D.x),D.y<A.aabb.miny&&(A.aabb.miny=D.y),D.y>A.aabb.maxy&&(A.aabb.maxy=D.y),V=V.next}}if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var F=n.polygon;if(null==F.lverts.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y;else if(null==F.lverts.next.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y,F.localCOMx+=F.lverts.next.next.x,F.localCOMy+=F.lverts.next.next.y,F.localCOMx*=.5,F.localCOMy*=.5;else{F.localCOMx=0;var R=F.localCOMy=0,Z=F.lverts.next,B=Z,G=Z=Z.next;for(Z=Z.next;null!=Z;){var q=Z;R+=G.x*(q.y-B.y);var U=q.y*G.x-q.x*G.y;F.localCOMx+=(G.x+q.x)*U,F.localCOMy+=(G.y+q.y)*U,B=G,G=q,Z=Z.next}var K=Z=F.lverts.next;R+=G.x*(K.y-B.y);var W=K.y*G.x-K.x*G.y;F.localCOMx+=(G.x+K.x)*W,F.localCOMy+=(G.y+K.y)*W,B=G;var Y=Z=Z.next;R+=K.x*(Y.y-B.y);var J=Y.y*K.x-Y.x*K.y;F.localCOMx+=(K.x+Y.x)*J,F.localCOMy+=(K.y+Y.y)*J;var X=R=1/(3*R);F.localCOMx*=X,F.localCOMy*=X}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var H=n.body;H.zip_axis&&(H.zip_axis=!1,H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}},ee.prototype.shapesInShape=function(n,t,e,i){return null},ee.prototype.bodiesInShape=function(n,t,e,i){return null},ee.prototype.rayCast=function(n,t,e){return null},ee.prototype.rayMultiCast=function(n,t,e,i){return null},ee.prototype.__class__=ee;var jl=zpp_nape.space.ZPP_AABBNode=function(){this.first_sync=!1,this.synced=!1,this.snext=null,this.moved=!1,this.mnext=null,this.next=null,this.rayt=0,this.height=0,this.child2=null,this.child1=null,this.parent=null,this.dyn=!1,this.shape=null,this.aabb=null,this.height=-1};jl.__name__=["zpp_nape","space","ZPP_AABBNode"],jl.prototype.aabb=null,jl.prototype.shape=null,jl.prototype.dyn=null,jl.prototype.parent=null,jl.prototype.child1=null,jl.prototype.child2=null,jl.prototype.height=null,jl.prototype.rayt=null,jl.prototype.next=null,jl.prototype.alloc=function(){null==Al.zpp_pool?this.aabb=new Al:(this.aabb=Al.zpp_pool,Al.zpp_pool=this.aabb.next,this.aabb.next=null),this.moved=!1,this.synced=!1,this.first_sync=!1},jl.prototype.free=function(){this.height=-1;var n=this.aabb;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Al.zpp_pool,Al.zpp_pool=n,this.child1=this.child2=this.parent=null,this.next=null,this.snext=null,this.mnext=null},jl.prototype.mnext=null,jl.prototype.moved=null,jl.prototype.snext=null,jl.prototype.synced=null,jl.prototype.first_sync=null,jl.prototype.isLeaf=function(){return null==this.child1},jl.prototype.__class__=jl;var ep=zpp_nape.space.ZPP_AABBPair=function(){this.next=null,this.arb=null,this.di=0,this.id=0,this.sleeping=!1,this.first=!1,this.n2=null,this.n1=null};ep.__name__=["zpp_nape","space","ZPP_AABBPair"],ep.prototype.n1=null,ep.prototype.n2=null,ep.prototype.first=null,ep.prototype.sleeping=null,ep.prototype.id=null,ep.prototype.di=null,ep.prototype.arb=null,ep.prototype.next=null,ep.prototype.alloc=function(){},ep.prototype.free=function(){this.n1=this.n2=null,this.sleeping=!1},ep.prototype.__class__=ep;var El=zpp_nape.space.ZPP_AABBTree=function(){this.root=null};El.__name__=["zpp_nape","space","ZPP_AABBTree"],El.prototype.root=null,El.prototype.clear=function(){if(null!=this.root){var n=null;for(this.root.next=n,n=this.root;null!=n;){var t=n,n=t.next;(t.next=null)==t.child1?(t.shape.node=null,t.shape.removedFromSpace(),t.shape=null):(null!=t.child1&&(t.child1.next=n,n=t.child1),null!=t.child2&&(t.child2.next=n,n=t.child2)),t.height=-1;var e=t.aabb;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e.wrap_min=e.wrap_max=null,e._invalidate=null,e._validate=null,e.next=Al.zpp_pool,Al.zpp_pool=e,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=jl.zpp_pool,jl.zpp_pool=t}this.root=null}},El.prototype.insertLeaf=function(n){if(null==this.root)this.root=n,this.root.parent=null;else{for(var t=n.aabb,e=this.root;null!=e.child1;){var i=e.child1,p=e.child2,l=e.aabb,r=2*(l.maxx-l.minx+(l.maxy-l.miny)),o=El.tmpaabb,a=e.aabb;o.minx=a.minx<t.minx?a.minx:t.minx,o.miny=a.miny<t.miny?a.miny:t.miny,o.maxx=a.maxx>t.maxx?a.maxx:t.maxx,o.maxy=a.maxy>t.maxy?a.maxy:t.maxy;var s,_,h,u,x,d=El.tmpaabb,y=2*(d.maxx-d.minx+(d.maxy-d.miny)),z=2*y,c=2*(y-r),v=El.tmpaabb,m=i.aabb;v.minx=t.minx<m.minx?t.minx:m.minx,v.miny=t.miny<m.miny?t.miny:m.miny,v.maxx=t.maxx>m.maxx?t.maxx:m.maxx,v.maxy=t.maxy>m.maxy?t.maxy:m.maxy,_=null==i.child1?2*((s=El.tmpaabb).maxx-s.minx+(s.maxy-s.miny))+c:(u=2*((h=i.aabb).maxx-h.minx+(h.maxy-h.miny)),2*((x=El.tmpaabb).maxx-x.minx+(x.maxy-x.miny))-u+c);var f,b,g,w,M,C=El.tmpaabb,k=p.aabb;if(C.minx=t.minx<k.minx?t.minx:k.minx,C.miny=t.miny<k.miny?t.miny:k.miny,C.maxx=t.maxx>k.maxx?t.maxx:k.maxx,C.maxy=t.maxy>k.maxy?t.maxy:k.maxy,b=null==p.child1?2*((f=El.tmpaabb).maxx-f.minx+(f.maxy-f.miny))+c:(w=2*((g=p.aabb).maxx-g.minx+(g.maxy-g.miny)),2*((M=El.tmpaabb).maxx-M.minx+(M.maxy-M.miny))-w+c),z<_&&z<b)break;e=_<b?i:p}var O,P=e,S=P.parent;null==jl.zpp_pool?O=new jl:(O=jl.zpp_pool,jl.zpp_pool=O.next,O.next=null),null==Al.zpp_pool?O.aabb=new Al:(O.aabb=Al.zpp_pool,Al.zpp_pool=O.aabb.next,O.aabb.next=null),O.moved=!1,O.synced=!1,O.first_sync=!1,O.parent=S;var A,j,E,I,T,N,L,V,D,F,R,Z,B,G,q,U,K,W,Y,J,X,H,$,Q,nn,tn,en,pn,ln,rn,on,an,sn,_n,hn,un,xn,dn,yn,zn,cn,vn,mn,fn,bn,gn,wn,Mn=O.aabb,Cn=P.aabb;for(Mn.minx=t.minx<Cn.minx?t.minx:Cn.minx,Mn.miny=t.miny<Cn.miny?t.miny:Cn.miny,Mn.maxx=t.maxx>Cn.maxx?t.maxx:Cn.maxx,Mn.maxy=t.maxy>Cn.maxy?t.maxy:Cn.maxy,O.height=P.height+1,null!=S?(S.child1==P?S.child1=O:S.child2=O,O.child1=P,O.child2=n,P.parent=O,n.parent=O):(O.child1=P,O.child2=n,P.parent=O,n.parent=O,this.root=O),e=n.parent;null!=e;){null==e.child1||e.height<2||(A=e.child1,1<(E=(j=e.child2).height-A.height)?(I=j.child1,T=j.child2,j.child1=e,j.parent=e.parent,null!=(e.parent=j).parent?j.parent.child1==e?j.parent.child1=j:j.parent.child2=j:this.root=j,I.height>T.height?(j.child2=I,N=((e.child2=T).parent=e).aabb,L=A.aabb,V=T.aabb,N.minx=L.minx<V.minx?L.minx:V.minx,N.miny=L.miny<V.miny?L.miny:V.miny,N.maxx=L.maxx>V.maxx?L.maxx:V.maxx,N.maxy=L.maxy>V.maxy?L.maxy:V.maxy,D=j.aabb,F=e.aabb,R=I.aabb,D.minx=F.minx<R.minx?F.minx:R.minx,D.miny=F.miny<R.miny?F.miny:R.miny,D.maxx=F.maxx>R.maxx?F.maxx:R.maxx,D.maxy=F.maxy>R.maxy?F.maxy:R.maxy,Z=A.height,B=T.height,e.height=1+(B<Z?Z:B),G=e.height,q=I.height,j.height=1+(q<G?G:q)):(j.child2=T,U=((e.child2=I).parent=e).aabb,K=A.aabb,W=I.aabb,U.minx=K.minx<W.minx?K.minx:W.minx,U.miny=K.miny<W.miny?K.miny:W.miny,U.maxx=K.maxx>W.maxx?K.maxx:W.maxx,U.maxy=K.maxy>W.maxy?K.maxy:W.maxy,Y=j.aabb,J=e.aabb,X=T.aabb,Y.minx=J.minx<X.minx?J.minx:X.minx,Y.miny=J.miny<X.miny?J.miny:X.miny,Y.maxx=J.maxx>X.maxx?J.maxx:X.maxx,Y.maxy=J.maxy>X.maxy?J.maxy:X.maxy,H=A.height,$=I.height,e.height=1+($<H?H:$),Q=e.height,nn=T.height,j.height=1+(nn<Q?Q:nn)),e=j):E<-1&&(tn=A.child1,en=A.child2,A.child1=e,A.parent=e.parent,null!=(e.parent=A).parent?A.parent.child1==e?A.parent.child1=A:A.parent.child2=A:this.root=A,tn.height>en.height?(A.child2=tn,pn=((e.child1=en).parent=e).aabb,ln=j.aabb,rn=en.aabb,pn.minx=ln.minx<rn.minx?ln.minx:rn.minx,pn.miny=ln.miny<rn.miny?ln.miny:rn.miny,pn.maxx=ln.maxx>rn.maxx?ln.maxx:rn.maxx,pn.maxy=ln.maxy>rn.maxy?ln.maxy:rn.maxy,on=A.aabb,an=e.aabb,sn=tn.aabb,on.minx=an.minx<sn.minx?an.minx:sn.minx,on.miny=an.miny<sn.miny?an.miny:sn.miny,on.maxx=an.maxx>sn.maxx?an.maxx:sn.maxx,on.maxy=an.maxy>sn.maxy?an.maxy:sn.maxy,_n=j.height,hn=en.height,e.height=1+(hn<_n?_n:hn),un=e.height,xn=tn.height,A.height=1+(xn<un?un:xn)):(A.child2=en,dn=((e.child1=tn).parent=e).aabb,yn=j.aabb,zn=tn.aabb,dn.minx=yn.minx<zn.minx?yn.minx:zn.minx,dn.miny=yn.miny<zn.miny?yn.miny:zn.miny,dn.maxx=yn.maxx>zn.maxx?yn.maxx:zn.maxx,dn.maxy=yn.maxy>zn.maxy?yn.maxy:zn.maxy,cn=A.aabb,vn=e.aabb,mn=en.aabb,cn.minx=vn.minx<mn.minx?vn.minx:mn.minx,cn.miny=vn.miny<mn.miny?vn.miny:mn.miny,cn.maxx=vn.maxx>mn.maxx?vn.maxx:mn.maxx,cn.maxy=vn.maxy>mn.maxy?vn.maxy:mn.maxy,fn=j.height,bn=tn.height,e.height=1+(bn<fn?fn:bn),gn=e.height,wn=en.height,A.height=1+(wn<gn?gn:wn)),e=A));var kn=e.child1,On=e.child2,Pn=kn.height,Sn=On.height;e.height=1+(Sn<Pn?Pn:Sn);var An=e.aabb,jn=kn.aabb,En=On.aabb;An.minx=jn.minx<En.minx?jn.minx:En.minx,An.miny=jn.miny<En.miny?jn.miny:En.miny,An.maxx=jn.maxx>En.maxx?jn.maxx:En.maxx,An.maxy=jn.maxy>En.maxy?jn.maxy:En.maxy,e=e.parent}}},El.prototype.inlined_insertLeaf=function(n){if(null==this.root)this.root=n,this.root.parent=null;else{for(var t=n.aabb,e=this.root;null!=e.child1;){var i=e.child1,p=e.child2,l=e.aabb,r=2*(l.maxx-l.minx+(l.maxy-l.miny)),o=El.tmpaabb,a=e.aabb;o.minx=a.minx<t.minx?a.minx:t.minx,o.miny=a.miny<t.miny?a.miny:t.miny,o.maxx=a.maxx>t.maxx?a.maxx:t.maxx,o.maxy=a.maxy>t.maxy?a.maxy:t.maxy;var s,_,h,u,x,d=El.tmpaabb,y=2*(d.maxx-d.minx+(d.maxy-d.miny)),z=2*y,c=2*(y-r),v=El.tmpaabb,m=i.aabb;v.minx=t.minx<m.minx?t.minx:m.minx,v.miny=t.miny<m.miny?t.miny:m.miny,v.maxx=t.maxx>m.maxx?t.maxx:m.maxx,v.maxy=t.maxy>m.maxy?t.maxy:m.maxy,_=null==i.child1?2*((s=El.tmpaabb).maxx-s.minx+(s.maxy-s.miny))+c:(u=2*((h=i.aabb).maxx-h.minx+(h.maxy-h.miny)),2*((x=El.tmpaabb).maxx-x.minx+(x.maxy-x.miny))-u+c);var f,b,g,w,M,C=El.tmpaabb,k=p.aabb;if(C.minx=t.minx<k.minx?t.minx:k.minx,C.miny=t.miny<k.miny?t.miny:k.miny,C.maxx=t.maxx>k.maxx?t.maxx:k.maxx,C.maxy=t.maxy>k.maxy?t.maxy:k.maxy,b=null==p.child1?2*((f=El.tmpaabb).maxx-f.minx+(f.maxy-f.miny))+c:(w=2*((g=p.aabb).maxx-g.minx+(g.maxy-g.miny)),2*((M=El.tmpaabb).maxx-M.minx+(M.maxy-M.miny))-w+c),z<_&&z<b)break;e=_<b?i:p}var O,P=e,S=P.parent;null==jl.zpp_pool?O=new jl:(O=jl.zpp_pool,jl.zpp_pool=O.next,O.next=null),null==Al.zpp_pool?O.aabb=new Al:(O.aabb=Al.zpp_pool,Al.zpp_pool=O.aabb.next,O.aabb.next=null),O.moved=!1,O.synced=!1,O.first_sync=!1,O.parent=S;var A,j,E,I,T,N,L,V,D,F,R,Z,B,G,q,U,K,W,Y,J,X,H,$,Q,nn,tn,en,pn,ln,rn,on,an,sn,_n,hn,un,xn,dn,yn,zn,cn,vn,mn,fn,bn,gn,wn,Mn=O.aabb,Cn=P.aabb;for(Mn.minx=t.minx<Cn.minx?t.minx:Cn.minx,Mn.miny=t.miny<Cn.miny?t.miny:Cn.miny,Mn.maxx=t.maxx>Cn.maxx?t.maxx:Cn.maxx,Mn.maxy=t.maxy>Cn.maxy?t.maxy:Cn.maxy,O.height=P.height+1,null!=S?(S.child1==P?S.child1=O:S.child2=O,O.child1=P,O.child2=n,P.parent=O,n.parent=O):(O.child1=P,O.child2=n,P.parent=O,n.parent=O,this.root=O),e=n.parent;null!=e;){null==e.child1||e.height<2||(A=e.child1,1<(E=(j=e.child2).height-A.height)?(I=j.child1,T=j.child2,j.child1=e,j.parent=e.parent,null!=(e.parent=j).parent?j.parent.child1==e?j.parent.child1=j:j.parent.child2=j:this.root=j,I.height>T.height?(j.child2=I,N=((e.child2=T).parent=e).aabb,L=A.aabb,V=T.aabb,N.minx=L.minx<V.minx?L.minx:V.minx,N.miny=L.miny<V.miny?L.miny:V.miny,N.maxx=L.maxx>V.maxx?L.maxx:V.maxx,N.maxy=L.maxy>V.maxy?L.maxy:V.maxy,D=j.aabb,F=e.aabb,R=I.aabb,D.minx=F.minx<R.minx?F.minx:R.minx,D.miny=F.miny<R.miny?F.miny:R.miny,D.maxx=F.maxx>R.maxx?F.maxx:R.maxx,D.maxy=F.maxy>R.maxy?F.maxy:R.maxy,Z=A.height,B=T.height,e.height=1+(B<Z?Z:B),G=e.height,q=I.height,j.height=1+(q<G?G:q)):(j.child2=T,U=((e.child2=I).parent=e).aabb,K=A.aabb,W=I.aabb,U.minx=K.minx<W.minx?K.minx:W.minx,U.miny=K.miny<W.miny?K.miny:W.miny,U.maxx=K.maxx>W.maxx?K.maxx:W.maxx,U.maxy=K.maxy>W.maxy?K.maxy:W.maxy,Y=j.aabb,J=e.aabb,X=T.aabb,Y.minx=J.minx<X.minx?J.minx:X.minx,Y.miny=J.miny<X.miny?J.miny:X.miny,Y.maxx=J.maxx>X.maxx?J.maxx:X.maxx,Y.maxy=J.maxy>X.maxy?J.maxy:X.maxy,H=A.height,$=I.height,e.height=1+($<H?H:$),Q=e.height,nn=T.height,j.height=1+(nn<Q?Q:nn)),e=j):E<-1&&(tn=A.child1,en=A.child2,A.child1=e,A.parent=e.parent,null!=(e.parent=A).parent?A.parent.child1==e?A.parent.child1=A:A.parent.child2=A:this.root=A,tn.height>en.height?(A.child2=tn,pn=((e.child1=en).parent=e).aabb,ln=j.aabb,rn=en.aabb,pn.minx=ln.minx<rn.minx?ln.minx:rn.minx,pn.miny=ln.miny<rn.miny?ln.miny:rn.miny,pn.maxx=ln.maxx>rn.maxx?ln.maxx:rn.maxx,pn.maxy=ln.maxy>rn.maxy?ln.maxy:rn.maxy,on=A.aabb,an=e.aabb,sn=tn.aabb,on.minx=an.minx<sn.minx?an.minx:sn.minx,on.miny=an.miny<sn.miny?an.miny:sn.miny,on.maxx=an.maxx>sn.maxx?an.maxx:sn.maxx,on.maxy=an.maxy>sn.maxy?an.maxy:sn.maxy,_n=j.height,hn=en.height,e.height=1+(hn<_n?_n:hn),un=e.height,xn=tn.height,A.height=1+(xn<un?un:xn)):(A.child2=en,dn=((e.child1=tn).parent=e).aabb,yn=j.aabb,zn=tn.aabb,dn.minx=yn.minx<zn.minx?yn.minx:zn.minx,dn.miny=yn.miny<zn.miny?yn.miny:zn.miny,dn.maxx=yn.maxx>zn.maxx?yn.maxx:zn.maxx,dn.maxy=yn.maxy>zn.maxy?yn.maxy:zn.maxy,cn=A.aabb,vn=e.aabb,mn=en.aabb,cn.minx=vn.minx<mn.minx?vn.minx:mn.minx,cn.miny=vn.miny<mn.miny?vn.miny:mn.miny,cn.maxx=vn.maxx>mn.maxx?vn.maxx:mn.maxx,cn.maxy=vn.maxy>mn.maxy?vn.maxy:mn.maxy,fn=j.height,bn=tn.height,e.height=1+(bn<fn?fn:bn),gn=e.height,wn=en.height,A.height=1+(wn<gn?gn:wn)),e=A));var kn=e.child1,On=e.child2,Pn=kn.height,Sn=On.height;e.height=1+(Sn<Pn?Pn:Sn);var An=e.aabb,jn=kn.aabb,En=On.aabb;An.minx=jn.minx<En.minx?jn.minx:En.minx,An.miny=jn.miny<En.miny?jn.miny:En.miny,An.maxx=jn.maxx>En.maxx?jn.maxx:En.maxx,An.maxy=jn.maxy>En.maxy?jn.maxy:En.maxy,e=e.parent}}},El.prototype.removeLeaf=function(n){if(n==this.root)this.root=null;else{var t=n.parent,e=t.parent,i=t.child1==n?t.child2:t.child1;if(null!=e){e.child1==t?e.child1=i:e.child2=i,i.parent=e,t.height=-1;var p=t.aabb;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=Al.zpp_pool,Al.zpp_pool=p,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=jl.zpp_pool,jl.zpp_pool=t;for(var l,r,o,a,s,_,h,u,x,d,y,z,c,v,m,f,b,g,w,M,C,k,O,P,S,A,j,E,I,T,N,L,V,D,F,R,Z,B,G,q,U,K,W,Y,J,X,H,$=e;null!=$;){null==$.child1||$.height<2||(l=$.child1,1<(o=(r=$.child2).height-l.height)?(a=r.child1,s=r.child2,r.child1=$,r.parent=$.parent,null!=($.parent=r).parent?r.parent.child1==$?r.parent.child1=r:r.parent.child2=r:this.root=r,a.height>s.height?(r.child2=a,_=(($.child2=s).parent=$).aabb,h=l.aabb,u=s.aabb,_.minx=h.minx<u.minx?h.minx:u.minx,_.miny=h.miny<u.miny?h.miny:u.miny,_.maxx=h.maxx>u.maxx?h.maxx:u.maxx,_.maxy=h.maxy>u.maxy?h.maxy:u.maxy,x=r.aabb,d=$.aabb,y=a.aabb,x.minx=d.minx<y.minx?d.minx:y.minx,x.miny=d.miny<y.miny?d.miny:y.miny,x.maxx=d.maxx>y.maxx?d.maxx:y.maxx,x.maxy=d.maxy>y.maxy?d.maxy:y.maxy,z=l.height,c=s.height,$.height=1+(c<z?z:c),v=$.height,m=a.height,r.height=1+(m<v?v:m)):(r.child2=s,f=(($.child2=a).parent=$).aabb,b=l.aabb,g=a.aabb,f.minx=b.minx<g.minx?b.minx:g.minx,f.miny=b.miny<g.miny?b.miny:g.miny,f.maxx=b.maxx>g.maxx?b.maxx:g.maxx,f.maxy=b.maxy>g.maxy?b.maxy:g.maxy,w=r.aabb,M=$.aabb,C=s.aabb,w.minx=M.minx<C.minx?M.minx:C.minx,w.miny=M.miny<C.miny?M.miny:C.miny,w.maxx=M.maxx>C.maxx?M.maxx:C.maxx,w.maxy=M.maxy>C.maxy?M.maxy:C.maxy,k=l.height,O=a.height,$.height=1+(O<k?k:O),P=$.height,S=s.height,r.height=1+(S<P?P:S)),$=r):o<-1&&(A=l.child1,j=l.child2,l.child1=$,l.parent=$.parent,null!=($.parent=l).parent?l.parent.child1==$?l.parent.child1=l:l.parent.child2=l:this.root=l,A.height>j.height?(l.child2=A,E=(($.child1=j).parent=$).aabb,I=r.aabb,T=j.aabb,E.minx=I.minx<T.minx?I.minx:T.minx,E.miny=I.miny<T.miny?I.miny:T.miny,E.maxx=I.maxx>T.maxx?I.maxx:T.maxx,E.maxy=I.maxy>T.maxy?I.maxy:T.maxy,N=l.aabb,L=$.aabb,V=A.aabb,N.minx=L.minx<V.minx?L.minx:V.minx,N.miny=L.miny<V.miny?L.miny:V.miny,N.maxx=L.maxx>V.maxx?L.maxx:V.maxx,N.maxy=L.maxy>V.maxy?L.maxy:V.maxy,D=r.height,F=j.height,$.height=1+(F<D?D:F),R=$.height,Z=A.height,l.height=1+(Z<R?R:Z)):(l.child2=j,B=(($.child1=A).parent=$).aabb,G=r.aabb,q=A.aabb,B.minx=G.minx<q.minx?G.minx:q.minx,B.miny=G.miny<q.miny?G.miny:q.miny,B.maxx=G.maxx>q.maxx?G.maxx:q.maxx,B.maxy=G.maxy>q.maxy?G.maxy:q.maxy,U=l.aabb,K=$.aabb,W=j.aabb,U.minx=K.minx<W.minx?K.minx:W.minx,U.miny=K.miny<W.miny?K.miny:W.miny,U.maxx=K.maxx>W.maxx?K.maxx:W.maxx,U.maxy=K.maxy>W.maxy?K.maxy:W.maxy,Y=r.height,J=A.height,$.height=1+(J<Y?Y:J),X=$.height,H=j.height,l.height=1+(H<X?X:H)),$=l));var Q=$.child1,nn=$.child2,tn=$.aabb,en=Q.aabb,pn=nn.aabb;tn.minx=en.minx<pn.minx?en.minx:pn.minx,tn.miny=en.miny<pn.miny?en.miny:pn.miny,tn.maxx=en.maxx>pn.maxx?en.maxx:pn.maxx,tn.maxy=en.maxy>pn.maxy?en.maxy:pn.maxy;var ln=Q.height,rn=nn.height;$.height=1+(rn<ln?ln:rn),$=$.parent}}else{(this.root=i).parent=null,t.height=-1;var on=t.aabb;null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on.wrap_min=on.wrap_max=null,on._invalidate=null,on._validate=null,on.next=Al.zpp_pool,Al.zpp_pool=on,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=jl.zpp_pool,jl.zpp_pool=t}}},El.prototype.inlined_removeLeaf=function(n){if(n!=this.root){var t=n.parent,e=t.parent,i=t.child1==n?t.child2:t.child1;if(null!=e){e.child1==t?e.child1=i:e.child2=i,i.parent=e,t.height=-1;var p=t.aabb;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=Al.zpp_pool,Al.zpp_pool=p,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=jl.zpp_pool,jl.zpp_pool=t;for(var l,r,o,a,s,_,h,u,x,d,y,z,c,v,m,f,b,g,w,M,C,k,O,P,S,A,j,E,I,T,N,L,V,D,F,R,Z,B,G,q,U,K,W,Y,J,X,H,$=e;null!=$;){null==$.child1||$.height<2||(l=$.child1,1<(o=(r=$.child2).height-l.height)?(a=r.child1,s=r.child2,r.child1=$,r.parent=$.parent,null!=($.parent=r).parent?r.parent.child1==$?r.parent.child1=r:r.parent.child2=r:this.root=r,a.height>s.height?(r.child2=a,_=(($.child2=s).parent=$).aabb,h=l.aabb,u=s.aabb,_.minx=h.minx<u.minx?h.minx:u.minx,_.miny=h.miny<u.miny?h.miny:u.miny,_.maxx=h.maxx>u.maxx?h.maxx:u.maxx,_.maxy=h.maxy>u.maxy?h.maxy:u.maxy,x=r.aabb,d=$.aabb,y=a.aabb,x.minx=d.minx<y.minx?d.minx:y.minx,x.miny=d.miny<y.miny?d.miny:y.miny,x.maxx=d.maxx>y.maxx?d.maxx:y.maxx,x.maxy=d.maxy>y.maxy?d.maxy:y.maxy,z=l.height,c=s.height,$.height=1+(c<z?z:c),v=$.height,m=a.height,r.height=1+(m<v?v:m)):(r.child2=s,f=(($.child2=a).parent=$).aabb,b=l.aabb,g=a.aabb,f.minx=b.minx<g.minx?b.minx:g.minx,f.miny=b.miny<g.miny?b.miny:g.miny,f.maxx=b.maxx>g.maxx?b.maxx:g.maxx,f.maxy=b.maxy>g.maxy?b.maxy:g.maxy,w=r.aabb,M=$.aabb,C=s.aabb,w.minx=M.minx<C.minx?M.minx:C.minx,w.miny=M.miny<C.miny?M.miny:C.miny,w.maxx=M.maxx>C.maxx?M.maxx:C.maxx,w.maxy=M.maxy>C.maxy?M.maxy:C.maxy,k=l.height,O=a.height,$.height=1+(O<k?k:O),P=$.height,S=s.height,r.height=1+(S<P?P:S)),$=r):o<-1&&(A=l.child1,j=l.child2,l.child1=$,l.parent=$.parent,null!=($.parent=l).parent?l.parent.child1==$?l.parent.child1=l:l.parent.child2=l:this.root=l,A.height>j.height?(l.child2=A,E=(($.child1=j).parent=$).aabb,I=r.aabb,T=j.aabb,E.minx=I.minx<T.minx?I.minx:T.minx,E.miny=I.miny<T.miny?I.miny:T.miny,E.maxx=I.maxx>T.maxx?I.maxx:T.maxx,E.maxy=I.maxy>T.maxy?I.maxy:T.maxy,N=l.aabb,L=$.aabb,V=A.aabb,N.minx=L.minx<V.minx?L.minx:V.minx,N.miny=L.miny<V.miny?L.miny:V.miny,N.maxx=L.maxx>V.maxx?L.maxx:V.maxx,N.maxy=L.maxy>V.maxy?L.maxy:V.maxy,D=r.height,F=j.height,$.height=1+(F<D?D:F),R=$.height,Z=A.height,l.height=1+(Z<R?R:Z)):(l.child2=j,B=(($.child1=A).parent=$).aabb,G=r.aabb,q=A.aabb,B.minx=G.minx<q.minx?G.minx:q.minx,B.miny=G.miny<q.miny?G.miny:q.miny,B.maxx=G.maxx>q.maxx?G.maxx:q.maxx,B.maxy=G.maxy>q.maxy?G.maxy:q.maxy,U=l.aabb,K=$.aabb,W=j.aabb,U.minx=K.minx<W.minx?K.minx:W.minx,U.miny=K.miny<W.miny?K.miny:W.miny,U.maxx=K.maxx>W.maxx?K.maxx:W.maxx,U.maxy=K.maxy>W.maxy?K.maxy:W.maxy,Y=r.height,J=A.height,$.height=1+(J<Y?Y:J),X=$.height,H=j.height,l.height=1+(H<X?X:H)),$=l));var Q=$.child1,nn=$.child2,tn=$.aabb,en=Q.aabb,pn=nn.aabb;tn.minx=en.minx<pn.minx?en.minx:pn.minx,tn.miny=en.miny<pn.miny?en.miny:pn.miny,tn.maxx=en.maxx>pn.maxx?en.maxx:pn.maxx,tn.maxy=en.maxy>pn.maxy?en.maxy:pn.maxy;var ln=Q.height,rn=nn.height;$.height=1+(rn<ln?ln:rn),$=$.parent}}else{(this.root=i).parent=null,t.height=-1;var on=t.aabb;null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on.wrap_min=on.wrap_max=null,on._invalidate=null,on._validate=null,on.next=Al.zpp_pool,Al.zpp_pool=on,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=jl.zpp_pool,jl.zpp_pool=t}}else this.root=null},El.prototype.balance=function(n){if(null==n.child1||n.height<2)return n;var t=n.child1,e=n.child2,i=e.height-t.height;if(1<i){var p,l,r,o,a,s,_,h,u,x,d,y,z,c,v,m,f,b,g,w,M=e.child1,C=e.child2;return e.child1=n,e.parent=n.parent,null!=(n.parent=e).parent?e.parent.child1==n?e.parent.child1=e:e.parent.child2=e:this.root=e,M.height>C.height?(e.child2=M,p=((n.child2=C).parent=n).aabb,l=t.aabb,r=C.aabb,p.minx=l.minx<r.minx?l.minx:r.minx,p.miny=l.miny<r.miny?l.miny:r.miny,p.maxx=l.maxx>r.maxx?l.maxx:r.maxx,p.maxy=l.maxy>r.maxy?l.maxy:r.maxy,o=e.aabb,a=n.aabb,s=M.aabb,o.minx=a.minx<s.minx?a.minx:s.minx,o.miny=a.miny<s.miny?a.miny:s.miny,o.maxx=a.maxx>s.maxx?a.maxx:s.maxx,o.maxy=a.maxy>s.maxy?a.maxy:s.maxy,_=t.height,h=C.height,n.height=1+(h<_?_:h),u=n.height,x=M.height,e.height=1+(x<u?u:x)):(e.child2=C,d=((n.child2=M).parent=n).aabb,y=t.aabb,z=M.aabb,d.minx=y.minx<z.minx?y.minx:z.minx,d.miny=y.miny<z.miny?y.miny:z.miny,d.maxx=y.maxx>z.maxx?y.maxx:z.maxx,d.maxy=y.maxy>z.maxy?y.maxy:z.maxy,c=e.aabb,v=n.aabb,m=C.aabb,c.minx=v.minx<m.minx?v.minx:m.minx,c.miny=v.miny<m.miny?v.miny:m.miny,c.maxx=v.maxx>m.maxx?v.maxx:m.maxx,c.maxy=v.maxy>m.maxy?v.maxy:m.maxy,f=t.height,b=M.height,n.height=1+(b<f?f:b),g=n.height,w=C.height,e.height=1+(w<g?g:w)),e}if(i<-1){var k,O,P,S,A,j,E,I,T,N,L,V,D,F,R,Z,B,G,q,U,K=t.child1,W=t.child2;return t.child1=n,t.parent=n.parent,null!=(n.parent=t).parent?t.parent.child1==n?t.parent.child1=t:t.parent.child2=t:this.root=t,K.height>W.height?(t.child2=K,k=((n.child1=W).parent=n).aabb,O=e.aabb,P=W.aabb,k.minx=O.minx<P.minx?O.minx:P.minx,k.miny=O.miny<P.miny?O.miny:P.miny,k.maxx=O.maxx>P.maxx?O.maxx:P.maxx,k.maxy=O.maxy>P.maxy?O.maxy:P.maxy,S=t.aabb,A=n.aabb,j=K.aabb,S.minx=A.minx<j.minx?A.minx:j.minx,S.miny=A.miny<j.miny?A.miny:j.miny,S.maxx=A.maxx>j.maxx?A.maxx:j.maxx,S.maxy=A.maxy>j.maxy?A.maxy:j.maxy,E=e.height,I=W.height,n.height=1+(I<E?E:I),T=n.height,N=K.height,t.height=1+(N<T?T:N)):(t.child2=W,L=((n.child1=K).parent=n).aabb,V=e.aabb,D=K.aabb,L.minx=V.minx<D.minx?V.minx:D.minx,L.miny=V.miny<D.miny?V.miny:D.miny,L.maxx=V.maxx>D.maxx?V.maxx:D.maxx,L.maxy=V.maxy>D.maxy?V.maxy:D.maxy,F=t.aabb,R=n.aabb,Z=W.aabb,F.minx=R.minx<Z.minx?R.minx:Z.minx,F.miny=R.miny<Z.miny?R.miny:Z.miny,F.maxx=R.maxx>Z.maxx?R.maxx:Z.maxx,F.maxy=R.maxy>Z.maxy?R.maxy:Z.maxy,B=e.height,G=K.height,n.height=1+(G<B?B:G),q=n.height,U=W.height,t.height=1+(U<q?q:U)),t}return n},El.prototype.__class__=El;var ie=zpp_nape.space.ZPP_DynAABBPhase=function(n){this.openlist=null,this.failed=null,this.treeStack2=null,this.treeStack=null,this.moves=null,this.syncs=null,this.pairs=null,this.dtree=null,this.stree=null,ee.call(this),this.space=n,this.is_sweep=!1,(this.dynab=this).stree=new El,this.dtree=new El};ie.__name__=["zpp_nape","space","ZPP_DynAABBPhase"],ie.__super__=ee,ie.prototype=Object.create(ee.prototype),ie.prototype.stree=null,ie.prototype.dtree=null,ie.prototype.pairs=null,ie.prototype.syncs=null,ie.prototype.moves=null,ie.prototype.dyn=function(n){return 1!=n.body.type&&!n.body.component.sleeping},ie.prototype.__insert=function(n){var t;null==jl.zpp_pool?t=new jl:(t=jl.zpp_pool,jl.zpp_pool=t.next,t.next=null),null==Al.zpp_pool?t.aabb=new Al:(t.aabb=Al.zpp_pool,Al.zpp_pool=t.aabb.next,t.aabb.next=null),t.moved=!1,t.synced=!1,t.first_sync=!1,((t.shape=n).node=t).synced=!0,t.first_sync=!0,t.snext=this.syncs,this.syncs=t},ie.prototype.__remove=function(n){var t=n.node;if(t.first_sync||(t.dyn?this.dtree.removeLeaf(t):this.stree.removeLeaf(t)),n.node=null,t.synced){for(var e=null,i=this.syncs;null!=i&&i!=t;)i=(e=i).snext;null==e?this.syncs=i.snext:e.snext=i.snext,i.snext=null,t.synced=!1}if(t.moved){for(var p=null,l=this.moves;null!=l&&l!=t;)l=(p=l).mnext;null==p?this.moves=l.mnext:p.mnext=l.mnext,l.mnext=null,t.moved=!1}for(var r=null,o=this.pairs;null!=o;){var a,s=o.next;o.n1!=t&&o.n2!=t?(r=o,o=s):(null==r?this.pairs=s:r.next=s,null!=o.arb&&(o.arb.pair=null),o.arb=null,o.n1.shape.pairs.remove(o),o.n2.shape.pairs.remove(o),(a=o).n1=a.n2=null,a.sleeping=!1,a.next=ep.zpp_pool,ep.zpp_pool=a,o=s)}for(;null!=n.pairs.head;){var _=n.pairs.pop_unsafe();_.n1==t?_.n2.shape.pairs.remove(_):_.n1.shape.pairs.remove(_),null!=_.arb&&(_.arb.pair=null),_.arb=null,_.n1=_.n2=null,_.sleeping=!1,_.next=ep.zpp_pool,ep.zpp_pool=_}t.height=-1;var h=t.aabb;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h.wrap_min=h.wrap_max=null,h._invalidate=null,h._validate=null,h.next=Al.zpp_pool,Al.zpp_pool=h,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=jl.zpp_pool,jl.zpp_pool=t},ie.prototype.__sync=function(n){var t,e,i=n.node;if(!i.synced){if(!this.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var p=n.circle;if(p.zip_worldCOM&&null!=p.body){if(p.zip_worldCOM=!1,p.zip_localCOM){if(p.zip_localCOM=!1,1==p.type){var l=p.polygon;if(null==l.lverts.next.next)l.localCOMx=l.lverts.next.x,l.localCOMy=l.lverts.next.y;else if(null==l.lverts.next.next.next)l.localCOMx=l.lverts.next.x,l.localCOMy=l.lverts.next.y,l.localCOMx+=l.lverts.next.next.x,l.localCOMy+=l.lverts.next.next.y,l.localCOMx*=.5,l.localCOMy*=.5;else{l.localCOMx=0;var r=l.localCOMy=0,o=l.lverts.next,a=o,s=o=o.next;for(o=o.next;null!=o;){var _=o;r+=s.x*(_.y-a.y);var h=_.y*s.x-_.x*s.y;l.localCOMx+=(s.x+_.x)*h,l.localCOMy+=(s.y+_.y)*h,a=s,s=_,o=o.next}var u=o=l.lverts.next;r+=s.x*(u.y-a.y);var x=u.y*s.x-u.x*s.y;l.localCOMx+=(s.x+u.x)*x,l.localCOMy+=(s.y+u.y)*x,a=s;var d=o=o.next;r+=u.x*(d.y-a.y);var y=d.y*u.x-d.x*u.y;l.localCOMx+=(u.x+d.x)*y,l.localCOMy+=(u.y+d.y)*y;var z=r=1/(3*r);l.localCOMx*=z,l.localCOMy*=z}}null!=p.wrap_localCOM&&(p.wrap_localCOM.zpp_inner.x=p.localCOMx,p.wrap_localCOM.zpp_inner.y=p.localCOMy)}var c=p.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),p.worldCOMx=p.body.posx+(p.body.axisy*p.localCOMx-p.body.axisx*p.localCOMy),p.worldCOMy=p.body.posy+(p.localCOMx*p.body.axisx+p.localCOMy*p.body.axisy)}var v=p.radius,m=p.radius;p.aabb.minx=p.worldCOMx-v,p.aabb.miny=p.worldCOMy-m,p.aabb.maxx=p.worldCOMx+v,p.aabb.maxy=p.worldCOMy+m}else{var f=n.polygon;if(f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var b=f.body;b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot));for(var g=f.lverts.next,w=f.gverts.next;null!=w;){var M=w,C=g,g=g.next;M.x=f.body.posx+(f.body.axisy*C.x-f.body.axisx*C.y),M.y=f.body.posy+(C.x*f.body.axisx+C.y*f.body.axisy),w=w.next}}var k=f.gverts.next;f.aabb.minx=k.x,f.aabb.miny=k.y,f.aabb.maxx=k.x,f.aabb.maxy=k.y;for(var O=f.gverts.next.next;null!=O;){var P=O;P.x<f.aabb.minx&&(f.aabb.minx=P.x),P.x>f.aabb.maxx&&(f.aabb.maxx=P.x),P.y<f.aabb.miny&&(f.aabb.miny=P.y),P.y>f.aabb.maxy&&(f.aabb.maxy=P.y),O=O.next}}(i.dyn!=(1!=n.body.type&&!n.body.component.sleeping)||(t=i.aabb,!((e=n.aabb).minx>=t.minx&&e.miny>=t.miny&&e.maxx<=t.maxx&&e.maxy<=t.maxy)))&&(i.synced=!0,i.snext=this.syncs,this.syncs=i)}},ie.prototype.sync_broadphase=function(){if(this.space.validation(),null!=this.syncs)if(null==this.moves){for(var n=this.syncs;null!=n;){var t=n.shape;if(n.first_sync)n.first_sync=!1;else{var e=n.dyn?this.dtree:this.stree;if(n==e.root)e.root=null;else{var i=n.parent,p=i.parent,l=i.child1==n?i.child2:i.child1;if(null!=p){p.child1==i?p.child1=l:p.child2=l,l.parent=p,i.height=-1;var r=i.aabb;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r.wrap_min=r.wrap_max=null,r._invalidate=null,r._validate=null,r.next=Al.zpp_pool,Al.zpp_pool=r,i.child1=i.child2=i.parent=null,i.next=null,i.snext=null,i.mnext=null,i.next=jl.zpp_pool,jl.zpp_pool=i;for(var o,a,s,_,h,u,x,d,y,z,c,v,m,f,b,g,w,M,C,k,O,P,S,A,j,E,I,T,N,L,V,D,F,R,Z,B,G,q,U,K,W,Y,J,X,H,$,Q,nn=p;null!=nn;){null==nn.child1||nn.height<2||(o=nn.child1,1<(s=(a=nn.child2).height-o.height)?(_=a.child1,h=a.child2,a.child1=nn,a.parent=nn.parent,null!=(nn.parent=a).parent?a.parent.child1==nn?a.parent.child1=a:a.parent.child2=a:e.root=a,_.height>h.height?(a.child2=_,u=((nn.child2=h).parent=nn).aabb,x=o.aabb,d=h.aabb,u.minx=x.minx<d.minx?x.minx:d.minx,u.miny=x.miny<d.miny?x.miny:d.miny,u.maxx=x.maxx>d.maxx?x.maxx:d.maxx,u.maxy=x.maxy>d.maxy?x.maxy:d.maxy,y=a.aabb,z=nn.aabb,c=_.aabb,y.minx=z.minx<c.minx?z.minx:c.minx,y.miny=z.miny<c.miny?z.miny:c.miny,y.maxx=z.maxx>c.maxx?z.maxx:c.maxx,y.maxy=z.maxy>c.maxy?z.maxy:c.maxy,v=o.height,m=h.height,nn.height=1+(m<v?v:m),f=nn.height,b=_.height,a.height=1+(b<f?f:b)):(a.child2=h,g=((nn.child2=_).parent=nn).aabb,w=o.aabb,M=_.aabb,g.minx=w.minx<M.minx?w.minx:M.minx,g.miny=w.miny<M.miny?w.miny:M.miny,g.maxx=w.maxx>M.maxx?w.maxx:M.maxx,g.maxy=w.maxy>M.maxy?w.maxy:M.maxy,C=a.aabb,k=nn.aabb,O=h.aabb,C.minx=k.minx<O.minx?k.minx:O.minx,C.miny=k.miny<O.miny?k.miny:O.miny,C.maxx=k.maxx>O.maxx?k.maxx:O.maxx,C.maxy=k.maxy>O.maxy?k.maxy:O.maxy,P=o.height,S=_.height,nn.height=1+(S<P?P:S),A=nn.height,j=h.height,a.height=1+(j<A?A:j)),nn=a):s<-1&&(E=o.child1,I=o.child2,o.child1=nn,o.parent=nn.parent,null!=(nn.parent=o).parent?o.parent.child1==nn?o.parent.child1=o:o.parent.child2=o:e.root=o,E.height>I.height?(o.child2=E,T=((nn.child1=I).parent=nn).aabb,N=a.aabb,L=I.aabb,T.minx=N.minx<L.minx?N.minx:L.minx,T.miny=N.miny<L.miny?N.miny:L.miny,T.maxx=N.maxx>L.maxx?N.maxx:L.maxx,T.maxy=N.maxy>L.maxy?N.maxy:L.maxy,V=o.aabb,D=nn.aabb,F=E.aabb,V.minx=D.minx<F.minx?D.minx:F.minx,V.miny=D.miny<F.miny?D.miny:F.miny,V.maxx=D.maxx>F.maxx?D.maxx:F.maxx,V.maxy=D.maxy>F.maxy?D.maxy:F.maxy,R=a.height,Z=I.height,nn.height=1+(Z<R?R:Z),B=nn.height,G=E.height,o.height=1+(G<B?B:G)):(o.child2=I,q=((nn.child1=E).parent=nn).aabb,U=a.aabb,K=E.aabb,q.minx=U.minx<K.minx?U.minx:K.minx,q.miny=U.miny<K.miny?U.miny:K.miny,q.maxx=U.maxx>K.maxx?U.maxx:K.maxx,q.maxy=U.maxy>K.maxy?U.maxy:K.maxy,W=o.aabb,Y=nn.aabb,J=I.aabb,W.minx=Y.minx<J.minx?Y.minx:J.minx,W.miny=Y.miny<J.miny?Y.miny:J.miny,W.maxx=Y.maxx>J.maxx?Y.maxx:J.maxx,W.maxy=Y.maxy>J.maxy?Y.maxy:J.maxy,X=a.height,H=E.height,nn.height=1+(H<X?X:H),$=nn.height,Q=I.height,o.height=1+(Q<$?$:Q)),nn=o));var tn=nn.child1,en=nn.child2,pn=nn.aabb,ln=tn.aabb,rn=en.aabb;pn.minx=ln.minx<rn.minx?ln.minx:rn.minx,pn.miny=ln.miny<rn.miny?ln.miny:rn.miny,pn.maxx=ln.maxx>rn.maxx?ln.maxx:rn.maxx,pn.maxy=ln.maxy>rn.maxy?ln.maxy:rn.maxy;var on=tn.height,an=en.height;nn.height=1+(an<on?on:an),nn=nn.parent}}else{(e.root=l).parent=null,i.height=-1;var sn=i.aabb;null!=sn.outer&&(sn.outer.zpp_inner=null,sn.outer=null),sn.wrap_min=sn.wrap_max=null,sn._invalidate=null,sn._validate=null,sn.next=Al.zpp_pool,Al.zpp_pool=sn,i.child1=i.child2=i.parent=null,i.next=null,i.snext=null,i.mnext=null,i.next=jl.zpp_pool,jl.zpp_pool=i}}}var _n=n.aabb;if(!this.space.continuous&&t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var hn=t.circle;if(hn.zip_worldCOM&&null!=hn.body){if(hn.zip_worldCOM=!1,hn.zip_localCOM){if(hn.zip_localCOM=!1,1==hn.type){var un=hn.polygon;if(null==un.lverts.next.next)un.localCOMx=un.lverts.next.x,un.localCOMy=un.lverts.next.y;else if(null==un.lverts.next.next.next)un.localCOMx=un.lverts.next.x,un.localCOMy=un.lverts.next.y,un.localCOMx+=un.lverts.next.next.x,un.localCOMy+=un.lverts.next.next.y,un.localCOMx*=.5,un.localCOMy*=.5;else{un.localCOMx=0;var xn=un.localCOMy=0,dn=un.lverts.next,yn=dn,zn=dn=dn.next;for(dn=dn.next;null!=dn;){var cn=dn;xn+=zn.x*(cn.y-yn.y);var vn=cn.y*zn.x-cn.x*zn.y;un.localCOMx+=(zn.x+cn.x)*vn,un.localCOMy+=(zn.y+cn.y)*vn,yn=zn,zn=cn,dn=dn.next}var mn=dn=un.lverts.next;xn+=zn.x*(mn.y-yn.y);var fn=mn.y*zn.x-mn.x*zn.y;un.localCOMx+=(zn.x+mn.x)*fn,un.localCOMy+=(zn.y+mn.y)*fn,yn=zn;var bn=dn=dn.next;xn+=mn.x*(bn.y-yn.y);var gn=bn.y*mn.x-bn.x*mn.y;un.localCOMx+=(mn.x+bn.x)*gn,un.localCOMy+=(mn.y+bn.y)*gn;var wn=xn=1/(3*xn);un.localCOMx*=wn,un.localCOMy*=wn}}null!=hn.wrap_localCOM&&(hn.wrap_localCOM.zpp_inner.x=hn.localCOMx,hn.wrap_localCOM.zpp_inner.y=hn.localCOMy)}var Mn=hn.body;Mn.zip_axis&&(Mn.zip_axis=!1,Mn.axisx=Math.sin(Mn.rot),Mn.axisy=Math.cos(Mn.rot)),hn.worldCOMx=hn.body.posx+(hn.body.axisy*hn.localCOMx-hn.body.axisx*hn.localCOMy),hn.worldCOMy=hn.body.posy+(hn.localCOMx*hn.body.axisx+hn.localCOMy*hn.body.axisy)}var Cn=hn.radius,kn=hn.radius;hn.aabb.minx=hn.worldCOMx-Cn,hn.aabb.miny=hn.worldCOMy-kn,hn.aabb.maxx=hn.worldCOMx+Cn,hn.aabb.maxy=hn.worldCOMy+kn}else{var On=t.polygon;if(On.zip_gverts&&null!=On.body){On.zip_gverts=!1,On.validate_lverts();var Pn=On.body;Pn.zip_axis&&(Pn.zip_axis=!1,Pn.axisx=Math.sin(Pn.rot),Pn.axisy=Math.cos(Pn.rot));for(var Sn=On.lverts.next,An=On.gverts.next;null!=An;){var jn=An,En=Sn,Sn=Sn.next;jn.x=On.body.posx+(On.body.axisy*En.x-On.body.axisx*En.y),jn.y=On.body.posy+(En.x*On.body.axisx+En.y*On.body.axisy),An=An.next}}var In=On.gverts.next;On.aabb.minx=In.x,On.aabb.miny=In.y,On.aabb.maxx=In.x,On.aabb.maxy=In.y;for(var Tn=On.gverts.next.next;null!=Tn;){var Nn=Tn;Nn.x<On.aabb.minx&&(On.aabb.minx=Nn.x),Nn.x>On.aabb.maxx&&(On.aabb.maxx=Nn.x),Nn.y<On.aabb.miny&&(On.aabb.miny=Nn.y),Nn.y>On.aabb.maxy&&(On.aabb.maxy=Nn.y),Tn=Tn.next}}var Ln=t.aabb;_n.minx=Ln.minx-3,_n.miny=Ln.miny-3,_n.maxx=Ln.maxx+3,_n.maxy=Ln.maxy+3;var Vn=(n.dyn=1!=t.body.type&&!t.body.component.sleeping)?this.dtree:this.stree;if(null==Vn.root)Vn.root=n,Vn.root.parent=null;else{for(var Dn=n.aabb,Fn=Vn.root;null!=Fn.child1;){var Rn=Fn.child1,Zn=Fn.child2,Bn=Fn.aabb,Gn=2*(Bn.maxx-Bn.minx+(Bn.maxy-Bn.miny)),qn=El.tmpaabb,Un=Fn.aabb;qn.minx=Un.minx<Dn.minx?Un.minx:Dn.minx,qn.miny=Un.miny<Dn.miny?Un.miny:Dn.miny,qn.maxx=Un.maxx>Dn.maxx?Un.maxx:Dn.maxx,qn.maxy=Un.maxy>Dn.maxy?Un.maxy:Dn.maxy;var Kn,Wn,Yn,Jn,Xn,Hn=El.tmpaabb,$n=2*(Hn.maxx-Hn.minx+(Hn.maxy-Hn.miny)),Qn=2*$n,nt=2*($n-Gn),tt=El.tmpaabb,et=Rn.aabb;tt.minx=Dn.minx<et.minx?Dn.minx:et.minx,tt.miny=Dn.miny<et.miny?Dn.miny:et.miny,tt.maxx=Dn.maxx>et.maxx?Dn.maxx:et.maxx,tt.maxy=Dn.maxy>et.maxy?Dn.maxy:et.maxy,Wn=null==Rn.child1?2*((Kn=El.tmpaabb).maxx-Kn.minx+(Kn.maxy-Kn.miny))+nt:(Jn=2*((Yn=Rn.aabb).maxx-Yn.minx+(Yn.maxy-Yn.miny)),2*((Xn=El.tmpaabb).maxx-Xn.minx+(Xn.maxy-Xn.miny))-Jn+nt);var it,pt,lt,rt,ot,at=El.tmpaabb,st=Zn.aabb;if(at.minx=Dn.minx<st.minx?Dn.minx:st.minx,at.miny=Dn.miny<st.miny?Dn.miny:st.miny,at.maxx=Dn.maxx>st.maxx?Dn.maxx:st.maxx,at.maxy=Dn.maxy>st.maxy?Dn.maxy:st.maxy,pt=null==Zn.child1?2*((it=El.tmpaabb).maxx-it.minx+(it.maxy-it.miny))+nt:(rt=2*((lt=Zn.aabb).maxx-lt.minx+(lt.maxy-lt.miny)),2*((ot=El.tmpaabb).maxx-ot.minx+(ot.maxy-ot.miny))-rt+nt),Qn<Wn&&Qn<pt)break;Fn=Wn<pt?Rn:Zn}var _t,ht=Fn,ut=ht.parent;null==jl.zpp_pool?_t=new jl:(_t=jl.zpp_pool,jl.zpp_pool=_t.next,_t.next=null),null==Al.zpp_pool?_t.aabb=new Al:(_t.aabb=Al.zpp_pool,Al.zpp_pool=_t.aabb.next,_t.aabb.next=null),_t.moved=!1,_t.synced=!1,_t.first_sync=!1,_t.parent=ut;var xt,dt,yt,zt,ct,vt,mt,ft,bt,gt,wt,Mt,Ct,kt,Ot,Pt,St,At,jt,Et,It,Tt,Nt,Lt,Vt,Dt,Ft,Rt,Zt,Bt,Gt,qt,Ut,Kt,Wt,Yt,Jt,Xt,Ht,$t,Qt,ne,te,ee,ie,pe,le,re=_t.aabb,oe=ht.aabb;for(re.minx=Dn.minx<oe.minx?Dn.minx:oe.minx,re.miny=Dn.miny<oe.miny?Dn.miny:oe.miny,re.maxx=Dn.maxx>oe.maxx?Dn.maxx:oe.maxx,re.maxy=Dn.maxy>oe.maxy?Dn.maxy:oe.maxy,_t.height=ht.height+1,null!=ut?(ut.child1==ht?ut.child1=_t:ut.child2=_t,_t.child1=ht,_t.child2=n,ht.parent=_t,n.parent=_t):(_t.child1=ht,_t.child2=n,ht.parent=_t,n.parent=_t,Vn.root=_t),Fn=n.parent;null!=Fn;){null==Fn.child1||Fn.height<2||(xt=Fn.child1,1<(yt=(dt=Fn.child2).height-xt.height)?(zt=dt.child1,ct=dt.child2,dt.child1=Fn,dt.parent=Fn.parent,null!=(Fn.parent=dt).parent?dt.parent.child1==Fn?dt.parent.child1=dt:dt.parent.child2=dt:Vn.root=dt,zt.height>ct.height?(dt.child2=zt,vt=((Fn.child2=ct).parent=Fn).aabb,mt=xt.aabb,ft=ct.aabb,vt.minx=mt.minx<ft.minx?mt.minx:ft.minx,vt.miny=mt.miny<ft.miny?mt.miny:ft.miny,vt.maxx=mt.maxx>ft.maxx?mt.maxx:ft.maxx,vt.maxy=mt.maxy>ft.maxy?mt.maxy:ft.maxy,bt=dt.aabb,gt=Fn.aabb,wt=zt.aabb,bt.minx=gt.minx<wt.minx?gt.minx:wt.minx,bt.miny=gt.miny<wt.miny?gt.miny:wt.miny,bt.maxx=gt.maxx>wt.maxx?gt.maxx:wt.maxx,bt.maxy=gt.maxy>wt.maxy?gt.maxy:wt.maxy,Mt=xt.height,Ct=ct.height,Fn.height=1+(Ct<Mt?Mt:Ct),kt=Fn.height,Ot=zt.height,dt.height=1+(Ot<kt?kt:Ot)):(dt.child2=ct,Pt=((Fn.child2=zt).parent=Fn).aabb,St=xt.aabb,At=zt.aabb,Pt.minx=St.minx<At.minx?St.minx:At.minx,Pt.miny=St.miny<At.miny?St.miny:At.miny,Pt.maxx=St.maxx>At.maxx?St.maxx:At.maxx,Pt.maxy=St.maxy>At.maxy?St.maxy:At.maxy,jt=dt.aabb,Et=Fn.aabb,It=ct.aabb,jt.minx=Et.minx<It.minx?Et.minx:It.minx,jt.miny=Et.miny<It.miny?Et.miny:It.miny,jt.maxx=Et.maxx>It.maxx?Et.maxx:It.maxx,jt.maxy=Et.maxy>It.maxy?Et.maxy:It.maxy,Tt=xt.height,Nt=zt.height,Fn.height=1+(Nt<Tt?Tt:Nt),Lt=Fn.height,Vt=ct.height,dt.height=1+(Vt<Lt?Lt:Vt)),Fn=dt):yt<-1&&(Dt=xt.child1,Ft=xt.child2,xt.child1=Fn,xt.parent=Fn.parent,null!=(Fn.parent=xt).parent?xt.parent.child1==Fn?xt.parent.child1=xt:xt.parent.child2=xt:Vn.root=xt,Dt.height>Ft.height?(xt.child2=Dt,Rt=((Fn.child1=Ft).parent=Fn).aabb,Zt=dt.aabb,Bt=Ft.aabb,Rt.minx=Zt.minx<Bt.minx?Zt.minx:Bt.minx,Rt.miny=Zt.miny<Bt.miny?Zt.miny:Bt.miny,Rt.maxx=Zt.maxx>Bt.maxx?Zt.maxx:Bt.maxx,Rt.maxy=Zt.maxy>Bt.maxy?Zt.maxy:Bt.maxy,Gt=xt.aabb,qt=Fn.aabb,Ut=Dt.aabb,Gt.minx=qt.minx<Ut.minx?qt.minx:Ut.minx,Gt.miny=qt.miny<Ut.miny?qt.miny:Ut.miny,Gt.maxx=qt.maxx>Ut.maxx?qt.maxx:Ut.maxx,Gt.maxy=qt.maxy>Ut.maxy?qt.maxy:Ut.maxy,Kt=dt.height,Wt=Ft.height,Fn.height=1+(Wt<Kt?Kt:Wt),Yt=Fn.height,Jt=Dt.height,xt.height=1+(Jt<Yt?Yt:Jt)):(xt.child2=Ft,Xt=((Fn.child1=Dt).parent=Fn).aabb,Ht=dt.aabb,$t=Dt.aabb,Xt.minx=Ht.minx<$t.minx?Ht.minx:$t.minx,Xt.miny=Ht.miny<$t.miny?Ht.miny:$t.miny,Xt.maxx=Ht.maxx>$t.maxx?Ht.maxx:$t.maxx,Xt.maxy=Ht.maxy>$t.maxy?Ht.maxy:$t.maxy,Qt=xt.aabb,ne=Fn.aabb,te=Ft.aabb,Qt.minx=ne.minx<te.minx?ne.minx:te.minx,Qt.miny=ne.miny<te.miny?ne.miny:te.miny,Qt.maxx=ne.maxx>te.maxx?ne.maxx:te.maxx,Qt.maxy=ne.maxy>te.maxy?ne.maxy:te.maxy,ee=dt.height,ie=Dt.height,Fn.height=1+(ie<ee?ee:ie),pe=Fn.height,le=Ft.height,xt.height=1+(le<pe?pe:le)),Fn=xt));var ae=Fn.child1,se=Fn.child2,_e=ae.height,he=se.height;Fn.height=1+(he<_e?_e:he);var ue=Fn.aabb,xe=ae.aabb,de=se.aabb;ue.minx=xe.minx<de.minx?xe.minx:de.minx,ue.miny=xe.miny<de.miny?xe.miny:de.miny,ue.maxx=xe.maxx>de.maxx?xe.maxx:de.maxx,ue.maxy=xe.maxy>de.maxy?xe.maxy:de.maxy,Fn=Fn.parent}}n.synced=!1,n.moved=!0,n.mnext=n.snext,n.snext=null,n=n.mnext}var ye=this.syncs;this.syncs=this.moves,this.moves=ye}else for(;null!=this.syncs;){var ze=this.syncs;this.syncs=ze.snext,ze.snext=null;var ce=ze.shape;if(ze.first_sync)ze.first_sync=!1;else{var ve=ze.dyn?this.dtree:this.stree;if(ze==ve.root)ve.root=null;else{var me=ze.parent,fe=me.parent,be=me.child1==ze?me.child2:me.child1;if(null!=fe){fe.child1==me?fe.child1=be:fe.child2=be,be.parent=fe,me.height=-1;var ge=me.aabb;null!=ge.outer&&(ge.outer.zpp_inner=null,ge.outer=null),ge.wrap_min=ge.wrap_max=null,ge._invalidate=null,ge._validate=null,ge.next=Al.zpp_pool,Al.zpp_pool=ge,me.child1=me.child2=me.parent=null,me.next=null,me.snext=null,me.mnext=null,me.next=jl.zpp_pool,jl.zpp_pool=me;for(var we,Me,Ce,ke,Oe,Pe,Se,Ae,je,Ee,Ie,Te,Ne,Le,Ve,De,Fe,Re,Ze,Be,Ge,qe,Ue,Ke,We,Ye,Je,Xe,He,$e,Qe,ni,ti,ei,ii,pi,li,ri,oi,ai,si,_i,hi,ui,xi,di,yi,zi=fe;null!=zi;){null==zi.child1||zi.height<2||(we=zi.child1,1<(Ce=(Me=zi.child2).height-we.height)?(ke=Me.child1,Oe=Me.child2,Me.child1=zi,Me.parent=zi.parent,null!=(zi.parent=Me).parent?Me.parent.child1==zi?Me.parent.child1=Me:Me.parent.child2=Me:ve.root=Me,ke.height>Oe.height?(Me.child2=ke,Pe=((zi.child2=Oe).parent=zi).aabb,Se=we.aabb,Ae=Oe.aabb,Pe.minx=Se.minx<Ae.minx?Se.minx:Ae.minx,Pe.miny=Se.miny<Ae.miny?Se.miny:Ae.miny,Pe.maxx=Se.maxx>Ae.maxx?Se.maxx:Ae.maxx,Pe.maxy=Se.maxy>Ae.maxy?Se.maxy:Ae.maxy,je=Me.aabb,Ee=zi.aabb,Ie=ke.aabb,je.minx=Ee.minx<Ie.minx?Ee.minx:Ie.minx,je.miny=Ee.miny<Ie.miny?Ee.miny:Ie.miny,je.maxx=Ee.maxx>Ie.maxx?Ee.maxx:Ie.maxx,je.maxy=Ee.maxy>Ie.maxy?Ee.maxy:Ie.maxy,Te=we.height,Ne=Oe.height,zi.height=1+(Ne<Te?Te:Ne),Le=zi.height,Ve=ke.height,Me.height=1+(Ve<Le?Le:Ve)):(Me.child2=Oe,De=((zi.child2=ke).parent=zi).aabb,Fe=we.aabb,Re=ke.aabb,De.minx=Fe.minx<Re.minx?Fe.minx:Re.minx,De.miny=Fe.miny<Re.miny?Fe.miny:Re.miny,De.maxx=Fe.maxx>Re.maxx?Fe.maxx:Re.maxx,De.maxy=Fe.maxy>Re.maxy?Fe.maxy:Re.maxy,Ze=Me.aabb,Be=zi.aabb,Ge=Oe.aabb,Ze.minx=Be.minx<Ge.minx?Be.minx:Ge.minx,Ze.miny=Be.miny<Ge.miny?Be.miny:Ge.miny,Ze.maxx=Be.maxx>Ge.maxx?Be.maxx:Ge.maxx,Ze.maxy=Be.maxy>Ge.maxy?Be.maxy:Ge.maxy,qe=we.height,Ue=ke.height,zi.height=1+(Ue<qe?qe:Ue),Ke=zi.height,We=Oe.height,Me.height=1+(We<Ke?Ke:We)),zi=Me):Ce<-1&&(Ye=we.child1,Je=we.child2,we.child1=zi,we.parent=zi.parent,null!=(zi.parent=we).parent?we.parent.child1==zi?we.parent.child1=we:we.parent.child2=we:ve.root=we,Ye.height>Je.height?(we.child2=Ye,Xe=((zi.child1=Je).parent=zi).aabb,He=Me.aabb,$e=Je.aabb,Xe.minx=He.minx<$e.minx?He.minx:$e.minx,Xe.miny=He.miny<$e.miny?He.miny:$e.miny,Xe.maxx=He.maxx>$e.maxx?He.maxx:$e.maxx,Xe.maxy=He.maxy>$e.maxy?He.maxy:$e.maxy,Qe=we.aabb,ni=zi.aabb,ti=Ye.aabb,Qe.minx=ni.minx<ti.minx?ni.minx:ti.minx,Qe.miny=ni.miny<ti.miny?ni.miny:ti.miny,Qe.maxx=ni.maxx>ti.maxx?ni.maxx:ti.maxx,Qe.maxy=ni.maxy>ti.maxy?ni.maxy:ti.maxy,ei=Me.height,ii=Je.height,zi.height=1+(ii<ei?ei:ii),pi=zi.height,li=Ye.height,we.height=1+(li<pi?pi:li)):(we.child2=Je,ri=((zi.child1=Ye).parent=zi).aabb,oi=Me.aabb,ai=Ye.aabb,ri.minx=oi.minx<ai.minx?oi.minx:ai.minx,ri.miny=oi.miny<ai.miny?oi.miny:ai.miny,ri.maxx=oi.maxx>ai.maxx?oi.maxx:ai.maxx,ri.maxy=oi.maxy>ai.maxy?oi.maxy:ai.maxy,si=we.aabb,_i=zi.aabb,hi=Je.aabb,si.minx=_i.minx<hi.minx?_i.minx:hi.minx,si.miny=_i.miny<hi.miny?_i.miny:hi.miny,si.maxx=_i.maxx>hi.maxx?_i.maxx:hi.maxx,si.maxy=_i.maxy>hi.maxy?_i.maxy:hi.maxy,ui=Me.height,xi=Ye.height,zi.height=1+(xi<ui?ui:xi),di=zi.height,yi=Je.height,we.height=1+(yi<di?di:yi)),zi=we));var ci=zi.child1,vi=zi.child2,mi=zi.aabb,fi=ci.aabb,bi=vi.aabb;mi.minx=fi.minx<bi.minx?fi.minx:bi.minx,mi.miny=fi.miny<bi.miny?fi.miny:bi.miny,mi.maxx=fi.maxx>bi.maxx?fi.maxx:bi.maxx,mi.maxy=fi.maxy>bi.maxy?fi.maxy:bi.maxy;var gi=ci.height,wi=vi.height;zi.height=1+(wi<gi?gi:wi),zi=zi.parent}}else{(ve.root=be).parent=null,me.height=-1;var Mi=me.aabb;null!=Mi.outer&&(Mi.outer.zpp_inner=null,Mi.outer=null),Mi.wrap_min=Mi.wrap_max=null,Mi._invalidate=null,Mi._validate=null,Mi.next=Al.zpp_pool,Al.zpp_pool=Mi,me.child1=me.child2=me.parent=null,me.next=null,me.snext=null,me.mnext=null,me.next=jl.zpp_pool,jl.zpp_pool=me}}}var Ci=ze.aabb;if(!this.space.continuous&&ce.zip_aabb&&null!=ce.body)if(ce.zip_aabb=!1,0==ce.type){var ki=ce.circle;if(ki.zip_worldCOM&&null!=ki.body){if(ki.zip_worldCOM=!1,ki.zip_localCOM){if(ki.zip_localCOM=!1,1==ki.type){var Oi=ki.polygon;if(null==Oi.lverts.next.next)Oi.localCOMx=Oi.lverts.next.x,Oi.localCOMy=Oi.lverts.next.y;else if(null==Oi.lverts.next.next.next)Oi.localCOMx=Oi.lverts.next.x,Oi.localCOMy=Oi.lverts.next.y,Oi.localCOMx+=Oi.lverts.next.next.x,Oi.localCOMy+=Oi.lverts.next.next.y,Oi.localCOMx*=.5,Oi.localCOMy*=.5;else{Oi.localCOMx=0;var Pi=Oi.localCOMy=0,Si=Oi.lverts.next,Ai=Si,ji=Si=Si.next;for(Si=Si.next;null!=Si;){var Ei=Si;Pi+=ji.x*(Ei.y-Ai.y);var Ii=Ei.y*ji.x-Ei.x*ji.y;Oi.localCOMx+=(ji.x+Ei.x)*Ii,Oi.localCOMy+=(ji.y+Ei.y)*Ii,Ai=ji,ji=Ei,Si=Si.next}var Ti=Si=Oi.lverts.next;Pi+=ji.x*(Ti.y-Ai.y);var Ni=Ti.y*ji.x-Ti.x*ji.y;Oi.localCOMx+=(ji.x+Ti.x)*Ni,Oi.localCOMy+=(ji.y+Ti.y)*Ni,Ai=ji;var Li=Si=Si.next;Pi+=Ti.x*(Li.y-Ai.y);var Vi=Li.y*Ti.x-Li.x*Ti.y;Oi.localCOMx+=(Ti.x+Li.x)*Vi,Oi.localCOMy+=(Ti.y+Li.y)*Vi;var Di=Pi=1/(3*Pi);Oi.localCOMx*=Di,Oi.localCOMy*=Di}}null!=ki.wrap_localCOM&&(ki.wrap_localCOM.zpp_inner.x=ki.localCOMx,ki.wrap_localCOM.zpp_inner.y=ki.localCOMy)}var Fi=ki.body;Fi.zip_axis&&(Fi.zip_axis=!1,Fi.axisx=Math.sin(Fi.rot),Fi.axisy=Math.cos(Fi.rot)),ki.worldCOMx=ki.body.posx+(ki.body.axisy*ki.localCOMx-ki.body.axisx*ki.localCOMy),ki.worldCOMy=ki.body.posy+(ki.localCOMx*ki.body.axisx+ki.localCOMy*ki.body.axisy)}var Ri=ki.radius,Zi=ki.radius;ki.aabb.minx=ki.worldCOMx-Ri,ki.aabb.miny=ki.worldCOMy-Zi,ki.aabb.maxx=ki.worldCOMx+Ri,ki.aabb.maxy=ki.worldCOMy+Zi}else{var Bi=ce.polygon;if(Bi.zip_gverts&&null!=Bi.body){Bi.zip_gverts=!1,Bi.validate_lverts();var Gi=Bi.body;Gi.zip_axis&&(Gi.zip_axis=!1,Gi.axisx=Math.sin(Gi.rot),Gi.axisy=Math.cos(Gi.rot));for(var qi=Bi.lverts.next,Ui=Bi.gverts.next;null!=Ui;){var Ki=Ui,Wi=qi,qi=qi.next;Ki.x=Bi.body.posx+(Bi.body.axisy*Wi.x-Bi.body.axisx*Wi.y),Ki.y=Bi.body.posy+(Wi.x*Bi.body.axisx+Wi.y*Bi.body.axisy),Ui=Ui.next}}var Yi=Bi.gverts.next;Bi.aabb.minx=Yi.x,Bi.aabb.miny=Yi.y,Bi.aabb.maxx=Yi.x,Bi.aabb.maxy=Yi.y;for(var Ji=Bi.gverts.next.next;null!=Ji;){var Xi=Ji;Xi.x<Bi.aabb.minx&&(Bi.aabb.minx=Xi.x),Xi.x>Bi.aabb.maxx&&(Bi.aabb.maxx=Xi.x),Xi.y<Bi.aabb.miny&&(Bi.aabb.miny=Xi.y),Xi.y>Bi.aabb.maxy&&(Bi.aabb.maxy=Xi.y),Ji=Ji.next}}var Hi=ce.aabb;Ci.minx=Hi.minx-3,Ci.miny=Hi.miny-3,Ci.maxx=Hi.maxx+3,Ci.maxy=Hi.maxy+3;var $i=(ze.dyn=1!=ce.body.type&&!ce.body.component.sleeping)?this.dtree:this.stree;if(null==$i.root)$i.root=ze,$i.root.parent=null;else{for(var Qi=ze.aabb,np=$i.root;null!=np.child1;){var tp=np.child1,ep=np.child2,ip=np.aabb,pp=2*(ip.maxx-ip.minx+(ip.maxy-ip.miny)),lp=El.tmpaabb,rp=np.aabb;lp.minx=rp.minx<Qi.minx?rp.minx:Qi.minx,lp.miny=rp.miny<Qi.miny?rp.miny:Qi.miny,lp.maxx=rp.maxx>Qi.maxx?rp.maxx:Qi.maxx,lp.maxy=rp.maxy>Qi.maxy?rp.maxy:Qi.maxy;var op,ap,sp,_p,hp,up=El.tmpaabb,xp=2*(up.maxx-up.minx+(up.maxy-up.miny)),dp=2*xp,yp=2*(xp-pp),zp=El.tmpaabb,cp=tp.aabb;zp.minx=Qi.minx<cp.minx?Qi.minx:cp.minx,zp.miny=Qi.miny<cp.miny?Qi.miny:cp.miny,zp.maxx=Qi.maxx>cp.maxx?Qi.maxx:cp.maxx,zp.maxy=Qi.maxy>cp.maxy?Qi.maxy:cp.maxy,ap=null==tp.child1?2*((op=El.tmpaabb).maxx-op.minx+(op.maxy-op.miny))+yp:(_p=2*((sp=tp.aabb).maxx-sp.minx+(sp.maxy-sp.miny)),2*((hp=El.tmpaabb).maxx-hp.minx+(hp.maxy-hp.miny))-_p+yp);var vp,mp,fp,bp,gp,wp=El.tmpaabb,Mp=ep.aabb;if(wp.minx=Qi.minx<Mp.minx?Qi.minx:Mp.minx,wp.miny=Qi.miny<Mp.miny?Qi.miny:Mp.miny,wp.maxx=Qi.maxx>Mp.maxx?Qi.maxx:Mp.maxx,wp.maxy=Qi.maxy>Mp.maxy?Qi.maxy:Mp.maxy,mp=null==ep.child1?2*((vp=El.tmpaabb).maxx-vp.minx+(vp.maxy-vp.miny))+yp:(bp=2*((fp=ep.aabb).maxx-fp.minx+(fp.maxy-fp.miny)),2*((gp=El.tmpaabb).maxx-gp.minx+(gp.maxy-gp.miny))-bp+yp),dp<ap&&dp<mp)break;np=ap<mp?tp:ep}var Cp,kp=np,Op=kp.parent;null==jl.zpp_pool?Cp=new jl:(Cp=jl.zpp_pool,jl.zpp_pool=Cp.next,Cp.next=null),null==Al.zpp_pool?Cp.aabb=new Al:(Cp.aabb=Al.zpp_pool,Al.zpp_pool=Cp.aabb.next,Cp.aabb.next=null),Cp.moved=!1,Cp.synced=!1,Cp.first_sync=!1,Cp.parent=Op;var Pp,Sp,Ap,jp,Ep,Ip,Tp,Np,Lp,Vp,Dp,Fp,Rp,Zp,Bp,Gp,qp,Up,Kp,Wp,Yp,Jp,Xp,Hp,$p,Qp,nl,tl,el,il,pl,ll,rl,ol,al,sl,_l,hl,ul,xl,dl,yl,zl,cl,vl,ml,fl,bl=Cp.aabb,gl=kp.aabb;for(bl.minx=Qi.minx<gl.minx?Qi.minx:gl.minx,bl.miny=Qi.miny<gl.miny?Qi.miny:gl.miny,bl.maxx=Qi.maxx>gl.maxx?Qi.maxx:gl.maxx,bl.maxy=Qi.maxy>gl.maxy?Qi.maxy:gl.maxy,Cp.height=kp.height+1,null!=Op?(Op.child1==kp?Op.child1=Cp:Op.child2=Cp,Cp.child1=kp,Cp.child2=ze,kp.parent=Cp,ze.parent=Cp):(Cp.child1=kp,Cp.child2=ze,kp.parent=Cp,ze.parent=Cp,$i.root=Cp),np=ze.parent;null!=np;){null==np.child1||np.height<2||(Pp=np.child1,1<(Ap=(Sp=np.child2).height-Pp.height)?(jp=Sp.child1,Ep=Sp.child2,Sp.child1=np,Sp.parent=np.parent,null!=(np.parent=Sp).parent?Sp.parent.child1==np?Sp.parent.child1=Sp:Sp.parent.child2=Sp:$i.root=Sp,jp.height>Ep.height?(Sp.child2=jp,Ip=((np.child2=Ep).parent=np).aabb,Tp=Pp.aabb,Np=Ep.aabb,Ip.minx=Tp.minx<Np.minx?Tp.minx:Np.minx,Ip.miny=Tp.miny<Np.miny?Tp.miny:Np.miny,Ip.maxx=Tp.maxx>Np.maxx?Tp.maxx:Np.maxx,Ip.maxy=Tp.maxy>Np.maxy?Tp.maxy:Np.maxy,Lp=Sp.aabb,Vp=np.aabb,Dp=jp.aabb,Lp.minx=Vp.minx<Dp.minx?Vp.minx:Dp.minx,Lp.miny=Vp.miny<Dp.miny?Vp.miny:Dp.miny,Lp.maxx=Vp.maxx>Dp.maxx?Vp.maxx:Dp.maxx,Lp.maxy=Vp.maxy>Dp.maxy?Vp.maxy:Dp.maxy,Fp=Pp.height,Rp=Ep.height,np.height=1+(Rp<Fp?Fp:Rp),Zp=np.height,Bp=jp.height,Sp.height=1+(Bp<Zp?Zp:Bp)):(Sp.child2=Ep,Gp=((np.child2=jp).parent=np).aabb,qp=Pp.aabb,Up=jp.aabb,Gp.minx=qp.minx<Up.minx?qp.minx:Up.minx,Gp.miny=qp.miny<Up.miny?qp.miny:Up.miny,Gp.maxx=qp.maxx>Up.maxx?qp.maxx:Up.maxx,Gp.maxy=qp.maxy>Up.maxy?qp.maxy:Up.maxy,Kp=Sp.aabb,Wp=np.aabb,Yp=Ep.aabb,Kp.minx=Wp.minx<Yp.minx?Wp.minx:Yp.minx,Kp.miny=Wp.miny<Yp.miny?Wp.miny:Yp.miny,Kp.maxx=Wp.maxx>Yp.maxx?Wp.maxx:Yp.maxx,Kp.maxy=Wp.maxy>Yp.maxy?Wp.maxy:Yp.maxy,Jp=Pp.height,Xp=jp.height,np.height=1+(Xp<Jp?Jp:Xp),Hp=np.height,$p=Ep.height,Sp.height=1+($p<Hp?Hp:$p)),np=Sp):Ap<-1&&(Qp=Pp.child1,nl=Pp.child2,Pp.child1=np,Pp.parent=np.parent,null!=(np.parent=Pp).parent?Pp.parent.child1==np?Pp.parent.child1=Pp:Pp.parent.child2=Pp:$i.root=Pp,Qp.height>nl.height?(Pp.child2=Qp,tl=((np.child1=nl).parent=np).aabb,el=Sp.aabb,il=nl.aabb,tl.minx=el.minx<il.minx?el.minx:il.minx,tl.miny=el.miny<il.miny?el.miny:il.miny,tl.maxx=el.maxx>il.maxx?el.maxx:il.maxx,tl.maxy=el.maxy>il.maxy?el.maxy:il.maxy,pl=Pp.aabb,ll=np.aabb,rl=Qp.aabb,pl.minx=ll.minx<rl.minx?ll.minx:rl.minx,pl.miny=ll.miny<rl.miny?ll.miny:rl.miny,pl.maxx=ll.maxx>rl.maxx?ll.maxx:rl.maxx,pl.maxy=ll.maxy>rl.maxy?ll.maxy:rl.maxy,ol=Sp.height,al=nl.height,np.height=1+(al<ol?ol:al),sl=np.height,_l=Qp.height,Pp.height=1+(_l<sl?sl:_l)):(Pp.child2=nl,hl=((np.child1=Qp).parent=np).aabb,ul=Sp.aabb,xl=Qp.aabb,hl.minx=ul.minx<xl.minx?ul.minx:xl.minx,hl.miny=ul.miny<xl.miny?ul.miny:xl.miny,hl.maxx=ul.maxx>xl.maxx?ul.maxx:xl.maxx,hl.maxy=ul.maxy>xl.maxy?ul.maxy:xl.maxy,dl=Pp.aabb,yl=np.aabb,zl=nl.aabb,dl.minx=yl.minx<zl.minx?yl.minx:zl.minx,dl.miny=yl.miny<zl.miny?yl.miny:zl.miny,dl.maxx=yl.maxx>zl.maxx?yl.maxx:zl.maxx,dl.maxy=yl.maxy>zl.maxy?yl.maxy:zl.maxy,cl=Sp.height,vl=Qp.height,np.height=1+(vl<cl?cl:vl),ml=np.height,fl=nl.height,Pp.height=1+(fl<ml?ml:fl)),np=Pp));var wl=np.child1,Ml=np.child2,Cl=wl.height,kl=Ml.height;np.height=1+(kl<Cl?Cl:kl);var Ol=np.aabb,Pl=wl.aabb,Sl=Ml.aabb;Ol.minx=Pl.minx<Sl.minx?Pl.minx:Sl.minx,Ol.miny=Pl.miny<Sl.miny?Pl.miny:Sl.miny,Ol.maxx=Pl.maxx>Sl.maxx?Pl.maxx:Sl.maxx,Ol.maxy=Pl.maxy>Sl.maxy?Pl.maxy:Sl.maxy,np=np.parent}}ze.synced=!1,ze.moved||(ze.moved=!0,ze.mnext=this.moves,this.moves=ze)}},ie.prototype.broadphase=function(n,t){for(var e=this.syncs;null!=e;){var i=e.shape;if(e.first_sync)e.first_sync=!1;else{var p=e.dyn?this.dtree:this.stree;if(e==p.root)p.root=null;else{var l=e.parent,r=l.parent,o=l.child1==e?l.child2:l.child1;if(null!=r){r.child1==l?r.child1=o:r.child2=o,o.parent=r,l.height=-1;var a=l.aabb;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a.wrap_min=a.wrap_max=null,a._invalidate=null,a._validate=null,a.next=Al.zpp_pool,Al.zpp_pool=a,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=jl.zpp_pool,jl.zpp_pool=l;for(var s,_,h,u,x,d,y,z,c,v,m,f,b,g,w,M,C,k,O,P,S,A,j,E,I,T,N,L,V,D,F,R,Z,B,G,q,U,K,W,Y,J,X,H,$,Q,nn,tn,en=r;null!=en;){null==en.child1||en.height<2||(s=en.child1,1<(h=(_=en.child2).height-s.height)?(u=_.child1,x=_.child2,_.child1=en,_.parent=en.parent,null!=(en.parent=_).parent?_.parent.child1==en?_.parent.child1=_:_.parent.child2=_:p.root=_,u.height>x.height?(_.child2=u,d=((en.child2=x).parent=en).aabb,y=s.aabb,z=x.aabb,d.minx=y.minx<z.minx?y.minx:z.minx,d.miny=y.miny<z.miny?y.miny:z.miny,d.maxx=y.maxx>z.maxx?y.maxx:z.maxx,d.maxy=y.maxy>z.maxy?y.maxy:z.maxy,c=_.aabb,v=en.aabb,m=u.aabb,c.minx=v.minx<m.minx?v.minx:m.minx,c.miny=v.miny<m.miny?v.miny:m.miny,c.maxx=v.maxx>m.maxx?v.maxx:m.maxx,c.maxy=v.maxy>m.maxy?v.maxy:m.maxy,f=s.height,b=x.height,en.height=1+(b<f?f:b),g=en.height,w=u.height,_.height=1+(w<g?g:w)):(_.child2=x,M=((en.child2=u).parent=en).aabb,C=s.aabb,k=u.aabb,M.minx=C.minx<k.minx?C.minx:k.minx,M.miny=C.miny<k.miny?C.miny:k.miny,M.maxx=C.maxx>k.maxx?C.maxx:k.maxx,M.maxy=C.maxy>k.maxy?C.maxy:k.maxy,O=_.aabb,P=en.aabb,S=x.aabb,O.minx=P.minx<S.minx?P.minx:S.minx,O.miny=P.miny<S.miny?P.miny:S.miny,O.maxx=P.maxx>S.maxx?P.maxx:S.maxx,O.maxy=P.maxy>S.maxy?P.maxy:S.maxy,A=s.height,j=u.height,en.height=1+(j<A?A:j),E=en.height,I=x.height,_.height=1+(I<E?E:I)),en=_):h<-1&&(T=s.child1,N=s.child2,s.child1=en,s.parent=en.parent,null!=(en.parent=s).parent?s.parent.child1==en?s.parent.child1=s:s.parent.child2=s:p.root=s,T.height>N.height?(s.child2=T,L=((en.child1=N).parent=en).aabb,V=_.aabb,D=N.aabb,L.minx=V.minx<D.minx?V.minx:D.minx,L.miny=V.miny<D.miny?V.miny:D.miny,L.maxx=V.maxx>D.maxx?V.maxx:D.maxx,L.maxy=V.maxy>D.maxy?V.maxy:D.maxy,F=s.aabb,R=en.aabb,Z=T.aabb,F.minx=R.minx<Z.minx?R.minx:Z.minx,F.miny=R.miny<Z.miny?R.miny:Z.miny,F.maxx=R.maxx>Z.maxx?R.maxx:Z.maxx,F.maxy=R.maxy>Z.maxy?R.maxy:Z.maxy,B=_.height,G=N.height,en.height=1+(G<B?B:G),q=en.height,U=T.height,s.height=1+(U<q?q:U)):(s.child2=N,K=((en.child1=T).parent=en).aabb,W=_.aabb,Y=T.aabb,K.minx=W.minx<Y.minx?W.minx:Y.minx,K.miny=W.miny<Y.miny?W.miny:Y.miny,K.maxx=W.maxx>Y.maxx?W.maxx:Y.maxx,K.maxy=W.maxy>Y.maxy?W.maxy:Y.maxy,J=s.aabb,X=en.aabb,H=N.aabb,J.minx=X.minx<H.minx?X.minx:H.minx,J.miny=X.miny<H.miny?X.miny:H.miny,J.maxx=X.maxx>H.maxx?X.maxx:H.maxx,J.maxy=X.maxy>H.maxy?X.maxy:H.maxy,$=_.height,Q=T.height,en.height=1+(Q<$?$:Q),nn=en.height,tn=N.height,s.height=1+(tn<nn?nn:tn)),en=s));var pn=en.child1,ln=en.child2,rn=en.aabb,on=pn.aabb,an=ln.aabb;rn.minx=on.minx<an.minx?on.minx:an.minx,rn.miny=on.miny<an.miny?on.miny:an.miny,rn.maxx=on.maxx>an.maxx?on.maxx:an.maxx,rn.maxy=on.maxy>an.maxy?on.maxy:an.maxy;var sn=pn.height,_n=ln.height;en.height=1+(_n<sn?sn:_n),en=en.parent}}else{(p.root=o).parent=null,l.height=-1;var hn=l.aabb;null!=hn.outer&&(hn.outer.zpp_inner=null,hn.outer=null),hn.wrap_min=hn.wrap_max=null,hn._invalidate=null,hn._validate=null,hn.next=Al.zpp_pool,Al.zpp_pool=hn,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=jl.zpp_pool,jl.zpp_pool=l}}}var un=e.aabb;if(!n.continuous&&i.zip_aabb&&null!=i.body)if(i.zip_aabb=!1,0==i.type){var xn=i.circle;if(xn.zip_worldCOM&&null!=xn.body){if(xn.zip_worldCOM=!1,xn.zip_localCOM){if(xn.zip_localCOM=!1,1==xn.type){var dn=xn.polygon;if(null==dn.lverts.next.next)dn.localCOMx=dn.lverts.next.x,dn.localCOMy=dn.lverts.next.y;else if(null==dn.lverts.next.next.next)dn.localCOMx=dn.lverts.next.x,dn.localCOMy=dn.lverts.next.y,dn.localCOMx+=dn.lverts.next.next.x,dn.localCOMy+=dn.lverts.next.next.y,dn.localCOMx*=.5,dn.localCOMy*=.5;else{dn.localCOMx=0;var yn=dn.localCOMy=0,zn=dn.lverts.next,cn=zn,vn=zn=zn.next;for(zn=zn.next;null!=zn;){var mn=zn;yn+=vn.x*(mn.y-cn.y);var fn=mn.y*vn.x-mn.x*vn.y;dn.localCOMx+=(vn.x+mn.x)*fn,dn.localCOMy+=(vn.y+mn.y)*fn,cn=vn,vn=mn,zn=zn.next}var bn=zn=dn.lverts.next;yn+=vn.x*(bn.y-cn.y);var gn=bn.y*vn.x-bn.x*vn.y;dn.localCOMx+=(vn.x+bn.x)*gn,dn.localCOMy+=(vn.y+bn.y)*gn,cn=vn;var wn=zn=zn.next;yn+=bn.x*(wn.y-cn.y);var Mn=wn.y*bn.x-wn.x*bn.y;dn.localCOMx+=(bn.x+wn.x)*Mn,dn.localCOMy+=(bn.y+wn.y)*Mn;var Cn=yn=1/(3*yn);dn.localCOMx*=Cn,dn.localCOMy*=Cn}}null!=xn.wrap_localCOM&&(xn.wrap_localCOM.zpp_inner.x=xn.localCOMx,xn.wrap_localCOM.zpp_inner.y=xn.localCOMy)}var kn=xn.body;kn.zip_axis&&(kn.zip_axis=!1,kn.axisx=Math.sin(kn.rot),kn.axisy=Math.cos(kn.rot)),xn.worldCOMx=xn.body.posx+(xn.body.axisy*xn.localCOMx-xn.body.axisx*xn.localCOMy),xn.worldCOMy=xn.body.posy+(xn.localCOMx*xn.body.axisx+xn.localCOMy*xn.body.axisy)}var On=xn.radius,Pn=xn.radius;xn.aabb.minx=xn.worldCOMx-On,xn.aabb.miny=xn.worldCOMy-Pn,xn.aabb.maxx=xn.worldCOMx+On,xn.aabb.maxy=xn.worldCOMy+Pn}else{var Sn=i.polygon;if(Sn.zip_gverts&&null!=Sn.body){Sn.zip_gverts=!1,Sn.validate_lverts();var An=Sn.body;An.zip_axis&&(An.zip_axis=!1,An.axisx=Math.sin(An.rot),An.axisy=Math.cos(An.rot));for(var jn=Sn.lverts.next,En=Sn.gverts.next;null!=En;){var In=En,Tn=jn,jn=jn.next;In.x=Sn.body.posx+(Sn.body.axisy*Tn.x-Sn.body.axisx*Tn.y),In.y=Sn.body.posy+(Tn.x*Sn.body.axisx+Tn.y*Sn.body.axisy),En=En.next}}var Nn=Sn.gverts.next;Sn.aabb.minx=Nn.x,Sn.aabb.miny=Nn.y,Sn.aabb.maxx=Nn.x,Sn.aabb.maxy=Nn.y;for(var Ln=Sn.gverts.next.next;null!=Ln;){var Vn=Ln;Vn.x<Sn.aabb.minx&&(Sn.aabb.minx=Vn.x),Vn.x>Sn.aabb.maxx&&(Sn.aabb.maxx=Vn.x),Vn.y<Sn.aabb.miny&&(Sn.aabb.miny=Vn.y),Vn.y>Sn.aabb.maxy&&(Sn.aabb.maxy=Vn.y),Ln=Ln.next}}var Dn=i.aabb;un.minx=Dn.minx-3,un.miny=Dn.miny-3,un.maxx=Dn.maxx+3,un.maxy=Dn.maxy+3;var Fn=(e.dyn=1!=i.body.type&&!i.body.component.sleeping)?this.dtree:this.stree;if(null==Fn.root)Fn.root=e,Fn.root.parent=null;else{for(var Rn=e.aabb,Zn=Fn.root;null!=Zn.child1;){var Bn=Zn.child1,Gn=Zn.child2,qn=Zn.aabb,Un=2*(qn.maxx-qn.minx+(qn.maxy-qn.miny)),Kn=El.tmpaabb,Wn=Zn.aabb;Kn.minx=Wn.minx<Rn.minx?Wn.minx:Rn.minx,Kn.miny=Wn.miny<Rn.miny?Wn.miny:Rn.miny,Kn.maxx=Wn.maxx>Rn.maxx?Wn.maxx:Rn.maxx,Kn.maxy=Wn.maxy>Rn.maxy?Wn.maxy:Rn.maxy;var Yn,Jn,Xn,Hn,$n,Qn=El.tmpaabb,nt=2*(Qn.maxx-Qn.minx+(Qn.maxy-Qn.miny)),tt=2*nt,et=2*(nt-Un),it=El.tmpaabb,pt=Bn.aabb;it.minx=Rn.minx<pt.minx?Rn.minx:pt.minx,it.miny=Rn.miny<pt.miny?Rn.miny:pt.miny,it.maxx=Rn.maxx>pt.maxx?Rn.maxx:pt.maxx,it.maxy=Rn.maxy>pt.maxy?Rn.maxy:pt.maxy,Jn=null==Bn.child1?2*((Yn=El.tmpaabb).maxx-Yn.minx+(Yn.maxy-Yn.miny))+et:(Hn=2*((Xn=Bn.aabb).maxx-Xn.minx+(Xn.maxy-Xn.miny)),2*(($n=El.tmpaabb).maxx-$n.minx+($n.maxy-$n.miny))-Hn+et);var lt,rt,ot,at,st,_t=El.tmpaabb,ht=Gn.aabb;if(_t.minx=Rn.minx<ht.minx?Rn.minx:ht.minx,_t.miny=Rn.miny<ht.miny?Rn.miny:ht.miny,_t.maxx=Rn.maxx>ht.maxx?Rn.maxx:ht.maxx,_t.maxy=Rn.maxy>ht.maxy?Rn.maxy:ht.maxy,rt=null==Gn.child1?2*((lt=El.tmpaabb).maxx-lt.minx+(lt.maxy-lt.miny))+et:(at=2*((ot=Gn.aabb).maxx-ot.minx+(ot.maxy-ot.miny)),2*((st=El.tmpaabb).maxx-st.minx+(st.maxy-st.miny))-at+et),tt<Jn&&tt<rt)break;Zn=Jn<rt?Bn:Gn}var ut,xt=Zn,dt=xt.parent;null==jl.zpp_pool?ut=new jl:(ut=jl.zpp_pool,jl.zpp_pool=ut.next,ut.next=null),null==Al.zpp_pool?ut.aabb=new Al:(ut.aabb=Al.zpp_pool,Al.zpp_pool=ut.aabb.next,ut.aabb.next=null),ut.moved=!1,ut.synced=!1,ut.first_sync=!1,ut.parent=dt;var yt,zt,ct,vt,mt,ft,bt,gt,wt,Mt,Ct,kt,Ot,Pt,St,At,jt,Et,It,Tt,Nt,Lt,Vt,Dt,Ft,Rt,Zt,Bt,Gt,qt,Ut,Kt,Wt,Yt,Jt,Xt,Ht,$t,Qt,ne,te,ee,ie,pe,le,re,oe,ae=ut.aabb,se=xt.aabb;for(ae.minx=Rn.minx<se.minx?Rn.minx:se.minx,ae.miny=Rn.miny<se.miny?Rn.miny:se.miny,ae.maxx=Rn.maxx>se.maxx?Rn.maxx:se.maxx,ae.maxy=Rn.maxy>se.maxy?Rn.maxy:se.maxy,ut.height=xt.height+1,null!=dt?(dt.child1==xt?dt.child1=ut:dt.child2=ut,ut.child1=xt,ut.child2=e,xt.parent=ut,e.parent=ut):(ut.child1=xt,ut.child2=e,xt.parent=ut,e.parent=ut,Fn.root=ut),Zn=e.parent;null!=Zn;){null==Zn.child1||Zn.height<2||(yt=Zn.child1,1<(ct=(zt=Zn.child2).height-yt.height)?(vt=zt.child1,mt=zt.child2,zt.child1=Zn,zt.parent=Zn.parent,null!=(Zn.parent=zt).parent?zt.parent.child1==Zn?zt.parent.child1=zt:zt.parent.child2=zt:Fn.root=zt,vt.height>mt.height?(zt.child2=vt,ft=((Zn.child2=mt).parent=Zn).aabb,bt=yt.aabb,gt=mt.aabb,ft.minx=bt.minx<gt.minx?bt.minx:gt.minx,ft.miny=bt.miny<gt.miny?bt.miny:gt.miny,ft.maxx=bt.maxx>gt.maxx?bt.maxx:gt.maxx,ft.maxy=bt.maxy>gt.maxy?bt.maxy:gt.maxy,wt=zt.aabb,Mt=Zn.aabb,Ct=vt.aabb,wt.minx=Mt.minx<Ct.minx?Mt.minx:Ct.minx,wt.miny=Mt.miny<Ct.miny?Mt.miny:Ct.miny,wt.maxx=Mt.maxx>Ct.maxx?Mt.maxx:Ct.maxx,wt.maxy=Mt.maxy>Ct.maxy?Mt.maxy:Ct.maxy,kt=yt.height,Ot=mt.height,Zn.height=1+(Ot<kt?kt:Ot),Pt=Zn.height,St=vt.height,zt.height=1+(St<Pt?Pt:St)):(zt.child2=mt,At=((Zn.child2=vt).parent=Zn).aabb,jt=yt.aabb,Et=vt.aabb,At.minx=jt.minx<Et.minx?jt.minx:Et.minx,At.miny=jt.miny<Et.miny?jt.miny:Et.miny,At.maxx=jt.maxx>Et.maxx?jt.maxx:Et.maxx,At.maxy=jt.maxy>Et.maxy?jt.maxy:Et.maxy,It=zt.aabb,Tt=Zn.aabb,Nt=mt.aabb,It.minx=Tt.minx<Nt.minx?Tt.minx:Nt.minx,It.miny=Tt.miny<Nt.miny?Tt.miny:Nt.miny,It.maxx=Tt.maxx>Nt.maxx?Tt.maxx:Nt.maxx,It.maxy=Tt.maxy>Nt.maxy?Tt.maxy:Nt.maxy,Lt=yt.height,Vt=vt.height,Zn.height=1+(Vt<Lt?Lt:Vt),Dt=Zn.height,Ft=mt.height,zt.height=1+(Ft<Dt?Dt:Ft)),Zn=zt):ct<-1&&(Rt=yt.child1,Zt=yt.child2,yt.child1=Zn,yt.parent=Zn.parent,null!=(Zn.parent=yt).parent?yt.parent.child1==Zn?yt.parent.child1=yt:yt.parent.child2=yt:Fn.root=yt,Rt.height>Zt.height?(yt.child2=Rt,Bt=((Zn.child1=Zt).parent=Zn).aabb,Gt=zt.aabb,qt=Zt.aabb,Bt.minx=Gt.minx<qt.minx?Gt.minx:qt.minx,Bt.miny=Gt.miny<qt.miny?Gt.miny:qt.miny,Bt.maxx=Gt.maxx>qt.maxx?Gt.maxx:qt.maxx,Bt.maxy=Gt.maxy>qt.maxy?Gt.maxy:qt.maxy,Ut=yt.aabb,Kt=Zn.aabb,Wt=Rt.aabb,Ut.minx=Kt.minx<Wt.minx?Kt.minx:Wt.minx,Ut.miny=Kt.miny<Wt.miny?Kt.miny:Wt.miny,Ut.maxx=Kt.maxx>Wt.maxx?Kt.maxx:Wt.maxx,Ut.maxy=Kt.maxy>Wt.maxy?Kt.maxy:Wt.maxy,Yt=zt.height,Jt=Zt.height,Zn.height=1+(Jt<Yt?Yt:Jt),Xt=Zn.height,Ht=Rt.height,yt.height=1+(Ht<Xt?Xt:Ht)):(yt.child2=Zt,$t=((Zn.child1=Rt).parent=Zn).aabb,Qt=zt.aabb,ne=Rt.aabb,$t.minx=Qt.minx<ne.minx?Qt.minx:ne.minx,$t.miny=Qt.miny<ne.miny?Qt.miny:ne.miny,$t.maxx=Qt.maxx>ne.maxx?Qt.maxx:ne.maxx,$t.maxy=Qt.maxy>ne.maxy?Qt.maxy:ne.maxy,te=yt.aabb,ee=Zn.aabb,ie=Zt.aabb,te.minx=ee.minx<ie.minx?ee.minx:ie.minx,te.miny=ee.miny<ie.miny?ee.miny:ie.miny,te.maxx=ee.maxx>ie.maxx?ee.maxx:ie.maxx,te.maxy=ee.maxy>ie.maxy?ee.maxy:ie.maxy,pe=zt.height,le=Rt.height,Zn.height=1+(le<pe?pe:le),re=Zn.height,oe=Zt.height,yt.height=1+(oe<re?re:oe)),Zn=yt));var _e=Zn.child1,he=Zn.child2,ue=_e.height,xe=he.height;Zn.height=1+(xe<ue?ue:xe);var de=Zn.aabb,ye=_e.aabb,ze=he.aabb;de.minx=ye.minx<ze.minx?ye.minx:ze.minx,de.miny=ye.miny<ze.miny?ye.miny:ze.miny,de.maxx=ye.maxx>ze.maxx?ye.maxx:ze.maxx,de.maxy=ye.maxy>ze.maxy?ye.maxy:ze.maxy,Zn=Zn.parent}}e.synced=!1,e=e.snext}for(;null!=this.syncs;){var ce=this.syncs;if(this.syncs=ce.snext,ce.snext=null,!ce.moved){ce.moved=!1;var ve=ce.shape;if(!ve.body.component.sleeping){var me=ce.aabb,fe=null;for(null!=this.dtree.root&&(this.dtree.root.next=fe,fe=this.dtree.root);null!=fe;){var be=fe,fe=be.next;if(be.next=null,be!=ce)if(null==be.child1){var ge=be.shape;if(ge.body!=ve.body&&(1!=ge.body.type||1!=ve.body.type)){var we=be.aabb;if(we.miny<=me.maxy&&me.miny<=we.maxy&&we.minx<=me.maxx&&me.minx<=we.maxx){for(var Me,Ce=ve.id<ge.id?(Me=ve.id,ge.id):(Me=ge.id,ve.id),ke=null,Oe=(ve.pairs.length<ge.pairs.length?ve:ge).pairs.head;null!=Oe;){var Pe=Oe.elt;if(Pe.id==Me&&Pe.di==Ce){ke=Pe;break}Oe=Oe.next}if(null!=ke){ke.sleeping&&(ke.sleeping=!1,ke.next=this.pairs,(this.pairs=ke).first=!0);continue}null==ep.zpp_pool?ke=new ep:(ke=ep.zpp_pool,ep.zpp_pool=ke.next,ke.next=null),ke.n1=ce,ke.n2=be,ke.id=Me,ke.di=Ce,ke.next=this.pairs,(this.pairs=ke).first=!0;var Se,Ae=ve.pairs;null==ip.zpp_pool?Se=new ip:(Se=ip.zpp_pool,ip.zpp_pool=Se.next,Se.next=null),Se.elt=ke;var je=Se;je.next=Ae.head,Ae.head=je,Ae.modified=!0,Ae.length++;var Ee,Ie=ge.pairs;null==ip.zpp_pool?Ee=new ip:(Ee=ip.zpp_pool,ip.zpp_pool=Ee.next,Ee.next=null),Ee.elt=ke;var Te=Ee;Te.next=Ie.head,Ie.head=Te,Ie.modified=!0,Ie.length++}}}else{var Ne=be.aabb;Ne.miny<=me.maxy&&me.miny<=Ne.maxy&&Ne.minx<=me.maxx&&me.minx<=Ne.maxx&&(null!=be.child1&&(be.child1.next=fe,fe=be.child1),null!=be.child2&&(be.child2.next=fe,fe=be.child2))}}for(null!=this.stree.root&&(this.stree.root.next=fe,fe=this.stree.root);null!=fe;){var Le=fe;if(fe=Le.next,Le.next=null,Le!=ce)if(null==Le.child1){var Ve=Le.shape;if(Ve.body!=ve.body&&(1!=Ve.body.type||1!=ve.body.type)){var De=Le.aabb;if(De.miny<=me.maxy&&me.miny<=De.maxy&&De.minx<=me.maxx&&me.minx<=De.maxx){for(var Fe,Re=ve.id<Ve.id?(Fe=ve.id,Ve.id):(Fe=Ve.id,ve.id),Ze=null,Be=(ve.pairs.length<Ve.pairs.length?ve:Ve).pairs.head;null!=Be;){var Ge=Be.elt;if(Ge.id==Fe&&Ge.di==Re){Ze=Ge;break}Be=Be.next}if(null!=Ze){Ze.sleeping&&(Ze.sleeping=!1,Ze.next=this.pairs,(this.pairs=Ze).first=!0);continue}null==ep.zpp_pool?Ze=new ep:(Ze=ep.zpp_pool,ep.zpp_pool=Ze.next,Ze.next=null),Ze.n1=ce,Ze.n2=Le,Ze.id=Fe,Ze.di=Re,Ze.next=this.pairs,(this.pairs=Ze).first=!0;var qe,Ue=ve.pairs;null==ip.zpp_pool?qe=new ip:(qe=ip.zpp_pool,ip.zpp_pool=qe.next,qe.next=null),qe.elt=Ze;var Ke=qe;Ke.next=Ue.head,Ue.head=Ke,Ue.modified=!0,Ue.length++;var We,Ye=Ve.pairs;null==ip.zpp_pool?We=new ip:(We=ip.zpp_pool,ip.zpp_pool=We.next,We.next=null),We.elt=Ze;var Je=We;Je.next=Ye.head,Ye.head=Je,Ye.modified=!0,Ye.length++}}}else{var Xe=Le.aabb;Xe.miny<=me.maxy&&me.miny<=Xe.maxy&&Xe.minx<=me.maxx&&me.minx<=Xe.maxx&&(null!=Le.child1&&(Le.child1.next=fe,fe=Le.child1),null!=Le.child2&&(Le.child2.next=fe,fe=Le.child2))}}}}}for(;null!=this.moves;){var He=this.moves;this.moves=He.mnext,He.mnext=null,He.moved=!1;var $e=He.shape;if(!$e.body.component.sleeping){var Qe=He.aabb,ni=null;for(null!=this.dtree.root&&(this.dtree.root.next=ni,ni=this.dtree.root);null!=ni;){var ti=ni,ni=ti.next;if(ti.next=null,ti!=He)if(null==ti.child1){var ei=ti.shape;if(ei.body!=$e.body&&(1!=ei.body.type||1!=$e.body.type)){var ii=ti.aabb;if(ii.miny<=Qe.maxy&&Qe.miny<=ii.maxy&&ii.minx<=Qe.maxx&&Qe.minx<=ii.maxx){for(var pi,li=$e.id<ei.id?(pi=$e.id,ei.id):(pi=ei.id,$e.id),ri=null,oi=($e.pairs.length<ei.pairs.length?$e:ei).pairs.head;null!=oi;){var ai=oi.elt;if(ai.id==pi&&ai.di==li){ri=ai;break}oi=oi.next}if(null!=ri){ri.sleeping&&(ri.sleeping=!1,ri.next=this.pairs,(this.pairs=ri).first=!0);continue}null==ep.zpp_pool?ri=new ep:(ri=ep.zpp_pool,ep.zpp_pool=ri.next,ri.next=null),ri.n1=He,ri.n2=ti,ri.id=pi,ri.di=li,ri.next=this.pairs,(this.pairs=ri).first=!0;var si,_i=$e.pairs;null==ip.zpp_pool?si=new ip:(si=ip.zpp_pool,ip.zpp_pool=si.next,si.next=null),si.elt=ri;var hi=si;hi.next=_i.head,_i.head=hi,_i.modified=!0,_i.length++;var ui,xi=ei.pairs;null==ip.zpp_pool?ui=new ip:(ui=ip.zpp_pool,ip.zpp_pool=ui.next,ui.next=null),ui.elt=ri;var di=ui;di.next=xi.head,xi.head=di,xi.modified=!0,xi.length++}}}else{var yi=ti.aabb;yi.miny<=Qe.maxy&&Qe.miny<=yi.maxy&&yi.minx<=Qe.maxx&&Qe.minx<=yi.maxx&&(null!=ti.child1&&(ti.child1.next=ni,ni=ti.child1),null!=ti.child2&&(ti.child2.next=ni,ni=ti.child2))}}for(null!=this.stree.root&&(this.stree.root.next=ni,ni=this.stree.root);null!=ni;){var zi=ni;if(ni=zi.next,zi.next=null,zi!=He)if(null==zi.child1){var ci=zi.shape;if(ci.body!=$e.body&&(1!=ci.body.type||1!=$e.body.type)){var vi=zi.aabb;if(vi.miny<=Qe.maxy&&Qe.miny<=vi.maxy&&vi.minx<=Qe.maxx&&Qe.minx<=vi.maxx){for(var mi,fi=$e.id<ci.id?(mi=$e.id,ci.id):(mi=ci.id,$e.id),bi=null,gi=($e.pairs.length<ci.pairs.length?$e:ci).pairs.head;null!=gi;){var wi=gi.elt;if(wi.id==mi&&wi.di==fi){bi=wi;break}gi=gi.next}if(null!=bi){bi.sleeping&&(bi.sleeping=!1,bi.next=this.pairs,(this.pairs=bi).first=!0);continue}null==ep.zpp_pool?bi=new ep:(bi=ep.zpp_pool,ep.zpp_pool=bi.next,bi.next=null),bi.n1=He,bi.n2=zi,bi.id=mi,bi.di=fi,bi.next=this.pairs,(this.pairs=bi).first=!0;var Mi,Ci=$e.pairs;null==ip.zpp_pool?Mi=new ip:(Mi=ip.zpp_pool,ip.zpp_pool=Mi.next,Mi.next=null),Mi.elt=bi;var ki=Mi;ki.next=Ci.head,Ci.head=ki,Ci.modified=!0,Ci.length++;var Oi,Pi=ci.pairs;null==ip.zpp_pool?Oi=new ip:(Oi=ip.zpp_pool,ip.zpp_pool=Oi.next,Oi.next=null),Oi.elt=bi;var Si=Oi;Si.next=Pi.head,Pi.head=Si,Pi.modified=!0,Pi.length++}}}else{var Ai=zi.aabb;Ai.miny<=Qe.maxy&&Qe.miny<=Ai.maxy&&Ai.minx<=Qe.maxx&&Qe.minx<=Ai.maxx&&(null!=zi.child1&&(zi.child1.next=ni,ni=zi.child1),null!=zi.child2&&(zi.child2.next=ni,ni=zi.child2))}}}}for(var ji,Ei,Ii=null,Ti=this.pairs;null!=Ti;){if(!Ti.first&&(ji=Ti.n1.aabb,!((Ei=Ti.n2.aabb).miny<=ji.maxy&&ji.miny<=Ei.maxy&&Ei.minx<=ji.maxx&&ji.minx<=Ei.maxx))){null==Ii?this.pairs=Ti.next:Ii.next=Ti.next;for(var Ni,Li,Vi=Ti.n1.shape.pairs,Di=null,Fi=Vi.head;null!=Fi;){if(Fi.elt==Ti){null==Di?(Li=(Ni=Vi.head).next,Vi.head=Li,null==Vi.head&&(Vi.pushmod=!0)):(Li=(Ni=Di.next).next,null==(Di.next=Li)&&(Vi.pushmod=!0));var Ri=Ni;Ri.elt=null,Ri.next=ip.zpp_pool,ip.zpp_pool=Ri,Vi.modified=!0,Vi.length--,Vi.pushmod=!0;break}Fi=(Di=Fi).next}for(var Zi,Bi,Gi=Ti.n2.shape.pairs,qi=null,Ui=Gi.head;null!=Ui;){if(Ui.elt==Ti){null==qi?(Bi=(Zi=Gi.head).next,Gi.head=Bi,null==Gi.head&&(Gi.pushmod=!0)):(Bi=(Zi=qi.next).next,null==(qi.next=Bi)&&(Gi.pushmod=!0));var Ki=Zi;Ki.elt=null,Ki.next=ip.zpp_pool,ip.zpp_pool=Ki,Gi.modified=!0,Gi.length--,Gi.pushmod=!0;break}Ui=(qi=Ui).next}var Wi=Ti.next;null!=Ti.arb&&(Ti.arb.pair=null),Ti.arb=null;var Yi=Ti;Yi.n1=Yi.n2=null,Yi.sleeping=!1,Yi.next=ep.zpp_pool,ep.zpp_pool=Yi,Ti=Wi}else var Ji,Xi,Hi,$i=Ti.n1.shape,Qi=$i.body,np=Ti.n2.shape,tp=np.body,Ti=Ti.first||!Qi.component.sleeping&&1!=Qi.type||!tp.component.sleeping&&1!=tp.type?(Ti.first=!1,Ji=$i.aabb,(Xi=np.aabb).miny<=Ji.maxy&&Ji.miny<=Xi.maxy&&Xi.minx<=Ji.maxx&&Ji.minx<=Xi.maxx&&(Hi=Ti.arb,Ti.arb=t?n.narrowPhase($i,np,2!=Qi.type||2!=tp.type,Ti.arb,!1):n.continuousEvent($i,np,2!=Qi.type||2!=tp.type,Ti.arb,!1),null==Ti.arb?null!=Hi&&(Hi.pair=null):Ti.arb.pair=Ti),(Ii=Ti).next):(Ti.sleeping=!0,null==Ii?this.pairs=Ti.next:Ii.next=Ti.next,Ti.next)}},ie.prototype.clear=function(){for(;null!=this.syncs;){var n=this.syncs.snext;this.syncs.snext=null,this.syncs.first_sync&&(this.syncs.shape.node=null,this.syncs.shape.removedFromSpace(),this.syncs.shape=null),this.syncs=n}for(;null!=this.moves;){var t=this.moves.mnext;this.moves.mnext=null,this.moves.first_sync&&(this.moves.shape.node=null,this.moves.shape.removedFromSpace(),this.moves.shape=null),this.moves=t}for(;null!=this.pairs;){var e=this.pairs.next;null!=this.pairs.arb&&(this.pairs.arb.pair=null),this.pairs.arb=null;for(var i,p,l=this.pairs.n1.shape.pairs,r=this.pairs,o=null,a=l.head;null!=a;){if(a.elt==r){null==o?(p=(i=l.head).next,l.head=p,null==l.head&&(l.pushmod=!0)):(p=(i=o.next).next,null==(o.next=p)&&(l.pushmod=!0));var s=i;s.elt=null,s.next=ip.zpp_pool,ip.zpp_pool=s,l.modified=!0,l.length--,l.pushmod=!0;break}a=(o=a).next}for(var _,h,u=this.pairs.n2.shape.pairs,x=this.pairs,d=null,y=u.head;null!=y;){if(y.elt==x){null==d?(h=(_=u.head).next,u.head=h,null==u.head&&(u.pushmod=!0)):(h=(_=d.next).next,null==(d.next=h)&&(u.pushmod=!0));var z=_;z.elt=null,z.next=ip.zpp_pool,ip.zpp_pool=z,u.modified=!0,u.length--,u.pushmod=!0;break}y=(d=y).next}var c=this.pairs;c.n1=c.n2=null,c.sleeping=!1,c.next=ep.zpp_pool,ep.zpp_pool=c,this.pairs=e}this.dtree.clear(),this.stree.clear()},ie.prototype.treeStack=null,ie.prototype.shapesUnderPoint=function(n,t,e,i){var p;this.sync_broadphase(),null==mo.zpp_pool?p=new mo:(p=mo.zpp_pool,mo.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t;var l=p,r=null==i?new bn:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o,a=this.treeStack.pop_unsafe(),s=a.aabb;l.x>=s.minx&&l.x<=s.maxx&&l.y>=s.miny&&l.y<=s.maxy&&(null==a.child1?(null==e||0!=((o=a.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&o.collisionGroup))&&(0==a.shape.type?vo.circleContains(a.shape.circle,l)&&r.push(a.shape.outer):vo.polyContains(a.shape.polygon,l)&&r.push(a.shape.outer)):(null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var _,h=this.treeStack.pop_unsafe(),u=h.aabb;l.x>=u.minx&&l.x<=u.maxx&&l.y>=u.miny&&l.y<=u.maxy&&(null==h.child1?(null==e||0!=((_=h.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&_.collisionGroup))&&(0==h.shape.type?vo.circleContains(h.shape.circle,l)&&r.push(h.shape.outer):vo.polyContains(h.shape.polygon,l)&&r.push(h.shape.outer)):(null!=h.child1&&this.treeStack.add(h.child1),null!=h.child2&&this.treeStack.add(h.child2)))}return null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=mo.zpp_pool,mo.zpp_pool=l,r},ie.prototype.bodiesUnderPoint=function(n,t,e,i){var p;this.sync_broadphase(),null==mo.zpp_pool?p=new mo:(p=mo.zpp_pool,mo.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t;var l=p,r=null==i?new tn:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o,a,s=this.treeStack.pop_unsafe(),_=s.aabb;l.x>=_.minx&&l.x<=_.maxx&&l.y>=_.miny&&l.y<=_.maxy&&(null==s.child1?(o=s.shape.body.outer,r.has(o)||(null==e||0!=((a=s.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&a.collisionGroup))&&(0==s.shape.type?vo.circleContains(s.shape.circle,l)&&r.push(o):vo.polyContains(s.shape.polygon,l)&&r.push(o))):(null!=s.child1&&this.treeStack.add(s.child1),null!=s.child2&&this.treeStack.add(s.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var h,u,x=this.treeStack.pop_unsafe(),d=x.aabb;l.x>=d.minx&&l.x<=d.maxx&&l.y>=d.miny&&l.y<=d.maxy&&(null==x.child1?(h=x.shape.body.outer,r.has(h)||(null==e||0!=((u=x.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&u.collisionGroup))&&(0==x.shape.type?vo.circleContains(x.shape.circle,l)&&r.push(h):vo.polyContains(x.shape.polygon,l)&&r.push(h))):(null!=x.child1&&this.treeStack.add(x.child1),null!=x.child2&&this.treeStack.add(x.child2)))}return null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=mo.zpp_pool,mo.zpp_pool=l,r},ie.prototype.treeStack2=null,ie.prototype.shapesInAABB=function(n,t,e,i,p){this.sync_broadphase(),this.updateAABBShape(n);var l=this.aabbShape.zpp_inner.aabb,r=null==p?new bn:p;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o,a=this.treeStack.pop_unsafe(),s=a.aabb;if(s.minx>=l.minx&&s.miny>=l.miny&&s.maxx<=l.maxx&&s.maxy<=l.maxy){if(null==a.child1)(null==i||0!=((o=a.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&o.collisionGroup))&&r.push(a.shape.outer);else for(null==this.treeStack2&&(this.treeStack2=new Ae),this.treeStack2.add(a);null!=this.treeStack2.head;){var _,h=this.treeStack2.pop_unsafe();null==h.child1?(null==i||0!=((_=h.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup))&&r.push(h.shape.outer):(null!=h.child1&&this.treeStack2.add(h.child1),null!=h.child2&&this.treeStack2.add(h.child2))}}else{var u,x,d,y=a.aabb;l.miny<=y.maxy&&y.miny<=l.maxy&&l.minx<=y.maxx&&y.minx<=l.maxx&&(null==a.child1?(null==i||0!=((u=a.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&u.collisionGroup))&&(t?e?vo.containTest(this.aabbShape.zpp_inner,a.shape)&&r.push(a.shape.outer):((x=a.shape.aabb).minx>=l.minx&&x.miny>=l.miny&&x.maxx<=l.maxx&&x.maxy<=l.maxy||vo.testCollide_safe(a.shape,this.aabbShape.zpp_inner))&&r.push(a.shape.outer):(!e||(d=a.shape.aabb).minx>=l.minx&&d.miny>=l.miny&&d.maxx<=l.maxx&&d.maxy<=l.maxy)&&r.push(a.shape.outer)):(null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)))}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var z,c=this.treeStack.pop_unsafe(),v=c.aabb;if(v.minx>=l.minx&&v.miny>=l.miny&&v.maxx<=l.maxx&&v.maxy<=l.maxy){if(null==c.child1)(null==i||0!=((z=c.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&z.collisionGroup))&&r.push(c.shape.outer);else for(null==this.treeStack2&&(this.treeStack2=new Ae),this.treeStack2.add(c);null!=this.treeStack2.head;){var m,f=this.treeStack2.pop_unsafe();null==f.child1?(null==i||0!=((m=f.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&m.collisionGroup))&&r.push(f.shape.outer):(null!=f.child1&&this.treeStack2.add(f.child1),null!=f.child2&&this.treeStack2.add(f.child2))}}else{var b,g,w,M=c.aabb;l.miny<=M.maxy&&M.miny<=l.maxy&&l.minx<=M.maxx&&M.minx<=l.maxx&&(null==c.child1?(null==i||0!=((b=c.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&b.collisionGroup))&&(t?e?vo.containTest(this.aabbShape.zpp_inner,c.shape)&&r.push(c.shape.outer):((g=c.shape.aabb).minx>=l.minx&&g.miny>=l.miny&&g.maxx<=l.maxx&&g.maxy<=l.maxy||vo.testCollide_safe(c.shape,this.aabbShape.zpp_inner))&&r.push(c.shape.outer):(!e||(w=c.shape.aabb).minx>=l.minx&&w.miny>=l.miny&&w.maxx<=l.maxx&&w.maxy<=l.maxy)&&r.push(c.shape.outer)):(null!=c.child1&&this.treeStack.add(c.child1),null!=c.child2&&this.treeStack.add(c.child2)))}}return r},ie.prototype.failed=null,ie.prototype.bodiesInAABB=function(n,t,e,i,p){this.sync_broadphase(),this.updateAABBShape(n);var l=this.aabbShape.zpp_inner.aabb,r=null==p?new tn:p;if(null==this.failed&&(this.failed=new tn),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o,a,s=this.treeStack.pop_unsafe(),_=s.aabb;if(_.minx>=l.minx&&_.miny>=l.miny&&_.maxx<=l.maxx&&_.maxy<=l.maxy){if(null==s.child1)(null==i||0!=((o=s.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&o.collisionGroup))&&(a=s.shape.body.outer,r.has(a)||r.push(a));else for(null==this.treeStack2&&(this.treeStack2=new Ae),this.treeStack2.add(s);null!=this.treeStack2.head;){var h,u,x=this.treeStack2.pop_unsafe();null==x.child1?(null==i||0!=((h=x.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&h.collisionGroup))&&(u=x.shape.body.outer,r.has(u)||r.push(u)):(null!=x.child1&&this.treeStack2.add(x.child1),null!=x.child2&&this.treeStack2.add(x.child2))}}else{var d,y,z,c,v,m,f=s.aabb;l.miny<=f.maxy&&f.miny<=l.maxy&&l.minx<=f.maxx&&f.minx<=l.maxx&&(null==s.child1?(d=s.shape.body.outer,(null==i||0!=((y=s.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&y.collisionGroup))&&(t?e?this.failed.has(d)||(z=vo.containTest(this.aabbShape.zpp_inner,s.shape),!r.has(d)&&z?r.push(d):z||(r.remove(d),this.failed.push(d))):!r.has(d)&&vo.testCollide_safe(s.shape,this.aabbShape.zpp_inner)&&r.push(d):e?this.failed.has(d)||(v=(c=s.shape.aabb).minx>=l.minx&&c.miny>=l.miny&&c.maxx<=l.maxx&&c.maxy<=l.maxy,!r.has(d)&&v?r.push(d):v||(r.remove(d),this.failed.push(d))):!r.has(d)&&((m=s.shape.aabb).minx>=l.minx&&m.miny>=l.miny&&m.maxx<=l.maxx&&m.maxy<=l.maxy)&&r.push(d))):(null!=s.child1&&this.treeStack.add(s.child1),null!=s.child2&&this.treeStack.add(s.child2)))}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var b,g,w=this.treeStack.pop_unsafe(),M=w.aabb;if(M.minx>=l.minx&&M.miny>=l.miny&&M.maxx<=l.maxx&&M.maxy<=l.maxy){if(null==w.child1)(null==i||0!=((b=w.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&b.collisionGroup))&&(g=w.shape.body.outer,r.has(g)||r.push(g));else for(null==this.treeStack2&&(this.treeStack2=new Ae),this.treeStack2.add(w);null!=this.treeStack2.head;){var C,k,O=this.treeStack2.pop_unsafe();null==O.child1?(null==i||0!=((C=O.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&C.collisionGroup))&&(k=O.shape.body.outer,r.has(k)||r.push(k)):(null!=O.child1&&this.treeStack2.add(O.child1),null!=O.child2&&this.treeStack2.add(O.child2))}}else{var P,S,A,j,E,I,T=w.aabb;l.miny<=T.maxy&&T.miny<=l.maxy&&l.minx<=T.maxx&&T.minx<=l.maxx&&(null==w.child1?(P=w.shape.body.outer,(null==i||0!=((S=w.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&S.collisionGroup))&&(t?e?this.failed.has(P)||(A=vo.containTest(this.aabbShape.zpp_inner,w.shape),!r.has(P)&&A?r.push(P):A||(r.remove(P),this.failed.push(P))):!r.has(P)&&vo.testCollide_safe(w.shape,this.aabbShape.zpp_inner)&&r.push(P):e?this.failed.has(P)||(E=(j=w.shape.aabb).minx>=l.minx&&j.miny>=l.miny&&j.maxx<=l.maxx&&j.maxy<=l.maxy,!r.has(P)&&E?r.push(P):E||(r.remove(P),this.failed.push(P))):!r.has(P)&&((I=w.shape.aabb).minx>=l.minx&&I.miny>=l.miny&&I.maxx<=l.maxx&&I.maxy<=l.maxy)&&r.push(P))):(null!=w.child1&&this.treeStack.add(w.child1),null!=w.child2&&this.treeStack.add(w.child2)))}}return this.failed.clear(),r},ie.prototype.shapesInCircle=function(n,t,e,i,p,l){this.sync_broadphase(),this.updateCircShape(n,t,e);var r=this.circShape.zpp_inner.aabb,o=null==l?new bn:l;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a,s=this.treeStack.pop_unsafe(),_=s.aabb;r.miny<=_.maxy&&_.miny<=r.maxy&&r.minx<=_.maxx&&_.minx<=r.maxx&&(null==s.child1?(null==p||0!=((a=s.shape.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&a.collisionGroup))&&(i?vo.containTest(this.circShape.zpp_inner,s.shape)&&o.push(s.shape.outer):vo.testCollide_safe(s.shape,this.circShape.zpp_inner)&&o.push(s.shape.outer)):(null!=s.child1&&this.treeStack.add(s.child1),null!=s.child2&&this.treeStack.add(s.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var h,u=this.treeStack.pop_unsafe(),x=u.aabb;r.miny<=x.maxy&&x.miny<=r.maxy&&r.minx<=x.maxx&&x.minx<=r.maxx&&(null==u.child1?(null==p||0!=((h=u.shape.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&h.collisionGroup))&&(i?vo.containTest(this.circShape.zpp_inner,u.shape)&&o.push(u.shape.outer):vo.testCollide_safe(u.shape,this.circShape.zpp_inner)&&o.push(u.shape.outer)):(null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)))}return o},ie.prototype.bodiesInCircle=function(n,t,e,i,p,l){this.sync_broadphase(),this.updateCircShape(n,t,e);var r=this.circShape.zpp_inner.aabb,o=null==l?new tn:l;if(null==this.failed&&(this.failed=new tn),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a,s,_,h=this.treeStack.pop_unsafe(),u=h.aabb;r.miny<=u.maxy&&u.miny<=r.maxy&&r.minx<=u.maxx&&u.minx<=r.maxx&&(null==h.child1?(a=h.shape.body.outer,(null==p||0!=((s=h.shape.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&s.collisionGroup))&&(i?this.failed.has(a)||(_=vo.containTest(this.circShape.zpp_inner,h.shape),!o.has(a)&&_?o.push(a):_||(o.remove(a),this.failed.push(a))):!o.has(a)&&vo.testCollide_safe(h.shape,this.circShape.zpp_inner)&&o.push(a))):(null!=h.child1&&this.treeStack.add(h.child1),null!=h.child2&&this.treeStack.add(h.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var x,d,y,z=this.treeStack.pop_unsafe(),c=z.aabb;r.miny<=c.maxy&&c.miny<=r.maxy&&r.minx<=c.maxx&&c.minx<=r.maxx&&(null==z.child1?(x=z.shape.body.outer,(null==p||0!=((d=z.shape.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&d.collisionGroup))&&(i?this.failed.has(x)||(y=vo.containTest(this.circShape.zpp_inner,z.shape),!o.has(x)&&y?o.push(x):y||(o.remove(x),this.failed.push(x))):!o.has(x)&&vo.testCollide_safe(z.shape,this.circShape.zpp_inner)&&o.push(x))):(null!=z.child1&&this.treeStack.add(z.child1),null!=z.child2&&this.treeStack.add(z.child2)))}return this.failed.clear(),o},ie.prototype.shapesInShape=function(n,t,e,i){this.sync_broadphase(),this.validateShape(n);var p=n.aabb,l=null==i?new bn:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var r,o=this.treeStack.pop_unsafe(),a=o.aabb;p.miny<=a.maxy&&a.miny<=p.maxy&&p.minx<=a.maxx&&a.minx<=p.maxx&&(null==o.child1?(null==e||0!=((r=o.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&r.collisionGroup))&&(t?vo.containTest(n,o.shape)&&l.push(o.shape.outer):vo.testCollide_safe(o.shape,n)&&l.push(o.shape.outer)):(null!=o.child1&&this.treeStack.add(o.child1),null!=o.child2&&this.treeStack.add(o.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var s,_=this.treeStack.pop_unsafe(),h=_.aabb;p.miny<=h.maxy&&h.miny<=p.maxy&&p.minx<=h.maxx&&h.minx<=p.maxx&&(null==_.child1?(null==e||0!=((s=_.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&s.collisionGroup))&&(t?vo.containTest(n,_.shape)&&l.push(_.shape.outer):vo.testCollide_safe(_.shape,n)&&l.push(_.shape.outer)):(null!=_.child1&&this.treeStack.add(_.child1),null!=_.child2&&this.treeStack.add(_.child2)))}return l},ie.prototype.bodiesInShape=function(n,t,e,i){this.sync_broadphase(),this.validateShape(n);var p=n.aabb,l=null==i?new tn:i;if(null==this.failed&&(this.failed=new tn),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var r,o,a,s=this.treeStack.pop_unsafe(),_=s.aabb;p.miny<=_.maxy&&_.miny<=p.maxy&&p.minx<=_.maxx&&_.minx<=p.maxx&&(null==s.child1?(r=s.shape.body.outer,(null==e||0!=((o=s.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&o.collisionGroup))&&(t?this.failed.has(r)||(a=vo.containTest(n,s.shape),!l.has(r)&&a?l.push(r):a||(l.remove(r),this.failed.push(r))):!l.has(r)&&vo.testCollide_safe(s.shape,n)&&l.push(r))):(null!=s.child1&&this.treeStack.add(s.child1),null!=s.child2&&this.treeStack.add(s.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ae),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var h,u,x,d=this.treeStack.pop_unsafe(),y=d.aabb;p.miny<=y.maxy&&y.miny<=p.maxy&&p.minx<=y.maxx&&y.minx<=p.maxx&&(null==d.child1?(h=d.shape.body.outer,(null==e||0!=((u=d.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&u.collisionGroup))&&(t?this.failed.has(h)||(x=vo.containTest(n,d.shape),!l.has(h)&&x?l.push(h):x||(l.remove(h),this.failed.push(h))):!l.has(h)&&vo.testCollide_safe(d.shape,n)&&l.push(h))):(null!=d.child1&&this.treeStack.add(d.child1),null!=d.child2&&this.treeStack.add(d.child2)))}return this.failed.clear(),l},ie.prototype.openlist=null,ie.prototype.rayCast=function(n,t,e){null==this.openlist&&(this.openlist=new Ae),this.sync_broadphase(),n.validate_dir();var i=n.maxdist;if(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb)){var p=n.aabbsect(this.dtree.root.aabb);if(0<=p&&p<i){this.dtree.root.rayt=p;for(var l=null,r=this.openlist.head;null!=r&&!(this.dtree.root.rayt<r.elt.rayt);)r=(l=r).next;var o,a=this.openlist;null==ai.zpp_pool?o=new ai:(o=ai.zpp_pool,ai.zpp_pool=o.next,o.next=null),o.elt=this.dtree.root;var s=o;null==l?(s.next=a.head,a.head=s):(s.next=l.next,l.next=s),a.pushmod=a.modified=!0,a.length++}}if(null!=this.stree.root&&n.aabbtest(this.stree.root.aabb)){var _=n.aabbsect(this.stree.root.aabb);if(0<=_&&_<i){this.stree.root.rayt=_;for(var h=null,u=this.openlist.head;null!=u&&!(this.stree.root.rayt<u.elt.rayt);)u=(h=u).next;var x,d=this.openlist;null==ai.zpp_pool?x=new ai:(x=ai.zpp_pool,ai.zpp_pool=x.next,x.next=null),x.elt=this.stree.root;var y=x;null==h?(y.next=d.head,d.head=y):(y.next=h.next,h.next=y),d.pushmod=d.modified=!0,d.length++}}for(var z=null;null!=this.openlist.head;){var c=this.openlist.pop_unsafe();if(c.rayt>=i)break;if(null==c.child1){var v,m,f=c.shape;!(null==e||0!=((v=f.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&v.collisionGroup))||null!=(m=0==f.type?n.circlesect(f.circle,t,i):n.aabbtest(f.aabb)?n.polysect(f.polygon,t,i):null)&&(i=m.zpp_inner.toiDistance,null!=z&&z.zpp_inner.free(),z=m)}else{if(null!=c.child1&&n.aabbtest(c.child1.aabb)){var b=n.aabbsect(c.child1.aabb);if(0<=b&&b<i){c.child1.rayt=b;for(var g=null,w=this.openlist.head;null!=w&&!(c.child1.rayt<w.elt.rayt);)w=(g=w).next;var M,C=this.openlist;null==ai.zpp_pool?M=new ai:(M=ai.zpp_pool,ai.zpp_pool=M.next,M.next=null),M.elt=c.child1;var k=M;null==g?(k.next=C.head,C.head=k):(k.next=g.next,g.next=k),C.pushmod=C.modified=!0,C.length++}}if(null!=c.child2&&n.aabbtest(c.child2.aabb)){var O=n.aabbsect(c.child2.aabb);if(0<=O&&O<i){c.child2.rayt=O;for(var P=null,S=this.openlist.head;null!=S&&!(c.child2.rayt<S.elt.rayt);)S=(P=S).next;var A,j=this.openlist;null==ai.zpp_pool?A=new ai:(A=ai.zpp_pool,ai.zpp_pool=A.next,A.next=null),A.elt=c.child2;var E=A;null==P?(E.next=j.head,j.head=E):(E.next=P.next,P.next=E),j.pushmod=j.modified=!0,j.length++}}}}return this.openlist.clear(),z},ie.prototype.rayMultiCast=function(n,t,e,i){null==this.openlist&&(this.openlist=new Ae),this.sync_broadphase(),n.validate_dir();var p,l,r=n.maxdist>=1/0,o=null==i?new J:i;for(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb)&&(r||0<=(p=n.aabbsect(this.dtree.root.aabb))&&p<n.maxdist)&&this.openlist.add(this.dtree.root),null!=this.stree.root&&n.aabbtest(this.stree.root.aabb)&&(r||0<=(l=n.aabbsect(this.stree.root.aabb))&&l<n.maxdist)&&this.openlist.add(this.stree.root);null!=this.openlist.head;){var a,s,_,h,u=this.openlist.pop_unsafe();null==u.child1?(a=u.shape,(null==e||0!=((s=a.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&s.collisionGroup))&&(0==a.type?n.circlesect2(a.circle,t,o):n.aabbtest(a.aabb)&&n.polysect2(a.polygon,t,o))):(null!=u.child1&&n.aabbtest(u.child1.aabb)&&(r||0<=(_=n.aabbsect(u.child1.aabb))&&_<n.maxdist)&&this.openlist.add(u.child1),null!=u.child2&&n.aabbtest(u.child2.aabb)&&(r||0<=(h=n.aabbsect(u.child2.aabb))&&h<n.maxdist)&&this.openlist.add(u.child2))}return this.openlist.clear(),o},ie.prototype.__class__=ie;var pe=zpp_nape.space.ZPP_Island=function(){this.waket=0,this.sleep=!1,this.comps=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.comps=new je};pe.__name__=["zpp_nape","space","ZPP_Island"],pe.prototype.next=null,pe.prototype.elem=function(){return this},pe.prototype.begin=function(){return this.next},pe.prototype._inuse=null,pe.prototype.modified=null,pe.prototype.pushmod=null,pe.prototype.length=null,pe.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},pe.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},pe.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},pe.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},pe.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pe.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pe.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pe.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pe.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},pe.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},pe.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},pe.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},pe.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},pe.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},pe.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},pe.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},pe.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},pe.prototype.clear=function(){},pe.prototype.inlined_clear=function(){},pe.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},pe.prototype.empty=function(){return null==this.next},pe.prototype.size=function(){return this.length},pe.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},pe.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},pe.prototype.front=function(){return this.next},pe.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},pe.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},pe.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t:null},pe.prototype.comps=null,pe.prototype.sleep=null,pe.prototype.waket=null,pe.prototype.free=function(){},pe.prototype.alloc=function(){this.waket=0},pe.prototype.__class__=pe;var re=zpp_nape.space.ZPP_Component=function(){this.woken=!1,this.waket=0,this.sleeping=!1,this.island=null,this.constraint=null,this.body=null,this.isBody=!1,this.rank=0,this.parent=null,this.next=null,this.sleeping=!1,this.island=null,(this.parent=this).rank=0,this.woken=!1};re.__name__=["zpp_nape","space","ZPP_Component"],re.prototype.next=null,re.prototype.parent=null,re.prototype.rank=null,re.prototype.isBody=null,re.prototype.body=null,re.prototype.constraint=null,re.prototype.island=null,re.prototype.sleeping=null,re.prototype.waket=null,re.prototype.woken=null,re.prototype.free=function(){this.body=null,this.constraint=null},re.prototype.alloc=function(){},re.prototype.reset=function(){this.sleeping=!1,this.island=null,(this.parent=this).rank=0},re.prototype.__class__=re;var Bl=zpp_nape.space.ZPP_CallbackSet=function(){this.lazydel=!1,this.freed=!1,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.int2=null,this.int1=null,this.di=0,this.id=0,this.arbiters=new fe};Bl.__name__=["zpp_nape","space","ZPP_CallbackSet"],Bl.get=function(n,t){var e;return null==Bl.zpp_pool?e=new Bl:(e=Bl.zpp_pool,Bl.zpp_pool=e.next,e.next=null),e.freed=!1,e.lazydel=!1,e.COLLISIONstate=1,e.COLLISIONstamp=0,e.SENSORstate=1,e.SENSORstamp=0,e.FLUIDstate=1,e.FLUIDstamp=0,n.id<t.id?(e.int1=n,e.int2=t):(e.int1=t,e.int2=n),e.id=e.int1.id,e.di=e.int2.id,e},Bl.prototype.id=null,Bl.prototype.di=null,Bl.prototype.int1=null,Bl.prototype.int2=null,Bl.prototype.arbiters=null,Bl.prototype.COLLISIONstate=null,Bl.prototype.COLLISIONstamp=null,Bl.prototype.SENSORstate=null,Bl.prototype.SENSORstamp=null,Bl.prototype.FLUIDstate=null,Bl.prototype.FLUIDstamp=null,Bl.prototype.next=null,Bl.prototype.elem=function(){return this},Bl.prototype.begin=function(){return this.next},Bl.prototype._inuse=null,Bl.prototype.modified=null,Bl.prototype.pushmod=null,Bl.prototype.length=null,Bl.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},Bl.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Bl.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Bl.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},Bl.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},Bl.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},Bl.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Bl.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Bl.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},Bl.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},Bl.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Bl.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Bl.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Bl.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Bl.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},Bl.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},Bl.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Bl.prototype.clear=function(){},Bl.prototype.inlined_clear=function(){},Bl.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},Bl.prototype.empty=function(){return null==this.next},Bl.prototype.size=function(){return this.length},Bl.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},Bl.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},Bl.prototype.front=function(){return this.next},Bl.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},Bl.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},Bl.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t:null},Bl.prototype.freed=null,Bl.prototype.lazydel=null,Bl.prototype.free=function(){this.int1=this.int2=null,this.id=this.di=-1,this.freed=!0},Bl.prototype.alloc=function(){this.freed=!1,this.lazydel=!1,this.COLLISIONstate=1,this.COLLISIONstamp=0,this.SENSORstate=1,this.SENSORstamp=0,this.FLUIDstate=1,this.FLUIDstamp=0},Bl.prototype.add_arb=function(n){for(var t=!1,e=this.arbiters.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}if(t)return!1;var i,p=this.arbiters;null==Gl.zpp_pool?i=new Gl:(i=Gl.zpp_pool,Gl.zpp_pool=i.next,i.next=null),i.elt=n;var l=i;return l.next=p.head,p.head=l,p.modified=!0,p.length++,!0},Bl.prototype.try_remove_arb=function(n){for(var t,e,i=this.arbiters,p=null,l=i.head,r=!1;null!=l;){if(l.elt==n){null==p?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=p.next).next,null==(p.next=e)&&(i.pushmod=!0));var o=t;o.elt=null,o.next=Gl.zpp_pool,Gl.zpp_pool=o,i.modified=!0,i.length--,r=i.pushmod=!0;break}l=(p=l).next}return r},Bl.prototype.remove_arb=function(n){for(var t,e,i=this.arbiters,p=null,l=i.head;null!=l;){if(l.elt==n){null==p?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=p.next).next,null==(p.next=e)&&(i.pushmod=!0));var r=t;r.elt=null,r.next=Gl.zpp_pool,Gl.zpp_pool=r,i.modified=!0,i.length--,i.pushmod=!0;break}l=(p=l).next}},Bl.prototype.empty_arb=function(n){for(var t=!0,e=this.arbiters.head;null!=e;){if(0!=(e.elt.type&n)){t=!1;break}e=e.next}return t},Bl.prototype.really_empty=function(){return null==this.arbiters.head},Bl.prototype.sleeping=function(){for(var n=!0,t=this.arbiters.head;null!=t;){if(!t.elt.sleeping){n=!1;break}t=t.next}return n},Bl.prototype.__class__=Bl;var oe=zpp_nape.space.ZPP_CbSetManager=function(n){this.space=null,(this.cbsets=null)==Yi.zpp_pool?this.cbsets=new Yi:(this.cbsets=Yi.zpp_pool,Yi.zpp_pool=this.cbsets.next,this.cbsets.next=null),this.cbsets.lt=Tl.setlt,this.space=n};oe.__name__=["zpp_nape","space","ZPP_CbSetManager"],oe.prototype.cbsets=null,oe.prototype.space=null,oe.prototype.get=function(n){if(null==n.head)return null;var t;null==Tl.zpp_pool?t=new Tl:(t=Tl.zpp_pool,Tl.zpp_pool=t.next,t.next=null);var e=t.cbTypes;t.cbTypes=n;var i,p=this.cbsets.find_weak(t),l=null!=p?p.data:(i=Tl.get(n),this.cbsets.insert(i),i.manager=this,i);t.cbTypes=e;var r=t;for(r.listeners.clear(),r.zip_listeners=!0,r.bodylisteners.clear(),r.zip_bodylisteners=!0,r.conlisteners.clear(),r.zip_conlisteners=!0;null!=r.cbTypes.head;)r.cbTypes.pop_unsafe().cbsets.remove(r);return r.next=Tl.zpp_pool,Tl.zpp_pool=r,l},oe.prototype.remove=function(n){for(this.cbsets.remove(n);null!=n.cbpairs.head;){var t=n.cbpairs.pop_unsafe();t.a!=t.b&&(n==t.a?t.b.cbpairs.remove(t):t.a.cbpairs.remove(t)),t.a=t.b=null,t.listeners.clear(),t.next=Nl.zpp_pool,Nl.zpp_pool=t}n.manager=null},oe.prototype.clear=function(){},oe.prototype.validate=function(){if(!this.cbsets.empty()){for(var n=this.cbsets.parent;null!=n.prev;)n=n.prev;for(;null!=n;)if(n.data.validate(),null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}},oe.prototype.pair=function(n,t){for(var e,i=null,p=(n.cbpairs.length<t.cbpairs.length?n.cbpairs:t.cbpairs).head;null!=p;){var l=p.elt;if(l.a==n&&l.b==t||l.a==t&&l.b==n){i=l;break}p=p.next}return null==i&&(null==Nl.zpp_pool?e=new Nl:(e=Nl.zpp_pool,Nl.zpp_pool=e.next,e.next=null),e.zip_listeners=!0,Tl.setlt(n,t)?(e.a=n,e.b=t):(e.a=t,e.b=n),i=e,n.cbpairs.add(i),t!=n&&t.cbpairs.add(i)),i.zip_listeners&&(i.zip_listeners=!1,i.__validate()),i},oe.prototype.valid_listener=function(n){return n.space==this.space},oe.prototype.__class__=oe;var ae=zpp_nape.space.ZPP_Space=function(n,t){this.prelisteners=null,this.precb=null,this.continuous=!1,this.toiEvents=null,this.pre_dt=0,this.convexShapeList=null,this.cbsets=null,this.callbackset_list=null,this.callbacks=null,this.wrap_listeners=null,this.listeners=null,this.islands=null,this.staticsleep=null,this.wrap_livecon=null,this.live_constraints=null,this.wrap_live=null,this.live=null,this.wrap_arbiters=null,this.s_arbiters=null,this.f_arbiters=null,this.c_arbiters_false=null,this.c_arbiters_true=null,this.sortcontacts=!1,this.time=0,this.midstep=!1,this.stamp=0,this.global_ang_drag=0,this.global_lin_drag=0,this.__static=null,this.bphase=null,this.kinematics=null,this.wrap_constraints=null,this.constraints=null,this.wrap_compounds=null,this.compounds=null,this.wrap_bodies=null,this.bodies=null,this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.userData=null,this.outer=null,this.toiEvents=new Ve,this.global_lin_drag=.015,this.global_ang_drag=.015,this.precb=new m,this.precb.zpp_inner=new pt,this.sortcontacts=!0,this.pre_dt=0,null==t||(null==Ll.Broadphase_DYNAMIC_AABB_TREE&&(Ll.internal=!0,Ll.Broadphase_DYNAMIC_AABB_TREE=new Mn,Ll.internal=!1),t==Ll.Broadphase_DYNAMIC_AABB_TREE)?this.bphase=new ie(this):(null==Ll.Broadphase_SWEEP_AND_PRUNE&&(Ll.internal=!0,Ll.Broadphase_SWEEP_AND_PRUNE=new Mn,Ll.internal=!1),t==Ll.Broadphase_SWEEP_AND_PRUNE&&(this.bphase=new _e(this))),this.time=0,null!=n?(this.gravityx=n.x,this.gravityy=n.y):(this.gravityx=0,this.gravityy=0),this.bodies=new ve,this.wrap_bodies=vi.get(this.bodies),this.wrap_bodies.zpp_inner.adder=Q(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=Q(this,this.bodies_subber),this.compounds=new me,this.wrap_compounds=Oi.get(this.compounds),this.wrap_compounds.zpp_inner.adder=Q(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=Q(this,this.compounds_subber),this.kinematics=new ve,this.c_arbiters_true=new Ne,this.c_arbiters_false=new Ne,this.f_arbiters=new Ee,this.s_arbiters=new Ie,this.islands=new pe,this.live=new ve,this.wrap_live=vi.get(this.live,!0),this.staticsleep=new ve,this.constraints=new In,this.wrap_constraints=ci.get(this.constraints),this.wrap_constraints.zpp_inner.adder=Q(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=Q(this,this.constraints_subber),this.live_constraints=new In,this.wrap_livecon=ci.get(this.live_constraints,!0),this.__static=Yt.__static(),(this.__static.zpp_inner.space=this).callbacks=new pt,this.midstep=!1,this.listeners=new Te,this.wrap_listeners=Pi.get(this.listeners),this.wrap_listeners.zpp_inner.adder=Q(this,this.listeners_adder),this.wrap_listeners.zpp_inner.subber=Q(this,this.listeners_subber),this.callbackset_list=new Bl,this.mrca1=new Tn,this.mrca2=new Tn,this.prelisteners=new An,this.cbsets=new oe(this)};ae.__name__=["zpp_nape","space","ZPP_Space"],ae.prototype.outer=null,ae.prototype.userData=null,ae.prototype.gravityx=null,ae.prototype.gravityy=null,ae.prototype.wrap_gravity=null,ae.prototype.getgravity=function(){var n,t,e,i,p,l=this.gravityx,r=this.gravityy;null==Ri.poolVec2?n=new at:(n=Ri.poolVec2,Ri.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==mo.zpp_pool?t=new mo:(t=mo.zpp_pool,mo.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=l,t.y=r,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x==l&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=l,n.zpp_inner.y=r,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p))),n.zpp_inner.weak=!1,this.wrap_gravity=n,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=Q(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=Q(this,this.gravity_validate)},ae.prototype.gravity_invalidate=function(n){this.gravityx=n.x,this.gravityy=n.y;for(var t=new me,e=this.bodies.head;null!=e;){var i=e.elt;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!1)),e=e.next}for(var p=this.compounds.head;null!=p;)t.add(p.elt),p=p.next;for(;null!=t.head;){for(var l=t.pop_unsafe(),r=l.bodies.head;null!=r;){var o=r.elt;o.world||(o.component.waket=this.stamp+(this.midstep?0:1),3==o.type&&(o.kinematicDelaySleep=!0),o.component.sleeping&&this.really_wake(o,!1)),r=r.next}for(var a=l.compounds.head;null!=a;)t.add(a.elt),a=a.next}},ae.prototype.gravity_validate=function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},ae.prototype.bodies=null,ae.prototype.wrap_bodies=null,ae.prototype.compounds=null,ae.prototype.wrap_compounds=null,ae.prototype.constraints=null,ae.prototype.wrap_constraints=null,ae.prototype.kinematics=null,ae.prototype.bphase=null,ae.prototype.__static=null,ae.prototype.global_lin_drag=null,ae.prototype.global_ang_drag=null,ae.prototype.stamp=null,ae.prototype.midstep=null,ae.prototype.time=null,ae.prototype.sortcontacts=null,ae.prototype.c_arbiters_true=null,ae.prototype.c_arbiters_false=null,ae.prototype.f_arbiters=null,ae.prototype.s_arbiters=null,ae.prototype.wrap_arbiters=null,ae.prototype.live=null,ae.prototype.wrap_live=null,ae.prototype.live_constraints=null,ae.prototype.wrap_livecon=null,ae.prototype.staticsleep=null,ae.prototype.islands=null,ae.prototype.listeners=null,ae.prototype.wrap_listeners=null,ae.prototype.callbacks=null,ae.prototype.callbackset_list=null,ae.prototype.cbsets=null,ae.prototype.clear=function(){for(;null!=this.listeners.head;)this.remListener(this.listeners.pop_unsafe());for(;null!=this.callbackset_list.next;){var n=this.callbackset_list.pop_unsafe();n.arbiters.clear(),n.int1=n.int2=null,n.id=n.di=-1,n.freed=!0,n.next=Bl.zpp_pool,Bl.zpp_pool=n}for(;null!=this.c_arbiters_true.head;){var t=this.c_arbiters_true.pop_unsafe();if(!t.cleared){for(var e,i,p=t.b1.arbiters,l=null,r=p.head;null!=r;){if(r.elt==t){null==l?(i=(e=p.head).next,p.head=i,null==p.head&&(p.pushmod=!0)):(i=(e=l.next).next,null==(l.next=i)&&(p.pushmod=!0));var o=e;o.elt=null,o.next=Gl.zpp_pool,Gl.zpp_pool=o,p.modified=!0,p.length--,p.pushmod=!0;break}r=(l=r).next}for(var a,s,_=t.b2.arbiters,h=null,u=_.head;null!=u;){if(u.elt==t){null==h?(s=(a=_.head).next,_.head=s,null==_.head&&(_.pushmod=!0)):(s=(a=h.next).next,null==(h.next=s)&&(_.pushmod=!0));var x=a;x.elt=null,x.next=Gl.zpp_pool,Gl.zpp_pool=x,_.modified=!0,_.length--,_.pushmod=!0;break}u=(h=u).next}null!=t.pair&&(t.pair.arb=null,t.pair=null)}for(t.b1=t.b2=null,t.active=!1,t.intchange=!1;null!=t.contacts.next;){var d=t.contacts,y=d.next;d.pop(),y.arbiter=null,y.next=Rl.zpp_pool,Rl.zpp_pool=y;var z=t.innards,c=z.next;z.next=c.next,c._inuse=!1,null==z.next&&(z.pushmod=!0),z.modified=!0,z.length--}t.userdef_dyn_fric=!1,t.userdef_stat_fric=!1,t.userdef_restitution=!1,t.userdef_rfric=!1,t.__ref_edge1=t.__ref_edge2=null,t.next=Fl.zpp_pool,(Fl.zpp_pool=t).pre_dt=-1}for(;null!=this.c_arbiters_false.head;){var v=this.c_arbiters_false.pop_unsafe();if(!v.cleared){for(var m,f,b=v.b1.arbiters,g=null,w=b.head;null!=w;){if(w.elt==v){null==g?(f=(m=b.head).next,b.head=f,null==b.head&&(b.pushmod=!0)):(f=(m=g.next).next,null==(g.next=f)&&(b.pushmod=!0));var M=m;M.elt=null,M.next=Gl.zpp_pool,Gl.zpp_pool=M,b.modified=!0,b.length--,b.pushmod=!0;break}w=(g=w).next}for(var C,k,O=v.b2.arbiters,P=null,S=O.head;null!=S;){if(S.elt==v){null==P?(k=(C=O.head).next,O.head=k,null==O.head&&(O.pushmod=!0)):(k=(C=P.next).next,null==(P.next=k)&&(O.pushmod=!0));var A=C;A.elt=null,A.next=Gl.zpp_pool,Gl.zpp_pool=A,O.modified=!0,O.length--,O.pushmod=!0;break}S=(P=S).next}null!=v.pair&&(v.pair.arb=null,v.pair=null)}for(v.b1=v.b2=null,v.active=!1,v.intchange=!1;null!=v.contacts.next;){var j=v.contacts,E=j.next;j.pop(),E.arbiter=null,E.next=Rl.zpp_pool,Rl.zpp_pool=E;var I=v.innards,T=I.next;I.next=T.next,T._inuse=!1,null==I.next&&(I.pushmod=!0),I.modified=!0,I.length--}v.userdef_dyn_fric=!1,v.userdef_stat_fric=!1,v.userdef_restitution=!1,v.userdef_rfric=!1,v.__ref_edge1=v.__ref_edge2=null,v.next=Fl.zpp_pool,(Fl.zpp_pool=v).pre_dt=-1}for(;null!=this.s_arbiters.head;){var N=this.s_arbiters.pop_unsafe();if(!N.cleared){for(var L,V,D=N.b1.arbiters,F=null,R=D.head;null!=R;){if(R.elt==N){null==F?(V=(L=D.head).next,D.head=V,null==D.head&&(D.pushmod=!0)):(V=(L=F.next).next,null==(F.next=V)&&(D.pushmod=!0));var Z=L;Z.elt=null,Z.next=Gl.zpp_pool,Gl.zpp_pool=Z,D.modified=!0,D.length--,D.pushmod=!0;break}R=(F=R).next}for(var B,G,q=N.b2.arbiters,U=null,K=q.head;null!=K;){if(K.elt==N){null==U?(G=(B=q.head).next,q.head=G,null==q.head&&(q.pushmod=!0)):(G=(B=U.next).next,null==(U.next=G)&&(q.pushmod=!0));var W=B;W.elt=null,W.next=Gl.zpp_pool,Gl.zpp_pool=W,q.modified=!0,q.length--,q.pushmod=!0;break}K=(U=K).next}null!=N.pair&&(N.pair.arb=null,N.pair=null)}N.b1=N.b2=null,N.active=!1,N.intchange=!1,N.next=Vl.zpp_pool,Vl.zpp_pool=N}for(;null!=this.f_arbiters.head;){var Y=this.f_arbiters.pop_unsafe();if(!Y.cleared){for(var J,X,H=Y.b1.arbiters,$=null,Q=H.head;null!=Q;){if(Q.elt==Y){null==$?(X=(J=H.head).next,H.head=X,null==H.head&&(H.pushmod=!0)):(X=(J=$.next).next,null==($.next=X)&&(H.pushmod=!0));var nn=J;nn.elt=null,nn.next=Gl.zpp_pool,Gl.zpp_pool=nn,H.modified=!0,H.length--,H.pushmod=!0;break}Q=($=Q).next}for(var tn,en,pn=Y.b2.arbiters,ln=null,rn=pn.head;null!=rn;){if(rn.elt==Y){null==ln?(en=(tn=pn.head).next,pn.head=en,null==pn.head&&(pn.pushmod=!0)):(en=(tn=ln.next).next,null==(ln.next=en)&&(pn.pushmod=!0));var on=tn;on.elt=null,on.next=Gl.zpp_pool,Gl.zpp_pool=on,pn.modified=!0,pn.length--,pn.pushmod=!0;break}rn=(ln=rn).next}null!=Y.pair&&(Y.pair.arb=null,Y.pair=null)}Y.b1=Y.b2=null,Y.active=!1,Y.intchange=!1,Y.next=Dl.zpp_pool,(Dl.zpp_pool=Y).pre_dt=-1}for(this.bphase.clear();null!=this.bodies.head;){var an=this.bodies.pop_unsafe();if(null!=an.component){var sn=an.component.island;if(null!=sn){for(;null!=sn.comps.head;){var _n=sn.comps.pop_unsafe();_n.sleeping=!1,_n.island=null,(_n.parent=_n).rank=0}sn.next=pe.zpp_pool,pe.zpp_pool=sn}}an.removedFromSpace(),an.space=null}for(;null!=this.constraints.head;){var hn=this.constraints.pop_unsafe();if(null!=hn.component){var un=hn.component.island;if(null!=un){for(;null!=un.comps.head;){var xn=un.comps.pop_unsafe();xn.sleeping=!1,xn.island=null,(xn.parent=xn).rank=0}un.next=pe.zpp_pool,pe.zpp_pool=un}}hn.removedFromSpace(),hn.space=null}this.kinematics.clear();for(var dn=new me;null!=this.compounds.head;)dn.add(this.compounds.pop_unsafe());for(;null!=dn.head;){var yn=dn.pop_unsafe();yn.removedFromSpace(),yn.space=null;for(var zn=yn.bodies.head;null!=zn;){var cn=zn.elt;if(null!=cn.component){var vn=cn.component.island;if(null!=vn){for(;null!=vn.comps.head;){var mn=vn.comps.pop_unsafe();mn.sleeping=!1,mn.island=null,(mn.parent=mn).rank=0}vn.next=pe.zpp_pool,pe.zpp_pool=vn}}cn.removedFromSpace(),cn.space=null,zn=zn.next}for(var fn=yn.constraints.head;null!=fn;){var bn=fn.elt;if(null!=bn.component){var gn=bn.component.island;if(null!=gn){for(;null!=gn.comps.head;){var wn=gn.comps.pop_unsafe();wn.sleeping=!1,wn.island=null,(wn.parent=wn).rank=0}gn.next=pe.zpp_pool,pe.zpp_pool=gn}}bn.removedFromSpace(),bn.space=null,fn=fn.next}for(var Mn=yn.compounds.head;null!=Mn;)dn.add(Mn.elt),Mn=Mn.next}this.staticsleep.clear(),this.live.clear(),this.live_constraints.clear(),this.stamp=0,this.time=0,this.mrca1.clear(),this.mrca2.clear(),this.prelisteners.clear(),this.cbsets.clear()},ae.prototype.bodies_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(n),this.addBody(n.zpp_inner),!0)},ae.prototype.bodies_subber=function(n){this.remBody(n.zpp_inner)},ae.prototype.compounds_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_compounds.remove(n),this.addCompound(n.zpp_inner),!0)},ae.prototype.compounds_subber=function(n){this.remCompound(n.zpp_inner)},ae.prototype.constraints_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(n),this.addConstraint(n.zpp_inner),!0)},ae.prototype.constraints_subber=function(n){this.remConstraint(n.zpp_inner)},ae.prototype.listeners_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(n),this.addListener(n.zpp_inner),!0)},ae.prototype.listeners_subber=function(n){this.remListener(n.zpp_inner)},ae.prototype.revoke_listener=function(n){},ae.prototype.unrevoke_listener=function(n){},ae.prototype.addListener=function(n){n.space=this,n.addedToSpace()},ae.prototype.remListener=function(n){n.removedFromSpace(),n.space=null},ae.prototype.add_callbackset=function(n){var t,e=n.int1.cbsets;null==Be.zpp_pool?t=new Be:(t=Be.zpp_pool,Be.zpp_pool=t.next,t.next=null),t.elt=n;var i=t;i.next=e.head,e.head=i,e.modified=!0,e.length++;var p,l=n.int2.cbsets;null==Be.zpp_pool?p=new Be:(p=Be.zpp_pool,Be.zpp_pool=p.next,p.next=null),p.elt=n;var r=p;r.next=l.head,l.head=r,l.modified=!0,l.length++;var o=this.callbackset_list;n._inuse=!0,n.next=o.next,o.next=n,o.modified=!0,o.length++},ae.prototype.remove_callbackset=function(n){n.lazydel=!0;for(var t,e,i=n.int1.cbsets,p=null,l=i.head;null!=l;){if(l.elt==n){null==p?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=p.next).next,null==(p.next=e)&&(i.pushmod=!0));var r=t;r.elt=null,r.next=Be.zpp_pool,Be.zpp_pool=r,i.modified=!0,i.length--,i.pushmod=!0;break}l=(p=l).next}for(var o,a,s=n.int2.cbsets,_=null,h=s.head;null!=h;){if(h.elt==n){null==_?(a=(o=s.head).next,s.head=a,null==s.head&&(s.pushmod=!0)):(a=(o=_.next).next,null==(_.next=a)&&(s.pushmod=!0));var u=o;u.elt=null,u.next=Be.zpp_pool,Be.zpp_pool=u,s.modified=!0,s.length--,s.pushmod=!0;break}h=(_=h).next}},ae.prototype.transmitType=function(n,t){n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!1)),2==n.type?this.live.remove(n):3==n.type?(this.kinematics.remove(n),this.staticsleep.remove(n)):1==n.type&&this.staticsleep.remove(n),n.type=t,3==n.type&&this.kinematics.add(n),1==n.type&&this.static_validation(n),n.component.sleeping=!0,n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0))},ae.prototype.added_shape=function(n,t){var e;null==t&&(t=!1),t||((e=n.body).world||(e.component.waket=this.stamp+(this.midstep?0:1),3==e.type&&(e.kinematicDelaySleep=!0),e.component.sleeping&&this.really_wake(e,!1))),this.bphase.insert(n),n.addedToSpace()},ae.prototype.removed_shape=function(n,t){null==t&&(t=!1);var e=n.body;t||e.wake();for(var i=null,p=e.arbiters.head;null!=p;){var l,r,o=p.elt;if(o.ws1!=n&&o.ws2!=n)p=(i=p).next;else{if(0!=o.present){this.MRCA_chains(o.ws1,o.ws2);for(var a=this.mrca1.head;null!=a;){for(var s=a.elt,_=this.mrca2.head;null!=_;){var h=_.elt,u=s.cbSet,x=h.cbSet;u.validate(),x.validate();for(var d,y=null,z=(u.cbpairs.length<x.cbpairs.length?u.cbpairs:x.cbpairs).head;null!=z;){var c=z.elt;if(c.a==u&&c.b==x||c.a==x&&c.b==u){y=c;break}z=z.next}if(null==y&&(null==Nl.zpp_pool?d=new Nl:(d=Nl.zpp_pool,Nl.zpp_pool=d.next,d.next=null),d.zip_listeners=!0,Tl.setlt(u,x)?(d.a=u,d.b=x):(d.a=x,d.b=u),y=d,u.cbpairs.add(y),x!=u&&x.cbpairs.add(y)),y.zip_listeners&&(y.zip_listeners=!1,y.__validate()),null!=y.listeners.head){var v=Zl.get(s,h);v.remove_arb(o),o.present--;for(var m,f=null,b=(u.cbpairs.length<x.cbpairs.length?u.cbpairs:x.cbpairs).head;null!=b;){var g=b.elt;if(g.a==u&&g.b==x||g.a==x&&g.b==u){f=g;break}b=b.next}null==f&&(null==Nl.zpp_pool?m=new Nl:(m=Nl.zpp_pool,Nl.zpp_pool=m.next,m.next=null),m.zip_listeners=!0,Tl.setlt(u,x)?(m.a=u,m.b=x):(m.a=x,m.b=u),f=m,u.cbpairs.add(f),x!=u&&x.cbpairs.add(f)),f.zip_listeners&&(f.zip_listeners=!1,f.__validate());for(var w=f.listeners.head;null!=w;){var M,C,k,O,P,S,A,j=w.elt;1==j.event&&0!=(j.itype&o.type)&&v.empty_arb(j.itype)&&((M=this.push_callback(j)).event=1,C=v.int1,k=v.int2,O=j.options1,P=C.cbTypes,!(!O.nonemptyintersection(P,O.includes)||O.nonemptyintersection(P,O.excludes))&&(S=j.options2,A=k.cbTypes,!!S.nonemptyintersection(A,S.includes)&&!S.nonemptyintersection(A,S.excludes))?(M.int1=C,M.int2=k):(M.int1=k,M.int2=C),M.set=v),w=w.next}null==v.arbiters.head&&this.remove_callbackset(v),_=_.next}else _=_.next}a=a.next}}if(o.b1!=e&&2==o.b1.type&&((l=o.b1).world||(l.component.waket=this.stamp+(this.midstep?0:1),3==l.type&&(l.kinematicDelaySleep=!0),l.component.sleeping&&this.really_wake(l,!1))),o.b2!=e&&2==o.b2.type&&((r=o.b2).world||(r.component.waket=this.stamp+(this.midstep?0:1),3==r.type&&(r.kinematicDelaySleep=!0),r.component.sleeping&&this.really_wake(r,!1))),o.cleared=!0,null==e||o.b2==e)for(var E,I,T=o.b1.arbiters,N=null,L=T.head;null!=L;){if(L.elt==o){null==N?(I=(E=T.head).next,T.head=I,null==T.head&&(T.pushmod=!0)):(I=(E=N.next).next,null==(N.next=I)&&(T.pushmod=!0));var V=E;V.elt=null,V.next=Gl.zpp_pool,Gl.zpp_pool=V,T.modified=!0,T.length--,T.pushmod=!0;break}L=(N=L).next}if(null==e||o.b1==e)for(var D,F,R=o.b2.arbiters,Z=null,B=R.head;null!=B;){if(B.elt==o){null==Z?(F=(D=R.head).next,R.head=F,null==R.head&&(R.pushmod=!0)):(F=(D=Z.next).next,null==(Z.next=F)&&(R.pushmod=!0));var G=D;G.elt=null,G.next=Gl.zpp_pool,Gl.zpp_pool=G,R.modified=!0,R.length--,R.pushmod=!0;break}B=(Z=B).next}null!=o.pair&&(o.pair.arb=null,o.pair=null),o.active=!1,this.f_arbiters.modified=!0,p=e.arbiters.erase(i)}}this.bphase.remove(n),n.removedFromSpace()},ae.prototype.addConstraint=function(n){n.space=this,n.addedToSpace(),n.active&&(n.component.sleeping=!0,this.wake_constraint(n,!0))},ae.prototype.remConstraint=function(n){n.active&&(this.wake_constraint(n,!0),this.live_constraints.remove(n)),n.removedFromSpace(),n.space=null},ae.prototype.addCompound=function(n){n.space=this,n.addedToSpace();for(var t=n.bodies.head;null!=t;)this.addBody(t.elt),t=t.next;for(var e=n.constraints.head;null!=e;)this.addConstraint(e.elt),e=e.next;for(var i=n.compounds.head;null!=i;)this.addCompound(i.elt),i=i.next},ae.prototype.remCompound=function(n){for(var t=n.bodies.head;null!=t;)this.remBody(t.elt),t=t.next;for(var e=n.constraints.head;null!=e;)this.remConstraint(e.elt),e=e.next;for(var i=n.compounds.head;null!=i;)this.remCompound(i.elt),i=i.next;n.removedFromSpace(),n.space=null},ae.prototype.addBody=function(n,t){null==t&&(t=-1),n.space=this,n.addedToSpace(),n.component.sleeping=!0,n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0));for(var e=n.shapes.head;null!=e;){var i=e.elt;this.bphase.insert(i),i.addedToSpace(),e=e.next}1==n.type?this.static_validation(n):2!=n.type&&3!=t&&this.kinematics.add(n)},ae.prototype.remBody=function(n,t){null==t&&(t=-1),1==n.type?(n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0)),this.staticsleep.remove(n)):2==n.type?(n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0)),this.live.remove(n)):(3!=t&&this.kinematics.remove(n),n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0)),this.staticsleep.remove(n));for(var e=n.shapes.head;null!=e;)this.removed_shape(e.elt,!0),e=e.next;n.removedFromSpace(),n.space=null},ae.prototype.shapesUnderPoint=function(n,t,e,i){return this.bphase.shapesUnderPoint(n,t,e,i)},ae.prototype.bodiesUnderPoint=function(n,t,e,i){return this.bphase.bodiesUnderPoint(n,t,e,i)},ae.prototype.shapesInAABB=function(n,t,e,i,p){return this.bphase.shapesInAABB(n.zpp_inner,t,e,i,p)},ae.prototype.bodiesInAABB=function(n,t,e,i,p){return this.bphase.bodiesInAABB(n.zpp_inner,t,e,i,p)},ae.prototype.shapesInCircle=function(n,t,e,i,p){var l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,o=n.zpp_inner;return null!=o._validate&&o._validate(),this.bphase.shapesInCircle(r,n.zpp_inner.y,t,e,i,p)},ae.prototype.bodiesInCircle=function(n,t,e,i,p){var l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,o=n.zpp_inner;return null!=o._validate&&o._validate(),this.bphase.bodiesInCircle(r,n.zpp_inner.y,t,e,i,p)},ae.prototype.shapesInShape=function(n,t,e,i){return this.bphase.shapesInShape(n,t,e,i)},ae.prototype.bodiesInShape=function(n,t,e,i){return this.bphase.bodiesInShape(n,t,e,i)},ae.prototype.rayCast=function(n,t,e){return this.bphase.rayCast(n.zpp_inner,t,null==e?null:e.zpp_inner)},ae.prototype.rayMultiCast=function(n,t,e,i){return this.bphase.rayMultiCast(n.zpp_inner,t,null==e?null:e.zpp_inner,i)},ae.prototype.convexShapeList=null,ae.prototype.convexCast=function(n,t,e,i){var p;if(null==qt.zpp_pool?p=new qt:(p=qt.zpp_pool,qt.zpp_pool=p.next,p.next=null),p.failed=!1,p.s1=p.s2=null,p.arbiter=null,0==n.type){var l=n.circle;if(l.zip_worldCOM&&null!=l.body){if(l.zip_worldCOM=!1,l.zip_localCOM){if(l.zip_localCOM=!1,1==l.type){var r=l.polygon;if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y,r.localCOMx+=r.lverts.next.next.x,r.localCOMy+=r.lverts.next.next.y,r.localCOMx*=.5,r.localCOMy*=.5;else{r.localCOMx=0;var o=r.localCOMy=0,a=r.lverts.next,s=a,_=a=a.next;for(a=a.next;null!=a;){var h=a;o+=_.x*(h.y-s.y);var u=h.y*_.x-h.x*_.y;r.localCOMx+=(_.x+h.x)*u,r.localCOMy+=(_.y+h.y)*u,s=_,_=h,a=a.next}var x=a=r.lverts.next;o+=_.x*(x.y-s.y);var d=x.y*_.x-x.x*_.y;r.localCOMx+=(_.x+x.x)*d,r.localCOMy+=(_.y+x.y)*d,s=_;var y=a=a.next;o+=x.x*(y.y-s.y);var z=y.y*x.x-y.x*x.y;r.localCOMx+=(x.x+y.x)*z,r.localCOMy+=(x.y+y.y)*z;var c=o=1/(3*o);r.localCOMx*=c,r.localCOMy*=c}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}var v=l.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)),l.worldCOMx=l.body.posx+(l.body.axisy*l.localCOMx-l.body.axisx*l.localCOMy),l.worldCOMy=l.body.posy+(l.localCOMx*l.body.axisx+l.localCOMy*l.body.axisy)}}else{var m=n.polygon;if(m.zip_gaxi&&null!=m.body){m.zip_gaxi=!1,m.validate_laxi();var f=m.body;if(f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot)),m.zip_gverts&&null!=m.body){m.zip_gverts=!1,m.validate_lverts();var b=m.body;b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot));for(var g=m.lverts.next,w=m.gverts.next;null!=w;){var M=w,C=g,g=g.next;M.x=m.body.posx+(m.body.axisy*C.x-m.body.axisx*C.y),M.y=m.body.posy+(C.x*m.body.axisx+C.y*m.body.axisy),w=w.next}}for(var k=m.edges.head,O=P=m.gverts.next,P=P.next;null!=P;){var S=P,A=k.elt,k=k.next;A.gp0=O,A.gp1=S,A.gnormx=m.body.axisy*A.lnormx-m.body.axisx*A.lnormy,A.gnormy=A.lnormx*m.body.axisx+A.lnormy*m.body.axisy,A.gprojection=m.body.posx*A.gnormx+m.body.posy*A.gnormy+A.lprojection,null!=A.wrap_gnorm&&(A.wrap_gnorm.zpp_inner.x=A.gnormx,A.wrap_gnorm.zpp_inner.y=A.gnormy),A.tp0=A.gp0.y*A.gnormx-A.gp0.x*A.gnormy,A.tp1=A.gp1.y*A.gnormx-A.gp1.x*A.gnormy,O=S,P=P.next}var j=k.elt;j.gp0=O,j.gp1=m.gverts.next,j.gnormx=m.body.axisy*j.lnormx-m.body.axisx*j.lnormy,j.gnormy=j.lnormx*m.body.axisx+j.lnormy*m.body.axisy,j.gprojection=m.body.posx*j.gnormx+m.body.posy*j.gnormy+j.lprojection,null!=j.wrap_gnorm&&(j.wrap_gnorm.zpp_inner.x=j.gnormx,j.wrap_gnorm.zpp_inner.y=j.gnormy),j.tp0=j.gp0.y*j.gnormx-j.gp0.x*j.gnormy,j.tp1=j.gp1.y*j.gnormx-j.gp1.x*j.gnormy}}var E=n.body,I=E.posx,T=E.posy;E.sweepTime=0,E.sweep_angvel=E.angvel;var N,L,V,D,F,R=t-E.sweepTime;0!=R&&(E.sweepTime=t,E.posx+=E.velx*R,E.posy+=E.vely*R,0!=E.angvel&&(N=E.sweep_angvel*R,E.rot+=N,1e-4<N*N?(E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot)):(D=1-(L=N*N)*L/8,F=((V=1-.5*L)*E.axisx+N*E.axisy)*D,E.axisy=(V*E.axisy-N*E.axisx)*D,E.axisx=F)));var Z=E.posx,B=E.posy;n.validate_sweepRadius();var G,q=n.sweepRadius;null==Al.zpp_pool?G=new Al:(G=Al.zpp_pool,Al.zpp_pool=G.next,G.next=null),G.minx=(I<Z?I:Z)-q,G.maxx=(Z<I?I:Z)+q,G.miny=(T<B?T:B)-q,G.maxy=(B<T?T:B)+q;var U=this.convexShapeList=this.bphase.shapesInAABB(G,!1,!1,null==e?null:e.zpp_inner,this.convexShapeList),K=G;null!=K.outer&&(K.outer.zpp_inner=null,K.outer=null),K.wrap_min=K.wrap_max=null,K._invalidate=null,K._validate=null,K.next=Al.zpp_pool,Al.zpp_pool=K;var W=0,Y=0,W=0,Y=0,J=0,X=0,J=0,X=0,H=null,$=t+1;U.zpp_inner.valmod();for(var Q=st.get(U);;){Q.zpp_inner.zpp_inner.valmod();var nn=Q.zpp_inner;nn.zpp_inner.valmod(),nn.zpp_inner.zip_length&&(nn.zpp_inner.zip_length=!1,nn.zpp_inner.user_length=nn.zpp_inner.inner.length);var tn=nn.zpp_inner.user_length;if(Q.zpp_critical=!0,!(Q.zpp_i<tn||(Q.zpp_next=st.zpp_pool,(st.zpp_pool=Q).zpp_inner=null,!1)))break;Q.zpp_critical=!1;var en=Q.zpp_inner.at(Q.zpp_i++);if(en!=n.outer&&(null!=en.zpp_inner.body?en.zpp_inner.body.outer:null)!=E.outer){if(p.s1=n,p.s2=en.zpp_inner,i){en.zpp_inner.validate_sweepRadius(),(null!=en.zpp_inner.body?en.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=en.zpp_inner.body?en.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=en.zpp_inner.body?en.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,Ut.dynamicSweep(p,t,0,0,!0);var pn,ln,rn,on,an,sn=(null!=en.zpp_inner.body?en.zpp_inner.body.outer:null).zpp_inner,_n=0-sn.sweepTime;0!=_n&&(sn.sweepTime=0,sn.posx+=sn.velx*_n,sn.posy+=sn.vely*_n,0!=sn.angvel&&(pn=sn.sweep_angvel*_n,sn.rot+=pn,1e-4<pn*pn?(sn.axisx=Math.sin(sn.rot),sn.axisy=Math.cos(sn.rot)):(on=1-(ln=pn*pn)*ln/8,an=((rn=1-.5*ln)*sn.axisx+pn*sn.axisy)*on,sn.axisy=(rn*sn.axisy-pn*sn.axisx)*on,sn.axisx=an)));var hn=(null!=en.zpp_inner.body?en.zpp_inner.body.outer:null).zpp_inner,un=en.zpp_inner;if(0==un.type)un.worldCOMx=hn.posx+(hn.axisy*un.localCOMx-hn.axisx*un.localCOMy),un.worldCOMy=hn.posy+(un.localCOMx*hn.axisx+un.localCOMy*hn.axisy);else{for(var xn=un.polygon,dn=xn.lverts.next,yn=xn.gverts.next;null!=yn;){var zn=yn,cn=dn,dn=dn.next;zn.x=hn.posx+(hn.axisy*cn.x-hn.axisx*cn.y),zn.y=hn.posy+(cn.x*hn.axisx+cn.y*hn.axisy),yn=yn.next}for(var vn=xn.edges.head,mn=fn=xn.gverts.next,fn=fn.next;null!=fn;){var bn=fn,gn=vn.elt,vn=vn.next;gn.gnormx=hn.axisy*gn.lnormx-hn.axisx*gn.lnormy,gn.gnormy=gn.lnormx*hn.axisx+gn.lnormy*hn.axisy,gn.gprojection=hn.posx*gn.gnormx+hn.posy*gn.gnormy+gn.lprojection,gn.tp0=mn.y*gn.gnormx-mn.x*gn.gnormy,gn.tp1=bn.y*gn.gnormx-bn.x*gn.gnormy,mn=bn,fn=fn.next}var wn=xn.gverts.next,Mn=vn.elt;Mn.gnormx=hn.axisy*Mn.lnormx-hn.axisx*Mn.lnormy,Mn.gnormy=Mn.lnormx*hn.axisx+Mn.lnormy*hn.axisy,Mn.gprojection=hn.posx*Mn.gnormx+hn.posy*Mn.gnormy+Mn.lprojection,Mn.tp0=mn.y*Mn.gnormx-mn.x*Mn.gnormy,Mn.tp1=wn.y*Mn.gnormx-wn.x*Mn.gnormy}}else Ut.staticSweep(p,t,0,0);p.toi*=t,0<p.toi&&p.toi<$&&($=p.toi,W=p.axis.x,Y=p.axis.y,J=p.c2.x,X=p.c2.y,H=en)}}U.clear();var Cn=p;Cn.next=qt.zpp_pool,qt.zpp_pool=Cn;var kn,On,Pn,Sn,An,jn=0-E.sweepTime;if(0!=jn&&(E.sweepTime=0,E.posx+=E.velx*jn,E.posy+=E.vely*jn,0!=E.angvel&&(kn=E.sweep_angvel*jn,E.rot+=kn,1e-4<kn*kn?(E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot)):(Sn=1-(On=kn*kn)*On/8,An=((Pn=1-.5*On)*E.axisx+kn*E.axisy)*Sn,E.axisy=(Pn*E.axisy-kn*E.axisx)*Sn,E.axisx=An))),0==n.type)n.worldCOMx=E.posx+(E.axisy*n.localCOMx-E.axisx*n.localCOMy),n.worldCOMy=E.posy+(n.localCOMx*E.axisx+n.localCOMy*E.axisy);else{for(var En=n.polygon,In=En.lverts.next,Tn=En.gverts.next;null!=Tn;){var Nn=Tn,Ln=In,In=In.next;Nn.x=E.posx+(E.axisy*Ln.x-E.axisx*Ln.y),Nn.y=E.posy+(Ln.x*E.axisx+Ln.y*E.axisy),Tn=Tn.next}for(var Vn=En.edges.head,Dn=Fn=En.gverts.next,Fn=Fn.next;null!=Fn;){var Rn=Fn,Zn=Vn.elt,Vn=Vn.next;Zn.gnormx=E.axisy*Zn.lnormx-E.axisx*Zn.lnormy,Zn.gnormy=Zn.lnormx*E.axisx+Zn.lnormy*E.axisy,Zn.gprojection=E.posx*Zn.gnormx+E.posy*Zn.gnormy+Zn.lprojection,Zn.tp0=Dn.y*Zn.gnormx-Dn.x*Zn.gnormy,Zn.tp1=Rn.y*Zn.gnormx-Rn.x*Zn.gnormy,Dn=Rn,Fn=Fn.next}var Bn=En.gverts.next,Gn=Vn.elt;Gn.gnormx=E.axisy*Gn.lnormx-E.axisx*Gn.lnormy,Gn.gnormy=Gn.lnormx*E.axisx+Gn.lnormy*E.axisy,Gn.gprojection=E.posx*Gn.gnormx+E.posy*Gn.gnormy+Gn.lprojection,Gn.tp0=Dn.y*Gn.gnormx-Dn.x*Gn.gnormy,Gn.tp1=Bn.y*Gn.gnormx-Bn.x*Gn.gnormy}if($<=t){var qn,Un,Kn,Wn,Yn,Jn=-W,Xn=-Y;null==Ri.poolVec2?qn=new at:(qn=Ri.poolVec2,Ri.poolVec2=qn.zpp_pool,qn.zpp_pool=null),null==qn.zpp_inner?(null==mo.zpp_pool?Un=new mo:(Un=mo.zpp_pool,mo.zpp_pool=Un.next,Un.next=null),Un.weak=!1,Un._immutable=!1,Un.x=Jn,Un.y=Xn,qn.zpp_inner=Un,qn.zpp_inner.outer=qn):(null!=(Kn=qn.zpp_inner)._validate&&Kn._validate(),qn.zpp_inner.x==Jn&&(null!=(Wn=qn.zpp_inner)._validate&&Wn._validate(),qn.zpp_inner.y==Xn)||(qn.zpp_inner.x=Jn,qn.zpp_inner.y=Xn,null!=(Yn=qn.zpp_inner)._invalidate&&Yn._invalidate(Yn))),qn.zpp_inner.weak=!1;var Hn,$n,Qn,nt,tt,et=qn;return null==Ri.poolVec2?Hn=new at:(Hn=Ri.poolVec2,Ri.poolVec2=Hn.zpp_pool,Hn.zpp_pool=null),null==Hn.zpp_inner?(null==mo.zpp_pool?$n=new mo:($n=mo.zpp_pool,mo.zpp_pool=$n.next,$n.next=null),$n.weak=!1,$n._immutable=!1,$n.x=J,$n.y=X,Hn.zpp_inner=$n,Hn.zpp_inner.outer=Hn):(null!=(Qn=Hn.zpp_inner)._validate&&Qn._validate(),Hn.zpp_inner.x==J&&(null!=(nt=Hn.zpp_inner)._validate&&nt._validate(),Hn.zpp_inner.y==X)||(Hn.zpp_inner.x=J,Hn.zpp_inner.y=X,null!=(tt=Hn.zpp_inner)._invalidate&&tt._invalidate(tt))),Hn.zpp_inner.weak=!1,wt.getConvex(et,Hn,$,H)}return null},ae.prototype.prepareCast=function(n){if(0==n.type){var t=n.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var e=t.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0;var i=e.localCOMy=0,p=e.lverts.next,l=p,r=p=p.next;for(p=p.next;null!=p;){var o=p;i+=r.x*(o.y-l.y);var a=o.y*r.x-o.x*r.y;e.localCOMx+=(r.x+o.x)*a,e.localCOMy+=(r.y+o.y)*a,l=r,r=o,p=p.next}var s=p=e.lverts.next;i+=r.x*(s.y-l.y);var _=s.y*r.x-s.x*r.y;e.localCOMx+=(r.x+s.x)*_,e.localCOMy+=(r.y+s.y)*_,l=r;var h=p=p.next;i+=s.x*(h.y-l.y);var u=h.y*s.x-h.x*s.y;e.localCOMx+=(s.x+h.x)*u,e.localCOMy+=(s.y+h.y)*u;var x=i=1/(3*i);e.localCOMx*=x,e.localCOMy*=x}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var d=t.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}}else{var y=n.polygon;if(y.zip_gaxi&&null!=y.body){y.zip_gaxi=!1,y.validate_laxi();var z=y.body;if(z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot)),y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var c=y.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var v=y.lverts.next,m=y.gverts.next;null!=m;){var f=m,b=v,v=v.next;f.x=y.body.posx+(y.body.axisy*b.x-y.body.axisx*b.y),f.y=y.body.posy+(b.x*y.body.axisx+b.y*y.body.axisy),m=m.next}}for(var g=y.edges.head,w=M=y.gverts.next,M=M.next;null!=M;){var C=M,k=g.elt,g=g.next;k.gp0=w,k.gp1=C,k.gnormx=y.body.axisy*k.lnormx-y.body.axisx*k.lnormy,k.gnormy=k.lnormx*y.body.axisx+k.lnormy*y.body.axisy,k.gprojection=y.body.posx*k.gnormx+y.body.posy*k.gnormy+k.lprojection,null!=k.wrap_gnorm&&(k.wrap_gnorm.zpp_inner.x=k.gnormx,k.wrap_gnorm.zpp_inner.y=k.gnormy),k.tp0=k.gp0.y*k.gnormx-k.gp0.x*k.gnormy,k.tp1=k.gp1.y*k.gnormx-k.gp1.x*k.gnormy,w=C,M=M.next}var O=g.elt;O.gp0=w,O.gp1=y.gverts.next,O.gnormx=y.body.axisy*O.lnormx-y.body.axisx*O.lnormy,O.gnormy=O.lnormx*y.body.axisx+O.lnormy*y.body.axisy,O.gprojection=y.body.posx*O.gnormx+y.body.posy*O.gnormy+O.lprojection,null!=O.wrap_gnorm&&(O.wrap_gnorm.zpp_inner.x=O.gnormx,O.wrap_gnorm.zpp_inner.y=O.gnormy),O.tp0=O.gp0.y*O.gnormx-O.gp0.x*O.gnormy,O.tp1=O.gp1.y*O.gnormx-O.gp1.x*O.gnormy}}},ae.prototype.convexMultiCast=function(n,t,e,i,p){var l;if(null==qt.zpp_pool?l=new qt:(l=qt.zpp_pool,qt.zpp_pool=l.next,l.next=null),l.failed=!1,l.s1=l.s2=null,l.arbiter=null,0==n.type){var r=n.circle;if(r.zip_worldCOM&&null!=r.body){if(r.zip_worldCOM=!1,r.zip_localCOM){if(r.zip_localCOM=!1,1==r.type){var o=r.polygon;if(null==o.lverts.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y;else if(null==o.lverts.next.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y,o.localCOMx+=o.lverts.next.next.x,o.localCOMy+=o.lverts.next.next.y,o.localCOMx*=.5,o.localCOMy*=.5;else{o.localCOMx=0;var a=o.localCOMy=0,s=o.lverts.next,_=s,h=s=s.next;for(s=s.next;null!=s;){var u=s;a+=h.x*(u.y-_.y);var x=u.y*h.x-u.x*h.y;o.localCOMx+=(h.x+u.x)*x,o.localCOMy+=(h.y+u.y)*x,_=h,h=u,s=s.next}var d=s=o.lverts.next;a+=h.x*(d.y-_.y);var y=d.y*h.x-d.x*h.y;o.localCOMx+=(h.x+d.x)*y,o.localCOMy+=(h.y+d.y)*y,_=h;var z=s=s.next;a+=d.x*(z.y-_.y);var c=z.y*d.x-z.x*d.y;o.localCOMx+=(d.x+z.x)*c,o.localCOMy+=(d.y+z.y)*c;var v=a=1/(3*a);o.localCOMx*=v,o.localCOMy*=v}}null!=r.wrap_localCOM&&(r.wrap_localCOM.zpp_inner.x=r.localCOMx,r.wrap_localCOM.zpp_inner.y=r.localCOMy)}var m=r.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)),r.worldCOMx=r.body.posx+(r.body.axisy*r.localCOMx-r.body.axisx*r.localCOMy),r.worldCOMy=r.body.posy+(r.localCOMx*r.body.axisx+r.localCOMy*r.body.axisy)}}else{var f=n.polygon;if(f.zip_gaxi&&null!=f.body){f.zip_gaxi=!1,f.validate_laxi();var b=f.body;if(b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot)),f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var g=f.body;g.zip_axis&&(g.zip_axis=!1,g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot));for(var w=f.lverts.next,M=f.gverts.next;null!=M;){var C=M,k=w,w=w.next;C.x=f.body.posx+(f.body.axisy*k.x-f.body.axisx*k.y),C.y=f.body.posy+(k.x*f.body.axisx+k.y*f.body.axisy),M=M.next}}for(var O=f.edges.head,P=S=f.gverts.next,S=S.next;null!=S;){var A=S,j=O.elt,O=O.next;j.gp0=P,j.gp1=A,j.gnormx=f.body.axisy*j.lnormx-f.body.axisx*j.lnormy,j.gnormy=j.lnormx*f.body.axisx+j.lnormy*f.body.axisy,j.gprojection=f.body.posx*j.gnormx+f.body.posy*j.gnormy+j.lprojection,null!=j.wrap_gnorm&&(j.wrap_gnorm.zpp_inner.x=j.gnormx,j.wrap_gnorm.zpp_inner.y=j.gnormy),j.tp0=j.gp0.y*j.gnormx-j.gp0.x*j.gnormy,j.tp1=j.gp1.y*j.gnormx-j.gp1.x*j.gnormy,P=A,S=S.next}var E=O.elt;E.gp0=P,E.gp1=f.gverts.next,E.gnormx=f.body.axisy*E.lnormx-f.body.axisx*E.lnormy,E.gnormy=E.lnormx*f.body.axisx+E.lnormy*f.body.axisy,E.gprojection=f.body.posx*E.gnormx+f.body.posy*E.gnormy+E.lprojection,null!=E.wrap_gnorm&&(E.wrap_gnorm.zpp_inner.x=E.gnormx,E.wrap_gnorm.zpp_inner.y=E.gnormy),E.tp0=E.gp0.y*E.gnormx-E.gp0.x*E.gnormy,E.tp1=E.gp1.y*E.gnormx-E.gp1.x*E.gnormy}}var I=n.body,T=I.posx,N=I.posy;I.sweepTime=0,I.sweep_angvel=I.angvel;var L,V,D,F,R,Z=t-I.sweepTime;0!=Z&&(I.sweepTime=t,I.posx+=I.velx*Z,I.posy+=I.vely*Z,0!=I.angvel&&(L=I.sweep_angvel*Z,I.rot+=L,1e-4<L*L?(I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot)):(F=1-(V=L*L)*V/8,R=((D=1-.5*V)*I.axisx+L*I.axisy)*F,I.axisy=(D*I.axisy-L*I.axisx)*F,I.axisx=R)));var B=I.posx,G=I.posy;n.validate_sweepRadius();var q,U=n.sweepRadius;null==Al.zpp_pool?q=new Al:(q=Al.zpp_pool,Al.zpp_pool=q.next,q.next=null),q.minx=(T<B?T:B)-U,q.maxx=(B<T?T:B)+U,q.miny=(N<G?N:G)-U,q.maxy=(G<N?N:G)+U;var K=this.convexShapeList=this.bphase.shapesInAABB(q,!1,!1,null==e?null:e.zpp_inner,this.convexShapeList),W=q;null!=W.outer&&(W.outer.zpp_inner=null,W.outer=null),W.wrap_min=W.wrap_max=null,W._invalidate=null,W._validate=null,W.next=Al.zpp_pool,Al.zpp_pool=W;var Y=null==p?new ot:p;K.zpp_inner.valmod();for(var J=st.get(K);;){J.zpp_inner.zpp_inner.valmod();var X=J.zpp_inner;X.zpp_inner.valmod(),X.zpp_inner.zip_length&&(X.zpp_inner.zip_length=!1,X.zpp_inner.user_length=X.zpp_inner.inner.length);var H=X.zpp_inner.user_length;if(J.zpp_critical=!0,!(J.zpp_i<H||(J.zpp_next=st.zpp_pool,(st.zpp_pool=J).zpp_inner=null,!1)))break;J.zpp_critical=!1;var $=J.zpp_inner.at(J.zpp_i++);if($!=n.outer&&(null!=$.zpp_inner.body?$.zpp_inner.body.outer:null)!=I.outer){if(l.s1=n,l.s2=$.zpp_inner,i){$.zpp_inner.validate_sweepRadius(),(null!=$.zpp_inner.body?$.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=$.zpp_inner.body?$.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=$.zpp_inner.body?$.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,Ut.dynamicSweep(l,t,0,0,!0);var Q,nn,tn,en,pn,ln=(null!=$.zpp_inner.body?$.zpp_inner.body.outer:null).zpp_inner,rn=0-ln.sweepTime;0!=rn&&(ln.sweepTime=0,ln.posx+=ln.velx*rn,ln.posy+=ln.vely*rn,0!=ln.angvel&&(Q=ln.sweep_angvel*rn,ln.rot+=Q,1e-4<Q*Q?(ln.axisx=Math.sin(ln.rot),ln.axisy=Math.cos(ln.rot)):(en=1-(nn=Q*Q)*nn/8,pn=((tn=1-.5*nn)*ln.axisx+Q*ln.axisy)*en,ln.axisy=(tn*ln.axisy-Q*ln.axisx)*en,ln.axisx=pn)));var on=(null!=$.zpp_inner.body?$.zpp_inner.body.outer:null).zpp_inner,an=$.zpp_inner;if(0==an.type)an.worldCOMx=on.posx+(on.axisy*an.localCOMx-on.axisx*an.localCOMy),an.worldCOMy=on.posy+(an.localCOMx*on.axisx+an.localCOMy*on.axisy);else{for(var sn=an.polygon,_n=sn.lverts.next,hn=sn.gverts.next;null!=hn;){var un=hn,xn=_n,_n=_n.next;un.x=on.posx+(on.axisy*xn.x-on.axisx*xn.y),un.y=on.posy+(xn.x*on.axisx+xn.y*on.axisy),hn=hn.next}for(var dn=sn.edges.head,yn=zn=sn.gverts.next,zn=zn.next;null!=zn;){var cn=zn,vn=dn.elt,dn=dn.next;vn.gnormx=on.axisy*vn.lnormx-on.axisx*vn.lnormy,vn.gnormy=vn.lnormx*on.axisx+vn.lnormy*on.axisy,vn.gprojection=on.posx*vn.gnormx+on.posy*vn.gnormy+vn.lprojection,vn.tp0=yn.y*vn.gnormx-yn.x*vn.gnormy,vn.tp1=cn.y*vn.gnormx-cn.x*vn.gnormy,yn=cn,zn=zn.next}var mn=sn.gverts.next,fn=dn.elt;fn.gnormx=on.axisy*fn.lnormx-on.axisx*fn.lnormy,fn.gnormy=fn.lnormx*on.axisx+fn.lnormy*on.axisy,fn.gprojection=on.posx*fn.gnormx+on.posy*fn.gnormy+fn.lprojection,fn.tp0=yn.y*fn.gnormx-yn.x*fn.gnormy,fn.tp1=mn.y*fn.gnormx-mn.x*fn.gnormy}}else Ut.staticSweep(l,t,0,0);if(l.toi*=t,0<l.toi){var bn,gn,wn,Mn,Cn,kn=-l.axis.x,On=-l.axis.y;null==Ri.poolVec2?bn=new at:(bn=Ri.poolVec2,Ri.poolVec2=bn.zpp_pool,bn.zpp_pool=null),null==bn.zpp_inner?(null==mo.zpp_pool?gn=new mo:(gn=mo.zpp_pool,mo.zpp_pool=gn.next,gn.next=null),gn.weak=!1,gn._immutable=!1,gn.x=kn,gn.y=On,bn.zpp_inner=gn,bn.zpp_inner.outer=bn):(null!=(wn=bn.zpp_inner)._validate&&wn._validate(),bn.zpp_inner.x==kn&&(null!=(Mn=bn.zpp_inner)._validate&&Mn._validate(),bn.zpp_inner.y==On)||(bn.zpp_inner.x=kn,bn.zpp_inner.y=On,null!=(Cn=bn.zpp_inner)._invalidate&&Cn._invalidate(Cn))),bn.zpp_inner.weak=!1;var Pn,Sn,An,jn,En,In=bn,Tn=l.c2.x,Nn=l.c2.y;null==Ri.poolVec2?Pn=new at:(Pn=Ri.poolVec2,Ri.poolVec2=Pn.zpp_pool,Pn.zpp_pool=null),null==Pn.zpp_inner?(null==mo.zpp_pool?Sn=new mo:(Sn=mo.zpp_pool,mo.zpp_pool=Sn.next,Sn.next=null),Sn.weak=!1,Sn._immutable=!1,Sn.x=Tn,Sn.y=Nn,Pn.zpp_inner=Sn,Pn.zpp_inner.outer=Pn):(null!=(An=Pn.zpp_inner)._validate&&An._validate(),Pn.zpp_inner.x==Tn&&(null!=(jn=Pn.zpp_inner)._validate&&jn._validate(),Pn.zpp_inner.y==Nn)||(Pn.zpp_inner.x=Tn,Pn.zpp_inner.y=Nn,null!=(En=Pn.zpp_inner)._invalidate&&En._invalidate(En))),Pn.zpp_inner.weak=!1;for(var Ln=wt.getConvex(In,Pn,l.toi,$),Vn=null,Dn=Y.zpp_inner.inner.head;null!=Dn&&!(Ln.zpp_inner.toiDistance<Dn.elt.zpp_inner.toiDistance);)Dn=(Vn=Dn).next;var Fn,Rn=Y.zpp_inner.inner;null==xi.zpp_pool?Fn=new xi:(Fn=xi.zpp_pool,xi.zpp_pool=Fn.next,Fn.next=null),Fn.elt=Ln;var Zn=Fn;null==Vn?(Zn.next=Rn.head,Rn.head=Zn):(Zn.next=Vn.next,Vn.next=Zn),Rn.pushmod=Rn.modified=!0,Rn.length++}}}K.clear();var Bn=l;Bn.next=qt.zpp_pool,qt.zpp_pool=Bn;var Gn,qn,Un,Kn,Wn,Yn=0-I.sweepTime;if(0!=Yn&&(I.sweepTime=0,I.posx+=I.velx*Yn,I.posy+=I.vely*Yn,0!=I.angvel&&(Gn=I.sweep_angvel*Yn,I.rot+=Gn,1e-4<Gn*Gn?(I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot)):(Kn=1-(qn=Gn*Gn)*qn/8,Wn=((Un=1-.5*qn)*I.axisx+Gn*I.axisy)*Kn,I.axisy=(Un*I.axisy-Gn*I.axisx)*Kn,I.axisx=Wn))),0==n.type)n.worldCOMx=I.posx+(I.axisy*n.localCOMx-I.axisx*n.localCOMy),n.worldCOMy=I.posy+(n.localCOMx*I.axisx+n.localCOMy*I.axisy);else{for(var Jn=n.polygon,Xn=Jn.lverts.next,Hn=Jn.gverts.next;null!=Hn;){var $n=Hn,Qn=Xn,Xn=Xn.next;$n.x=I.posx+(I.axisy*Qn.x-I.axisx*Qn.y),$n.y=I.posy+(Qn.x*I.axisx+Qn.y*I.axisy),Hn=Hn.next}for(var nt=Jn.edges.head,tt=et=Jn.gverts.next,et=et.next;null!=et;){var it=et,pt=nt.elt,nt=nt.next;pt.gnormx=I.axisy*pt.lnormx-I.axisx*pt.lnormy,pt.gnormy=pt.lnormx*I.axisx+pt.lnormy*I.axisy,pt.gprojection=I.posx*pt.gnormx+I.posy*pt.gnormy+pt.lprojection,pt.tp0=tt.y*pt.gnormx-tt.x*pt.gnormy,pt.tp1=it.y*pt.gnormx-it.x*pt.gnormy,tt=it,et=et.next}var lt=Jn.gverts.next,rt=nt.elt;rt.gnormx=I.axisy*rt.lnormx-I.axisx*rt.lnormy,rt.gnormy=rt.lnormx*I.axisx+rt.lnormy*I.axisy,rt.gprojection=I.posx*rt.gnormx+I.posy*rt.gnormy+rt.lprojection,rt.tp0=tt.y*rt.gnormx-tt.x*rt.gnormy,rt.tp1=lt.y*rt.gnormx-lt.x*rt.gnormy}return Y},ae.prototype.push_callback=function(n){var t;return null==pt.zpp_pool?t=new pt:(t=pt.zpp_pool,pt.zpp_pool=t.next,t.next=null),this.callbacks.push(t),t.listener=n,t},ae.prototype.pre_dt=null,ae.prototype.step=function(n,t,e){if(this.time+=n,this.pre_dt=n,this.midstep=!0,this.stamp++,this.validation(),this.bphase.broadphase(this,!0),this.prestep(n),this.sortcontacts){var i=this.c_arbiters_false;if(null!=i.head&&null!=i.head.next){for(var p,l,r,o=i.head,a=null,s=null,_=null,h=null,u=1;;){for(p=0,s=o,a=o=null;null!=s;){for(++p,_=s,l=0,r=u;null!=_&&l<u;)++l,_=_.next;for(;0<l||0<r&&null!=_;)0!=l&&(0==r||null==_||!s.elt.active||!_.elt.active||s.elt.oc1.dist<_.elt.oc1.dist)?(s=(h=s).next,--l):(_=(h=_).next,--r),null!=a?a.next=h:o=h,a=h;s=_}if(a.next=null,u<<=1,!(1<p))break}i.head=o,i.modified=!0,i.pushmod=!0}}this.updateVel(n),this.warmStart(),this.iterateVel(t);for(var x=this.kinematics.head;null!=x;){var d=x.elt;d.pre_posx=d.posx,d.pre_posy=d.posy,d.pre_rot=d.rot,x=x.next}for(var y=this.live.head;null!=y;){var z=y.elt;z.pre_posx=z.posx,z.pre_posy=z.posy,z.pre_rot=z.rot,y=y.next}this.updatePos(n),this.continuous=!0,this.continuousCollisions(n),this.continuous=!1,this.iteratePos(e);for(var c=this.kinematics.head;null!=c;){var v=c.elt,m=!(v.posx==v.pre_posx&&v.posy==v.pre_posy),f=v.pre_rot!=v.rot;if(m){for(var b=v.shapes.head;null!=b;){var g=b.elt;1==g.type&&(g.polygon.invalidate_gverts(),g.polygon.invalidate_gaxi()),g.invalidate_worldCOM(),b=b.next}v.zip_worldCOM=!0}if(f){v.zip_axis=!0;for(var w=v.shapes.head;null!=w;){var M=w.elt;1==M.type&&(M.polygon.invalidate_gverts(),M.polygon.invalidate_gaxi()),M.invalidate_worldCOM(),w=w.next}v.zip_worldCOM=!0}c=c.next}for(var C=this.live.head;null!=C;){var k=C.elt,O=!(k.posx==k.pre_posx&&k.posy==k.pre_posy),P=k.pre_rot!=k.rot;if(O){for(var S=k.shapes.head;null!=S;){var A=S.elt;1==A.type&&(A.polygon.invalidate_gverts(),A.polygon.invalidate_gaxi()),A.invalidate_worldCOM(),S=S.next}k.zip_worldCOM=!0}if(P){k.zip_axis=!0;for(var j=k.shapes.head;null!=j;){var E=j.elt;1==E.type&&(E.polygon.invalidate_gverts(),E.polygon.invalidate_gaxi()),E.invalidate_worldCOM(),j=j.next}k.zip_worldCOM=!0}C=C.next}for(var I=null,T=this.staticsleep.head;null!=T;){var N=T.elt;if(3!=N.type||0==N.velx&&0==N.vely&&0==N.angvel){if(N.kinematicDelaySleep){N.kinematicDelaySleep=!1,T=T.next;continue}N.component.sleeping=!0;var L,V,D=this.staticsleep;null==I?(V=(L=D.head).next,D.head=V,null==D.head&&(D.pushmod=!0)):(V=(L=I.next).next,null==(I.next=V)&&(D.pushmod=!0));var F=L;F.elt=null,F.next=qe.zpp_pool,qe.zpp_pool=F,D.modified=!0,D.length--,D.pushmod=!0,T=V}else T=(I=T).next}this.doForests(n),this.sleepArbiters(),this.midstep=!1;for(var R=null,Z=this.callbackset_list.next;null!=Z;){var B=Z;if(null!=B.arbiters.head){for(var G=!0,q=B.arbiters.head;null!=q;){if(!q.elt.sleeping){G=!1;break}q=q.next}for(var U,K=G,W=B.int1.cbSet,Y=B.int2.cbSet,J=null,X=(W.cbpairs.length<Y.cbpairs.length?W.cbpairs:Y.cbpairs).head;null!=X;){var H=X.elt;if(H.a==W&&H.b==Y||H.a==Y&&H.b==W){J=H;break}X=X.next}null==J&&(null==Nl.zpp_pool?U=new Nl:(U=Nl.zpp_pool,Nl.zpp_pool=U.next,U.next=null),U.zip_listeners=!0,Tl.setlt(W,Y)?(U.a=W,U.b=Y):(U.a=Y,U.b=W),J=U,W.cbpairs.add(J),Y!=W&&Y.cbpairs.add(J)),J.zip_listeners&&(J.zip_listeners=!1,J.__validate());for(var $=J.listeners.head;null!=$;){var Q,nn,tn,en,pn,ln,rn,on=$.elt;6==on.event&&(K&&!on.allowSleepingCallbacks||B.empty_arb(on.itype)||((Q=this.push_callback(on)).event=6,nn=B.int1,tn=B.int2,en=on.options1,pn=nn.cbTypes,!(!en.nonemptyintersection(pn,en.includes)||en.nonemptyintersection(pn,en.excludes))&&(ln=on.options2,rn=tn.cbTypes,!!ln.nonemptyintersection(rn,ln.includes)&&!ln.nonemptyintersection(rn,ln.excludes))?(Q.int1=nn,Q.int2=tn):(Q.int1=tn,Q.int2=nn),Q.set=B)),$=$.next}Z=(R=Z).next}else{var an,sn,_n=this.callbackset_list;null==R?(sn=(an=_n.next).next,_n.next=sn,null==_n.next&&(_n.pushmod=!0)):(sn=(an=R.next).next,null==(R.next=sn)&&(_n.pushmod=!0)),an._inuse=!1,_n.modified=!0,_n.length--,_n.pushmod=!0,Z=sn,B.int1=B.int2=null,B.id=B.di=-1,B.freed=!0,B.next=Bl.zpp_pool,Bl.zpp_pool=B}}for(;!this.callbacks.empty();){var hn=this.callbacks.pop();0==hn.listener.type?hn.listener.body.handler(hn.wrapper_body()):1==hn.listener.type?hn.listener.constraint.handler(hn.wrapper_con()):2==hn.listener.type&&hn.listener.interaction.handleri(hn.wrapper_int()),hn.int1=hn.int2=null,hn.body=null,hn.constraint=null,(hn.listener=null)!=hn.wrap_arbiters&&(hn.wrap_arbiters.zpp_inner.inner=null),hn.set=null,hn.next=pt.zpp_pool,pt.zpp_pool=hn}},ae.prototype.toiEvents=null,ae.prototype.continuousCollisions=function(n){var t=2*Math.PI/n;this.bphase.broadphase(this,!1);for(var e=0;e<1&&null!=this.toiEvents.head;){for(var i=null,p=2,l=!1,r=null,o=null,a=this.toiEvents.head;null!=a;){var s,_=a.elt,h=_.s1.body,u=_.s2.body;if(h.sweepFrozen&&u.sweepFrozen){if(0==_.toi||!vo.testCollide_safe(_.s1,_.s2)){a=this.toiEvents.erase(o),_.next=qt.zpp_pool,qt.zpp_pool=_;continue}_.toi=0}if(_.frozen1!=h.sweepFrozen||_.frozen2!=u.sweepFrozen){if(_.kinematic){a=this.toiEvents.erase(o),_.next=qt.zpp_pool,qt.zpp_pool=_;continue}if(_.frozen1=h.sweepFrozen,_.frozen2=u.sweepFrozen,_.frozen1&&(s=_.s1,_.s1=_.s2,_.s2=s,_.frozen1=!1,_.frozen2=!0),Ut.staticSweep(_,n,0,co.collisionSlopCCD),_.toi<0){a=this.toiEvents.erase(o),_.next=qt.zpp_pool,qt.zpp_pool=_;continue}}0<=_.toi&&(_.toi<p||!l&&_.kinematic)&&(p=(i=_).toi,l=_.kinematic,r=o),a=(o=a).next}if(null==i)break;this.toiEvents.erase(r),e=i.toi;var x=i.s1.body,d=i.s2.body;if(!x.sweepFrozen){var y,z,c,v,m,f=e*n,b=f-x.sweepTime;0!=b&&(x.sweepTime=f,x.posx+=x.velx*b,x.posy+=x.vely*b,0!=x.angvel&&(y=x.sweep_angvel*b,x.rot+=y,1e-4<y*y?(x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)):(v=1-(z=y*y)*z/8,m=((c=1-.5*z)*x.axisx+y*x.axisy)*v,x.axisy=(c*x.axisy-y*x.axisx)*v,x.axisx=m)));var g=i.s1;if(0==g.type)g.worldCOMx=x.posx+(x.axisy*g.localCOMx-x.axisx*g.localCOMy),g.worldCOMy=x.posy+(g.localCOMx*x.axisx+g.localCOMy*x.axisy);else{for(var w=g.polygon,M=w.lverts.next,C=w.gverts.next;null!=C;){var k=C,O=M,M=M.next;k.x=x.posx+(x.axisy*O.x-x.axisx*O.y),k.y=x.posy+(O.x*x.axisx+O.y*x.axisy),C=C.next}for(var P=w.edges.head,S=A=w.gverts.next,A=A.next;null!=A;){var j=A,E=P.elt,P=P.next;E.gnormx=x.axisy*E.lnormx-x.axisx*E.lnormy,E.gnormy=E.lnormx*x.axisx+E.lnormy*x.axisy,E.gprojection=x.posx*E.gnormx+x.posy*E.gnormy+E.lprojection,E.tp0=S.y*E.gnormx-S.x*E.gnormy,E.tp1=j.y*E.gnormx-j.x*E.gnormy,S=j,A=A.next}var I=w.gverts.next,T=P.elt;T.gnormx=x.axisy*T.lnormx-x.axisx*T.lnormy,T.gnormy=T.lnormx*x.axisx+T.lnormy*x.axisy,T.gprojection=x.posx*T.gnormx+x.posy*T.gnormy+T.lprojection,T.tp0=S.y*T.gnormx-S.x*T.gnormy,T.tp1=I.y*T.gnormx-I.x*T.gnormy}}if(!d.sweepFrozen){var N,L,V,D,F,R=e*n,Z=R-d.sweepTime;0!=Z&&(d.sweepTime=R,d.posx+=d.velx*Z,d.posy+=d.vely*Z,0!=d.angvel&&(N=d.sweep_angvel*Z,d.rot+=N,1e-4<N*N?(d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)):(D=1-(L=N*N)*L/8,F=((V=1-.5*L)*d.axisx+N*d.axisy)*D,d.axisy=(V*d.axisy-N*d.axisx)*D,d.axisx=F)));var B=i.s2;if(0==B.type)B.worldCOMx=d.posx+(d.axisy*B.localCOMx-d.axisx*B.localCOMy),B.worldCOMy=d.posy+(B.localCOMx*d.axisx+B.localCOMy*d.axisy);else{for(var G=B.polygon,q=G.lverts.next,U=G.gverts.next;null!=U;){var K=U,W=q,q=q.next;K.x=d.posx+(d.axisy*W.x-d.axisx*W.y),K.y=d.posy+(W.x*d.axisx+W.y*d.axisy),U=U.next}for(var Y=G.edges.head,J=X=G.gverts.next,X=X.next;null!=X;){var H=X,$=Y.elt,Y=Y.next;$.gnormx=d.axisy*$.lnormx-d.axisx*$.lnormy,$.gnormy=$.lnormx*d.axisx+$.lnormy*d.axisy,$.gprojection=d.posx*$.gnormx+d.posy*$.gnormy+$.lprojection,$.tp0=J.y*$.gnormx-J.x*$.gnormy,$.tp1=H.y*$.gnormx-H.x*$.gnormy,J=H,X=X.next}var Q=G.gverts.next,nn=Y.elt;nn.gnormx=d.axisy*nn.lnormx-d.axisx*nn.lnormy,nn.gnormy=nn.lnormx*d.axisx+nn.lnormy*d.axisy,nn.gprojection=d.posx*nn.gnormx+d.posy*nn.gnormy+nn.lprojection,nn.tp0=J.y*nn.gnormx-J.x*nn.gnormy,nn.tp1=Q.y*nn.gnormx-Q.x*nn.gnormy}}var tn,en,pn,ln,rn,on,an,sn,_n,hn,un,xn,dn,yn,zn,cn,vn,mn,fn,bn,gn,wn,Mn,Cn,kn,On,Pn,Sn,An,jn,En,In,Tn,Nn,Ln,Vn,Dn,Fn,Rn,Zn,Bn,Gn,qn,Un,Kn,Wn,Yn,Jn,Xn,Hn,$n,Qn,nt,tt,et,it,pt,lt,rt,ot,at,st,_t,ht,ut,xt,dt,yt,zt,ct,vt,mt,ft,bt,gt,wt,Mt,Ct=this.narrowPhase(i.s1,i.s2,!0,i.arbiter,!0);null==Ct?null!=i.arbiter&&null!=i.arbiter.pair&&(i.arbiter.pair.arb=null,i.arbiter.pair=null):this.presteparb(Ct,n,!0)||Ct.type==ri.COL&&Ct.active&&0!=(1&Ct.immState)&&(en=(tn=Ct.colarb).nx*tn.c1.jnAcc-tn.ny*tn.c1.jtAcc,pn=tn.ny*tn.c1.jnAcc+tn.nx*tn.c1.jtAcc,ln=tn.b1.imass,tn.b1.velx-=en*ln,tn.b1.vely-=pn*ln,tn.b1.angvel-=tn.b1.iinertia*(pn*tn.c1.r1x-en*tn.c1.r1y),rn=tn.b2.imass,tn.b2.velx+=en*rn,tn.b2.vely+=pn*rn,tn.b2.angvel+=tn.b2.iinertia*(pn*tn.c1.r2x-en*tn.c1.r2y),tn.hc2&&(on=tn.nx*tn.c2.jnAcc-tn.ny*tn.c2.jtAcc,an=tn.ny*tn.c2.jnAcc+tn.nx*tn.c2.jtAcc,sn=tn.b1.imass,tn.b1.velx-=on*sn,tn.b1.vely-=an*sn,tn.b1.angvel-=tn.b1.iinertia*(an*tn.c2.r1x-on*tn.c2.r1y),_n=tn.b2.imass,tn.b2.velx+=on*_n,tn.b2.vely+=an*_n,tn.b2.angvel+=tn.b2.iinertia*(an*tn.c2.r2x-on*tn.c2.r2y)),tn.b2.angvel+=tn.jrAcc*tn.b2.iinertia,tn.b1.angvel-=tn.jrAcc*tn.b1.iinertia,dn=(hn=Ct.colarb).k1x+hn.b2.velx-hn.c1.r2y*hn.b2.angvel-(hn.b1.velx-hn.c1.r1y*hn.b1.angvel),vn=((yn=hn.k1y+hn.b2.vely+hn.c1.r2x*hn.b2.angvel-(hn.b1.vely+hn.c1.r1x*hn.b1.angvel))*hn.nx-dn*hn.ny+hn.surfacex)*hn.c1.tMass,(mn=hn.c1.friction*hn.c1.jnAcc)<(bn=(fn=hn.c1.jtAcc)-vn)?bn=mn:bn<-mn&&(bn=-mn),vn=bn-fn,hn.c1.jtAcc=bn,un=-hn.ny*vn,xn=hn.nx*vn,hn.b2.velx+=un*hn.b2.imass,hn.b2.vely+=xn*hn.b2.imass,hn.b1.velx-=un*hn.b1.imass,hn.b1.vely-=xn*hn.b1.imass,hn.b2.angvel+=hn.rt1b*vn*hn.b2.iinertia,hn.b1.angvel-=hn.rt1a*vn*hn.b1.iinertia,hn.hc2?(zn=hn.k2x+hn.b2.velx-hn.c2.r2y*hn.b2.angvel-(hn.b1.velx-hn.c2.r1y*hn.b1.angvel),vn=((cn=hn.k2y+hn.b2.vely+hn.c2.r2x*hn.b2.angvel-(hn.b1.vely+hn.c2.r1x*hn.b1.angvel))*hn.nx-zn*hn.ny+hn.surfacex)*hn.c2.tMass,(mn=hn.c2.friction*hn.c2.jnAcc)<(bn=(fn=hn.c2.jtAcc)-vn)?bn=mn:bn<-mn&&(bn=-mn),vn=bn-fn,hn.c2.jtAcc=bn,un=-hn.ny*vn,xn=hn.nx*vn,hn.b2.velx+=un*hn.b2.imass,hn.b2.vely+=xn*hn.b2.imass,hn.b1.velx-=un*hn.b1.imass,hn.b1.vely-=xn*hn.b1.imass,hn.b2.angvel+=hn.rt2b*vn*hn.b2.iinertia,hn.b1.angvel-=hn.rt2a*vn*hn.b1.iinertia,dn=hn.k1x+hn.b2.velx-hn.c1.r2y*hn.b2.angvel-(hn.b1.velx-hn.c1.r1y*hn.b1.angvel),yn=hn.k1y+hn.b2.vely+hn.c1.r2x*hn.b2.angvel-(hn.b1.vely+hn.c1.r1x*hn.b1.angvel),zn=hn.k2x+hn.b2.velx-hn.c2.r2y*hn.b2.angvel-(hn.b1.velx-hn.c2.r1y*hn.b1.angvel),cn=hn.k2y+hn.b2.vely+hn.c2.r2x*hn.b2.angvel-(hn.b1.vely+hn.c2.r1x*hn.b1.angvel),gn=hn.c1.jnAcc,wn=hn.c2.jnAcc,Mn=dn*hn.nx+yn*hn.ny+hn.surfacey+hn.c1.bounce-(hn.Ka*gn+hn.Kb*wn),Cn=zn*hn.nx+cn*hn.ny+hn.surfacey+hn.c2.bounce-(hn.Kb*gn+hn.Kc*wn),kn=-(hn.kMassa*Mn+hn.kMassb*Cn),On=-(hn.kMassb*Mn+hn.kMassc*Cn),0<=kn&&0<=On?(Mn=kn-gn,Cn=On-wn,hn.c1.jnAcc=kn,hn.c2.jnAcc=On):0<=(kn=-hn.c1.nMass*Mn)&&0<=hn.Kb*kn+Cn?(Mn=kn-gn,Cn=-wn,hn.c1.jnAcc=kn,hn.c2.jnAcc=0):0<=(On=-hn.c2.nMass*Cn)&&0<=hn.Kb*On+Mn?(Mn=-gn,Cn=On-wn,hn.c1.jnAcc=0,hn.c2.jnAcc=On):0<=Mn&&0<=Cn?(Mn=-gn,Cn=-wn,hn.c1.jnAcc=hn.c2.jnAcc=0):Cn=Mn=0,vn=Mn+Cn,un=hn.nx*vn,xn=hn.ny*vn,hn.b2.velx+=un*hn.b2.imass,hn.b2.vely+=xn*hn.b2.imass,hn.b1.velx-=un*hn.b1.imass,hn.b1.vely-=xn*hn.b1.imass,hn.b2.angvel+=(hn.rn1b*Mn+hn.rn2b*Cn)*hn.b2.iinertia,hn.b1.angvel-=(hn.rn1a*Mn+hn.rn2a*Cn)*hn.b1.iinertia):(0!=hn.radius&&(vn=(hn.b2.angvel-hn.b1.angvel)*hn.rMass,mn=hn.rfric*hn.c1.jnAcc,fn=hn.jrAcc,hn.jrAcc-=vn,hn.jrAcc>mn?hn.jrAcc=mn:hn.jrAcc<-mn&&(hn.jrAcc=-mn),vn=hn.jrAcc-fn,hn.b2.angvel+=vn*hn.b2.iinertia,hn.b1.angvel-=vn*hn.b1.iinertia),dn=hn.k1x+hn.b2.velx-hn.c1.r2y*hn.b2.angvel-(hn.b1.velx-hn.c1.r1y*hn.b1.angvel),yn=hn.k1y+hn.b2.vely+hn.c1.r2x*hn.b2.angvel-(hn.b1.vely+hn.c1.r1x*hn.b1.angvel),vn=(hn.c1.bounce+(hn.nx*dn+hn.ny*yn)+hn.surfacey)*hn.c1.nMass,(bn=(fn=hn.c1.jnAcc)-vn)<0&&(bn=0),vn=bn-fn,hn.c1.jnAcc=bn,un=hn.nx*vn,xn=hn.ny*vn,hn.b2.velx+=un*hn.b2.imass,hn.b2.vely+=xn*hn.b2.imass,hn.b1.velx-=un*hn.b1.imass,hn.b1.vely-=xn*hn.b1.imass,hn.b2.angvel+=hn.rn1b*vn*hn.b2.iinertia,hn.b1.angvel-=hn.rn1a*vn*hn.b1.iinertia),jn=(Pn=Ct.colarb).k1x+Pn.b2.velx-Pn.c1.r2y*Pn.b2.angvel-(Pn.b1.velx-Pn.c1.r1y*Pn.b1.angvel),Nn=((En=Pn.k1y+Pn.b2.vely+Pn.c1.r2x*Pn.b2.angvel-(Pn.b1.vely+Pn.c1.r1x*Pn.b1.angvel))*Pn.nx-jn*Pn.ny+Pn.surfacex)*Pn.c1.tMass,(Ln=Pn.c1.friction*Pn.c1.jnAcc)<(Dn=(Vn=Pn.c1.jtAcc)-Nn)?Dn=Ln:Dn<-Ln&&(Dn=-Ln),Nn=Dn-Vn,Pn.c1.jtAcc=Dn,Sn=-Pn.ny*Nn,An=Pn.nx*Nn,Pn.b2.velx+=Sn*Pn.b2.imass,Pn.b2.vely+=An*Pn.b2.imass,Pn.b1.velx-=Sn*Pn.b1.imass,Pn.b1.vely-=An*Pn.b1.imass,Pn.b2.angvel+=Pn.rt1b*Nn*Pn.b2.iinertia,Pn.b1.angvel-=Pn.rt1a*Nn*Pn.b1.iinertia,Pn.hc2?(In=Pn.k2x+Pn.b2.velx-Pn.c2.r2y*Pn.b2.angvel-(Pn.b1.velx-Pn.c2.r1y*Pn.b1.angvel),Nn=((Tn=Pn.k2y+Pn.b2.vely+Pn.c2.r2x*Pn.b2.angvel-(Pn.b1.vely+Pn.c2.r1x*Pn.b1.angvel))*Pn.nx-In*Pn.ny+Pn.surfacex)*Pn.c2.tMass,(Ln=Pn.c2.friction*Pn.c2.jnAcc)<(Dn=(Vn=Pn.c2.jtAcc)-Nn)?Dn=Ln:Dn<-Ln&&(Dn=-Ln),Nn=Dn-Vn,Pn.c2.jtAcc=Dn,Sn=-Pn.ny*Nn,An=Pn.nx*Nn,Pn.b2.velx+=Sn*Pn.b2.imass,Pn.b2.vely+=An*Pn.b2.imass,Pn.b1.velx-=Sn*Pn.b1.imass,Pn.b1.vely-=An*Pn.b1.imass,Pn.b2.angvel+=Pn.rt2b*Nn*Pn.b2.iinertia,Pn.b1.angvel-=Pn.rt2a*Nn*Pn.b1.iinertia,jn=Pn.k1x+Pn.b2.velx-Pn.c1.r2y*Pn.b2.angvel-(Pn.b1.velx-Pn.c1.r1y*Pn.b1.angvel),En=Pn.k1y+Pn.b2.vely+Pn.c1.r2x*Pn.b2.angvel-(Pn.b1.vely+Pn.c1.r1x*Pn.b1.angvel),In=Pn.k2x+Pn.b2.velx-Pn.c2.r2y*Pn.b2.angvel-(Pn.b1.velx-Pn.c2.r1y*Pn.b1.angvel),Tn=Pn.k2y+Pn.b2.vely+Pn.c2.r2x*Pn.b2.angvel-(Pn.b1.vely+Pn.c2.r1x*Pn.b1.angvel),Fn=Pn.c1.jnAcc,Rn=Pn.c2.jnAcc,Zn=jn*Pn.nx+En*Pn.ny+Pn.surfacey+Pn.c1.bounce-(Pn.Ka*Fn+Pn.Kb*Rn),Bn=In*Pn.nx+Tn*Pn.ny+Pn.surfacey+Pn.c2.bounce-(Pn.Kb*Fn+Pn.Kc*Rn),Gn=-(Pn.kMassa*Zn+Pn.kMassb*Bn),qn=-(Pn.kMassb*Zn+Pn.kMassc*Bn),0<=Gn&&0<=qn?(Zn=Gn-Fn,Bn=qn-Rn,Pn.c1.jnAcc=Gn,Pn.c2.jnAcc=qn):0<=(Gn=-Pn.c1.nMass*Zn)&&0<=Pn.Kb*Gn+Bn?(Zn=Gn-Fn,Bn=-Rn,Pn.c1.jnAcc=Gn,Pn.c2.jnAcc=0):0<=(qn=-Pn.c2.nMass*Bn)&&0<=Pn.Kb*qn+Zn?(Zn=-Fn,Bn=qn-Rn,Pn.c1.jnAcc=0,Pn.c2.jnAcc=qn):0<=Zn&&0<=Bn?(Zn=-Fn,Bn=-Rn,Pn.c1.jnAcc=Pn.c2.jnAcc=0):Bn=Zn=0,Nn=Zn+Bn,Sn=Pn.nx*Nn,An=Pn.ny*Nn,Pn.b2.velx+=Sn*Pn.b2.imass,Pn.b2.vely+=An*Pn.b2.imass,Pn.b1.velx-=Sn*Pn.b1.imass,Pn.b1.vely-=An*Pn.b1.imass,Pn.b2.angvel+=(Pn.rn1b*Zn+Pn.rn2b*Bn)*Pn.b2.iinertia,Pn.b1.angvel-=(Pn.rn1a*Zn+Pn.rn2a*Bn)*Pn.b1.iinertia):(0!=Pn.radius&&(Nn=(Pn.b2.angvel-Pn.b1.angvel)*Pn.rMass,Ln=Pn.rfric*Pn.c1.jnAcc,Vn=Pn.jrAcc,Pn.jrAcc-=Nn,Pn.jrAcc>Ln?Pn.jrAcc=Ln:Pn.jrAcc<-Ln&&(Pn.jrAcc=-Ln),Nn=Pn.jrAcc-Vn,Pn.b2.angvel+=Nn*Pn.b2.iinertia,Pn.b1.angvel-=Nn*Pn.b1.iinertia),jn=Pn.k1x+Pn.b2.velx-Pn.c1.r2y*Pn.b2.angvel-(Pn.b1.velx-Pn.c1.r1y*Pn.b1.angvel),En=Pn.k1y+Pn.b2.vely+Pn.c1.r2x*Pn.b2.angvel-(Pn.b1.vely+Pn.c1.r1x*Pn.b1.angvel),Nn=(Pn.c1.bounce+(Pn.nx*jn+Pn.ny*En)+Pn.surfacey)*Pn.c1.nMass,(Dn=(Vn=Pn.c1.jnAcc)-Nn)<0&&(Dn=0),Nn=Dn-Vn,Pn.c1.jnAcc=Dn,Sn=Pn.nx*Nn,An=Pn.ny*Nn,Pn.b2.velx+=Sn*Pn.b2.imass,Pn.b2.vely+=An*Pn.b2.imass,Pn.b1.velx-=Sn*Pn.b1.imass,Pn.b1.vely-=An*Pn.b1.imass,Pn.b2.angvel+=Pn.rn1b*Nn*Pn.b2.iinertia,Pn.b1.angvel-=Pn.rn1a*Nn*Pn.b1.iinertia),Yn=(Un=Ct.colarb).k1x+Un.b2.velx-Un.c1.r2y*Un.b2.angvel-(Un.b1.velx-Un.c1.r1y*Un.b1.angvel),$n=((Jn=Un.k1y+Un.b2.vely+Un.c1.r2x*Un.b2.angvel-(Un.b1.vely+Un.c1.r1x*Un.b1.angvel))*Un.nx-Yn*Un.ny+Un.surfacex)*Un.c1.tMass,(Qn=Un.c1.friction*Un.c1.jnAcc)<(tt=(nt=Un.c1.jtAcc)-$n)?tt=Qn:tt<-Qn&&(tt=-Qn),$n=tt-nt,Un.c1.jtAcc=tt,Kn=-Un.ny*$n,Wn=Un.nx*$n,Un.b2.velx+=Kn*Un.b2.imass,Un.b2.vely+=Wn*Un.b2.imass,Un.b1.velx-=Kn*Un.b1.imass,Un.b1.vely-=Wn*Un.b1.imass,Un.b2.angvel+=Un.rt1b*$n*Un.b2.iinertia,Un.b1.angvel-=Un.rt1a*$n*Un.b1.iinertia,Un.hc2?(Xn=Un.k2x+Un.b2.velx-Un.c2.r2y*Un.b2.angvel-(Un.b1.velx-Un.c2.r1y*Un.b1.angvel),$n=((Hn=Un.k2y+Un.b2.vely+Un.c2.r2x*Un.b2.angvel-(Un.b1.vely+Un.c2.r1x*Un.b1.angvel))*Un.nx-Xn*Un.ny+Un.surfacex)*Un.c2.tMass,(Qn=Un.c2.friction*Un.c2.jnAcc)<(tt=(nt=Un.c2.jtAcc)-$n)?tt=Qn:tt<-Qn&&(tt=-Qn),$n=tt-nt,Un.c2.jtAcc=tt,Kn=-Un.ny*$n,Wn=Un.nx*$n,Un.b2.velx+=Kn*Un.b2.imass,Un.b2.vely+=Wn*Un.b2.imass,Un.b1.velx-=Kn*Un.b1.imass,Un.b1.vely-=Wn*Un.b1.imass,Un.b2.angvel+=Un.rt2b*$n*Un.b2.iinertia,Un.b1.angvel-=Un.rt2a*$n*Un.b1.iinertia,Yn=Un.k1x+Un.b2.velx-Un.c1.r2y*Un.b2.angvel-(Un.b1.velx-Un.c1.r1y*Un.b1.angvel),Jn=Un.k1y+Un.b2.vely+Un.c1.r2x*Un.b2.angvel-(Un.b1.vely+Un.c1.r1x*Un.b1.angvel),Xn=Un.k2x+Un.b2.velx-Un.c2.r2y*Un.b2.angvel-(Un.b1.velx-Un.c2.r1y*Un.b1.angvel),Hn=Un.k2y+Un.b2.vely+Un.c2.r2x*Un.b2.angvel-(Un.b1.vely+Un.c2.r1x*Un.b1.angvel),et=Un.c1.jnAcc,it=Un.c2.jnAcc,pt=Yn*Un.nx+Jn*Un.ny+Un.surfacey+Un.c1.bounce-(Un.Ka*et+Un.Kb*it),lt=Xn*Un.nx+Hn*Un.ny+Un.surfacey+Un.c2.bounce-(Un.Kb*et+Un.Kc*it),rt=-(Un.kMassa*pt+Un.kMassb*lt),ot=-(Un.kMassb*pt+Un.kMassc*lt),0<=rt&&0<=ot?(pt=rt-et,lt=ot-it,Un.c1.jnAcc=rt,Un.c2.jnAcc=ot):0<=(rt=-Un.c1.nMass*pt)&&0<=Un.Kb*rt+lt?(pt=rt-et,lt=-it,Un.c1.jnAcc=rt,Un.c2.jnAcc=0):0<=(ot=-Un.c2.nMass*lt)&&0<=Un.Kb*ot+pt?(pt=-et,lt=ot-it,Un.c1.jnAcc=0,Un.c2.jnAcc=ot):0<=pt&&0<=lt?(pt=-et,lt=-it,Un.c1.jnAcc=Un.c2.jnAcc=0):lt=pt=0,$n=pt+lt,Kn=Un.nx*$n,Wn=Un.ny*$n,Un.b2.velx+=Kn*Un.b2.imass,Un.b2.vely+=Wn*Un.b2.imass,Un.b1.velx-=Kn*Un.b1.imass,Un.b1.vely-=Wn*Un.b1.imass,Un.b2.angvel+=(Un.rn1b*pt+Un.rn2b*lt)*Un.b2.iinertia,Un.b1.angvel-=(Un.rn1a*pt+Un.rn2a*lt)*Un.b1.iinertia):(0!=Un.radius&&($n=(Un.b2.angvel-Un.b1.angvel)*Un.rMass,Qn=Un.rfric*Un.c1.jnAcc,nt=Un.jrAcc,Un.jrAcc-=$n,Un.jrAcc>Qn?Un.jrAcc=Qn:Un.jrAcc<-Qn&&(Un.jrAcc=-Qn),$n=Un.jrAcc-nt,Un.b2.angvel+=$n*Un.b2.iinertia,Un.b1.angvel-=$n*Un.b1.iinertia),Yn=Un.k1x+Un.b2.velx-Un.c1.r2y*Un.b2.angvel-(Un.b1.velx-Un.c1.r1y*Un.b1.angvel),Jn=Un.k1y+Un.b2.vely+Un.c1.r2x*Un.b2.angvel-(Un.b1.vely+Un.c1.r1x*Un.b1.angvel),$n=(Un.c1.bounce+(Un.nx*Yn+Un.ny*Jn)+Un.surfacey)*Un.c1.nMass,(tt=(nt=Un.c1.jnAcc)-$n)<0&&(tt=0),$n=tt-nt,Un.c1.jnAcc=tt,Kn=Un.nx*$n,Wn=Un.ny*$n,Un.b2.velx+=Kn*Un.b2.imass,Un.b2.vely+=Wn*Un.b2.imass,Un.b1.velx-=Kn*Un.b1.imass,Un.b1.vely-=Wn*Un.b1.imass,Un.b2.angvel+=Un.rn1b*$n*Un.b2.iinertia,Un.b1.angvel-=Un.rn1a*$n*Un.b1.iinertia),ht=(at=Ct.colarb).k1x+at.b2.velx-at.c1.r2y*at.b2.angvel-(at.b1.velx-at.c1.r1y*at.b1.angvel),yt=((ut=at.k1y+at.b2.vely+at.c1.r2x*at.b2.angvel-(at.b1.vely+at.c1.r1x*at.b1.angvel))*at.nx-ht*at.ny+at.surfacex)*at.c1.tMass,(zt=at.c1.friction*at.c1.jnAcc)<(vt=(ct=at.c1.jtAcc)-yt)?vt=zt:vt<-zt&&(vt=-zt),yt=vt-ct,at.c1.jtAcc=vt,st=-at.ny*yt,_t=at.nx*yt,at.b2.velx+=st*at.b2.imass,at.b2.vely+=_t*at.b2.imass,at.b1.velx-=st*at.b1.imass,at.b1.vely-=_t*at.b1.imass,at.b2.angvel+=at.rt1b*yt*at.b2.iinertia,at.b1.angvel-=at.rt1a*yt*at.b1.iinertia,at.hc2?(xt=at.k2x+at.b2.velx-at.c2.r2y*at.b2.angvel-(at.b1.velx-at.c2.r1y*at.b1.angvel),yt=((dt=at.k2y+at.b2.vely+at.c2.r2x*at.b2.angvel-(at.b1.vely+at.c2.r1x*at.b1.angvel))*at.nx-xt*at.ny+at.surfacex)*at.c2.tMass,(zt=at.c2.friction*at.c2.jnAcc)<(vt=(ct=at.c2.jtAcc)-yt)?vt=zt:vt<-zt&&(vt=-zt),yt=vt-ct,at.c2.jtAcc=vt,st=-at.ny*yt,_t=at.nx*yt,at.b2.velx+=st*at.b2.imass,at.b2.vely+=_t*at.b2.imass,at.b1.velx-=st*at.b1.imass,at.b1.vely-=_t*at.b1.imass,at.b2.angvel+=at.rt2b*yt*at.b2.iinertia,at.b1.angvel-=at.rt2a*yt*at.b1.iinertia,ht=at.k1x+at.b2.velx-at.c1.r2y*at.b2.angvel-(at.b1.velx-at.c1.r1y*at.b1.angvel),ut=at.k1y+at.b2.vely+at.c1.r2x*at.b2.angvel-(at.b1.vely+at.c1.r1x*at.b1.angvel),xt=at.k2x+at.b2.velx-at.c2.r2y*at.b2.angvel-(at.b1.velx-at.c2.r1y*at.b1.angvel),dt=at.k2y+at.b2.vely+at.c2.r2x*at.b2.angvel-(at.b1.vely+at.c2.r1x*at.b1.angvel),mt=at.c1.jnAcc,ft=at.c2.jnAcc,bt=ht*at.nx+ut*at.ny+at.surfacey+at.c1.bounce-(at.Ka*mt+at.Kb*ft),gt=xt*at.nx+dt*at.ny+at.surfacey+at.c2.bounce-(at.Kb*mt+at.Kc*ft),wt=-(at.kMassa*bt+at.kMassb*gt),Mt=-(at.kMassb*bt+at.kMassc*gt),0<=wt&&0<=Mt?(bt=wt-mt,gt=Mt-ft,at.c1.jnAcc=wt,at.c2.jnAcc=Mt):0<=(wt=-at.c1.nMass*bt)&&0<=at.Kb*wt+gt?(bt=wt-mt,gt=-ft,at.c1.jnAcc=wt,at.c2.jnAcc=0):0<=(Mt=-at.c2.nMass*gt)&&0<=at.Kb*Mt+bt?(bt=-mt,gt=Mt-ft,at.c1.jnAcc=0,at.c2.jnAcc=Mt):0<=bt&&0<=gt?(bt=-mt,gt=-ft,at.c1.jnAcc=at.c2.jnAcc=0):gt=bt=0,yt=bt+gt,st=at.nx*yt,_t=at.ny*yt,at.b2.velx+=st*at.b2.imass,at.b2.vely+=_t*at.b2.imass,at.b1.velx-=st*at.b1.imass,at.b1.vely-=_t*at.b1.imass,at.b2.angvel+=(at.rn1b*bt+at.rn2b*gt)*at.b2.iinertia,at.b1.angvel-=(at.rn1a*bt+at.rn2a*gt)*at.b1.iinertia):(0!=at.radius&&(yt=(at.b2.angvel-at.b1.angvel)*at.rMass,zt=at.rfric*at.c1.jnAcc,ct=at.jrAcc,at.jrAcc-=yt,at.jrAcc>zt?at.jrAcc=zt:at.jrAcc<-zt&&(at.jrAcc=-zt),yt=at.jrAcc-ct,at.b2.angvel+=yt*at.b2.iinertia,at.b1.angvel-=yt*at.b1.iinertia),ht=at.k1x+at.b2.velx-at.c1.r2y*at.b2.angvel-(at.b1.velx-at.c1.r1y*at.b1.angvel),ut=at.k1y+at.b2.vely+at.c1.r2x*at.b2.angvel-(at.b1.vely+at.c1.r1x*at.b1.angvel),yt=(at.c1.bounce+(at.nx*ht+at.ny*ut)+at.surfacey)*at.c1.nMass,(vt=(ct=at.c1.jnAcc)-yt)<0&&(vt=0),yt=vt-ct,at.c1.jnAcc=vt,st=at.nx*yt,_t=at.ny*yt,at.b2.velx+=st*at.b2.imass,at.b2.vely+=_t*at.b2.imass,at.b1.velx-=st*at.b1.imass,at.b1.vely-=_t*at.b1.imass,at.b2.angvel+=at.rn1b*yt*at.b2.iinertia,at.b1.angvel-=at.rn1a*yt*at.b1.iinertia),x.sweep_angvel=x.angvel%t,d.sweep_angvel=d.angvel%t),null!=Ct&&Ct.active&&0!=(1&Ct.immState)&&Ct.type==ri.COL&&(x.sweepFrozen||3==x.type||(x.sweepFrozen=!0,i.failed?x.angvel=x.sweep_angvel=0:i.slipped?x.angvel=x.sweep_angvel*=co.angularCCDSlipScale:x.angvel=x.sweep_angvel),d.sweepFrozen||3==d.type||(d.sweepFrozen=!0,i.failed?d.angvel=d.sweep_angvel=0:i.slipped?d.angvel=d.sweep_angvel*=co.angularCCDSlipScale:d.angvel=d.sweep_angvel));var kt=i;kt.next=qt.zpp_pool,qt.zpp_pool=kt}for(;null!=this.toiEvents.head;){var Ot=this.toiEvents.pop_unsafe();Ot.next=qt.zpp_pool,qt.zpp_pool=Ot}for(var Pt=this.kinematics.head;null!=Pt;){var St,At,jt,Et,It,Tt=Pt.elt,Nt=n-Tt.sweepTime;0!=Nt&&(Tt.sweepTime=n,Tt.posx+=Tt.velx*Nt,Tt.posy+=Tt.vely*Nt,0!=Tt.angvel&&(St=Tt.sweep_angvel*Nt,Tt.rot+=St,1e-4<St*St?(Tt.axisx=Math.sin(Tt.rot),Tt.axisy=Math.cos(Tt.rot)):(Et=1-(At=St*St)*At/8,It=((jt=1-.5*At)*Tt.axisx+St*Tt.axisy)*Et,Tt.axisy=(jt*Tt.axisy-St*Tt.axisx)*Et,Tt.axisx=It))),Tt.sweepTime=0,Pt=Pt.next}for(var Lt=this.live.head;null!=Lt;){var Vt,Dt,Ft,Rt,Zt,Bt,Gt=Lt.elt;Gt.sweepFrozen||0!=(Vt=n-Gt.sweepTime)&&(Gt.sweepTime=n,Gt.posx+=Gt.velx*Vt,Gt.posy+=Gt.vely*Vt,0!=Gt.angvel&&(Dt=Gt.sweep_angvel*Vt,Gt.rot+=Dt,1e-4<Dt*Dt?(Gt.axisx=Math.sin(Gt.rot),Gt.axisy=Math.cos(Gt.rot)):(Zt=1-(Ft=Dt*Dt)*Ft/8,Bt=((Rt=1-.5*Ft)*Gt.axisx+Dt*Gt.axisy)*Zt,Gt.axisy=(Rt*Gt.axisy-Dt*Gt.axisx)*Zt,Gt.axisx=Bt))),Gt.sweepTime=0,Lt=Lt.next}},ae.prototype.continuousEvent=function(n,t,e,i,p){if(n.body.sweepFrozen&&t.body.sweepFrozen)return i;if(n.body.disableCCD||t.body.disableCCD)return i;var l;if(null==i||null!=i.colarb){for(var r,o,a,s,_,h,u,x=n.body,d=t.body,y=!1,z=x.constraints.head;null!=z;){var c=z.elt;if(c.ignore&&c.pair_exists(x.id,d.id)){y=!0;break}z=z.next}if(y)r=!1;else{for(var v=n;null!=v&&null==v.group;)v=null!=v.ishape?v.ishape.body:null!=v.icompound?v.icompound.compound:v.ibody.compound;var m,f=null==v?null:v.group;if(null==f)m=!1;else{for(var b=t;null!=b&&null==b.group;)b=null!=b.ishape?b.ishape.body:null!=b.icompound?b.icompound.compound:b.ibody.compound;var g=null==b?null:b.group;if(null==g)m=!1;else{for(var w=!1;null!=f&&null!=g;){if(f==g){w=f.ignore;break}f.depth<g.depth?g=g.group:f=f.group}m=w}}r=!m}l=(r?!(!n.sensorEnabled&&!t.sensorEnabled)&&(o=n.filter,a=t.filter,0!=(o.sensorMask&a.sensorGroup)&&0!=(a.sensorMask&o.sensorGroup))?2:!!(!(!n.fluidEnabled&&!t.fluidEnabled)&&(s=n.filter,_=t.filter,0!=(s.fluidMask&_.fluidGroup)&&0!=(_.fluidMask&s.fluidGroup)))&&!(0==x.imass&&0==d.imass&&0==x.iinertia&&0==d.iinertia)?0:(h=n.filter,u=t.filter,0!=(h.collisionMask&u.collisionGroup)&&0!=(u.collisionMask&h.collisionGroup)&&!(0==x.imass&&0==d.imass&&0==x.iinertia&&0==d.iinertia)?1:-1):-1)<=0}else l=!0;if(l)return i;var M,C,k,O,P=n.body,S=t.body;return(e||P.bullet||S.bullet)&&(null==qt.zpp_pool?M=new qt:(M=qt.zpp_pool,qt.zpp_pool=M.next,M.next=null),M.failed=!1,M.s1=M.s2=null,M.arbiter=null,C=3==P.type||3==S.type,e&&!C?(2!=n.body.type?(M.s2=n,M.s1=t):(M.s1=n,M.s2=t),M.kinematic=!1,Ut.staticSweep(M,this.pre_dt,0,co.collisionSlopCCD)):(M.s1=n,M.s2=t,M.kinematic=C,M.s1.body.sweepFrozen||M.s2.body.sweepFrozen?(M.s1.body.sweepFrozen&&(k=M.s1,M.s1=M.s2,M.s2=k,M.frozen1=!1,M.frozen2=!0),Ut.staticSweep(M,this.pre_dt,0,co.collisionSlopCCD)):Ut.dynamicSweep(M,this.pre_dt,0,co.collisionSlopCCD)),e&&M.toi<0||M.failed?((O=M).next=qt.zpp_pool,qt.zpp_pool=O):(this.toiEvents.add(M),M.frozen1=M.s1.body.sweepFrozen,M.frozen2=M.s2.body.sweepFrozen,M.arbiter=null!=i?i.colarb:null)),i},ae.prototype.bodyCbWake=function(n){if(2==n.type&&null!=n.cbSet)if(this.midstep)for(var t=n.cbSet.bodylisteners.head;null!=t;){var e,i=t.elt;2==i.event?((e=this.push_callback(i)).event=2,e.body=n,t=t.next):t=t.next}else n.component.woken=!0},ae.prototype.bodyCbSleep=function(n){if(2==n.type&&null!=n.cbSet)for(var t=n.cbSet.bodylisteners.head;null!=t;){var e,i=t.elt;3==i.event?((e=this.push_callback(i)).event=3,e.body=n,t=t.next):t=t.next}},ae.prototype.constraintCbWake=function(n){if(null!=n.cbSet)if(this.midstep)for(var t=n.cbSet.conlisteners.head;null!=t;){var e,i=t.elt;2==i.event?((e=this.push_callback(i)).event=2,e.constraint=n,t=t.next):t=t.next}else n.component.woken=!0},ae.prototype.constraintCbSleep=function(n){if(null!=n.cbSet)for(var t=n.cbSet.conlisteners.head;null!=t;){var e,i=t.elt;3==i.event?((e=this.push_callback(i)).event=3,e.constraint=n,t=t.next):t=t.next}},ae.prototype.constraintCbBreak=function(n){if(null!=n.cbSet)for(var t=n.cbSet.conlisteners.head;null!=t;){var e,i=t.elt;4==i.event?((e=this.push_callback(i)).event=4,e.constraint=n,t=t.next):t=t.next}},ae.prototype.nullListenerType=function(n,t){for(var e=new Tn,i=n.interactors.head;null!=i;)e.add(i.elt),i=i.next;if(n!=t)for(var p=t.interactors.head;null!=p;)e.add(p.elt),p=p.next;for(;null!=e.head;){var l=e.pop_unsafe();if(null!=l.icompound){for(var r=l.icompound,o=r.bodies.head;null!=o;)e.add(o.elt),o=o.next;for(var a=r.compounds.head;null!=a;)e.add(a.elt),a=a.next}else for(var s=null!=l.ibody?l.ibody:l.ishape.body,_=null!=l.ishape?l.ishape:null,h=s.arbiters.head;null!=h;){var u=h.elt;if(0!=u.present)if(null==_||u.ws1==_||u.ws2==_){this.MRCA_chains(u.ws1,u.ws2);for(var x=this.mrca1.head;null!=x;){var d=x.elt;if(d.cbSet==n||d.cbSet==t){for(var y=this.mrca2.head;null!=y;){var z=y.elt;if(d.cbSet==n&&z.cbSet!=t||d.cbSet==t&&z.cbSet!=n)y=y.next;else{var c=Zl.get(d,z);if(null!=c){for(;null!=c.arbiters.head;)c.arbiters.pop_unsafe().present--;this.remove_callbackset(c)}y=y.next}}x=x.next}else x=x.next}h=h.next}else h=h.next;else h=h.next}}},ae.prototype.nullInteractorType=function(n,t){if(null==t&&(t=n),null!=n.icompound){for(var e=n.icompound,i=e.bodies.head;null!=i;)this.nullInteractorType(i.elt,t),i=i.next;for(var p=e.compounds.head;null!=p;)this.nullInteractorType(p.elt,t),p=p.next}else for(var l=null!=n.ibody?n.ibody:n.ishape.body,r=null!=n.ishape?n.ishape:null,o=l.arbiters.head;null!=o;){var a=o.elt;if(0!=a.present)if(null==r||a.ws1==r||a.ws2==r){this.MRCA_chains(a.ws1,a.ws2);for(var s=this.mrca1.head;null!=s;){for(var _=s.elt,h=this.mrca2.head;null!=h;){var u,x=h.elt;_==t||x==t?(null!=(u=Zl.get(_,x))&&(a.present--,u.remove_arb(a),null==u.arbiters.head&&this.remove_callbackset(u)),h=h.next):h=h.next}s=s.next}o=o.next}else o=o.next;else o=o.next}},ae.prototype.freshListenerType=function(n,t){for(var e=new Tn,i=n.interactors.head;null!=i;)e.add(i.elt),i=i.next;if(n!=t)for(var p=t.interactors.head;null!=p;)e.add(p.elt),p=p.next;for(;null!=e.head;){var l=e.pop_unsafe();if(null!=l.icompound){for(var r=l.icompound,o=r.bodies.head;null!=o;)e.add(o.elt),o=o.next;for(var a=r.compounds.head;null!=a;)e.add(a.elt),a=a.next}else for(var s=null!=l.ibody?l.ibody:l.ishape.body,_=null!=l.ishape?l.ishape:null,h=s.arbiters.head;null!=h;){var u=h.elt;if(u.presentable)if(null==_||u.ws1==_||u.ws2==_){this.MRCA_chains(u.ws1,u.ws2);for(var x=this.mrca1.head;null!=x;){var d=x.elt;if(d.cbSet==n||d.cbSet==t){for(var y=this.mrca2.head;null!=y;){var z=y.elt;if(d.cbSet==n&&z.cbSet!=t||d.cbSet==t&&z.cbSet!=n)y=y.next;else{var c,v=Zl.get(d,z);null==v&&(v=Bl.get(d,z),this.add_callbackset(v)),c=!1;for(var m,f,b,g=v.arbiters.head;null!=g;){if(g.elt==u){c=!0;break}g=g.next}!c&&(m=v.arbiters,null==Gl.zpp_pool?f=new Gl:(f=Gl.zpp_pool,Gl.zpp_pool=f.next,f.next=null),f.elt=u,(b=f).next=m.head,m.head=b,m.modified=!0,m.length++,!0)&&u.present++,y=y.next}}x=x.next}else x=x.next}h=h.next}else h=h.next;else h=h.next}}},ae.prototype.freshInteractorType=function(n,t){if(null==t&&(t=n),null!=n.icompound){for(var e=n.icompound,i=e.bodies.head;null!=i;)this.freshInteractorType(i.elt,t),i=i.next;for(var p=e.compounds.head;null!=p;)this.freshInteractorType(p.elt,t),p=p.next}else for(var l=null!=n.ibody?n.ibody:n.ishape.body,r=null!=n.ishape?n.ishape:null,o=l.arbiters.head;null!=o;){var a=o.elt;if(a.presentable)if(null==r||a.ws1==r||a.ws2==r){this.MRCA_chains(a.ws1,a.ws2);for(var s=this.mrca1.head;null!=s;){for(var _=s.elt,h=this.mrca2.head;null!=h;){var u=h.elt;if(_==t||u==t){var x=_.cbSet,d=u.cbSet;x.validate(),d.validate();for(var y,z=null,c=(x.cbpairs.length<d.cbpairs.length?x.cbpairs:d.cbpairs).head;null!=c;){var v=c.elt;if(v.a==x&&v.b==d||v.a==d&&v.b==x){z=v;break}c=c.next}if(null==z&&(null==Nl.zpp_pool?y=new Nl:(y=Nl.zpp_pool,Nl.zpp_pool=y.next,y.next=null),y.zip_listeners=!0,Tl.setlt(x,d)?(y.a=x,y.b=d):(y.a=d,y.b=x),z=y,x.cbpairs.add(z),d!=x&&d.cbpairs.add(z)),z.zip_listeners&&(z.zip_listeners=!1,z.__validate()),null!=z.listeners.head){var m,f=Zl.get(_,u);null==f&&(f=Bl.get(_,u),this.add_callbackset(f)),m=!1;for(var b,g,w,M=f.arbiters.head;null!=M;){if(M.elt==a){m=!0;break}M=M.next}!m&&(b=f.arbiters,null==Gl.zpp_pool?g=new Gl:(g=Gl.zpp_pool,Gl.zpp_pool=g.next,g.next=null),g.elt=a,(w=g).next=b.head,b.head=w,b.modified=!0,b.length++,!0)&&a.present++}h=h.next}else h=h.next}s=s.next}o=o.next}else o=o.next;else o=o.next}},ae.prototype.wakeCompound=function(n){for(var t=n.bodies.head;null!=t;){var e=t.elt;e.world||(e.component.waket=this.stamp+(this.midstep?0:1),3==e.type&&(e.kinematicDelaySleep=!0),e.component.sleeping&&this.really_wake(e,!1)),t=t.next}for(var i=n.constraints.head;null!=i;)this.wake_constraint(i.elt),i=i.next;for(var p=n.compounds.head;null!=p;)this.wakeCompound(p.elt),p=p.next},ae.prototype.wakeIsland=function(n){for(;null!=n.comps.head;){var t=n.comps.pop_unsafe();if(t.waket=this.stamp+(this.midstep?0:1),t.isBody){var e=t.body;this.live.add(e);for(var i=e.arbiters.head;null!=i;){var p,l,r,o,a,s,_,h,u,x,d,y,z,c,v,m=i.elt;m.sleeping&&(m.sleeping=!1,m.up_stamp+=this.stamp-m.sleep_stamp,m.type==ri.COL?(p=m.colarb).stat?(l=this.c_arbiters_true,null==Yl.zpp_pool?r=new Yl:(r=Yl.zpp_pool,Yl.zpp_pool=r.next,r.next=null),r.elt=p,(o=r).next=l.head,l.head=o,l.modified=!0,l.length++):(a=this.c_arbiters_false,null==Yl.zpp_pool?s=new Yl:(s=Yl.zpp_pool,Yl.zpp_pool=s.next,s.next=null),s.elt=p,(_=s).next=a.head,a.head=_,a.modified=!0,a.length++):m.type==ri.FLUID?(h=this.f_arbiters,u=m.fluidarb,null==Kl.zpp_pool?x=new Kl:(x=Kl.zpp_pool,Kl.zpp_pool=x.next,x.next=null),x.elt=u,(d=x).next=h.head,h.head=d,h.modified=!0,h.length++):(y=this.s_arbiters,z=m.sensorarb,null==Wl.zpp_pool?c=new Wl:(c=Wl.zpp_pool,Wl.zpp_pool=c.next,c.next=null),c.elt=z,(v=c).next=y.head,y.head=v,y.modified=!0,y.length++)),i=i.next}if(this.bodyCbWake(e),t.sleeping=!1,t.island=null,(t.parent=t).rank=0,1!=e.type)for(var f=e.shapes.head;null!=f;){var b=f.elt;null!=b.node&&this.bphase.sync(b),f=f.next}}else{var g,w=t.constraint,M=this.live_constraints;null==Ue.zpp_pool?g=new Ue:(g=Ue.zpp_pool,Ue.zpp_pool=g.next,g.next=null),g.elt=w;var C=g;C.next=M.head,M.head=C,M.modified=!0,M.length++,this.constraintCbWake(w),t.sleeping=!1,t.island=null,(t.parent=t).rank=0}}n.next=pe.zpp_pool,pe.zpp_pool=n},ae.prototype.non_inlined_wake=function(n,t){null==t&&(t=!1),n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,t))},ae.prototype.really_wake=function(n,t){if(null==t&&(t=!1),null==n.component.island){var e,i,p,l,r,o;n.component.sleeping=!1,3==n.type||1==n.type?(e=this.staticsleep,null==qe.zpp_pool?i=new qe:(i=qe.zpp_pool,qe.zpp_pool=i.next,i.next=null),i.elt=n,(p=i).next=e.head,e.head=p,e.modified=!0,e.length++):(l=this.live,null==qe.zpp_pool?r=new qe:(r=qe.zpp_pool,qe.zpp_pool=r.next,r.next=null),r.elt=n,(o=r).next=l.head,l.head=o,l.modified=!0,l.length++);for(var a=n.constraints.head;null!=a;){var s=a.elt;s.space==this&&this.wake_constraint(s),a=a.next}for(var _=n.arbiters.head;null!=_;){var h,u,x,d,y,z,c,v,m,f,b,g,w,M,C,k,O,P=_.elt;P.sleeping&&(P.sleeping=!1,P.up_stamp+=this.stamp+(this.midstep?0:1)-P.sleep_stamp,P.type==ri.COL?(h=P.colarb).stat?(u=this.c_arbiters_true,null==Yl.zpp_pool?x=new Yl:(x=Yl.zpp_pool,Yl.zpp_pool=x.next,x.next=null),x.elt=h,(d=x).next=u.head,u.head=d,u.modified=!0,u.length++):(y=this.c_arbiters_false,null==Yl.zpp_pool?z=new Yl:(z=Yl.zpp_pool,Yl.zpp_pool=z.next,z.next=null),z.elt=h,(c=z).next=y.head,y.head=c,y.modified=!0,y.length++):P.type==ri.FLUID?(v=this.f_arbiters,m=P.fluidarb,null==Kl.zpp_pool?f=new Kl:(f=Kl.zpp_pool,Kl.zpp_pool=f.next,f.next=null),f.elt=m,(b=f).next=v.head,v.head=b,v.modified=!0,v.length++):(g=this.s_arbiters,w=P.sensorarb,null==Wl.zpp_pool?M=new Wl:(M=Wl.zpp_pool,Wl.zpp_pool=M.next,M.next=null),M.elt=w,(C=M).next=g.head,g.head=C,g.modified=!0,g.length++)),P.type!=ri.SENSOR&&!P.cleared&&P.up_stamp>=this.stamp&&0!=(1&P.immState)&&(2==P.b1.type&&P.b1.component.sleeping&&((k=P.b1).world||(k.component.waket=this.stamp+(this.midstep?0:1),3==k.type&&(k.kinematicDelaySleep=!0),k.component.sleeping&&this.really_wake(k,!1))),2==P.b2.type&&P.b2.component.sleeping&&((O=P.b2).world||(O.component.waket=this.stamp+(this.midstep?0:1),3==O.type&&(O.kinematicDelaySleep=!0),O.component.sleeping&&this.really_wake(O,!1)))),_=_.next}if(t||2!=n.type||this.bodyCbWake(n),!t&&!this.bphase.is_sweep&&1!=n.type)for(var S=n.shapes.head;null!=S;){var A=S.elt;null!=A.node&&this.bphase.sync(A),S=S.next}}else this.wakeIsland(n.component.island)},ae.prototype.wake_constraint=function(n,t){var e,i,p;return null==t&&(t=!1),!!n.active&&(n.component.waket=this.stamp+(this.midstep?0:1),!!n.component.sleeping&&(null==n.component.island?(n.component.sleeping=!1,e=this.live_constraints,null==Ue.zpp_pool?i=new Ue:(i=Ue.zpp_pool,Ue.zpp_pool=i.next,i.next=null),i.elt=n,(p=i).next=e.head,e.head=p,e.modified=!0,e.length++,n.wake_connected(),t||this.constraintCbWake(n)):this.wakeIsland(n.component.island),!0))},ae.prototype.doForests=function(n){for(var t=this.c_arbiters_false.head;null!=t;){var e,i,p=t.elt;if(!p.cleared&&p.up_stamp==this.stamp&&0!=(1&p.immState)&&2==p.b1.type&&2==p.b2.type){if(p.b1.component==p.b1.component.parent)e=p.b1.component;else{for(var l=p.b1.component,r=null;l!=l.parent;){var o=l.parent;l.parent=r,r=l,l=o}for(;null!=r;){var a=r.parent;r.parent=l,r=a}e=l}if(p.b2.component==p.b2.component.parent)i=p.b2.component;else{for(var s=p.b2.component,_=null;s!=s.parent;){var h=s.parent;s.parent=_,_=s,s=h}for(;null!=_;){var u=_.parent;_.parent=s,_=u}i=s}e!=i&&(e.rank<i.rank?e.parent=i:e.rank>i.rank?i.parent=e:(i.parent=e).rank++)}t=t.next}for(var x=this.f_arbiters.head;null!=x;){var d,y,z=x.elt;if(!z.cleared&&z.up_stamp==this.stamp&&0!=(1&z.immState)&&2==z.b1.type&&2==z.b2.type){if(z.b1.component==z.b1.component.parent)d=z.b1.component;else{for(var c=z.b1.component,v=null;c!=c.parent;){var m=c.parent;c.parent=v,v=c,c=m}for(;null!=v;){var f=v.parent;v.parent=c,v=f}d=c}if(z.b2.component==z.b2.component.parent)y=z.b2.component;else{for(var b=z.b2.component,g=null;b!=b.parent;){var w=b.parent;b.parent=g,g=b,b=w}for(;null!=g;){var M=g.parent;g.parent=b,g=M}y=b}d!=y&&(d.rank<y.rank?d.parent=y:d.rank>y.rank?y.parent=d:(y.parent=d).rank++)}x=x.next}for(var C=this.live_constraints.head;null!=C;)C.elt.forest(),C=C.next;for(;null!=this.live.head;){var k=this.live,O=k.head.elt;k.pop();var P,S,A,j=O.component;if(j==j.parent)P=j;else{for(var E=j,I=null;E!=E.parent;){var T=E.parent;E.parent=I,I=E,E=T}for(;null!=I;){var N=I.parent;I.parent=E,I=N}P=E}null==P.island&&(null==pe.zpp_pool?P.island=new pe:(P.island=pe.zpp_pool,pe.zpp_pool=P.island.next,P.island.next=null),P.island.waket=0,S=this.islands,(A=P.island)._inuse=!0,A.next=S.next,S.next=A,S.modified=!0,S.length++,P.island.sleep=!0),j.island=P.island;var L,V=j.island.comps;null==si.zpp_pool?L=new si:(L=si.zpp_pool,si.zpp_pool=L.next,L.next=null),L.elt=j;var D=L;D.next=V.head,V.head=D,V.modified=!0,V.length++;var F=O.atRest(n);j.island.sleep=j.island.sleep&&F,j.waket>j.island.waket&&(j.island.waket=j.waket)}for(;null!=this.live_constraints.head;){var R=this.live_constraints,Z=R.head.elt;R.pop();var B,G=Z.component;if(G==G.parent)B=G;else{for(var q=G,U=null;q!=q.parent;){var K=q.parent;q.parent=U,U=q,q=K}for(;null!=U;){var W=U.parent;U.parent=q,U=W}B=q}G.island=B.island;var Y,J=G.island.comps;null==si.zpp_pool?Y=new si:(Y=si.zpp_pool,si.zpp_pool=Y.next,Y.next=null),Y.elt=G;var X=Y;X.next=J.head,J.head=X,J.modified=!0,J.length++,G.waket>G.island.waket&&(G.island.waket=G.waket)}for(;null!=this.islands.next;){var H=this.islands,$=H.next;if(H.pop(),$.sleep)for(var Q=$.comps.head;null!=Q;){var nn=Q.elt;if(nn.isBody){var tn=nn.body;tn.velx=0,tn.vely=0,tn.angvel=0,nn.sleeping=!0;for(var en=tn.shapes.head;null!=en;)this.bphase.sync(en.elt),en=en.next;this.bodyCbSleep(tn)}else this.constraintCbSleep(nn.constraint),nn.sleeping=!0;Q=Q.next}else{for(;null!=$.comps.head;){var pn,ln,rn,on,an,sn,_n,hn,un=$.comps,xn=un.head.elt;un.pop(),xn.waket=$.waket,xn.isBody?(pn=this.live,ln=xn.body,null==qe.zpp_pool?rn=new qe:(rn=qe.zpp_pool,qe.zpp_pool=rn.next,rn.next=null),rn.elt=ln,(on=rn).next=pn.head,pn.head=on,pn.modified=!0,pn.length++):(an=this.live_constraints,sn=xn.constraint,null==Ue.zpp_pool?_n=new Ue:(_n=Ue.zpp_pool,Ue.zpp_pool=_n.next,_n.next=null),_n.elt=sn,(hn=_n).next=an.head,an.head=hn,an.modified=!0,an.length++),xn.sleeping=!1,xn.island=null,(xn.parent=xn).rank=0}$.next=pe.zpp_pool,pe.zpp_pool=$}}},ae.prototype.sleepArbiters=function(){var n=null,t=this.c_arbiters_true,e=t.head,i=null!=this.c_arbiters_false;for(i&&null==e&&(i=!1,e=this.c_arbiters_false.head,t=this.c_arbiters_false,n=null);null!=e;){var p,l,r,o=e.elt;o.b1.component.sleeping&&o.b2.component.sleeping?(o.sleep_stamp=this.stamp,o.sleeping=!0,null==n?(l=(p=t.head).next,t.head=l,null==t.head&&(t.pushmod=!0)):(l=(p=n.next).next,null==(n.next=l)&&(t.pushmod=!0)),(r=p).elt=null,r.next=Yl.zpp_pool,Yl.zpp_pool=r,t.modified=!0,t.length--,t.pushmod=!0,e=l,i&&null==e&&(i=!1,e=this.c_arbiters_false.head,t=this.c_arbiters_false,n=null)):(e=(n=e).next,i&&null==e&&(i=!1,e=this.c_arbiters_false.head,t=this.c_arbiters_false,n=null))}for(var a=null,s=this.f_arbiters,_=s.head;null!=_;){var h,u,x,d=_.elt;d.b1.component.sleeping&&d.b2.component.sleeping?(d.sleep_stamp=this.stamp,d.sleeping=!0,null==a?(u=(h=s.head).next,s.head=u,null==s.head&&(s.pushmod=!0)):(u=(h=a.next).next,null==(a.next=u)&&(s.pushmod=!0)),(x=h).elt=null,x.next=Kl.zpp_pool,Kl.zpp_pool=x,s.modified=!0,s.length--,s.pushmod=!0,_=u):_=(a=_).next}for(var y=null,z=this.s_arbiters,c=z.head;null!=c;){var v,m,f,b=c.elt;b.b1.component.sleeping&&b.b2.component.sleeping?(b.sleep_stamp=this.stamp,b.sleeping=!0,null==y?(m=(v=z.head).next,z.head=m,null==z.head&&(z.pushmod=!0)):(m=(v=y.next).next,null==(y.next=m)&&(z.pushmod=!0)),(f=v).elt=null,f.next=Wl.zpp_pool,Wl.zpp_pool=f,z.modified=!0,z.length--,z.pushmod=!0,c=m):c=(y=c).next}},ae.prototype.static_validation=function(n){if(null!=n.shapes.head&&n.zip_aabb){n.zip_aabb=!1,n.aabb.minx=1/0,n.aabb.miny=1/0,n.aabb.maxx=-1/0,n.aabb.maxy=-1/0;for(var t=n.shapes.head;null!=t;){var e=t.elt;if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var i=e.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var p=i.polygon;if(null==p.lverts.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y;else if(null==p.lverts.next.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y,p.localCOMx+=p.lverts.next.next.x,p.localCOMy+=p.lverts.next.next.y,p.localCOMx*=.5,p.localCOMy*=.5;else{p.localCOMx=0;var l=p.localCOMy=0,r=p.lverts.next,o=r,a=r=r.next;for(r=r.next;null!=r;){var s=r;l+=a.x*(s.y-o.y);var _=s.y*a.x-s.x*a.y;p.localCOMx+=(a.x+s.x)*_,p.localCOMy+=(a.y+s.y)*_,o=a,a=s,r=r.next}var h=r=p.lverts.next;l+=a.x*(h.y-o.y);var u=h.y*a.x-h.x*a.y;p.localCOMx+=(a.x+h.x)*u,p.localCOMy+=(a.y+h.y)*u,o=a;var x=r=r.next;l+=h.x*(x.y-o.y);var d=x.y*h.x-x.x*h.y;p.localCOMx+=(h.x+x.x)*d,p.localCOMy+=(h.y+x.y)*d;var y=l=1/(3*l);p.localCOMx*=y,p.localCOMy*=y}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var z=i.body;z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var c=i.radius,v=i.radius;i.aabb.minx=i.worldCOMx-c,i.aabb.miny=i.worldCOMy-v,i.aabb.maxx=i.worldCOMx+c,i.aabb.maxy=i.worldCOMy+v}else{var m=e.polygon;if(m.zip_gverts&&null!=m.body){m.zip_gverts=!1,m.validate_lverts();var f=m.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot));for(var b=m.lverts.next,g=m.gverts.next;null!=g;){var w=g,M=b,b=b.next;w.x=m.body.posx+(m.body.axisy*M.x-m.body.axisx*M.y),w.y=m.body.posy+(M.x*m.body.axisx+M.y*m.body.axisy),g=g.next}}var C=m.gverts.next;m.aabb.minx=C.x,m.aabb.miny=C.y,m.aabb.maxx=C.x,m.aabb.maxy=C.y;for(var k=m.gverts.next.next;null!=k;){var O=k;O.x<m.aabb.minx&&(m.aabb.minx=O.x),O.x>m.aabb.maxx&&(m.aabb.maxx=O.x),O.y<m.aabb.miny&&(m.aabb.miny=O.y),O.y>m.aabb.maxy&&(m.aabb.maxy=O.y),k=k.next}}var P=n.aabb,S=e.aabb;S.minx<P.minx&&(P.minx=S.minx),S.maxx>P.maxx&&(P.maxx=S.maxx),S.miny<P.miny&&(P.miny=S.miny),S.maxy>P.maxy&&(P.maxy=S.maxy),t=t.next}}n.validate_mass(),n.validate_inertia();for(var A=n.shapes.head;null!=A;){var j=A.elt;if(1==j.type){var E=j.polygon;E.zip_sanitation&&(E.zip_sanitation=!1,E.splice_collinear_real());var I=j.polygon;if(I.zip_gaxi&&null!=I.body){I.zip_gaxi=!1,I.validate_laxi();var T=I.body;if(T.zip_axis&&(T.zip_axis=!1,T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot)),I.zip_gverts&&null!=I.body){I.zip_gverts=!1,I.validate_lverts();var N=I.body;N.zip_axis&&(N.zip_axis=!1,N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot));for(var L=I.lverts.next,V=I.gverts.next;null!=V;){var D=V,F=L,L=L.next;D.x=I.body.posx+(I.body.axisy*F.x-I.body.axisx*F.y),D.y=I.body.posy+(F.x*I.body.axisx+F.y*I.body.axisy),V=V.next}}for(var R=I.edges.head,Z=B=I.gverts.next,B=B.next;null!=B;){var G=B,q=R.elt,R=R.next;q.gp0=Z,q.gp1=G,q.gnormx=I.body.axisy*q.lnormx-I.body.axisx*q.lnormy,q.gnormy=q.lnormx*I.body.axisx+q.lnormy*I.body.axisy,q.gprojection=I.body.posx*q.gnormx+I.body.posy*q.gnormy+q.lprojection,null!=q.wrap_gnorm&&(q.wrap_gnorm.zpp_inner.x=q.gnormx,q.wrap_gnorm.zpp_inner.y=q.gnormy),q.tp0=q.gp0.y*q.gnormx-q.gp0.x*q.gnormy,q.tp1=q.gp1.y*q.gnormx-q.gp1.x*q.gnormy,Z=G,B=B.next}var U=R.elt;U.gp0=Z,U.gp1=I.gverts.next,U.gnormx=I.body.axisy*U.lnormx-I.body.axisx*U.lnormy,U.gnormy=U.lnormx*I.body.axisx+U.lnormy*I.body.axisy,U.gprojection=I.body.posx*U.gnormx+I.body.posy*U.gnormy+U.lprojection,null!=U.wrap_gnorm&&(U.wrap_gnorm.zpp_inner.x=U.gnormx,U.wrap_gnorm.zpp_inner.y=U.gnormy),U.tp0=U.gp0.y*U.gnormx-U.gp0.x*U.gnormy,U.tp1=U.gp1.y*U.gnormx-U.gp1.x*U.gnormy}}A=A.next}n.sweepFrozen=!0},ae.prototype.validation=function(){var n=this.cbsets;if(!n.cbsets.empty()){for(var t=n.cbsets.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data.validate(),null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}for(var e=this.live.head;null!=e;){var i=e.elt;i.sweepRadius=0;for(var p=i.shapes.head;null!=p;){var l=p.elt;if(1==l.type){var r=l.polygon;r.zip_sanitation&&(r.zip_sanitation=!1,r.splice_collinear_real());var o=l.polygon;if(o.zip_gaxi&&null!=o.body){o.zip_gaxi=!1,o.validate_laxi();var a=o.body;if(a.zip_axis&&(a.zip_axis=!1,a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)),o.zip_gverts&&null!=o.body){o.zip_gverts=!1,o.validate_lverts();var s=o.body;s.zip_axis&&(s.zip_axis=!1,s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot));for(var _=o.lverts.next,h=o.gverts.next;null!=h;){var u=h,x=_,_=_.next;u.x=o.body.posx+(o.body.axisy*x.x-o.body.axisx*x.y),u.y=o.body.posy+(x.x*o.body.axisx+x.y*o.body.axisy),h=h.next}}for(var d=o.edges.head,y=z=o.gverts.next,z=z.next;null!=z;){var c=z,v=d.elt,d=d.next;v.gp0=y,v.gp1=c,v.gnormx=o.body.axisy*v.lnormx-o.body.axisx*v.lnormy,v.gnormy=v.lnormx*o.body.axisx+v.lnormy*o.body.axisy,v.gprojection=o.body.posx*v.gnormx+o.body.posy*v.gnormy+v.lprojection,null!=v.wrap_gnorm&&(v.wrap_gnorm.zpp_inner.x=v.gnormx,v.wrap_gnorm.zpp_inner.y=v.gnormy),v.tp0=v.gp0.y*v.gnormx-v.gp0.x*v.gnormy,v.tp1=v.gp1.y*v.gnormx-v.gp1.x*v.gnormy,y=c,z=z.next}var m=d.elt;m.gp0=y,m.gp1=o.gverts.next,m.gnormx=o.body.axisy*m.lnormx-o.body.axisx*m.lnormy,m.gnormy=m.lnormx*o.body.axisx+m.lnormy*o.body.axisy,m.gprojection=o.body.posx*m.gnormx+o.body.posy*m.gnormy+m.lprojection,null!=m.wrap_gnorm&&(m.wrap_gnorm.zpp_inner.x=m.gnormx,m.wrap_gnorm.zpp_inner.y=m.gnormy),m.tp0=m.gp0.y*m.gnormx-m.gp0.x*m.gnormy,m.tp1=m.gp1.y*m.gnormx-m.gp1.x*m.gnormy}}l.validate_sweepRadius(),l.sweepRadius>i.sweepRadius&&(i.sweepRadius=l.sweepRadius),p=p.next}if(i.validate_mass(),i.validate_inertia(),null!=i.shapes.head){if(i.zip_aabb){i.zip_aabb=!1,i.aabb.minx=1/0,i.aabb.miny=1/0,i.aabb.maxx=-1/0,i.aabb.maxy=-1/0;for(var f=i.shapes.head;null!=f;){var b=f.elt;if(b.zip_aabb&&null!=b.body)if(b.zip_aabb=!1,0==b.type){var g=b.circle;if(g.zip_worldCOM&&null!=g.body){if(g.zip_worldCOM=!1,g.zip_localCOM){if(g.zip_localCOM=!1,1==g.type){var w=g.polygon;if(null==w.lverts.next.next)w.localCOMx=w.lverts.next.x,w.localCOMy=w.lverts.next.y;else if(null==w.lverts.next.next.next)w.localCOMx=w.lverts.next.x,w.localCOMy=w.lverts.next.y,w.localCOMx+=w.lverts.next.next.x,w.localCOMy+=w.lverts.next.next.y,w.localCOMx*=.5,w.localCOMy*=.5;else{w.localCOMx=0;var M=w.localCOMy=0,C=w.lverts.next,k=C,O=C=C.next;for(C=C.next;null!=C;){var P=C;M+=O.x*(P.y-k.y);var S=P.y*O.x-P.x*O.y;w.localCOMx+=(O.x+P.x)*S,w.localCOMy+=(O.y+P.y)*S,k=O,O=P,C=C.next}var A=C=w.lverts.next;M+=O.x*(A.y-k.y);var j=A.y*O.x-A.x*O.y;w.localCOMx+=(O.x+A.x)*j,w.localCOMy+=(O.y+A.y)*j,k=O;var E=C=C.next;M+=A.x*(E.y-k.y);var I=E.y*A.x-E.x*A.y;w.localCOMx+=(A.x+E.x)*I,w.localCOMy+=(A.y+E.y)*I;var T=M=1/(3*M);w.localCOMx*=T,w.localCOMy*=T}}null!=g.wrap_localCOM&&(g.wrap_localCOM.zpp_inner.x=g.localCOMx,g.wrap_localCOM.zpp_inner.y=g.localCOMy)}var N=g.body;N.zip_axis&&(N.zip_axis=!1,N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot)),g.worldCOMx=g.body.posx+(g.body.axisy*g.localCOMx-g.body.axisx*g.localCOMy),g.worldCOMy=g.body.posy+(g.localCOMx*g.body.axisx+g.localCOMy*g.body.axisy)}var L=g.radius,V=g.radius;g.aabb.minx=g.worldCOMx-L,g.aabb.miny=g.worldCOMy-V,g.aabb.maxx=g.worldCOMx+L,g.aabb.maxy=g.worldCOMy+V}else{var D=b.polygon;if(D.zip_gverts&&null!=D.body){D.zip_gverts=!1,D.validate_lverts();var F=D.body;F.zip_axis&&(F.zip_axis=!1,F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot));for(var R=D.lverts.next,Z=D.gverts.next;null!=Z;){var B=Z,G=R,R=R.next;B.x=D.body.posx+(D.body.axisy*G.x-D.body.axisx*G.y),B.y=D.body.posy+(G.x*D.body.axisx+G.y*D.body.axisy),Z=Z.next}}var q=D.gverts.next;D.aabb.minx=q.x,D.aabb.miny=q.y,D.aabb.maxx=q.x,D.aabb.maxy=q.y;for(var U=D.gverts.next.next;null!=U;){var K=U;K.x<D.aabb.minx&&(D.aabb.minx=K.x),K.x>D.aabb.maxx&&(D.aabb.maxx=K.x),K.y<D.aabb.miny&&(D.aabb.miny=K.y),K.y>D.aabb.maxy&&(D.aabb.maxy=K.y),U=U.next}}var W=i.aabb,Y=b.aabb;Y.minx<W.minx&&(W.minx=Y.minx),Y.maxx>W.maxx&&(W.maxx=Y.maxx),Y.miny<W.miny&&(W.miny=Y.miny),Y.maxy>W.maxy&&(W.maxy=Y.maxy),f=f.next}}i.validate_worldCOM()}if(i.validate_gravMass(),i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)),i.component.woken&&null!=i.cbSet)for(var J=i.cbSet.bodylisteners.head;null!=J;){var X,H=J.elt;2==H.event?((X=this.push_callback(H)).event=2,X.body=i,J=J.next):J=J.next}i.component.woken=!1;for(var $=i.shapes.head;null!=$;)this.bphase.sync($.elt),$=$.next;e=e.next}for(var Q=this.kinematics.head;null!=Q;){var nn=Q.elt;nn.sweepRadius=0;for(var tn=nn.shapes.head;null!=tn;){var en=tn.elt;if(1==en.type){var pn=en.polygon;pn.zip_sanitation&&(pn.zip_sanitation=!1,pn.splice_collinear_real());var ln=en.polygon;if(ln.zip_gaxi&&null!=ln.body){ln.zip_gaxi=!1,ln.validate_laxi();var rn=ln.body;if(rn.zip_axis&&(rn.zip_axis=!1,rn.axisx=Math.sin(rn.rot),rn.axisy=Math.cos(rn.rot)),ln.zip_gverts&&null!=ln.body){ln.zip_gverts=!1,ln.validate_lverts();var on=ln.body;on.zip_axis&&(on.zip_axis=!1,on.axisx=Math.sin(on.rot),on.axisy=Math.cos(on.rot));for(var an=ln.lverts.next,sn=ln.gverts.next;null!=sn;){var _n=sn,hn=an,an=an.next;_n.x=ln.body.posx+(ln.body.axisy*hn.x-ln.body.axisx*hn.y),_n.y=ln.body.posy+(hn.x*ln.body.axisx+hn.y*ln.body.axisy),sn=sn.next}}for(var un=ln.edges.head,xn=dn=ln.gverts.next,dn=dn.next;null!=dn;){var yn=dn,zn=un.elt,un=un.next;zn.gp0=xn,zn.gp1=yn,zn.gnormx=ln.body.axisy*zn.lnormx-ln.body.axisx*zn.lnormy,zn.gnormy=zn.lnormx*ln.body.axisx+zn.lnormy*ln.body.axisy,zn.gprojection=ln.body.posx*zn.gnormx+ln.body.posy*zn.gnormy+zn.lprojection,null!=zn.wrap_gnorm&&(zn.wrap_gnorm.zpp_inner.x=zn.gnormx,zn.wrap_gnorm.zpp_inner.y=zn.gnormy),zn.tp0=zn.gp0.y*zn.gnormx-zn.gp0.x*zn.gnormy,zn.tp1=zn.gp1.y*zn.gnormx-zn.gp1.x*zn.gnormy,xn=yn,dn=dn.next}var cn=un.elt;cn.gp0=xn,cn.gp1=ln.gverts.next,cn.gnormx=ln.body.axisy*cn.lnormx-ln.body.axisx*cn.lnormy,cn.gnormy=cn.lnormx*ln.body.axisx+cn.lnormy*ln.body.axisy,cn.gprojection=ln.body.posx*cn.gnormx+ln.body.posy*cn.gnormy+cn.lprojection,null!=cn.wrap_gnorm&&(cn.wrap_gnorm.zpp_inner.x=cn.gnormx,cn.wrap_gnorm.zpp_inner.y=cn.gnormy),cn.tp0=cn.gp0.y*cn.gnormx-cn.gp0.x*cn.gnormy,cn.tp1=cn.gp1.y*cn.gnormx-cn.gp1.x*cn.gnormy}}en.validate_sweepRadius(),en.sweepRadius>nn.sweepRadius&&(nn.sweepRadius=en.sweepRadius),tn=tn.next}if(nn.validate_mass(),nn.validate_inertia(),null!=nn.shapes.head){if(nn.zip_aabb){nn.zip_aabb=!1,nn.aabb.minx=1/0,nn.aabb.miny=1/0,nn.aabb.maxx=-1/0,nn.aabb.maxy=-1/0;for(var vn=nn.shapes.head;null!=vn;){var mn=vn.elt;if(mn.zip_aabb&&null!=mn.body)if(mn.zip_aabb=!1,0==mn.type){var fn=mn.circle;if(fn.zip_worldCOM&&null!=fn.body){if(fn.zip_worldCOM=!1,fn.zip_localCOM){if(fn.zip_localCOM=!1,1==fn.type){var bn=fn.polygon;if(null==bn.lverts.next.next)bn.localCOMx=bn.lverts.next.x,bn.localCOMy=bn.lverts.next.y;else if(null==bn.lverts.next.next.next)bn.localCOMx=bn.lverts.next.x,bn.localCOMy=bn.lverts.next.y,bn.localCOMx+=bn.lverts.next.next.x,bn.localCOMy+=bn.lverts.next.next.y,bn.localCOMx*=.5,bn.localCOMy*=.5;else{bn.localCOMx=0;var gn=bn.localCOMy=0,wn=bn.lverts.next,Mn=wn,Cn=wn=wn.next;for(wn=wn.next;null!=wn;){var kn=wn;gn+=Cn.x*(kn.y-Mn.y);var On=kn.y*Cn.x-kn.x*Cn.y;bn.localCOMx+=(Cn.x+kn.x)*On,bn.localCOMy+=(Cn.y+kn.y)*On,Mn=Cn,Cn=kn,wn=wn.next}var Pn=wn=bn.lverts.next;gn+=Cn.x*(Pn.y-Mn.y);var Sn=Pn.y*Cn.x-Pn.x*Cn.y;bn.localCOMx+=(Cn.x+Pn.x)*Sn,bn.localCOMy+=(Cn.y+Pn.y)*Sn,Mn=Cn;var An=wn=wn.next;gn+=Pn.x*(An.y-Mn.y);var jn=An.y*Pn.x-An.x*Pn.y;bn.localCOMx+=(Pn.x+An.x)*jn,bn.localCOMy+=(Pn.y+An.y)*jn;var En=gn=1/(3*gn);bn.localCOMx*=En,bn.localCOMy*=En}}null!=fn.wrap_localCOM&&(fn.wrap_localCOM.zpp_inner.x=fn.localCOMx,fn.wrap_localCOM.zpp_inner.y=fn.localCOMy)}var In=fn.body;In.zip_axis&&(In.zip_axis=!1,In.axisx=Math.sin(In.rot),In.axisy=Math.cos(In.rot)),fn.worldCOMx=fn.body.posx+(fn.body.axisy*fn.localCOMx-fn.body.axisx*fn.localCOMy),fn.worldCOMy=fn.body.posy+(fn.localCOMx*fn.body.axisx+fn.localCOMy*fn.body.axisy)}var Tn=fn.radius,Nn=fn.radius;fn.aabb.minx=fn.worldCOMx-Tn,fn.aabb.miny=fn.worldCOMy-Nn,fn.aabb.maxx=fn.worldCOMx+Tn,fn.aabb.maxy=fn.worldCOMy+Nn}else{var Ln=mn.polygon;if(Ln.zip_gverts&&null!=Ln.body){Ln.zip_gverts=!1,Ln.validate_lverts();var Vn=Ln.body;Vn.zip_axis&&(Vn.zip_axis=!1,Vn.axisx=Math.sin(Vn.rot),Vn.axisy=Math.cos(Vn.rot));for(var Dn=Ln.lverts.next,Fn=Ln.gverts.next;null!=Fn;){var Rn=Fn,Zn=Dn,Dn=Dn.next;Rn.x=Ln.body.posx+(Ln.body.axisy*Zn.x-Ln.body.axisx*Zn.y),Rn.y=Ln.body.posy+(Zn.x*Ln.body.axisx+Zn.y*Ln.body.axisy),Fn=Fn.next}}var Bn=Ln.gverts.next;Ln.aabb.minx=Bn.x,Ln.aabb.miny=Bn.y,Ln.aabb.maxx=Bn.x,Ln.aabb.maxy=Bn.y;for(var Gn=Ln.gverts.next.next;null!=Gn;){var qn=Gn;qn.x<Ln.aabb.minx&&(Ln.aabb.minx=qn.x),qn.x>Ln.aabb.maxx&&(Ln.aabb.maxx=qn.x),qn.y<Ln.aabb.miny&&(Ln.aabb.miny=qn.y),qn.y>Ln.aabb.maxy&&(Ln.aabb.maxy=qn.y),Gn=Gn.next}}var Un=nn.aabb,Kn=mn.aabb;Kn.minx<Un.minx&&(Un.minx=Kn.minx),Kn.maxx>Un.maxx&&(Un.maxx=Kn.maxx),Kn.miny<Un.miny&&(Un.miny=Kn.miny),Kn.maxy>Un.maxy&&(Un.maxy=Kn.maxy),vn=vn.next}}nn.validate_worldCOM()}nn.validate_gravMass(),nn.zip_axis&&(nn.zip_axis=!1,nn.axisx=Math.sin(nn.rot),nn.axisy=Math.cos(nn.rot));for(var Wn=nn.shapes.head;null!=Wn;)this.bphase.sync(Wn.elt),Wn=Wn.next;Q=Q.next}for(var Yn=this.live_constraints.head;null!=Yn;){var Jn=Yn.elt;if(Jn.active){if(Jn.component.woken&&null!=Jn.cbSet)for(var Xn=Jn.cbSet.conlisteners.head;null!=Xn;){var Hn,$n=Xn.elt;2==$n.event?((Hn=this.push_callback($n)).event=2,Hn.constraint=Jn,Xn=Xn.next):Xn=Xn.next}Jn.component.woken=!1}Yn=Yn.next}},ae.prototype.updateVel=function(n){for(var t=1-n*this.global_lin_drag,e=1-n*this.global_ang_drag,i=this.live.head;null!=i;){var p,l,r,o=i.elt;0!=o.smass&&(p=n*o.imass,o.velx=t*o.velx+(o.forcex+this.gravityx*o.gravMass)*p,o.vely=t*o.vely+(o.forcey+this.gravityy*o.gravMass)*p),0!=o.sinertia&&(r=l=0,l=o.worldCOMx-o.posx,r=o.worldCOMy-o.posy,o.angvel=e*o.angvel+(o.torque+(this.gravityy*l-this.gravityx*r)*o.gravMass)*n*o.iinertia),i=i.next}},ae.prototype.updatePos=function(n){for(var t=2*Math.PI/n,e=this.live.head;null!=e;){var i=e.elt;i.pre_posx=i.posx,i.pre_posy=i.posy,i.pre_rot=i.rot,i.sweepTime=0,i.sweep_angvel=i.angvel%t;var p,l,r,o,a,s=n-i.sweepTime;if(0!=s&&(i.sweepTime=n,i.posx+=i.velx*s,i.posy+=i.vely*s,0!=i.angvel&&(p=i.sweep_angvel*s,i.rot+=p,1e-4<p*p?(i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)):(o=1-(l=p*p)*l/8,a=((r=1-.5*l)*i.axisx+p*i.axisy)*o,i.axisy=(r*i.axisy-p*i.axisx)*o,i.axisx=a))),i.disableCCD)i.sweepFrozen=!0,i.bullet=!1;else{var _=co.staticCCDLinearThreshold*i.sweepRadius,h=co.staticCCDAngularThreshold;if((i.velx*i.velx+i.vely*i.vely)*n*n>_*_||i.angvel*i.angvel*n*n>h*h||3==i.type){var u=i.sweep_angvel;u<0&&(u=-u);for(var x,d,y=1/u,z=i.shapes.head;null!=z;){var c=z.elt,v=c.aabb,m=v.minx,f=v.miny,b=v.maxx,g=v.maxy,w=u*n*c.sweepCoef*.008333333333333333|0;8<w&&(w=8);var M,C,k,O,P,S=u*n/w,A=n-i.sweepTime;if(0!=A&&(i.sweepTime=n,i.posx+=i.velx*A,i.posy+=i.vely*A,0!=i.angvel&&(M=i.sweep_angvel*A,i.rot+=M,1e-4<M*M?(i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)):(O=1-(C=M*M)*C/8,P=((k=1-.5*C)*i.axisx+M*i.axisy)*O,i.axisy=(k*i.axisy-M*i.axisx)*O,i.axisx=P))),0==c.type){var j=c.circle;j.worldCOMx=j.body.posx+(j.body.axisy*j.localCOMx-j.body.axisx*j.localCOMy),j.worldCOMy=j.body.posy+(j.localCOMx*j.body.axisx+j.localCOMy*j.body.axisy),j.aabb.minx=j.worldCOMx-j.radius,j.aabb.miny=j.worldCOMy-j.radius,j.aabb.maxx=j.worldCOMx+j.radius,j.aabb.maxy=j.worldCOMy+j.radius}else{var E=c.polygon,I=E.lverts.next,T=E.gverts.next,N=I;I=I.next,T.x=E.body.posx+(E.body.axisy*N.x-E.body.axisx*N.y),T.y=E.body.posy+(N.x*E.body.axisx+N.y*E.body.axisy),E.aabb.minx=T.x,E.aabb.miny=T.y,E.aabb.maxx=T.x,E.aabb.maxy=T.y;for(var L=E.gverts.next.next;null!=L;){var V=L,D=I,I=I.next;V.x=E.body.posx+(E.body.axisy*D.x-E.body.axisx*D.y),V.y=E.body.posy+(D.x*E.body.axisx+D.y*E.body.axisy),V.x<E.aabb.minx&&(E.aabb.minx=V.x),V.x>E.aabb.maxx&&(E.aabb.maxx=V.x),V.y<E.aabb.miny&&(E.aabb.miny=V.y),V.y>E.aabb.maxy&&(E.aabb.maxy=V.y),L=L.next}}m<v.minx?v.minx=m:m=v.minx,f<v.miny?v.miny=f:f=v.miny,b>v.maxx?v.maxx=b:b=v.maxx,g>v.maxy?v.maxy=g:g=v.maxy;for(var F=1,R=w;F<R;){var Z,B,G,q,U,K=S*F++*y,W=K-i.sweepTime;if(0!=W&&(i.sweepTime=K,i.posx+=i.velx*W,i.posy+=i.vely*W,0!=i.angvel&&(Z=i.sweep_angvel*W,i.rot+=Z,1e-4<Z*Z?(i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)):(q=1-(B=Z*Z)*B/8,U=((G=1-.5*B)*i.axisx+Z*i.axisy)*q,i.axisy=(G*i.axisy-Z*i.axisx)*q,i.axisx=U))),0==c.type){var Y=c.circle;Y.worldCOMx=Y.body.posx+(Y.body.axisy*Y.localCOMx-Y.body.axisx*Y.localCOMy),Y.worldCOMy=Y.body.posy+(Y.localCOMx*Y.body.axisx+Y.localCOMy*Y.body.axisy),Y.aabb.minx=Y.worldCOMx-Y.radius,Y.aabb.miny=Y.worldCOMy-Y.radius,Y.aabb.maxx=Y.worldCOMx+Y.radius,Y.aabb.maxy=Y.worldCOMy+Y.radius}else{var J=c.polygon,X=J.lverts.next,H=J.gverts.next,$=X;X=X.next,H.x=J.body.posx+(J.body.axisy*$.x-J.body.axisx*$.y),H.y=J.body.posy+($.x*J.body.axisx+$.y*J.body.axisy),J.aabb.minx=H.x,J.aabb.miny=H.y,J.aabb.maxx=H.x,J.aabb.maxy=H.y;for(var Q=J.gverts.next.next;null!=Q;){var nn=Q,tn=X,X=X.next;nn.x=J.body.posx+(J.body.axisy*tn.x-J.body.axisx*tn.y),nn.y=J.body.posy+(tn.x*J.body.axisx+tn.y*J.body.axisy),nn.x<J.aabb.minx&&(J.aabb.minx=nn.x),nn.x>J.aabb.maxx&&(J.aabb.maxx=nn.x),nn.y<J.aabb.miny&&(J.aabb.miny=nn.y),nn.y>J.aabb.maxy&&(J.aabb.maxy=nn.y),Q=Q.next}}m<v.minx?v.minx=m:m=v.minx,f<v.miny?v.miny=f:f=v.miny,b>v.maxx?v.maxx=b:b=v.maxx,g>v.maxy?v.maxy=g:g=v.maxy}this.bphase.sync(c),z=z.next}i.sweepFrozen=!1,2==i.type&&i.bulletEnabled&&(x=co.bulletCCDLinearThreshold*i.sweepRadius,d=co.bulletCCDAngularThreshold,((i.velx*i.velx+i.vely*i.vely)*n*n>x*x||i.angvel*i.angvel*n*n>d*d)&&(i.bullet=!0))}else i.sweepFrozen=!0,i.bullet=!1}e=e.next}for(var en=this.kinematics.head;null!=en;){var pn=en.elt;pn.pre_posx=pn.posx,pn.pre_posy=pn.posy,pn.pre_rot=pn.rot,pn.sweepTime=0,pn.sweep_angvel=pn.angvel%t;var ln,rn,on,an,sn,_n=n-pn.sweepTime;if(0!=_n&&(pn.sweepTime=n,pn.posx+=pn.velx*_n,pn.posy+=pn.vely*_n,0!=pn.angvel&&(ln=pn.sweep_angvel*_n,pn.rot+=ln,1e-4<ln*ln?(pn.axisx=Math.sin(pn.rot),pn.axisy=Math.cos(pn.rot)):(an=1-(rn=ln*ln)*rn/8,sn=((on=1-.5*rn)*pn.axisx+ln*pn.axisy)*an,pn.axisy=(on*pn.axisy-ln*pn.axisx)*an,pn.axisx=sn))),pn.disableCCD)pn.sweepFrozen=!0,pn.bullet=!1;else{var hn=co.staticCCDLinearThreshold*pn.sweepRadius,un=co.staticCCDAngularThreshold;if((pn.velx*pn.velx+pn.vely*pn.vely)*n*n>hn*hn||pn.angvel*pn.angvel*n*n>un*un||3==pn.type){var xn=pn.sweep_angvel;xn<0&&(xn=-xn);for(var dn,yn,zn=1/xn,cn=pn.shapes.head;null!=cn;){var vn=cn.elt,mn=vn.aabb,fn=mn.minx,bn=mn.miny,gn=mn.maxx,wn=mn.maxy,Mn=xn*n*vn.sweepCoef*.008333333333333333|0;8<Mn&&(Mn=8);var Cn,kn,On,Pn,Sn,An=xn*n/Mn,jn=n-pn.sweepTime;if(0!=jn&&(pn.sweepTime=n,pn.posx+=pn.velx*jn,pn.posy+=pn.vely*jn,0!=pn.angvel&&(Cn=pn.sweep_angvel*jn,pn.rot+=Cn,1e-4<Cn*Cn?(pn.axisx=Math.sin(pn.rot),pn.axisy=Math.cos(pn.rot)):(Pn=1-(kn=Cn*Cn)*kn/8,Sn=((On=1-.5*kn)*pn.axisx+Cn*pn.axisy)*Pn,pn.axisy=(On*pn.axisy-Cn*pn.axisx)*Pn,pn.axisx=Sn))),0==vn.type){var En=vn.circle;En.worldCOMx=En.body.posx+(En.body.axisy*En.localCOMx-En.body.axisx*En.localCOMy),En.worldCOMy=En.body.posy+(En.localCOMx*En.body.axisx+En.localCOMy*En.body.axisy),En.aabb.minx=En.worldCOMx-En.radius,En.aabb.miny=En.worldCOMy-En.radius,En.aabb.maxx=En.worldCOMx+En.radius,En.aabb.maxy=En.worldCOMy+En.radius}else{var In=vn.polygon,Tn=In.lverts.next,Nn=In.gverts.next,Ln=Tn;Tn=Tn.next,Nn.x=In.body.posx+(In.body.axisy*Ln.x-In.body.axisx*Ln.y),Nn.y=In.body.posy+(Ln.x*In.body.axisx+Ln.y*In.body.axisy),In.aabb.minx=Nn.x,In.aabb.miny=Nn.y,In.aabb.maxx=Nn.x,In.aabb.maxy=Nn.y;for(var Vn=In.gverts.next.next;null!=Vn;){var Dn=Vn,Fn=Tn,Tn=Tn.next;Dn.x=In.body.posx+(In.body.axisy*Fn.x-In.body.axisx*Fn.y),Dn.y=In.body.posy+(Fn.x*In.body.axisx+Fn.y*In.body.axisy),Dn.x<In.aabb.minx&&(In.aabb.minx=Dn.x),Dn.x>In.aabb.maxx&&(In.aabb.maxx=Dn.x),Dn.y<In.aabb.miny&&(In.aabb.miny=Dn.y),Dn.y>In.aabb.maxy&&(In.aabb.maxy=Dn.y),Vn=Vn.next}}fn<mn.minx?mn.minx=fn:fn=mn.minx,bn<mn.miny?mn.miny=bn:bn=mn.miny,gn>mn.maxx?mn.maxx=gn:gn=mn.maxx,wn>mn.maxy?mn.maxy=wn:wn=mn.maxy;for(var Rn=1,Zn=Mn;Rn<Zn;){var Bn,Gn,qn,Un,Kn,Wn=An*Rn++*zn,Yn=Wn-pn.sweepTime;if(0!=Yn&&(pn.sweepTime=Wn,pn.posx+=pn.velx*Yn,pn.posy+=pn.vely*Yn,0!=pn.angvel&&(Bn=pn.sweep_angvel*Yn,pn.rot+=Bn,1e-4<Bn*Bn?(pn.axisx=Math.sin(pn.rot),pn.axisy=Math.cos(pn.rot)):(Un=1-(Gn=Bn*Bn)*Gn/8,Kn=((qn=1-.5*Gn)*pn.axisx+Bn*pn.axisy)*Un,pn.axisy=(qn*pn.axisy-Bn*pn.axisx)*Un,pn.axisx=Kn))),0==vn.type){var Jn=vn.circle;Jn.worldCOMx=Jn.body.posx+(Jn.body.axisy*Jn.localCOMx-Jn.body.axisx*Jn.localCOMy),Jn.worldCOMy=Jn.body.posy+(Jn.localCOMx*Jn.body.axisx+Jn.localCOMy*Jn.body.axisy),Jn.aabb.minx=Jn.worldCOMx-Jn.radius,Jn.aabb.miny=Jn.worldCOMy-Jn.radius,Jn.aabb.maxx=Jn.worldCOMx+Jn.radius,Jn.aabb.maxy=Jn.worldCOMy+Jn.radius}else{var Xn=vn.polygon,Hn=Xn.lverts.next,$n=Xn.gverts.next,Qn=Hn;Hn=Hn.next,$n.x=Xn.body.posx+(Xn.body.axisy*Qn.x-Xn.body.axisx*Qn.y),$n.y=Xn.body.posy+(Qn.x*Xn.body.axisx+Qn.y*Xn.body.axisy),Xn.aabb.minx=$n.x,Xn.aabb.miny=$n.y,Xn.aabb.maxx=$n.x,Xn.aabb.maxy=$n.y;for(var nt=Xn.gverts.next.next;null!=nt;){var tt=nt,et=Hn,Hn=Hn.next;tt.x=Xn.body.posx+(Xn.body.axisy*et.x-Xn.body.axisx*et.y),tt.y=Xn.body.posy+(et.x*Xn.body.axisx+et.y*Xn.body.axisy),tt.x<Xn.aabb.minx&&(Xn.aabb.minx=tt.x),tt.x>Xn.aabb.maxx&&(Xn.aabb.maxx=tt.x),tt.y<Xn.aabb.miny&&(Xn.aabb.miny=tt.y),tt.y>Xn.aabb.maxy&&(Xn.aabb.maxy=tt.y),nt=nt.next}}fn<mn.minx?mn.minx=fn:fn=mn.minx,bn<mn.miny?mn.miny=bn:bn=mn.miny,gn>mn.maxx?mn.maxx=gn:gn=mn.maxx,wn>mn.maxy?mn.maxy=wn:wn=mn.maxy}this.bphase.sync(vn),cn=cn.next}pn.sweepFrozen=!1,2==pn.type&&pn.bulletEnabled&&(dn=co.bulletCCDLinearThreshold*pn.sweepRadius,yn=co.bulletCCDAngularThreshold,((pn.velx*pn.velx+pn.vely*pn.vely)*n*n>dn*dn||pn.angvel*pn.angvel*n*n>yn*yn)&&(pn.bullet=!0))}else pn.sweepFrozen=!0,pn.bullet=!1}en=en.next}},ae.prototype.continuous=null,ae.prototype.presteparb=function(n,t,e){null==e&&(e=!1);if(!n.cleared&&n.b1.component.sleeping&&n.b2.component.sleeping)return n.sleep_stamp=this.stamp,n.sleeping=!0;if(!n.cleared||0!=n.present||n.intchange){var i=!e&&n.up_stamp==this.stamp-1&&!n.cleared&&!n.intchange,p=n.fresh&&!n.cleared&&!n.intchange;if(i&&(n.endGenerated=this.stamp),p||i||n.cleared||n.intchange){for(var l=n.ws1,r=n.ws2,o=this.mrca1;null!=o.head;){var a=o.head;o.head=a.next,a.elt=null,a.next=Ul.zpp_pool,Ul.zpp_pool=a,null==o.head&&(o.pushmod=!0),o.modified=!0,o.length--}o.pushmod=!0;for(var s,_,h,u,x,d,y,z,c,v,m,f,b,g,w=this.mrca2;null!=w.head;){var M=w.head;w.head=M.next,M.elt=null,M.next=Ul.zpp_pool,Ul.zpp_pool=M,null==w.head&&(w.pushmod=!0),w.modified=!0,w.length--}w.pushmod=!0,null!=l.cbSet&&(s=this.mrca1,null==Ul.zpp_pool?_=new Ul:(_=Ul.zpp_pool,Ul.zpp_pool=_.next,_.next=null),_.elt=l,(h=_).next=s.head,s.head=h,s.modified=!0,s.length++),null!=l.body.cbSet&&(u=this.mrca1,x=l.body,null==Ul.zpp_pool?d=new Ul:(d=Ul.zpp_pool,Ul.zpp_pool=d.next,d.next=null),d.elt=x,(y=d).next=u.head,u.head=y,u.modified=!0,u.length++),null!=r.cbSet&&(z=this.mrca2,null==Ul.zpp_pool?c=new Ul:(c=Ul.zpp_pool,Ul.zpp_pool=c.next,c.next=null),c.elt=r,(v=c).next=z.head,z.head=v,z.modified=!0,z.length++),null!=r.body.cbSet&&(m=this.mrca2,f=r.body,null==Ul.zpp_pool?b=new Ul:(b=Ul.zpp_pool,Ul.zpp_pool=b.next,b.next=null),b.elt=f,(g=b).next=m.head,m.head=g,m.modified=!0,m.length++);for(var C,k,O,P,S,A,j=l.body.compound,E=r.body.compound;j!=E;){(null==j?0:j.depth)<(null==E?0:E.depth)?(null!=E.cbSet&&(C=this.mrca2,null==Ul.zpp_pool?k=new Ul:(k=Ul.zpp_pool,Ul.zpp_pool=k.next,k.next=null),k.elt=E,(O=k).next=C.head,C.head=O,C.modified=!0,C.length++),E=E.compound):(null!=j.cbSet&&(P=this.mrca1,null==Ul.zpp_pool?S=new Ul:(S=Ul.zpp_pool,Ul.zpp_pool=S.next,S.next=null),S.elt=j,(A=S).next=P.head,P.head=A,P.modified=!0,P.length++),j=j.compound)}for(var I=this.mrca1.head;null!=I;){for(var T=I.elt,N=this.mrca2.head;null!=N;){for(var L,V=N.elt,D=T.cbSet,F=V.cbSet,R=null,Z=(D.cbpairs.length<F.cbpairs.length?D.cbpairs:F.cbpairs).head;null!=Z;){var B=Z.elt;if(B.a==D&&B.b==F||B.a==F&&B.b==D){R=B;break}Z=Z.next}if(null==R&&(null==Nl.zpp_pool?L=new Nl:(L=Nl.zpp_pool,Nl.zpp_pool=L.next,L.next=null),L.zip_listeners=!0,Tl.setlt(D,F)?(L.a=D,L.b=F):(L.a=F,L.b=D),R=L,D.cbpairs.add(R),F!=D&&F.cbpairs.add(R)),R.zip_listeners&&(R.zip_listeners=!1,R.__validate()),null!=R.listeners.head){var G=Zl.get(T,V);if(p||n.intchange){null==G&&(G=Bl.get(T,V),this.add_callbackset(G));for(var q,U=null,K=(D.cbpairs.length<F.cbpairs.length?D.cbpairs:F.cbpairs).head;null!=K;){var W=K.elt;if(W.a==D&&W.b==F||W.a==F&&W.b==D){U=W;break}K=K.next}null==U&&(null==Nl.zpp_pool?q=new Nl:(q=Nl.zpp_pool,Nl.zpp_pool=q.next,q.next=null),q.zip_listeners=!0,Tl.setlt(D,F)?(q.a=D,q.b=F):(q.a=F,q.b=D),U=q,D.cbpairs.add(U),F!=D&&F.cbpairs.add(U)),U.zip_listeners&&(U.zip_listeners=!1,U.__validate());for(var Y,J=U.listeners.head;null!=J;){var X,H,$,Q,nn,tn,en,pn=J.elt;0==pn.event&&0!=(pn.itype&n.type)&&G.empty_arb(pn.itype)&&((X=this.push_callback(pn)).event=0,H=G.int1,$=G.int2,Q=pn.options1,nn=H.cbTypes,!(!Q.nonemptyintersection(nn,Q.includes)||Q.nonemptyintersection(nn,Q.excludes))&&(tn=pn.options2,en=$.cbTypes,!!tn.nonemptyintersection(en,tn.includes)&&!tn.nonemptyintersection(en,tn.excludes))?(X.int1=H,X.int2=$):(X.int1=$,X.int2=H),X.set=G),J=J.next}Y=!1;for(var ln,rn,on,an=G.arbiters.head;null!=an;){if(an.elt==n){Y=!0;break}an=an.next}!Y&&(ln=G.arbiters,null==Gl.zpp_pool?rn=new Gl:(rn=Gl.zpp_pool,Gl.zpp_pool=rn.next,rn.next=null),rn.elt=n,(on=rn).next=ln.head,ln.head=on,ln.modified=!0,ln.length++,!0)&&n.present++}else{n.present--,G.remove_arb(n);for(var sn,_n=null,hn=(D.cbpairs.length<F.cbpairs.length?D.cbpairs:F.cbpairs).head;null!=hn;){var un=hn.elt;if(un.a==D&&un.b==F||un.a==F&&un.b==D){_n=un;break}hn=hn.next}null==_n&&(null==Nl.zpp_pool?sn=new Nl:(sn=Nl.zpp_pool,Nl.zpp_pool=sn.next,sn.next=null),sn.zip_listeners=!0,Tl.setlt(D,F)?(sn.a=D,sn.b=F):(sn.a=F,sn.b=D),_n=sn,D.cbpairs.add(_n),F!=D&&F.cbpairs.add(_n)),_n.zip_listeners&&(_n.zip_listeners=!1,_n.__validate());for(var xn=_n.listeners.head;null!=xn;){var dn,yn,zn,cn,vn,mn,fn,bn=xn.elt;1==bn.event&&0!=(bn.itype&n.type)&&G.empty_arb(bn.itype)&&((dn=this.push_callback(bn)).event=1,yn=G.int1,zn=G.int2,cn=bn.options1,vn=yn.cbTypes,!(!cn.nonemptyintersection(vn,cn.includes)||cn.nonemptyintersection(vn,cn.excludes))&&(mn=bn.options2,fn=zn.cbTypes,!!mn.nonemptyintersection(fn,mn.includes)&&!mn.nonemptyintersection(fn,mn.excludes))?(dn.int1=yn,dn.int2=zn):(dn.int1=zn,dn.int2=yn),dn.set=G),xn=xn.next}null==G.arbiters.head&&this.remove_callbackset(G)}N=N.next}else N=N.next}I=I.next}}n.fresh=!1,n.intchange=!1}if(n.cleared||n.up_stamp+(n.type==ri.COL?co.arbiterExpirationDelay:0)<this.stamp){if(n.type==ri.SENSOR){var gn=n.sensorarb;if(!gn.cleared){for(var wn,Mn,Cn=gn.b1.arbiters,kn=null,On=Cn.head;null!=On;){if(On.elt==gn){null==kn?(Mn=(wn=Cn.head).next,Cn.head=Mn,null==Cn.head&&(Cn.pushmod=!0)):(Mn=(wn=kn.next).next,null==(kn.next=Mn)&&(Cn.pushmod=!0));var Pn=wn;Pn.elt=null,Pn.next=Gl.zpp_pool,Gl.zpp_pool=Pn,Cn.modified=!0,Cn.length--,Cn.pushmod=!0;break}On=(kn=On).next}for(var Sn,An,jn=gn.b2.arbiters,En=null,In=jn.head;null!=In;){if(In.elt==gn){null==En?(An=(Sn=jn.head).next,jn.head=An,null==jn.head&&(jn.pushmod=!0)):(An=(Sn=En.next).next,null==(En.next=An)&&(jn.pushmod=!0));var Tn=Sn;Tn.elt=null,Tn.next=Gl.zpp_pool,Gl.zpp_pool=Tn,jn.modified=!0,jn.length--,jn.pushmod=!0;break}In=(En=In).next}null!=gn.pair&&(gn.pair.arb=null,gn.pair=null)}gn.b1=gn.b2=null,gn.active=!1,gn.intchange=!1,gn.next=Vl.zpp_pool,Vl.zpp_pool=gn}else if(n.type==ri.FLUID){var Nn=n.fluidarb;if(!Nn.cleared){for(var Ln,Vn,Dn=Nn.b1.arbiters,Fn=null,Rn=Dn.head;null!=Rn;){if(Rn.elt==Nn){null==Fn?(Vn=(Ln=Dn.head).next,Dn.head=Vn,null==Dn.head&&(Dn.pushmod=!0)):(Vn=(Ln=Fn.next).next,null==(Fn.next=Vn)&&(Dn.pushmod=!0));var Zn=Ln;Zn.elt=null,Zn.next=Gl.zpp_pool,Gl.zpp_pool=Zn,Dn.modified=!0,Dn.length--,Dn.pushmod=!0;break}Rn=(Fn=Rn).next}for(var Bn,Gn,qn=Nn.b2.arbiters,Un=null,Kn=qn.head;null!=Kn;){if(Kn.elt==Nn){null==Un?(Gn=(Bn=qn.head).next,qn.head=Gn,null==qn.head&&(qn.pushmod=!0)):(Gn=(Bn=Un.next).next,null==(Un.next=Gn)&&(qn.pushmod=!0));var Wn=Bn;Wn.elt=null,Wn.next=Gl.zpp_pool,Gl.zpp_pool=Wn,qn.modified=!0,qn.length--,qn.pushmod=!0;break}Kn=(Un=Kn).next}null!=Nn.pair&&(Nn.pair.arb=null,Nn.pair=null)}Nn.b1=Nn.b2=null,Nn.active=!1,Nn.intchange=!1,Nn.next=Dl.zpp_pool,(Dl.zpp_pool=Nn).pre_dt=-1}else{var Yn=n.colarb;if(!Yn.cleared){for(var Jn,Xn,Hn=Yn.b1.arbiters,$n=null,Qn=Hn.head;null!=Qn;){if(Qn.elt==Yn){null==$n?(Xn=(Jn=Hn.head).next,Hn.head=Xn,null==Hn.head&&(Hn.pushmod=!0)):(Xn=(Jn=$n.next).next,null==($n.next=Xn)&&(Hn.pushmod=!0));var nt=Jn;nt.elt=null,nt.next=Gl.zpp_pool,Gl.zpp_pool=nt,Hn.modified=!0,Hn.length--,Hn.pushmod=!0;break}Qn=($n=Qn).next}for(var tt,et,it=Yn.b2.arbiters,pt=null,lt=it.head;null!=lt;){if(lt.elt==Yn){null==pt?(et=(tt=it.head).next,it.head=et,null==it.head&&(it.pushmod=!0)):(et=(tt=pt.next).next,null==(pt.next=et)&&(it.pushmod=!0));var rt=tt;rt.elt=null,rt.next=Gl.zpp_pool,Gl.zpp_pool=rt,it.modified=!0,it.length--,it.pushmod=!0;break}lt=(pt=lt).next}null!=Yn.pair&&(Yn.pair.arb=null,Yn.pair=null)}for(Yn.b1=Yn.b2=null,Yn.active=!1,Yn.intchange=!1;null!=Yn.contacts.next;){var ot=Yn.contacts,at=ot.next;ot.pop(),at.arbiter=null,at.next=Rl.zpp_pool,Rl.zpp_pool=at;var st=Yn.innards,_t=st.next;st.next=_t.next,_t._inuse=!1,null==st.next&&(st.pushmod=!0),st.modified=!0,st.length--}Yn.userdef_dyn_fric=!1,Yn.userdef_stat_fric=!1,Yn.userdef_restitution=!1,Yn.userdef_rfric=!1,Yn.__ref_edge1=Yn.__ref_edge2=null,Yn.next=Fl.zpp_pool,(Fl.zpp_pool=Yn).pre_dt=-1}return!0}var ht=n.active;if(n.active=n.presentable=n.up_stamp==this.stamp,0!=(1&n.immState)){if(n.active&&n.type!=ri.SENSOR)if(null!=n.colarb){var ut=n.colarb;ut.invalidated&&(ut.invalidated=!1,ut.userdef_restitution||(ut.s1.material.elasticity<=-1/0||ut.s2.material.elasticity<=-1/0?ut.restitution=0:ut.s1.material.elasticity>=1/0||ut.s2.material.elasticity>=1/0?ut.restitution=1:ut.restitution=(ut.s1.material.elasticity+ut.s2.material.elasticity)/2,ut.restitution<0&&(ut.restitution=0),1<ut.restitution&&(ut.restitution=1)),ut.userdef_dyn_fric||(ut.dyn_fric=Math.sqrt(ut.s1.material.dynamicFriction*ut.s2.material.dynamicFriction)),ut.userdef_stat_fric||(ut.stat_fric=Math.sqrt(ut.s1.material.staticFriction*ut.s2.material.staticFriction)),ut.userdef_rfric||(ut.rfric=Math.sqrt(ut.s1.material.rollingFriction*ut.s2.material.rollingFriction))),-1==ut.pre_dt&&(ut.pre_dt=t);var xt=t/ut.pre_dt;ut.pre_dt=t;var dt=ut.b1.smass+ut.b2.smass,yt=!(ut.hc2=!1);ut.biasCoef=2!=ut.b1.type||2!=ut.b2.type?ut.continuous?co.contactContinuousStaticBiasCoef:co.contactStaticBiasCoef:ut.continuous?co.contactContinuousBiasCoef:co.contactBiasCoef,ut.continuous=!1;for(var zt,ct,vt,mt,ft,bt=null,gt=null,wt=ut.innards.next,Mt=ut.contacts.next;null!=Mt;){var Ct,kt,Ot,Pt,St,At,jt,Et,It,Tt,Nt,Lt,Vt,Dt,Ft,Rt,Zt,Bt,Gt,qt=Mt;qt.stamp+co.arbiterExpirationDelay<ut.stamp?(Ct=ut.contacts,null==bt?(Ot=(kt=Ct.next).next,Ct.next=Ot,null==Ct.next&&(Ct.pushmod=!0)):(Ot=(kt=bt.next).next,null==(bt.next=Ot)&&(Ct.pushmod=!0)),kt._inuse=!1,Ct.modified=!0,Ct.length--,Ct.pushmod=!0,Mt=Ot,Pt=ut.innards,null==gt?(At=(St=Pt.next).next,Pt.next=At,null==Pt.next&&(Pt.pushmod=!0)):(At=(St=gt.next).next,null==(gt.next=At)&&(Pt.pushmod=!0)),St._inuse=!1,Pt.modified=!0,Pt.length--,Pt.pushmod=!0,wt=At,qt.arbiter=null,qt.next=Rl.zpp_pool,Rl.zpp_pool=qt):(jt=qt.inner,Et=qt.active,qt.active=qt.stamp==ut.stamp,qt.active&&(yt?(yt=!1,ut.c1=jt,ut.oc1=qt):(ut.hc2=!0,ut.c2=jt,ut.oc2=qt),jt.r2x=qt.px-ut.b2.posx,jt.r2y=qt.py-ut.b2.posy,jt.r1x=qt.px-ut.b1.posx,jt.r1y=qt.py-ut.b1.posy,It=jt.r2x*ut.nx+jt.r2y*ut.ny,Tt=dt+ut.b2.sinertia*(It*It),Nt=jt.r1x*ut.nx+jt.r1y*ut.ny,Tt+=ut.b1.sinertia*(Nt*Nt),jt.tMass=Tt<co.epsilon*co.epsilon?0:1/Tt,Lt=ut.ny*jt.r2x-ut.nx*jt.r2y,Vt=dt+ut.b2.sinertia*(Lt*Lt),Dt=ut.ny*jt.r1x-ut.nx*jt.r1y,Vt+=ut.b1.sinertia*(Dt*Dt),jt.nMass=Vt<co.epsilon*co.epsilon?0:1/Vt,Rt=Ft=0,Zt=ut.b2.angvel+ut.b2.kinangvel,Ft=ut.b2.velx+ut.b2.kinvelx-jt.r2y*Zt,Rt=ut.b2.vely+ut.b2.kinvely+jt.r2x*Zt,Zt=ut.b1.angvel+ut.b1.kinangvel,Ft-=ut.b1.velx+ut.b1.kinvelx-jt.r1y*Zt,Rt-=ut.b1.vely+ut.b1.kinvely+jt.r1x*Zt,Bt=ut.nx*Ft+ut.ny*Rt,qt.elasticity=ut.restitution,jt.bounce=Bt*qt.elasticity,jt.bounce>-co.elasticThreshold&&(jt.bounce=0),Bt=Rt*ut.nx-Ft*ut.ny,Gt=co.staticFrictionThreshold,jt.friction=Gt*Gt<Bt*Bt?ut.dyn_fric:ut.stat_fric,jt.jnAcc*=xt,jt.jtAcc*=xt),Et!=qt.active&&(ut.contacts.modified=!0),bt=Mt,wt=(gt=wt).next,Mt=Mt.next)}ut.hc2?(ut.hpc2=!0,ut.oc1.posOnly?(zt=ut.c1,ut.c1=ut.c2,ut.c2=zt,ct=ut.oc1,ut.oc1=ut.oc2,ut.oc2=ct,ut.hc2=!1):ut.oc2.posOnly&&(ut.hc2=!1),ut.oc1.posOnly&&(yt=!0)):ut.hpc2=!1,ut.jrAcc*=xt,yt||(ut.rn1a=ut.ny*ut.c1.r1x-ut.nx*ut.c1.r1y,ut.rt1a=ut.c1.r1x*ut.nx+ut.c1.r1y*ut.ny,ut.rn1b=ut.ny*ut.c1.r2x-ut.nx*ut.c1.r2y,ut.rt1b=ut.c1.r2x*ut.nx+ut.c1.r2y*ut.ny,ut.k1x=ut.b2.kinvelx-ut.c1.r2y*ut.b2.kinangvel-(ut.b1.kinvelx-ut.c1.r1y*ut.b1.kinangvel),ut.k1y=ut.b2.kinvely+ut.c1.r2x*ut.b2.kinangvel-(ut.b1.kinvely+ut.c1.r1x*ut.b1.kinangvel)),ut.hc2&&(ut.rn2a=ut.ny*ut.c2.r1x-ut.nx*ut.c2.r1y,ut.rt2a=ut.c2.r1x*ut.nx+ut.c2.r1y*ut.ny,ut.rn2b=ut.ny*ut.c2.r2x-ut.nx*ut.c2.r2y,ut.rt2b=ut.c2.r2x*ut.nx+ut.c2.r2y*ut.ny,ut.k2x=ut.b2.kinvelx-ut.c2.r2y*ut.b2.kinangvel-(ut.b1.kinvelx-ut.c2.r1y*ut.b1.kinangvel),ut.k2y=ut.b2.kinvely+ut.c2.r2x*ut.b2.kinangvel-(ut.b1.kinvely+ut.c2.r1x*ut.b1.kinangvel),ut.kMassa=dt+ut.b1.sinertia*ut.rn1a*ut.rn1a+ut.b2.sinertia*ut.rn1b*ut.rn1b,ut.kMassb=dt+ut.b1.sinertia*ut.rn1a*ut.rn2a+ut.b2.sinertia*ut.rn1b*ut.rn2b,ut.kMassc=dt+ut.b1.sinertia*ut.rn2a*ut.rn2a+ut.b2.sinertia*ut.rn2b*ut.rn2b,ut.kMassa*ut.kMassa+2*ut.kMassb*ut.kMassb+ut.kMassc*ut.kMassc<co.illConditionedThreshold*(ut.kMassa*ut.kMassc-ut.kMassb*ut.kMassb)?(ut.Ka=ut.kMassa,ut.Kb=ut.kMassb,ut.Kc=ut.kMassc,(vt=ut.kMassa*ut.kMassc-ut.kMassb*ut.kMassb)!=vt?ut.kMassa=ut.kMassb=ut.kMassc=0:0==vt?(0!=ut.kMassa?ut.kMassa=1/ut.kMassa:ut.kMassa=0,0!=ut.kMassc?ut.kMassc=1/ut.kMassc:ut.kMassc=0,ut.kMassb=0):(vt=1/vt,mt=ut.kMassc*vt,ut.kMassc=ut.kMassa*vt,ut.kMassa=mt,ut.kMassb*=-vt)):(ut.hc2=!1,ut.oc2.dist<ut.oc1.dist&&(ft=ut.c1,ut.c1=ut.c2,ut.c2=ft),ut.oc2.active=!1,ut.contacts.modified=!0)),ut.surfacex=ut.b2.svelx,ut.surfacey=ut.b2.svely,ut.surfacex+=ut.b1.svelx,ut.surfacey+=ut.b1.svely,ut.surfacex=-ut.surfacex,ut.surfacey=-ut.surfacey,ut.rMass=ut.b1.sinertia+ut.b2.sinertia,0!=ut.rMass&&(ut.rMass=1/ut.rMass),yt&&(n.active=!1)}else{var Ut=n.fluidarb;-1==Ut.pre_dt&&(Ut.pre_dt=t);var Kt=t/Ut.pre_dt;Ut.pre_dt=t,Ut.r1x=Ut.centroidx-Ut.b1.posx,Ut.r1y=Ut.centroidy-Ut.b1.posy,Ut.r2x=Ut.centroidx-Ut.b2.posx,Ut.r2y=Ut.centroidy-Ut.b2.posy;var Wt,Yt,Jt,Xt,Ht,$t,Qt,ne,te,ee,ie,pe,le=0,re=0,re=Ut.ws1.fluidEnabled&&null!=Ut.ws1.fluidProperties.wrap_gravity?(le=Ut.ws1.fluidProperties.gravityx,Ut.ws1.fluidProperties.gravityy):(le=this.gravityx,this.gravityy),oe=0,ae=0,ae=Ut.ws2.fluidEnabled&&null!=Ut.ws2.fluidProperties.wrap_gravity?(oe=Ut.ws2.fluidProperties.gravityx,Ut.ws2.fluidProperties.gravityy):(oe=this.gravityx,this.gravityy),se=0,_e=0;if(Ut.ws1.fluidEnabled&&Ut.ws2.fluidEnabled?(Wt=Ut.overlap*Ut.ws1.fluidProperties.density,(Yt=Ut.overlap*Ut.ws2.fluidProperties.density)<Wt?(se-=le*(Jt=Wt+Yt),_e-=re*Jt):Wt<Yt?(se+=oe*(Xt=Wt+Yt),_e+=ae*Xt):(ne=Qt=0,Qt=le+oe,ne=re+ae,Qt*=.5,ne*=.5,Ut.ws1.worldCOMx*Qt+Ut.ws1.worldCOMy*ne>Ut.ws2.worldCOMx*Qt+Ut.ws2.worldCOMy*ne?(se-=Qt*(Ht=Wt+Yt),_e-=ne*Ht):(se+=Qt*($t=Wt+Yt),_e+=ne*$t))):Ut.ws1.fluidEnabled?(se-=le*(te=Ut.overlap*Ut.ws1.fluidProperties.density),_e-=re*te):Ut.ws2.fluidEnabled&&(se+=oe*(ee=Ut.overlap*Ut.ws2.fluidProperties.density),_e+=ae*ee),se*=t,_e*=t,Ut.buoyx=se,Ut.buoyy=_e,2==Ut.b1.type&&(ie=Ut.b1.imass,Ut.b1.velx-=se*ie,Ut.b1.vely-=_e*ie,Ut.b1.angvel-=(_e*Ut.r1x-se*Ut.r1y)*Ut.b1.iinertia),2==Ut.b2.type&&(pe=Ut.b2.imass,Ut.b2.velx+=se*pe,Ut.b2.vely+=_e*pe,Ut.b2.angvel+=(_e*Ut.r2x-se*Ut.r2y)*Ut.b2.iinertia),Ut.ws1.fluidEnabled&&0!=Ut.ws1.fluidProperties.viscosity||Ut.ws2.fluidEnabled&&0!=Ut.ws2.fluidProperties.viscosity){Ut.nodrag=!1;var he,ue,xe,de=0;Ut.ws1.fluidEnabled&&(Ut.ws2.validate_angDrag(),de=Ut.ws1.fluidProperties.viscosity*Ut.ws2.angDrag*Ut.overlap/Ut.ws2.area),Ut.ws2.fluidEnabled&&(Ut.ws1.validate_angDrag(),de+=Ut.ws2.fluidProperties.viscosity*Ut.ws1.angDrag*Ut.overlap/Ut.ws1.area),0!=de?(he=Ut.b1.sinertia+Ut.b2.sinertia,Ut.wMass=0!=he?1/he:0,de*=4e-4,ue=2*Math.PI*de,Ut.agamma=1/(t*ue*(2+ue*t)),xe=1/(1+Ut.agamma),Ut.agamma*=xe,Ut.wMass*=xe):(Ut.wMass=0,Ut.agamma=0);var ye,ze=Ut.b2.velx+Ut.b2.kinvelx-Ut.r2y*(Ut.b2.angvel+Ut.b2.kinangvel)-(Ut.b1.velx+Ut.b1.kinvelx-Ut.r1y*(Ut.b2.angvel+Ut.b2.kinangvel)),ce=Ut.b2.vely+Ut.b2.kinvely+Ut.r2x*(Ut.b2.angvel+Ut.b2.kinangvel)-(Ut.b1.vely+Ut.b1.kinvely+Ut.r1x*(Ut.b1.angvel+Ut.b1.kinangvel));ze*ze+ce*ce<co.epsilon*co.epsilon||(ze*=ye=1/Math.sqrt(ze*ze+ce*ce),ce*=ye,Ut.nx=ze,Ut.ny=ce);var ve,me,fe,be,ge,we,Me,Ce,ke,Oe,Pe,Se,Ae=0;if(Ut.ws1.fluidEnabled){var je=-Ut.ws1.fluidProperties.viscosity*Ut.overlap/Ut.ws2.area;if(0==Ut.ws2.type)Ae=0-je*Ut.ws2.circle.radius*co.fluidLinearDrag/(2*Ut.ws2.circle.radius*Math.PI);else{for(var Ee=0,Ie=0,Te=Ut.ws2.polygon.edges.head;null!=Te;){var Ne=Te.elt;Ee+=Ne.length;var Le=je*Ne.length*(Ne.gnormx*Ut.nx+Ne.gnormy*Ut.ny);0<Le&&(Le*=-co.fluidVacuumDrag),Ie-=.5*Le*co.fluidLinearDrag,Te=Te.next}Ae=Ie/Ee}}if(Ut.ws2.fluidEnabled){var Ve=-Ut.ws2.fluidProperties.viscosity*Ut.overlap/Ut.ws1.area;if(0==Ut.ws1.type)Ae-=Ve*Ut.ws1.circle.radius*co.fluidLinearDrag/(2*Ut.ws1.circle.radius*Math.PI);else{for(var De=0,Fe=0,Re=Ut.ws1.polygon.edges.head;null!=Re;){var Ze=Re.elt;De+=Ze.length;var Be=Ve*Ze.length*(Ze.gnormx*Ut.nx+Ze.gnormy*Ut.ny);0<Be&&(Be*=-co.fluidVacuumDrag),Fe-=.5*Be*co.fluidLinearDrag,Re=Re.next}Ae+=Fe/De}}0!=Ae?(Oe=me=ge=0,Oe=ge=ve=Ut.b1.smass+Ut.b2.smass,(me=0)!=Ut.b1.sinertia&&(fe=Ut.r1x*Ut.b1.sinertia,ge=ve+(be=Ut.r1y*Ut.b1.sinertia)*Ut.r1y,me+=-be*Ut.r1x,Oe=ve+fe*Ut.r1x),0!=Ut.b2.sinertia&&(we=Ut.r2x*Ut.b2.sinertia,ge+=(Me=Ut.r2y*Ut.b2.sinertia)*Ut.r2y,me+=-Me*Ut.r2x,Oe+=we*Ut.r2x),(Ce=ge*Oe-me*me)!=Ce?ge=me=Oe=0:0==Ce?(ge=0!=ge?1/ge:0,Oe=0!=Oe?1/Oe:0,me=0):(ke=Oe*(Ce=1/Ce),Oe=ge*Ce,ge=ke,me*=-Ce),Ut.vMassa=ge,Ut.vMassb=me,Ut.vMassc=Oe,Pe=2*Math.PI*Ae,Ut.lgamma=1/(t*Pe*(2+Pe*t)),Se=1/(1+Ut.lgamma),Ut.lgamma*=Se,Ut.vMassa*=Se,Ut.vMassb*=Se,Ut.vMassc*=Se):(Ut.vMassa=0,Ut.vMassb=0,Ut.vMassc=0,Ut.lgamma=0)}else Ut.nodrag=!0,Ut.dampx=0,Ut.dampy=0,Ut.adamp=0;Ut.dampx*=Kt,Ut.dampy*=Kt,Ut.adamp*=Kt}}else if(null!=n.colarb){var Ge=n.colarb,qe=!0,Ue=null,Ke=null,We=Ge.innards.next;Ge.hc2=!1;for(var Ye,Je,Xe=Ge.contacts.next;null!=Xe;){var He,$e,Qe,ni,ti,ei,ii,pi,li=Xe;li.stamp+co.arbiterExpirationDelay<Ge.stamp?(He=Ge.contacts,null==Ue?(Qe=($e=He.next).next,He.next=Qe,null==He.next&&(He.pushmod=!0)):(Qe=($e=Ue.next).next,null==(Ue.next=Qe)&&(He.pushmod=!0)),$e._inuse=!1,He.modified=!0,He.length--,He.pushmod=!0,Xe=Qe,ni=Ge.innards,null==Ke?(ei=(ti=ni.next).next,ni.next=ei,null==ni.next&&(ni.pushmod=!0)):(ei=(ti=Ke.next).next,null==(Ke.next=ei)&&(ni.pushmod=!0)),ti._inuse=!1,ni.modified=!0,ni.length--,ni.pushmod=!0,We=ei,li.arbiter=null,li.next=Rl.zpp_pool,Rl.zpp_pool=li):(ii=li.inner,pi=li.active,li.active=li.stamp==Ge.stamp,li.active&&(qe?(qe=!1,Ge.c1=ii,Ge.oc1=li):(Ge.hc2=!0,Ge.c2=ii,Ge.oc2=li)),pi!=li.active&&(Ge.contacts.modified=!0),Ue=Xe,We=(Ke=We).next,Xe=Xe.next)}Ge.hc2?(Ge.hpc2=!0,Ge.oc1.posOnly?(Ye=Ge.c1,Ge.c1=Ge.c2,Ge.c2=Ye,Je=Ge.oc1,Ge.oc1=Ge.oc2,Ge.oc2=Je,Ge.hc2=!1):Ge.oc2.posOnly&&(Ge.hc2=!1),Ge.oc1.posOnly&&(qe=!0)):Ge.hpc2=!1,qe&&(n.active=!1)}return ht!=n.active&&(n.b1.arbiters.modified=!0,n.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0),!1},ae.prototype.prestep=function(n){for(var t=null,e=this.live_constraints.head;null!=e;){var i=e.elt;i.preStep(n)?(e=this.live_constraints.erase(t),i.broken(),this.constraintCbBreak(i),i.removeOnBreak?(i.component.sleeping=!0,this.midstep=!1,null!=i.compound?i.compound.wrap_constraints.remove(i.outer):this.wrap_constraints.remove(i.outer),this.midstep=!0):i.active=!1,i.clearcache()):e=(t=e).next}var p,l,r,o=null,a=this.c_arbiters_true,s=a.head,_=null!=this.c_arbiters_false;for(_&&null==s&&(_=!1,s=this.c_arbiters_false.head,a=this.c_arbiters_false,o=null);null!=s;){this.presteparb(s.elt,n)?(null==o?(l=(p=a.head).next,a.head=l,null==a.head&&(a.pushmod=!0)):(l=(p=o.next).next,null==(o.next=l)&&(a.pushmod=!0)),(r=p).elt=null,r.next=Yl.zpp_pool,Yl.zpp_pool=r,a.modified=!0,a.length--,a.pushmod=!0,s=l,_&&null==s&&(_=!1,s=this.c_arbiters_false.head,a=this.c_arbiters_false,o=null)):(s=(o=s).next,_&&null==s&&(_=!1,s=this.c_arbiters_false.head,a=this.c_arbiters_false,o=null))}for(var h,u,x,d=null,y=this.f_arbiters,z=y.head;null!=z;){this.presteparb(z.elt,n)?(null==d?(u=(h=y.head).next,y.head=u,null==y.head&&(y.pushmod=!0)):(u=(h=d.next).next,null==(d.next=u)&&(y.pushmod=!0)),(x=h).elt=null,x.next=Kl.zpp_pool,Kl.zpp_pool=x,y.modified=!0,y.length--,y.pushmod=!0,z=u):z=(d=z).next}for(var c,v,m,f=null,b=this.s_arbiters,g=b.head;null!=g;){this.presteparb(g.elt,n)?(null==f?(v=(c=b.head).next,b.head=v,null==b.head&&(b.pushmod=!0)):(v=(c=f.next).next,null==(f.next=v)&&(b.pushmod=!0)),(m=c).elt=null,m.next=Wl.zpp_pool,Wl.zpp_pool=m,b.modified=!0,b.length--,b.pushmod=!0,g=v):g=(f=g).next}},ae.prototype.warmStart=function(){for(var n=this.f_arbiters.head;null!=n;){var t,e,i=n.elt;i.active&&0!=(1&i.immState)&&(t=i.b1.imass,i.b1.velx-=i.dampx*t,i.b1.vely-=i.dampy*t,e=i.b2.imass,i.b2.velx+=i.dampx*e,i.b2.vely+=i.dampy*e,i.b1.angvel-=i.b1.iinertia*(i.dampy*i.r1x-i.dampx*i.r1y),i.b2.angvel+=i.b2.iinertia*(i.dampy*i.r2x-i.dampx*i.r2y),i.b1.angvel-=i.adamp*i.b1.iinertia,i.b2.angvel+=i.adamp*i.b2.iinertia),n=n.next}var p=this.c_arbiters_false.head,l=!0;for(null==p&&(p=this.c_arbiters_true.head,l=!1);null!=p;){var r,o,a,s,_,h,u,x,d=p.elt;d.active&&0!=(1&d.immState)&&(r=d.nx*d.c1.jnAcc-d.ny*d.c1.jtAcc,o=d.ny*d.c1.jnAcc+d.nx*d.c1.jtAcc,a=d.b1.imass,d.b1.velx-=r*a,d.b1.vely-=o*a,d.b1.angvel-=d.b1.iinertia*(o*d.c1.r1x-r*d.c1.r1y),s=d.b2.imass,d.b2.velx+=r*s,d.b2.vely+=o*s,d.b2.angvel+=d.b2.iinertia*(o*d.c1.r2x-r*d.c1.r2y),d.hc2&&(_=d.nx*d.c2.jnAcc-d.ny*d.c2.jtAcc,h=d.ny*d.c2.jnAcc+d.nx*d.c2.jtAcc,u=d.b1.imass,d.b1.velx-=_*u,d.b1.vely-=h*u,d.b1.angvel-=d.b1.iinertia*(h*d.c2.r1x-_*d.c2.r1y),x=d.b2.imass,d.b2.velx+=_*x,d.b2.vely+=h*x,d.b2.angvel+=d.b2.iinertia*(h*d.c2.r2x-_*d.c2.r2y)),d.b2.angvel+=d.jrAcc*d.b2.iinertia,d.b1.angvel-=d.jrAcc*d.b1.iinertia),p=p.next,l&&null==p&&(p=this.c_arbiters_true.head,l=!1)}for(var y=this.live_constraints.head;null!=y;)y.elt.warmStart(),y=y.next},ae.prototype.iterateVel=function(n){for(var t=0;t<n;){++t;for(var e=this.f_arbiters.head;null!=e;){var i,p,l,r,o,a,s,_,h,u=e.elt;u.active&&0!=(1&u.immState)&&(u.nodrag||(i=u.b1.angvel+u.b1.kinangvel,p=u.b2.angvel+u.b2.kinangvel,o=u.b1.velx+u.b1.kinvelx-u.r1y*i-(u.b2.velx+u.b2.kinvelx-u.r2y*p),r=u.b1.vely+u.b1.kinvely+u.r1x*i-(u.b2.vely+u.b2.kinvely+u.r2x*p),l=u.vMassa*o+u.vMassb*r,r=u.vMassb*o+u.vMassc*r,o=l,a=u.lgamma,o-=u.dampx*a,r-=u.dampy*a,u.dampx+=o,u.dampy+=r,s=u.b1.imass,u.b1.velx-=o*s,u.b1.vely-=r*s,_=u.b2.imass,u.b2.velx+=o*_,u.b2.vely+=r*_,u.b1.angvel-=u.b1.iinertia*(r*u.r1x-o*u.r1y),u.b2.angvel+=u.b2.iinertia*(r*u.r2x-o*u.r2y),h=(i-p)*u.wMass-u.adamp*u.agamma,u.adamp+=h,u.b1.angvel-=h*u.b1.iinertia,u.b2.angvel+=h*u.b2.iinertia)),e=e.next}for(var x=null,d=this.live_constraints.head;null!=d;){var y=d.elt;y.applyImpulseVel()?(d=this.live_constraints.erase(x),y.broken(),this.constraintCbBreak(y),y.removeOnBreak?(y.component.sleeping=!0,this.midstep=!1,null!=y.compound?y.compound.wrap_constraints.remove(y.outer):this.wrap_constraints.remove(y.outer),this.midstep=!0):y.active=!1,y.clearcache()):d=(x=d).next}var z=this.c_arbiters_false.head,c=!0;for(null==z&&(z=this.c_arbiters_true.head,c=!1);null!=z;){var v,m,f,b,g,w,M,C,k,O,P,S,A,j,E,I,T=z.elt;T.active&&0!=(1&T.immState)&&(f=T.k1x+T.b2.velx-T.c1.r2y*T.b2.angvel-(T.b1.velx-T.c1.r1y*T.b1.angvel),M=((b=T.k1y+T.b2.vely+T.c1.r2x*T.b2.angvel-(T.b1.vely+T.c1.r1x*T.b1.angvel))*T.nx-f*T.ny+T.surfacex)*T.c1.tMass,(C=T.c1.friction*T.c1.jnAcc)<(O=(k=T.c1.jtAcc)-M)?O=C:O<-C&&(O=-C),M=O-k,T.c1.jtAcc=O,v=-T.ny*M,m=T.nx*M,T.b2.velx+=v*T.b2.imass,T.b2.vely+=m*T.b2.imass,T.b1.velx-=v*T.b1.imass,T.b1.vely-=m*T.b1.imass,T.b2.angvel+=T.rt1b*M*T.b2.iinertia,T.b1.angvel-=T.rt1a*M*T.b1.iinertia,T.hc2?(g=T.k2x+T.b2.velx-T.c2.r2y*T.b2.angvel-(T.b1.velx-T.c2.r1y*T.b1.angvel),M=((w=T.k2y+T.b2.vely+T.c2.r2x*T.b2.angvel-(T.b1.vely+T.c2.r1x*T.b1.angvel))*T.nx-g*T.ny+T.surfacex)*T.c2.tMass,(C=T.c2.friction*T.c2.jnAcc)<(O=(k=T.c2.jtAcc)-M)?O=C:O<-C&&(O=-C),M=O-k,T.c2.jtAcc=O,v=-T.ny*M,m=T.nx*M,T.b2.velx+=v*T.b2.imass,T.b2.vely+=m*T.b2.imass,T.b1.velx-=v*T.b1.imass,T.b1.vely-=m*T.b1.imass,T.b2.angvel+=T.rt2b*M*T.b2.iinertia,T.b1.angvel-=T.rt2a*M*T.b1.iinertia,f=T.k1x+T.b2.velx-T.c1.r2y*T.b2.angvel-(T.b1.velx-T.c1.r1y*T.b1.angvel),b=T.k1y+T.b2.vely+T.c1.r2x*T.b2.angvel-(T.b1.vely+T.c1.r1x*T.b1.angvel),g=T.k2x+T.b2.velx-T.c2.r2y*T.b2.angvel-(T.b1.velx-T.c2.r1y*T.b1.angvel),w=T.k2y+T.b2.vely+T.c2.r2x*T.b2.angvel-(T.b1.vely+T.c2.r1x*T.b1.angvel),P=T.c1.jnAcc,S=T.c2.jnAcc,A=f*T.nx+b*T.ny+T.surfacey+T.c1.bounce-(T.Ka*P+T.Kb*S),j=g*T.nx+w*T.ny+T.surfacey+T.c2.bounce-(T.Kb*P+T.Kc*S),E=-(T.kMassa*A+T.kMassb*j),I=-(T.kMassb*A+T.kMassc*j),0<=E&&0<=I?(A=E-P,j=I-S,T.c1.jnAcc=E,T.c2.jnAcc=I):0<=(E=-T.c1.nMass*A)&&0<=T.Kb*E+j?(A=E-P,j=-S,T.c1.jnAcc=E,T.c2.jnAcc=0):0<=(I=-T.c2.nMass*j)&&0<=T.Kb*I+A?(A=-P,j=I-S,T.c1.jnAcc=0,T.c2.jnAcc=I):0<=A&&0<=j?(A=-P,j=-S,T.c1.jnAcc=T.c2.jnAcc=0):j=A=0,M=A+j,v=T.nx*M,m=T.ny*M,T.b2.velx+=v*T.b2.imass,T.b2.vely+=m*T.b2.imass,T.b1.velx-=v*T.b1.imass,T.b1.vely-=m*T.b1.imass,T.b2.angvel+=(T.rn1b*A+T.rn2b*j)*T.b2.iinertia,T.b1.angvel-=(T.rn1a*A+T.rn2a*j)*T.b1.iinertia):(0!=T.radius&&(M=(T.b2.angvel-T.b1.angvel)*T.rMass,C=T.rfric*T.c1.jnAcc,k=T.jrAcc,T.jrAcc-=M,T.jrAcc>C?T.jrAcc=C:T.jrAcc<-C&&(T.jrAcc=-C),M=T.jrAcc-k,T.b2.angvel+=M*T.b2.iinertia,T.b1.angvel-=M*T.b1.iinertia),f=T.k1x+T.b2.velx-T.c1.r2y*T.b2.angvel-(T.b1.velx-T.c1.r1y*T.b1.angvel),b=T.k1y+T.b2.vely+T.c1.r2x*T.b2.angvel-(T.b1.vely+T.c1.r1x*T.b1.angvel),M=(T.c1.bounce+(T.nx*f+T.ny*b)+T.surfacey)*T.c1.nMass,(O=(k=T.c1.jnAcc)-M)<0&&(O=0),M=O-k,T.c1.jnAcc=O,v=T.nx*M,m=T.ny*M,T.b2.velx+=v*T.b2.imass,T.b2.vely+=m*T.b2.imass,T.b1.velx-=v*T.b1.imass,T.b1.vely-=m*T.b1.imass,T.b2.angvel+=T.rn1b*M*T.b2.iinertia,T.b1.angvel-=T.rn1a*M*T.b1.iinertia)),z=z.next,c&&null==z&&(z=this.c_arbiters_true.head,c=!1)}}},ae.prototype.iteratePos=function(n){for(var t=0;t<n;){++t;for(var e=null,i=this.live_constraints.head;null!=i;){var p=i.elt;!p.__velocity&&p.stiff&&p.applyImpulsePos()?(i=this.live_constraints.erase(e),p.broken(),this.constraintCbBreak(p),p.removeOnBreak?(p.component.sleeping=!0,this.midstep=!1,null!=p.compound?p.compound.wrap_constraints.remove(p.outer):this.wrap_constraints.remove(p.outer),this.midstep=!0):p.active=!1,p.clearcache()):i=(e=i).next}var l=this.c_arbiters_false.head,r=!0;for(null==l&&(l=this.c_arbiters_true.head,r=!1);null!=l;){var o=l.elt;if(o.active&&0!=(1&o.immState))if(2==o.ptype){var a=o.c1,s=0,_=0;s=o.b2.axisy*a.lr2x-o.b2.axisx*a.lr2y,_=a.lr2x*o.b2.axisx+a.lr2y*o.b2.axisy,s+=o.b2.posx,_+=o.b2.posy;var h=0,u=0;h=o.b1.axisy*a.lr1x-o.b1.axisx*a.lr1y,u=a.lr1x*o.b1.axisx+a.lr1y*o.b1.axisy;var x,d,y,z,c,v,m,f,b,g,w,M,C,k,O,P,S,A,j,E,I,T,N,L,V=0,D=0,V=s-(h+=o.b1.posx),D=_-(u+=o.b1.posy),F=Math.sqrt(V*V+D*D),R=o.radius-co.collisionSlop,Z=F-R;V*o.nx+D*o.ny<0&&(V=-V,D=-D,Z-=o.radius),Z<0&&(F<co.epsilon?0!=o.b1.smass?o.b1.posx+=10*co.epsilon:o.b2.posx+=10*co.epsilon:(V*=x=1/F,y=.5*(u+_),z=F-R,c=(D*=x)*(h=(d=.5*(h+s))-o.b1.posx)-V*(u=y-o.b1.posy),v=D*(s=d-o.b2.posx)-V*(_=y-o.b2.posy),0!=(m=o.b2.smass+v*v*o.b2.sinertia+o.b1.smass+c*c*o.b1.sinertia)&&(g=b=0,b=V*(f=-o.biasCoef*z/m),g=D*f,w=o.b1.imass,o.b1.posx-=b*w,o.b1.posy-=g*w,M=o.b1,C=-c*o.b1.iinertia*f,M.rot+=C,1e-4<C*C?(M.axisx=Math.sin(M.rot),M.axisy=Math.cos(M.rot)):(P=1-(k=C*C)*k/8,S=((O=1-.5*k)*M.axisx+C*M.axisy)*P,M.axisy=(O*M.axisy-C*M.axisx)*P,M.axisx=S),A=o.b2.imass,o.b2.posx+=b*A,o.b2.posy+=g*A,j=o.b2,E=v*o.b2.iinertia*f,j.rot+=E,1e-4<E*E?(j.axisx=Math.sin(j.rot),j.axisy=Math.cos(j.rot)):(N=1-(I=E*E)*I/8,L=((T=1-.5*I)*j.axisx+E*j.axisy)*N,j.axisy=(T*j.axisy-E*j.axisx)*N,j.axisx=L))))}else{var B,G=0,q=0,U=0,K=0,W=0,Y=0;0==o.ptype?(G=o.b1.axisy*o.lnormx-o.b1.axisx*o.lnormy,q=o.lnormx*o.b1.axisx+o.lnormy*o.b1.axisy,B=o.lproj+(G*o.b1.posx+q*o.b1.posy),U=o.b2.axisy*o.c1.lr1x-o.b2.axisx*o.c1.lr1y,K=o.c1.lr1x*o.b2.axisx+o.c1.lr1y*o.b2.axisy,U+=o.b2.posx,K+=o.b2.posy,o.hpc2&&(W=o.b2.axisy*o.c2.lr1x-o.b2.axisx*o.c2.lr1y,Y=o.c2.lr1x*o.b2.axisx+o.c2.lr1y*o.b2.axisy,W+=o.b2.posx,Y+=o.b2.posy)):(G=o.b2.axisy*o.lnormx-o.b2.axisx*o.lnormy,q=o.lnormx*o.b2.axisx+o.lnormy*o.b2.axisy,B=o.lproj+(G*o.b2.posx+q*o.b2.posy),U=o.b1.axisy*o.c1.lr1x-o.b1.axisx*o.c1.lr1y,K=o.c1.lr1x*o.b1.axisx+o.c1.lr1y*o.b1.axisy,U+=o.b1.posx,K+=o.b1.posy,o.hpc2&&(W=o.b1.axisy*o.c2.lr1x-o.b1.axisx*o.c2.lr1y,Y=o.c2.lr1x*o.b1.axisx+o.c2.lr1y*o.b1.axisy,W+=o.b1.posx,Y+=o.b1.posy));var J=U*G+K*q-B-o.radius;J+=co.collisionSlop;var X=0;if(o.hpc2&&(X=W*G+Y*q-B-o.radius,X+=co.collisionSlop),J<0||X<0){o.rev&&(G=-G,q=-q);var H=U-o.b1.posx,$=K-o.b1.posy,Q=U-o.b2.posx,nn=K-o.b2.posy;if(o.hpc2){var tn=q*H-G*$,en=q*Q-G*nn,pn=q*(W-o.b1.posx)-G*(Y-o.b1.posy),ln=q*(W-o.b2.posx)-G*(Y-o.b2.posy),rn=o.b1.smass+o.b2.smass;o.kMassa=rn+o.b1.sinertia*tn*tn+o.b2.sinertia*en*en,o.kMassb=rn+o.b1.sinertia*tn*pn+o.b2.sinertia*en*ln,o.kMassc=rn+o.b1.sinertia*pn*pn+o.b2.sinertia*ln*ln;for(var on=o.kMassa,an=o.kMassb,sn=o.kMassc,_n=J*o.biasCoef,hn=X*o.biasCoef;;){var un=0,xn=0;un=-(un=_n),xn=-(xn=hn);var dn,yn=o.kMassa*o.kMassc-o.kMassb*o.kMassb;if(yn!=yn?un=xn=0:0==yn?(0!=o.kMassa?un/=o.kMassa:un=0,0!=o.kMassc?xn/=o.kMassc:xn=0):(dn=(yn=1/yn)*(o.kMassc*un-o.kMassb*xn),xn=yn*(o.kMassa*xn-o.kMassb*un),un=dn),0<=un&&0<=xn){var zn=(un+xn)*o.b1.imass;o.b1.posx-=G*zn,o.b1.posy-=q*zn;var cn,vn,mn,fn,bn=o.b1,gn=-o.b1.iinertia*(tn*un+pn*xn);bn.rot+=gn,1e-4<gn*gn?(bn.axisx=Math.sin(bn.rot),bn.axisy=Math.cos(bn.rot)):(mn=1-(cn=gn*gn)*cn/8,fn=((vn=1-.5*cn)*bn.axisx+gn*bn.axisy)*mn,bn.axisy=(vn*bn.axisy-gn*bn.axisx)*mn,bn.axisx=fn);var wn=(un+xn)*o.b2.imass;o.b2.posx+=G*wn,o.b2.posy+=q*wn;var Mn,Cn,kn,On,Pn=o.b2,Sn=o.b2.iinertia*(en*un+ln*xn);Pn.rot+=Sn,1e-4<Sn*Sn?(Pn.axisx=Math.sin(Pn.rot),Pn.axisy=Math.cos(Pn.rot)):(kn=1-(Mn=Sn*Sn)*Mn/8,On=((Cn=1-.5*Mn)*Pn.axisx+Sn*Pn.axisy)*kn,Pn.axisy=(Cn*Pn.axisy-Sn*Pn.axisx)*kn,Pn.axisx=On);break}if((xn=0)<=(un=-_n/on)&&0<=an*un+hn){var An=(un+xn)*o.b1.imass;o.b1.posx-=G*An,o.b1.posy-=q*An;var jn,En,In,Tn,Nn=o.b1,Ln=-o.b1.iinertia*(tn*un+pn*xn);Nn.rot+=Ln,1e-4<Ln*Ln?(Nn.axisx=Math.sin(Nn.rot),Nn.axisy=Math.cos(Nn.rot)):(In=1-(jn=Ln*Ln)*jn/8,Tn=((En=1-.5*jn)*Nn.axisx+Ln*Nn.axisy)*In,Nn.axisy=(En*Nn.axisy-Ln*Nn.axisx)*In,Nn.axisx=Tn);var Vn=(un+xn)*o.b2.imass;o.b2.posx+=G*Vn,o.b2.posy+=q*Vn;var Dn,Fn,Rn,Zn,Bn=o.b2,Gn=o.b2.iinertia*(en*un+ln*xn);Bn.rot+=Gn,1e-4<Gn*Gn?(Bn.axisx=Math.sin(Bn.rot),Bn.axisy=Math.cos(Bn.rot)):(Rn=1-(Dn=Gn*Gn)*Dn/8,Zn=((Fn=1-.5*Dn)*Bn.axisx+Gn*Bn.axisy)*Rn,Bn.axisy=(Fn*Bn.axisy-Gn*Bn.axisx)*Rn,Bn.axisx=Zn);break}if((un=0)<=(xn=-hn/sn)&&0<=an*xn+_n){var qn=(un+xn)*o.b1.imass;o.b1.posx-=G*qn,o.b1.posy-=q*qn;var Un,Kn,Wn,Yn,Jn=o.b1,Xn=-o.b1.iinertia*(tn*un+pn*xn);Jn.rot+=Xn,1e-4<Xn*Xn?(Jn.axisx=Math.sin(Jn.rot),Jn.axisy=Math.cos(Jn.rot)):(Wn=1-(Un=Xn*Xn)*Un/8,Yn=((Kn=1-.5*Un)*Jn.axisx+Xn*Jn.axisy)*Wn,Jn.axisy=(Kn*Jn.axisy-Xn*Jn.axisx)*Wn,Jn.axisx=Yn);var Hn=(un+xn)*o.b2.imass;o.b2.posx+=G*Hn,o.b2.posy+=q*Hn;var $n,Qn,nt,tt,et=o.b2,it=o.b2.iinertia*(en*un+ln*xn);et.rot+=it,1e-4<it*it?(et.axisx=Math.sin(et.rot),et.axisy=Math.cos(et.rot)):(nt=1-($n=it*it)*$n/8,tt=((Qn=1-.5*$n)*et.axisx+it*et.axisy)*nt,et.axisy=(Qn*et.axisy-it*et.axisx)*nt,et.axisx=tt);break}break}}else{var pt,lt,rt,ot,at,st,_t,ht,ut,xt,dt,yt,zt,ct,vt,mt,ft,bt=q*H-G*$,gt=q*Q-G*nn,wt=o.b2.smass+gt*gt*o.b2.sinertia+o.b1.smass+bt*bt*o.b1.sinertia;0!=wt&&(rt=lt=0,lt=G*(pt=-o.biasCoef*J/wt),rt=q*pt,ot=o.b1.imass,o.b1.posx-=lt*ot,o.b1.posy-=rt*ot,at=o.b1,st=-bt*o.b1.iinertia*pt,at.rot+=st,1e-4<st*st?(at.axisx=Math.sin(at.rot),at.axisy=Math.cos(at.rot)):(ut=1-(_t=st*st)*_t/8,xt=((ht=1-.5*_t)*at.axisx+st*at.axisy)*ut,at.axisy=(ht*at.axisy-st*at.axisx)*ut,at.axisx=xt),dt=o.b2.imass,o.b2.posx+=lt*dt,o.b2.posy+=rt*dt,yt=o.b2,zt=gt*o.b2.iinertia*pt,yt.rot+=zt,1e-4<zt*zt?(yt.axisx=Math.sin(yt.rot),yt.axisy=Math.cos(yt.rot)):(mt=1-(ct=zt*zt)*ct/8,ft=((vt=1-.5*ct)*yt.axisx+zt*yt.axisy)*mt,yt.axisy=(vt*yt.axisy-zt*yt.axisx)*mt,yt.axisx=ft))}}}l=l.next,r&&null==l&&(l=this.c_arbiters_true.head,r=!1)}}},ae.prototype.group_ignore=function(n,t){for(var e=n;null!=e&&null==e.group;)e=null!=e.ishape?e.ishape.body:null!=e.icompound?e.icompound.compound:e.ibody.compound;var i=null==e?null:e.group;if(null==i)return!1;for(var p=t;null!=p&&null==p.group;)p=null!=p.ishape?p.ishape.body:null!=p.icompound?p.icompound.compound:p.ibody.compound;var l=null==p?null:p.group;if(null==l)return!1;for(var r=!1;null!=i&&null!=l;){if(i==l){r=i.ignore;break}i.depth<l.depth?l=l.group:i=i.group}return r},ae.prototype.interactionType=function(n,t,e,i){for(var p,l,r,o,a,s=!1,_=e.constraints.head;null!=_;){var h=_.elt;if(h.ignore&&h.pair_exists(e.id,i.id)){s=!0;break}_=_.next}if(s)p=!1;else{for(var u=n;null!=u&&null==u.group;)u=null!=u.ishape?u.ishape.body:null!=u.icompound?u.icompound.compound:u.ibody.compound;var x,d=null==u?null:u.group;if(null==d)x=!1;else{for(var y=t;null!=y&&null==y.group;)y=null!=y.ishape?y.ishape.body:null!=y.icompound?y.icompound.compound:y.ibody.compound;var z=null==y?null:y.group;if(null==z)x=!1;else{for(var c=!1;null!=d&&null!=z;){if(d==z){c=d.ignore;break}d.depth<z.depth?z=z.group:d=d.group}x=c}}p=!x}if(p){if(!(!n.sensorEnabled&&!t.sensorEnabled)&&(l=n.filter,r=t.filter,0!=(l.sensorMask&r.sensorGroup)&&0!=(r.sensorMask&l.sensorGroup)))return 2;if(!!(!(!n.fluidEnabled&&!t.fluidEnabled)&&(o=n.filter,a=t.filter,0!=(o.fluidMask&a.fluidGroup)&&0!=(a.fluidMask&o.fluidGroup)))&&!(0==e.imass&&0==i.imass&&0==e.iinertia&&0==i.iinertia))return 0;var v=n.filter,m=t.filter,f=0!=(v.collisionMask&m.collisionGroup)&&0!=(m.collisionMask&v.collisionGroup)&&!(0==e.imass&&0==i.imass&&0==e.iinertia&&0==i.iinertia);return f?1:-1}return-1},ae.prototype.precb=null,ae.prototype.prelisteners=null,ae.prototype.narrowPhase=function(n,t,e,i,p){for(var l,r,o,a,s,_,h,u,x,d,y=null,z=n.body,c=t.body,v=!1,m=z.constraints.head;null!=m;){var f=m.elt;if(f.ignore&&f.pair_exists(z.id,c.id)){v=!0;break}m=m.next}if(v)l=!1;else{for(var b=n;null!=b&&null==b.group;)b=null!=b.ishape?b.ishape.body:null!=b.icompound?b.icompound.compound:b.ibody.compound;var g,w=null==b?null:b.group;if(null==w)g=!1;else{for(var M=t;null!=M&&null==M.group;)M=null!=M.ishape?M.ishape.body:null!=M.icompound?M.icompound.compound:M.ibody.compound;var C=null==M?null:M.group;if(null==C)g=!1;else{for(var k=!1;null!=w&&null!=C;){if(w==C){k=w.ignore;break}w.depth<C.depth?C=C.group:w=w.group}g=k}}l=!g}if(-1!=(u=l?!(!n.sensorEnabled&&!t.sensorEnabled)&&(r=n.filter,o=t.filter,0!=(r.sensorMask&o.sensorGroup)&&0!=(o.sensorMask&r.sensorGroup))?2:!!(!(!n.fluidEnabled&&!t.fluidEnabled)&&(a=n.filter,s=t.filter,0!=(a.fluidMask&s.fluidGroup)&&0!=(s.fluidMask&a.fluidGroup)))&&!(0==z.imass&&0==c.imass&&0==z.iinertia&&0==c.iinertia)?0:(_=n.filter,h=t.filter,0!=(_.collisionMask&h.collisionGroup)&&0!=(h.collisionMask&_.collisionGroup)&&!(0==z.imass&&0==c.imass&&0==z.iinertia&&0==c.iinertia)?1:-1):-1)){n.type>t.type?(x=t,d=n):n.type!=t.type||n.id<t.id?(x=n,d=t):(d=n,x=t);var O,P,S=x==t;if(0==u){if(null==i){for(var A=null,j=(z.arbiters.length<c.arbiters.length?z:c).arbiters.head;null!=j;){var E=j.elt;if(E.id==x.id&&E.di==d.id){A=E;break}j=j.next}O=A}else O=i;var I,T,N,L,V,D,F,R,Z,B,G,q,U,K,W,Y,J,X=null==O,H=!1;if(X)null==Dl.zpp_pool?I=new Dl:(I=Dl.zpp_pool,Dl.zpp_pool=I.next,I.next=null);else if(null==O.fluidarb){O.cleared=!0;for(var $,Q,nn=O.b1.arbiters,tn=null,en=nn.head;null!=en;){if(en.elt==O){null==tn?(Q=($=nn.head).next,nn.head=Q,null==nn.head&&(nn.pushmod=!0)):(Q=($=tn.next).next,null==(tn.next=Q)&&(nn.pushmod=!0));var pn=$;pn.elt=null,pn.next=Gl.zpp_pool,Gl.zpp_pool=pn,nn.modified=!0,nn.length--,nn.pushmod=!0;break}en=(tn=en).next}for(var ln,rn,on=O.b2.arbiters,an=null,sn=on.head;null!=sn;){if(sn.elt==O){null==an?(rn=(ln=on.head).next,on.head=rn,null==on.head&&(on.pushmod=!0)):(rn=(ln=an.next).next,null==(an.next=rn)&&(on.pushmod=!0));var _n=ln;_n.elt=null,_n.next=Gl.zpp_pool,Gl.zpp_pool=_n,on.modified=!0,on.length--,on.pushmod=!0;break}sn=(an=sn).next}null!=O.pair&&(O.pair.arb=null,O.pair=null),O.active=!1,this.f_arbiters.modified=!0,null==Dl.zpp_pool?I=new Dl:(I=Dl.zpp_pool,Dl.zpp_pool=I.next,I.next=null),H=X=I.intchange=!0}else I=O.fluidarb;if(X||I.stamp!=this.stamp||p)if(I.stamp=this.stamp,vo.flowCollide(x,d,I)){if(X?(T=x.id,N=d.id,I.b1=n.body,I.ws1=n,I.b2=t.body,I.ws2=t,I.id=T,I.di=N,L=I.b1.arbiters,null==Gl.zpp_pool?V=new Gl:(V=Gl.zpp_pool,Gl.zpp_pool=V.next,V.next=null),V.elt=I,(D=V).next=L.head,L.head=D,L.modified=!0,L.length++,F=I.b2.arbiters,null==Gl.zpp_pool?R=new Gl:(R=Gl.zpp_pool,Gl.zpp_pool=R.next,R.next=null),R.elt=I,(Z=R).next=F.head,F.head=Z,F.modified=!0,F.length++,I.active=!0,I.present=0,I.cleared=!1,I.sleeping=!1,I.fresh=!1,I.presentable=!1,I.nx=0,I.ny=1,I.dampx=0,I.dampy=0,I.adamp=0,B=this.f_arbiters,null==Kl.zpp_pool?G=new Kl:(G=Kl.zpp_pool,Kl.zpp_pool=G.next,G.next=null),G.elt=I,(q=G).next=B.head,B.head=q,B.modified=!0,B.length++,I.fresh=!H):I.fresh=I.up_stamp<this.stamp-1||I.endGenerated==this.stamp&&p,I.up_stamp=I.stamp,I.fresh||0==(4&I.immState)){for(var hn=!(I.immState=1),un=I.ws1.id>I.ws2.id?I.ws2:I.ws1,xn=I.ws1.id>I.ws2.id?I.ws1:I.ws2,dn=this.mrca1;null!=dn.head;){var yn=dn.head;dn.head=yn.next,yn.elt=null,yn.next=Ul.zpp_pool,Ul.zpp_pool=yn,null==dn.head&&(dn.pushmod=!0),dn.modified=!0,dn.length--}dn.pushmod=!0;for(var zn,cn,vn,mn,fn,bn,gn,wn,Mn,Cn,kn,On,Pn,Sn,An=this.mrca2;null!=An.head;){var jn=An.head;An.head=jn.next,jn.elt=null,jn.next=Ul.zpp_pool,Ul.zpp_pool=jn,null==An.head&&(An.pushmod=!0),An.modified=!0,An.length--}An.pushmod=!0,null!=un.cbSet&&(zn=this.mrca1,null==Ul.zpp_pool?cn=new Ul:(cn=Ul.zpp_pool,Ul.zpp_pool=cn.next,cn.next=null),cn.elt=un,(vn=cn).next=zn.head,zn.head=vn,zn.modified=!0,zn.length++),null!=un.body.cbSet&&(mn=this.mrca1,fn=un.body,null==Ul.zpp_pool?bn=new Ul:(bn=Ul.zpp_pool,Ul.zpp_pool=bn.next,bn.next=null),bn.elt=fn,(gn=bn).next=mn.head,mn.head=gn,mn.modified=!0,mn.length++),null!=xn.cbSet&&(wn=this.mrca2,null==Ul.zpp_pool?Mn=new Ul:(Mn=Ul.zpp_pool,Ul.zpp_pool=Mn.next,Mn.next=null),Mn.elt=xn,(Cn=Mn).next=wn.head,wn.head=Cn,wn.modified=!0,wn.length++),null!=xn.body.cbSet&&(kn=this.mrca2,On=xn.body,null==Ul.zpp_pool?Pn=new Ul:(Pn=Ul.zpp_pool,Ul.zpp_pool=Pn.next,Pn.next=null),Pn.elt=On,(Sn=Pn).next=kn.head,kn.head=Sn,kn.modified=!0,kn.length++);for(var En,In,Tn,Nn,Ln,Vn,Dn=un.body.compound,Fn=xn.body.compound;Dn!=Fn;){(null==Dn?0:Dn.depth)<(null==Fn?0:Fn.depth)?(null!=Fn.cbSet&&(En=this.mrca2,null==Ul.zpp_pool?In=new Ul:(In=Ul.zpp_pool,Ul.zpp_pool=In.next,In.next=null),In.elt=Fn,(Tn=In).next=En.head,En.head=Tn,En.modified=!0,En.length++),Fn=Fn.compound):(null!=Dn.cbSet&&(Nn=this.mrca1,null==Ul.zpp_pool?Ln=new Ul:(Ln=Ul.zpp_pool,Ul.zpp_pool=Ln.next,Ln.next=null),Ln.elt=Dn,(Vn=Ln).next=Nn.head,Nn.head=Vn,Nn.modified=!0,Nn.length++),Dn=Dn.compound)}for(var Rn,Zn,Bn=this.mrca1.head;null!=Bn;){for(var Gn=Bn.elt,qn=this.mrca2.head;null!=qn;){for(var Un,Kn=qn.elt,Wn=Gn.cbSet,Yn=Kn.cbSet,Jn=null,Xn=(Wn.cbpairs.length<Yn.cbpairs.length?Wn.cbpairs:Yn.cbpairs).head;null!=Xn;){var Hn=Xn.elt;if(Hn.a==Wn&&Hn.b==Yn||Hn.a==Yn&&Hn.b==Wn){Jn=Hn;break}Xn=Xn.next}if(null==Jn&&(null==Nl.zpp_pool?Un=new Nl:(Un=Nl.zpp_pool,Nl.zpp_pool=Un.next,Un.next=null),Un.zip_listeners=!0,Tl.setlt(Wn,Yn)?(Un.a=Wn,Un.b=Yn):(Un.a=Yn,Un.b=Wn),Jn=Un,Wn.cbpairs.add(Jn),Yn!=Wn&&Yn.cbpairs.add(Jn)),Jn.zip_listeners&&(Jn.zip_listeners=!1,Jn.__validate()),null!=Jn.listeners.head){for(var $n=null,Qn=null,nt=this.prelisteners;null!=nt.head;){var tt=nt.head;nt.head=tt.next,tt.elt=null,tt.next=ql.zpp_pool,ql.zpp_pool=tt,null==nt.head&&(nt.pushmod=!0),nt.modified=!0,nt.length--}nt.pushmod=!0;for(var et,it=null,pt=null,lt=(Wn.cbpairs.length<Yn.cbpairs.length?Wn.cbpairs:Yn.cbpairs).head;null!=lt;){var rt=lt.elt;if(rt.a==Wn&&rt.b==Yn||rt.a==Yn&&rt.b==Wn){pt=rt;break}lt=lt.next}null==pt&&(null==Nl.zpp_pool?et=new Nl:(et=Nl.zpp_pool,Nl.zpp_pool=et.next,et.next=null),et.zip_listeners=!0,Tl.setlt(Wn,Yn)?(et.a=Wn,et.b=Yn):(et.a=Yn,et.b=Wn),pt=et,Wn.cbpairs.add(pt),Yn!=Wn&&Yn.cbpairs.add(pt)),pt.zip_listeners&&(pt.zip_listeners=!1,pt.__validate());for(var ot=pt.listeners.head;null!=ot;){var at,st,_t,ht=ot.elt;5==ht.event&&0!=(4&ht.itype)&&(at=this.prelisteners,null==ql.zpp_pool?st=new ql:(st=ql.zpp_pool,ql.zpp_pool=st.next,st.next=null),st.elt=ht,_t=st,null==it?(_t.next=at.head,at.head=_t):(_t.next=it.next,it.next=_t),at.pushmod=at.modified=!0,at.length++,it=_t,hn=!!hn||!ht.pure),ot=ot.next}if(null!=this.prelisteners.head){if(null==($n=Zl.get(Gn,Kn))&&(Qn=Bl.get(Gn,Kn),this.add_callbackset(Qn)),null==$n||($n.FLUIDstamp!=this.stamp||p)&&0==(4&$n.FLUIDstate)){if(null!=Qn&&($n=Qn),null!=$n)for(var ut=this.prelisteners.head;null!=ut;)7==ut.elt.itype&&($n.COLLISIONstamp=this.stamp,$n.SENSORstamp=this.stamp),$n.FLUIDstamp=this.stamp,ut=ut.next;var xt=I.active;I.active=!0,this.precb.zpp_inner.pre_arbiter=I,this.precb.zpp_inner.set=$n;for(var dt=this.prelisteners.head;null!=dt;){var yt=dt.elt;this.precb.zpp_inner.listener=yt;var zt,ct,vt=this.precb.zpp_inner,mt=$n.int1,ft=$n.int2,bt=yt.options1,gt=mt.cbTypes;!(!bt.nonemptyintersection(gt,bt.includes)||bt.nonemptyintersection(gt,bt.excludes))&&(zt=yt.options2,ct=ft.cbTypes,!!zt.nonemptyintersection(ct,zt.includes)&&!zt.nonemptyintersection(ct,zt.excludes))?(vt.int1=mt,vt.int2=ft):(vt.int1=ft,vt.int2=mt),this.precb.zpp_inner.pre_swapped=Gn!=this.precb.zpp_inner.int1;var wt,Mt=yt.handlerp(this.precb);null!=Mt&&(null==Ll.PreFlag_ACCEPT&&(Ll.internal=!0,Ll.PreFlag_ACCEPT=new Il,Ll.internal=!1),wt=Mt==Ll.PreFlag_ACCEPT?5:(null==Ll.PreFlag_ACCEPT_ONCE&&(Ll.internal=!0,Ll.PreFlag_ACCEPT_ONCE=new Il,Ll.internal=!1),Mt==Ll.PreFlag_ACCEPT_ONCE?1:(null==Ll.PreFlag_IGNORE&&(Ll.internal=!0,Ll.PreFlag_IGNORE=new Il,Ll.internal=!1),Mt==Ll.PreFlag_IGNORE?6:2)),I.immState=wt),dt=dt.next}if(I.active=xt,null!=$n)for(var Ct=this.prelisteners.head;null!=Ct;)7==Ct.elt.itype&&($n.COLLISIONstate=I.immState,$n.SENSORstate=I.immState),$n.FLUIDstate=I.immState,Ct=Ct.next}else null==$n?0==(4&I.immState)&&(I.immState=1):I.immState=$n.FLUIDstate;qn=qn.next}else qn=qn.next}else qn=qn.next}Bn=Bn.next}hn&&0==(4&I.immState)&&(2==I.b1.type&&((Rn=I.b1).world||(Rn.component.waket=this.stamp+(this.midstep?0:1),3==Rn.type&&(Rn.kinematicDelaySleep=!0),Rn.component.sleeping&&this.really_wake(Rn,!1))),2==I.b1.type&&((Zn=I.b2).world||(Zn.component.waket=this.stamp+(this.midstep?0:1),3==Zn.type&&(Zn.kinematicDelaySleep=!0),Zn.component.sleeping&&this.really_wake(Zn,!1))))}0!=(1&I.immState)&&(2==I.b1.type&&I.b1.component.sleeping&&((U=I.b1).world||(U.component.waket=this.stamp+(this.midstep?0:1),3==U.type&&(U.kinematicDelaySleep=!0),U.component.sleeping&&this.really_wake(U,!1))),2==I.b2.type&&I.b2.component.sleeping&&((K=I.b2).world||(K.component.waket=this.stamp+(this.midstep?0:1),3==K.type&&(K.kinematicDelaySleep=!0),K.component.sleeping&&this.really_wake(K,!1)))),I.sleeping&&(I.sleeping=!1,W=this.f_arbiters,null==Kl.zpp_pool?Y=new Kl:(Y=Kl.zpp_pool,Kl.zpp_pool=Y.next,Y.next=null),Y.elt=I,(J=Y).next=W.head,W.head=J,W.modified=!0,W.length++),y=I}else var kt,y=X?((kt=I).next=Dl.zpp_pool,Dl.zpp_pool=kt,null):I;else y=I}else if(1==u){var Ot,Pt=e?this.c_arbiters_true:this.c_arbiters_false;if(null==i){for(var St=null,At=(z.arbiters.length<c.arbiters.length?z:c).arbiters.head;null!=At;){var jt=At.elt;if(jt.id==x.id&&jt.di==d.id){St=jt;break}At=At.next}Ot=St}else Ot=i;var Et,It,Tt,Nt,Lt,Vt,Dt,Ft,Rt,Zt,Bt,Gt,qt,Ut,Kt,Wt,Yt=null==Ot,Jt=!1;if(Yt)null==Fl.zpp_pool?Et=new Fl:(Et=Fl.zpp_pool,Fl.zpp_pool=Et.next,Et.next=null),Et.stat=e;else if(null==Ot.colarb){Ot.cleared=!0;for(var Xt,Ht,$t=Ot.b1.arbiters,Qt=null,ne=$t.head;null!=ne;){if(ne.elt==Ot){null==Qt?(Ht=(Xt=$t.head).next,$t.head=Ht,null==$t.head&&($t.pushmod=!0)):(Ht=(Xt=Qt.next).next,null==(Qt.next=Ht)&&($t.pushmod=!0));var te=Xt;te.elt=null,te.next=Gl.zpp_pool,Gl.zpp_pool=te,$t.modified=!0,$t.length--,$t.pushmod=!0;break}ne=(Qt=ne).next}for(var ee,ie,pe=Ot.b2.arbiters,le=null,re=pe.head;null!=re;){if(re.elt==Ot){null==le?(ie=(ee=pe.head).next,pe.head=ie,null==pe.head&&(pe.pushmod=!0)):(ie=(ee=le.next).next,null==(le.next=ie)&&(pe.pushmod=!0));var oe=ee;oe.elt=null,oe.next=Gl.zpp_pool,Gl.zpp_pool=oe,pe.modified=!0,pe.length--,pe.pushmod=!0;break}re=(le=re).next}null!=Ot.pair&&(Ot.pair.arb=null,Ot.pair=null),Ot.active=!1,this.f_arbiters.modified=!0,null==Fl.zpp_pool?Et=new Fl:(Et=Fl.zpp_pool,Fl.zpp_pool=Et.next,Et.next=null),Et.intchange=!0,Et.stat=e,Jt=Yt=!0}else S=x!=(Et=Ot.colarb).s1,Et.stat!=e&&(Et.stat=e,Et.sleeping||((e?this.c_arbiters_false:this.c_arbiters_true).remove(Et),Pt.add(Et)));if(Yt||Et.stamp!=this.stamp||p)if(Et.stamp=this.stamp,vo.contactCollide(x,d,Et,S)){if(Yt?(It=x.id,Tt=d.id,Et.b1=n.body,Et.ws1=n,Et.b2=t.body,Et.ws2=t,Et.id=It,Et.di=Tt,Nt=Et.b1.arbiters,null==Gl.zpp_pool?Lt=new Gl:(Lt=Gl.zpp_pool,Gl.zpp_pool=Lt.next,Lt.next=null),Lt.elt=Et,(Vt=Lt).next=Nt.head,Nt.head=Vt,Nt.modified=!0,Nt.length++,Dt=Et.b2.arbiters,null==Gl.zpp_pool?Ft=new Gl:(Ft=Gl.zpp_pool,Gl.zpp_pool=Ft.next,Ft.next=null),Ft.elt=Et,(Rt=Ft).next=Dt.head,Dt.head=Rt,Dt.modified=!0,Dt.length++,Et.active=!0,Et.present=0,Et.cleared=!1,Et.sleeping=!1,Et.fresh=!1,Et.presentable=!1,Et.s1=n,Et.s2=t,Et.userdef_restitution||(Et.s1.material.elasticity<=-1/0||Et.s2.material.elasticity<=-1/0?Et.restitution=0:Et.s1.material.elasticity>=1/0||Et.s2.material.elasticity>=1/0?Et.restitution=1:Et.restitution=(Et.s1.material.elasticity+Et.s2.material.elasticity)/2,Et.restitution<0&&(Et.restitution=0),1<Et.restitution&&(Et.restitution=1)),Et.userdef_dyn_fric||(Et.dyn_fric=Math.sqrt(Et.s1.material.dynamicFriction*Et.s2.material.dynamicFriction)),Et.userdef_stat_fric||(Et.stat_fric=Math.sqrt(Et.s1.material.staticFriction*Et.s2.material.staticFriction)),Et.userdef_rfric||(Et.rfric=Math.sqrt(Et.s1.material.rollingFriction*Et.s2.material.rollingFriction)),null==Yl.zpp_pool?Zt=new Yl:(Zt=Yl.zpp_pool,Yl.zpp_pool=Zt.next,Zt.next=null),Zt.elt=Et,(Bt=Zt).next=Pt.head,Pt.head=Bt,Pt.modified=!0,Pt.length++,Et.fresh=!Jt):Et.fresh=Et.up_stamp<this.stamp-1||Et.endGenerated==this.stamp&&p,Et.up_stamp=Et.stamp,Et.fresh||0==(4&Et.immState)){for(var ae=!(Et.immState=1),se=Et.ws1.id>Et.ws2.id?Et.ws2:Et.ws1,_e=Et.ws1.id>Et.ws2.id?Et.ws1:Et.ws2,he=this.mrca1;null!=he.head;){var ue=he.head;he.head=ue.next,ue.elt=null,ue.next=Ul.zpp_pool,Ul.zpp_pool=ue,null==he.head&&(he.pushmod=!0),he.modified=!0,he.length--}he.pushmod=!0;for(var xe,de,ye,ze,ce,ve,me,fe,be,ge,we,Me,Ce,ke,Oe=this.mrca2;null!=Oe.head;){var Pe=Oe.head;Oe.head=Pe.next,Pe.elt=null,Pe.next=Ul.zpp_pool,Ul.zpp_pool=Pe,null==Oe.head&&(Oe.pushmod=!0),Oe.modified=!0,Oe.length--}Oe.pushmod=!0,null!=se.cbSet&&(xe=this.mrca1,null==Ul.zpp_pool?de=new Ul:(de=Ul.zpp_pool,Ul.zpp_pool=de.next,de.next=null),de.elt=se,(ye=de).next=xe.head,xe.head=ye,xe.modified=!0,xe.length++),null!=se.body.cbSet&&(ze=this.mrca1,ce=se.body,null==Ul.zpp_pool?ve=new Ul:(ve=Ul.zpp_pool,Ul.zpp_pool=ve.next,ve.next=null),ve.elt=ce,(me=ve).next=ze.head,ze.head=me,ze.modified=!0,ze.length++),null!=_e.cbSet&&(fe=this.mrca2,null==Ul.zpp_pool?be=new Ul:(be=Ul.zpp_pool,Ul.zpp_pool=be.next,be.next=null),be.elt=_e,(ge=be).next=fe.head,fe.head=ge,fe.modified=!0,fe.length++),null!=_e.body.cbSet&&(we=this.mrca2,Me=_e.body,null==Ul.zpp_pool?Ce=new Ul:(Ce=Ul.zpp_pool,Ul.zpp_pool=Ce.next,Ce.next=null),Ce.elt=Me,(ke=Ce).next=we.head,we.head=ke,we.modified=!0,we.length++);for(var Se,Ae,je,Ee,Ie,Te,Ne=se.body.compound,Le=_e.body.compound;Ne!=Le;){(null==Ne?0:Ne.depth)<(null==Le?0:Le.depth)?(null!=Le.cbSet&&(Se=this.mrca2,null==Ul.zpp_pool?Ae=new Ul:(Ae=Ul.zpp_pool,Ul.zpp_pool=Ae.next,Ae.next=null),Ae.elt=Le,(je=Ae).next=Se.head,Se.head=je,Se.modified=!0,Se.length++),Le=Le.compound):(null!=Ne.cbSet&&(Ee=this.mrca1,null==Ul.zpp_pool?Ie=new Ul:(Ie=Ul.zpp_pool,Ul.zpp_pool=Ie.next,Ie.next=null),Ie.elt=Ne,(Te=Ie).next=Ee.head,Ee.head=Te,Ee.modified=!0,Ee.length++),Ne=Ne.compound)}for(var Ve,De,Fe=this.mrca1.head;null!=Fe;){for(var Re=Fe.elt,Ze=this.mrca2.head;null!=Ze;){for(var Be,Ge=Ze.elt,qe=Re.cbSet,Ue=Ge.cbSet,Ke=null,We=(qe.cbpairs.length<Ue.cbpairs.length?qe.cbpairs:Ue.cbpairs).head;null!=We;){var Ye=We.elt;if(Ye.a==qe&&Ye.b==Ue||Ye.a==Ue&&Ye.b==qe){Ke=Ye;break}We=We.next}if(null==Ke&&(null==Nl.zpp_pool?Be=new Nl:(Be=Nl.zpp_pool,Nl.zpp_pool=Be.next,Be.next=null),Be.zip_listeners=!0,Tl.setlt(qe,Ue)?(Be.a=qe,Be.b=Ue):(Be.a=Ue,Be.b=qe),Ke=Be,qe.cbpairs.add(Ke),Ue!=qe&&Ue.cbpairs.add(Ke)),Ke.zip_listeners&&(Ke.zip_listeners=!1,Ke.__validate()),null!=Ke.listeners.head){for(var Je=null,Xe=null,He=this.prelisteners;null!=He.head;){var $e=He.head;He.head=$e.next,$e.elt=null,$e.next=ql.zpp_pool,ql.zpp_pool=$e,null==He.head&&(He.pushmod=!0),He.modified=!0,He.length--}He.pushmod=!0;for(var Qe,ni=null,ti=null,ei=(qe.cbpairs.length<Ue.cbpairs.length?qe.cbpairs:Ue.cbpairs).head;null!=ei;){var ii=ei.elt;if(ii.a==qe&&ii.b==Ue||ii.a==Ue&&ii.b==qe){ti=ii;break}ei=ei.next}null==ti&&(null==Nl.zpp_pool?Qe=new Nl:(Qe=Nl.zpp_pool,Nl.zpp_pool=Qe.next,Qe.next=null),Qe.zip_listeners=!0,Tl.setlt(qe,Ue)?(Qe.a=qe,Qe.b=Ue):(Qe.a=Ue,Qe.b=qe),ti=Qe,qe.cbpairs.add(ti),Ue!=qe&&Ue.cbpairs.add(ti)),ti.zip_listeners&&(ti.zip_listeners=!1,ti.__validate());for(var pi=ti.listeners.head;null!=pi;){var li,ri,oi,ai=pi.elt;5==ai.event&&0!=(1&ai.itype)&&(li=this.prelisteners,null==ql.zpp_pool?ri=new ql:(ri=ql.zpp_pool,ql.zpp_pool=ri.next,ri.next=null),ri.elt=ai,oi=ri,null==ni?(oi.next=li.head,li.head=oi):(oi.next=ni.next,ni.next=oi),li.pushmod=li.modified=!0,li.length++,ni=oi,ae=!!ae||!ai.pure),pi=pi.next}if(null!=this.prelisteners.head){if(null==(Je=Zl.get(Re,Ge))&&(Xe=Bl.get(Re,Ge),this.add_callbackset(Xe)),null==Je||(Je.COLLISIONstamp!=this.stamp||p)&&0==(4&Je.COLLISIONstate)){if(null!=Xe&&(Je=Xe),null!=Je)for(var si=this.prelisteners.head;null!=si;)7==si.elt.itype?(Je.COLLISIONstamp=this.stamp,Je.SENSORstamp=this.stamp,Je.FLUIDstamp=this.stamp):Je.COLLISIONstamp=this.stamp,si=si.next;var _i=Et.active,hi=Et.active=!0,ui=null,xi=null,di=Et.innards.next;Et.hc2=!1;for(var yi,zi,ci=Et.contacts.next;null!=ci;){var vi,mi,fi,bi,gi,wi,Mi,Ci,ki=ci;ki.stamp+co.arbiterExpirationDelay<Et.stamp?(vi=Et.contacts,null==ui?(fi=(mi=vi.next).next,vi.next=fi,null==vi.next&&(vi.pushmod=!0)):(fi=(mi=ui.next).next,null==(ui.next=fi)&&(vi.pushmod=!0)),mi._inuse=!1,vi.modified=!0,vi.length--,vi.pushmod=!0,ci=fi,bi=Et.innards,null==xi?(wi=(gi=bi.next).next,bi.next=wi,null==bi.next&&(bi.pushmod=!0)):(wi=(gi=xi.next).next,null==(xi.next=wi)&&(bi.pushmod=!0)),gi._inuse=!1,bi.modified=!0,bi.length--,bi.pushmod=!0,di=wi,ki.arbiter=null,ki.next=Rl.zpp_pool,Rl.zpp_pool=ki):(Mi=ki.inner,Ci=ki.active,ki.active=ki.stamp==Et.stamp,ki.active&&(hi?(hi=!1,Et.c1=Mi,Et.oc1=ki):(Et.hc2=!0,Et.c2=Mi,Et.oc2=ki)),Ci!=ki.active&&(Et.contacts.modified=!0),ui=ci,di=(xi=di).next,ci=ci.next)}Et.hc2?(Et.hpc2=!0,Et.oc1.posOnly?(yi=Et.c1,Et.c1=Et.c2,Et.c2=yi,zi=Et.oc1,Et.oc1=Et.oc2,Et.oc2=zi,Et.hc2=!1):Et.oc2.posOnly&&(Et.hc2=!1)):Et.hpc2=!1,this.precb.zpp_inner.pre_arbiter=Et,this.precb.zpp_inner.set=Je;for(var Oi=this.prelisteners.head;null!=Oi;){var Pi=Oi.elt;this.precb.zpp_inner.listener=Pi;var Si,Ai,ji=this.precb.zpp_inner,Ei=Je.int1,Ii=Je.int2,Ti=Pi.options1,Ni=Ei.cbTypes;!(!Ti.nonemptyintersection(Ni,Ti.includes)||Ti.nonemptyintersection(Ni,Ti.excludes))&&(Si=Pi.options2,Ai=Ii.cbTypes,!!Si.nonemptyintersection(Ai,Si.includes)&&!Si.nonemptyintersection(Ai,Si.excludes))?(ji.int1=Ei,ji.int2=Ii):(ji.int1=Ii,ji.int2=Ei),this.precb.zpp_inner.pre_swapped=Re!=this.precb.zpp_inner.int1;var Li,Vi=Pi.handlerp(this.precb);null!=Vi&&(null==Ll.PreFlag_ACCEPT&&(Ll.internal=!0,Ll.PreFlag_ACCEPT=new Il,Ll.internal=!1),Li=Vi==Ll.PreFlag_ACCEPT?5:(null==Ll.PreFlag_ACCEPT_ONCE&&(Ll.internal=!0,Ll.PreFlag_ACCEPT_ONCE=new Il,Ll.internal=!1),Vi==Ll.PreFlag_ACCEPT_ONCE?1:(null==Ll.PreFlag_IGNORE&&(Ll.internal=!0,Ll.PreFlag_IGNORE=new Il,Ll.internal=!1),Vi==Ll.PreFlag_IGNORE?6:2)),Et.immState=Li),Oi=Oi.next}if(Et.active=_i,null!=Je)for(var Di=this.prelisteners.head;null!=Di;)7==Di.elt.itype?(Je.COLLISIONstate=Et.immState,Je.SENSORstate=Et.immState,Je.FLUIDstate=Et.immState):Je.COLLISIONstate=Et.immState,Di=Di.next}else null==Je?0==(4&Et.immState)&&(Et.immState=1):Et.immState=Je.COLLISIONstate;Ze=Ze.next}else Ze=Ze.next}else Ze=Ze.next}Fe=Fe.next}ae&&0==(4&Et.immState)&&(2==Et.b1.type&&((Ve=Et.b1).world||(Ve.component.waket=this.stamp+(this.midstep?0:1),3==Ve.type&&(Ve.kinematicDelaySleep=!0),Ve.component.sleeping&&this.really_wake(Ve,!1))),2==Et.b1.type&&((De=Et.b2).world||(De.component.waket=this.stamp+(this.midstep?0:1),3==De.type&&(De.kinematicDelaySleep=!0),De.component.sleeping&&this.really_wake(De,!1))))}0!=(1&Et.immState)&&(2==Et.b1.type&&Et.b1.component.sleeping&&((Gt=Et.b1).world||(Gt.component.waket=this.stamp+(this.midstep?0:1),3==Gt.type&&(Gt.kinematicDelaySleep=!0),Gt.component.sleeping&&this.really_wake(Gt,!1))),2==Et.b2.type&&Et.b2.component.sleeping&&((qt=Et.b2).world||(qt.component.waket=this.stamp+(this.midstep?0:1),3==qt.type&&(qt.kinematicDelaySleep=!0),qt.component.sleeping&&this.really_wake(qt,!1)))),Et.sleeping&&(Et.sleeping=!1,null==Yl.zpp_pool?Ut=new Yl:(Ut=Yl.zpp_pool,Yl.zpp_pool=Ut.next,Ut.next=null),Ut.elt=Et,(Kt=Ut).next=Pt.head,Pt.head=Kt,Pt.modified=!0,Pt.length++),y=Et}else{y=Yt?((Wt=Et).userdef_dyn_fric=!1,Wt.userdef_stat_fric=!1,Wt.userdef_restitution=!1,Wt.userdef_rfric=!1,Wt.__ref_edge1=Wt.__ref_edge2=null,Wt.next=Fl.zpp_pool,Fl.zpp_pool=Wt,null):Et}else y=Et}else{if(null==i){for(var Fi=null,Ri=(z.arbiters.length<c.arbiters.length?z:c).arbiters.head;null!=Ri;){var Zi=Ri.elt;if(Zi.id==x.id&&Zi.di==d.id){Fi=Zi;break}Ri=Ri.next}P=Fi}else P=i;var Bi,Gi,qi,Ui,Ki,Wi,Yi,Ji,Xi,Hi,$i,Qi,np,tp,ep,ip,pp=null==P,lp=!1;if(pp)null==Vl.zpp_pool?Bi=new Vl:(Bi=Vl.zpp_pool,Vl.zpp_pool=Bi.next,Bi.next=null);else if(null==P.sensorarb){P.cleared=!0;for(var rp,op,ap=P.b1.arbiters,sp=null,_p=ap.head;null!=_p;){if(_p.elt==P){null==sp?(op=(rp=ap.head).next,ap.head=op,null==ap.head&&(ap.pushmod=!0)):(op=(rp=sp.next).next,null==(sp.next=op)&&(ap.pushmod=!0));var hp=rp;hp.elt=null,hp.next=Gl.zpp_pool,Gl.zpp_pool=hp,ap.modified=!0,ap.length--,ap.pushmod=!0;break}_p=(sp=_p).next}for(var up,xp,dp=P.b2.arbiters,yp=null,zp=dp.head;null!=zp;){if(zp.elt==P){null==yp?(xp=(up=dp.head).next,dp.head=xp,null==dp.head&&(dp.pushmod=!0)):(xp=(up=yp.next).next,null==(yp.next=xp)&&(dp.pushmod=!0));var cp=up;cp.elt=null,cp.next=Gl.zpp_pool,Gl.zpp_pool=cp,dp.modified=!0,dp.length--,dp.pushmod=!0;break}zp=(yp=zp).next}null!=P.pair&&(P.pair.arb=null,P.pair=null),P.active=!1,this.f_arbiters.modified=!0,null==Vl.zpp_pool?Bi=new Vl:(Bi=Vl.zpp_pool,Vl.zpp_pool=Bi.next,Bi.next=null),lp=pp=Bi.intchange=!0}else Bi=P.sensorarb;if(pp||Bi.stamp!=this.stamp||p)if(Bi.stamp=this.stamp,vo.testCollide(x,d)){if(pp?(Gi=x.id,qi=d.id,Bi.b1=n.body,Bi.ws1=n,Bi.b2=t.body,Bi.ws2=t,Bi.id=Gi,Bi.di=qi,Ui=Bi.b1.arbiters,null==Gl.zpp_pool?Ki=new Gl:(Ki=Gl.zpp_pool,Gl.zpp_pool=Ki.next,Ki.next=null),Ki.elt=Bi,(Wi=Ki).next=Ui.head,Ui.head=Wi,Ui.modified=!0,Ui.length++,Yi=Bi.b2.arbiters,null==Gl.zpp_pool?Ji=new Gl:(Ji=Gl.zpp_pool,Gl.zpp_pool=Ji.next,Ji.next=null),Ji.elt=Bi,(Xi=Ji).next=Yi.head,Yi.head=Xi,Yi.modified=!0,Yi.length++,Bi.active=!0,Bi.present=0,Bi.cleared=!1,Bi.sleeping=!1,Bi.fresh=!1,Bi.presentable=!1,Hi=this.s_arbiters,null==Wl.zpp_pool?$i=new Wl:($i=Wl.zpp_pool,Wl.zpp_pool=$i.next,$i.next=null),$i.elt=Bi,(Qi=$i).next=Hi.head,Hi.head=Qi,Hi.modified=!0,Hi.length++,Bi.fresh=!lp):Bi.fresh=Bi.up_stamp<this.stamp-1||Bi.endGenerated==this.stamp&&p,Bi.up_stamp=Bi.stamp,Bi.fresh||0==(4&Bi.immState)){for(var vp=!(Bi.immState=1),mp=Bi.ws1.id>Bi.ws2.id?Bi.ws2:Bi.ws1,fp=Bi.ws1.id>Bi.ws2.id?Bi.ws1:Bi.ws2,bp=this.mrca1;null!=bp.head;){var gp=bp.head;bp.head=gp.next,gp.elt=null,gp.next=Ul.zpp_pool,Ul.zpp_pool=gp,null==bp.head&&(bp.pushmod=!0),bp.modified=!0,bp.length--}bp.pushmod=!0;for(var wp,Mp,Cp,kp,Op,Pp,Sp,Ap,jp,Ep,Ip,Tp,Np,Lp,Vp=this.mrca2;null!=Vp.head;){var Dp=Vp.head;Vp.head=Dp.next,Dp.elt=null,Dp.next=Ul.zpp_pool,Ul.zpp_pool=Dp,null==Vp.head&&(Vp.pushmod=!0),Vp.modified=!0,Vp.length--}Vp.pushmod=!0,null!=mp.cbSet&&(wp=this.mrca1,null==Ul.zpp_pool?Mp=new Ul:(Mp=Ul.zpp_pool,Ul.zpp_pool=Mp.next,Mp.next=null),Mp.elt=mp,(Cp=Mp).next=wp.head,wp.head=Cp,wp.modified=!0,wp.length++),null!=mp.body.cbSet&&(kp=this.mrca1,Op=mp.body,null==Ul.zpp_pool?Pp=new Ul:(Pp=Ul.zpp_pool,Ul.zpp_pool=Pp.next,Pp.next=null),Pp.elt=Op,(Sp=Pp).next=kp.head,kp.head=Sp,kp.modified=!0,kp.length++),null!=fp.cbSet&&(Ap=this.mrca2,null==Ul.zpp_pool?jp=new Ul:(jp=Ul.zpp_pool,Ul.zpp_pool=jp.next,jp.next=null),jp.elt=fp,(Ep=jp).next=Ap.head,Ap.head=Ep,Ap.modified=!0,Ap.length++),null!=fp.body.cbSet&&(Ip=this.mrca2,Tp=fp.body,null==Ul.zpp_pool?Np=new Ul:(Np=Ul.zpp_pool,Ul.zpp_pool=Np.next,Np.next=null),Np.elt=Tp,(Lp=Np).next=Ip.head,Ip.head=Lp,Ip.modified=!0,Ip.length++);for(var Fp,Rp,Zp,Bp,Gp,qp,Up=mp.body.compound,Kp=fp.body.compound;Up!=Kp;){(null==Up?0:Up.depth)<(null==Kp?0:Kp.depth)?(null!=Kp.cbSet&&(Fp=this.mrca2,null==Ul.zpp_pool?Rp=new Ul:(Rp=Ul.zpp_pool,Ul.zpp_pool=Rp.next,Rp.next=null),Rp.elt=Kp,(Zp=Rp).next=Fp.head,Fp.head=Zp,Fp.modified=!0,Fp.length++),Kp=Kp.compound):(null!=Up.cbSet&&(Bp=this.mrca1,null==Ul.zpp_pool?Gp=new Ul:(Gp=Ul.zpp_pool,Ul.zpp_pool=Gp.next,Gp.next=null),Gp.elt=Up,(qp=Gp).next=Bp.head,Bp.head=qp,Bp.modified=!0,Bp.length++),Up=Up.compound)}for(var Wp,Yp,Jp=this.mrca1.head;null!=Jp;){for(var Xp=Jp.elt,Hp=this.mrca2.head;null!=Hp;){for(var $p,Qp=Hp.elt,nl=Xp.cbSet,tl=Qp.cbSet,el=null,il=(nl.cbpairs.length<tl.cbpairs.length?nl.cbpairs:tl.cbpairs).head;null!=il;){var pl=il.elt;if(pl.a==nl&&pl.b==tl||pl.a==tl&&pl.b==nl){el=pl;break}il=il.next}if(null==el&&(null==Nl.zpp_pool?$p=new Nl:($p=Nl.zpp_pool,Nl.zpp_pool=$p.next,$p.next=null),$p.zip_listeners=!0,Tl.setlt(nl,tl)?($p.a=nl,$p.b=tl):($p.a=tl,$p.b=nl),el=$p,nl.cbpairs.add(el),tl!=nl&&tl.cbpairs.add(el)),el.zip_listeners&&(el.zip_listeners=!1,el.__validate()),null!=el.listeners.head){for(var ll=null,rl=null,ol=this.prelisteners;null!=ol.head;){var al=ol.head;ol.head=al.next,al.elt=null,al.next=ql.zpp_pool,ql.zpp_pool=al,null==ol.head&&(ol.pushmod=!0),ol.modified=!0,ol.length--}ol.pushmod=!0;for(var sl,_l=null,hl=null,ul=(nl.cbpairs.length<tl.cbpairs.length?nl.cbpairs:tl.cbpairs).head;null!=ul;){var xl=ul.elt;if(xl.a==nl&&xl.b==tl||xl.a==tl&&xl.b==nl){hl=xl;break}ul=ul.next}null==hl&&(null==Nl.zpp_pool?sl=new Nl:(sl=Nl.zpp_pool,Nl.zpp_pool=sl.next,sl.next=null),sl.zip_listeners=!0,Tl.setlt(nl,tl)?(sl.a=nl,sl.b=tl):(sl.a=tl,sl.b=nl),hl=sl,nl.cbpairs.add(hl),tl!=nl&&tl.cbpairs.add(hl)),hl.zip_listeners&&(hl.zip_listeners=!1,hl.__validate());for(var dl=hl.listeners.head;null!=dl;){var yl,zl,cl,vl=dl.elt;5==vl.event&&0!=(2&vl.itype)&&(yl=this.prelisteners,null==ql.zpp_pool?zl=new ql:(zl=ql.zpp_pool,ql.zpp_pool=zl.next,zl.next=null),zl.elt=vl,cl=zl,null==_l?(cl.next=yl.head,yl.head=cl):(cl.next=_l.next,_l.next=cl),yl.pushmod=yl.modified=!0,yl.length++,_l=cl,vp=!!vp||!vl.pure),dl=dl.next}if(null!=this.prelisteners.head){if(null==(ll=Zl.get(Xp,Qp))&&(rl=Bl.get(Xp,Qp),this.add_callbackset(rl)),null==ll||(ll.SENSORstamp!=this.stamp||p)&&0==(4&ll.SENSORstate)){if(null!=rl&&(ll=rl),null!=ll)for(var ml=this.prelisteners.head;null!=ml;)7==ml.elt.itype?(ll.COLLISIONstamp=this.stamp,ll.SENSORstamp=this.stamp,ll.FLUIDstamp=this.stamp):ll.SENSORstamp=this.stamp,ml=ml.next;var fl=Bi.active;Bi.active=!0,this.precb.zpp_inner.pre_arbiter=Bi,this.precb.zpp_inner.set=ll;for(var bl=this.prelisteners.head;null!=bl;){var gl=bl.elt;this.precb.zpp_inner.listener=gl;var wl,Ml,Cl=this.precb.zpp_inner,kl=ll.int1,Ol=ll.int2,Pl=gl.options1,Sl=kl.cbTypes;!(!Pl.nonemptyintersection(Sl,Pl.includes)||Pl.nonemptyintersection(Sl,Pl.excludes))&&(wl=gl.options2,Ml=Ol.cbTypes,!!wl.nonemptyintersection(Ml,wl.includes)&&!wl.nonemptyintersection(Ml,wl.excludes))?(Cl.int1=kl,Cl.int2=Ol):(Cl.int1=Ol,Cl.int2=kl),this.precb.zpp_inner.pre_swapped=Xp!=this.precb.zpp_inner.int1;var Al,jl=gl.handlerp(this.precb);null!=jl&&(null==Ll.PreFlag_ACCEPT&&(Ll.internal=!0,Ll.PreFlag_ACCEPT=new Il,Ll.internal=!1),Al=jl==Ll.PreFlag_ACCEPT?5:(null==Ll.PreFlag_ACCEPT_ONCE&&(Ll.internal=!0,Ll.PreFlag_ACCEPT_ONCE=new Il,Ll.internal=!1),jl==Ll.PreFlag_ACCEPT_ONCE?1:(null==Ll.PreFlag_IGNORE&&(Ll.internal=!0,Ll.PreFlag_IGNORE=new Il,Ll.internal=!1),jl==Ll.PreFlag_IGNORE?6:2)),Bi.immState=Al),bl=bl.next}if(Bi.active=fl,null!=ll)for(var El=this.prelisteners.head;null!=El;)7==El.elt.itype?(ll.COLLISIONstate=Bi.immState,ll.SENSORstate=Bi.immState,ll.FLUIDstate=Bi.immState):ll.SENSORstate=Bi.immState,El=El.next}else null==ll?0==(4&Bi.immState)&&(Bi.immState=1):Bi.immState=ll.SENSORstate;Hp=Hp.next}else Hp=Hp.next}else Hp=Hp.next}Jp=Jp.next}vp&&0==(4&Bi.immState)&&(1!=Bi.b1.type&&((Wp=Bi.b1).world||(Wp.component.waket=this.stamp+(this.midstep?0:1),3==Wp.type&&(Wp.kinematicDelaySleep=!0),Wp.component.sleeping&&this.really_wake(Wp,!1))),1!=Bi.b2.type&&((Yp=Bi.b2).world||(Yp.component.waket=this.stamp+(this.midstep?0:1),3==Yp.type&&(Yp.kinematicDelaySleep=!0),Yp.component.sleeping&&this.really_wake(Yp,!1))))}Bi.sleeping&&(Bi.sleeping=!1,np=this.s_arbiters,null==Wl.zpp_pool?tp=new Wl:(tp=Wl.zpp_pool,Wl.zpp_pool=tp.next,tp.next=null),tp.elt=Bi,(ep=tp).next=np.head,np.head=ep,np.modified=!0,np.length++),y=Bi}else{y=pp?((ip=Bi).next=Vl.zpp_pool,Vl.zpp_pool=ip,null):Bi}else y=Bi}}return y},ae.prototype.mrca1=null,ae.prototype.mrca2=null,ae.prototype.MRCA_chains=function(n,t){for(var e=this.mrca1;null!=e.head;){var i=e.head;e.head=i.next,i.elt=null,i.next=Ul.zpp_pool,Ul.zpp_pool=i,null==e.head&&(e.pushmod=!0),e.modified=!0,e.length--}e.pushmod=!0;for(var p,l,r,o,a,s,_,h,u,x,d,y,z,c,v=this.mrca2;null!=v.head;){var m=v.head;v.head=m.next,m.elt=null,m.next=Ul.zpp_pool,Ul.zpp_pool=m,null==v.head&&(v.pushmod=!0),v.modified=!0,v.length--}v.pushmod=!0,null!=n.cbSet&&(p=this.mrca1,null==Ul.zpp_pool?l=new Ul:(l=Ul.zpp_pool,Ul.zpp_pool=l.next,l.next=null),l.elt=n,(r=l).next=p.head,p.head=r,p.modified=!0,p.length++),null!=n.body.cbSet&&(o=this.mrca1,a=n.body,null==Ul.zpp_pool?s=new Ul:(s=Ul.zpp_pool,Ul.zpp_pool=s.next,s.next=null),s.elt=a,(_=s).next=o.head,o.head=_,o.modified=!0,o.length++),null!=t.cbSet&&(h=this.mrca2,null==Ul.zpp_pool?u=new Ul:(u=Ul.zpp_pool,Ul.zpp_pool=u.next,u.next=null),u.elt=t,(x=u).next=h.head,h.head=x,h.modified=!0,h.length++),null!=t.body.cbSet&&(d=this.mrca2,y=t.body,null==Ul.zpp_pool?z=new Ul:(z=Ul.zpp_pool,Ul.zpp_pool=z.next,z.next=null),z.elt=y,(c=z).next=d.head,d.head=c,d.modified=!0,d.length++);for(var f,b,g,w,M,C,k=n.body.compound,O=t.body.compound;k!=O;){(null==k?0:k.depth)<(null==O?0:O.depth)?(null!=O.cbSet&&(f=this.mrca2,null==Ul.zpp_pool?b=new Ul:(b=Ul.zpp_pool,Ul.zpp_pool=b.next,b.next=null),b.elt=O,(g=b).next=f.head,f.head=g,f.modified=!0,f.length++),O=O.compound):(null!=k.cbSet&&(w=this.mrca1,null==Ul.zpp_pool?M=new Ul:(M=Ul.zpp_pool,Ul.zpp_pool=M.next,M.next=null),M.elt=k,(C=M).next=w.head,w.head=C,w.modified=!0,w.length++),k=k.compound)}},ae.prototype.inlined_MRCA_chains=function(n,t){for(var e=this.mrca1;null!=e.head;){var i=e.head;e.head=i.next,i.elt=null,i.next=Ul.zpp_pool,Ul.zpp_pool=i,null==e.head&&(e.pushmod=!0),e.modified=!0,e.length--}e.pushmod=!0;for(var p,l,r,o,a,s,_,h,u,x,d,y,z,c,v=this.mrca2;null!=v.head;){var m=v.head;v.head=m.next,m.elt=null,m.next=Ul.zpp_pool,Ul.zpp_pool=m,null==v.head&&(v.pushmod=!0),v.modified=!0,v.length--}v.pushmod=!0,null!=n.cbSet&&(p=this.mrca1,null==Ul.zpp_pool?l=new Ul:(l=Ul.zpp_pool,Ul.zpp_pool=l.next,l.next=null),l.elt=n,(r=l).next=p.head,p.head=r,p.modified=!0,p.length++),null!=n.body.cbSet&&(o=this.mrca1,a=n.body,null==Ul.zpp_pool?s=new Ul:(s=Ul.zpp_pool,Ul.zpp_pool=s.next,s.next=null),s.elt=a,(_=s).next=o.head,o.head=_,o.modified=!0,o.length++),null!=t.cbSet&&(h=this.mrca2,null==Ul.zpp_pool?u=new Ul:(u=Ul.zpp_pool,Ul.zpp_pool=u.next,u.next=null),u.elt=t,(x=u).next=h.head,h.head=x,h.modified=!0,h.length++),null!=t.body.cbSet&&(d=this.mrca2,y=t.body,null==Ul.zpp_pool?z=new Ul:(z=Ul.zpp_pool,Ul.zpp_pool=z.next,z.next=null),z.elt=y,(c=z).next=d.head,d.head=c,d.modified=!0,d.length++);for(var f,b,g,w,M,C,k=n.body.compound,O=t.body.compound;k!=O;){(null==k?0:k.depth)<(null==O?0:O.depth)?(null!=O.cbSet&&(f=this.mrca2,null==Ul.zpp_pool?b=new Ul:(b=Ul.zpp_pool,Ul.zpp_pool=b.next,b.next=null),b.elt=O,(g=b).next=f.head,f.head=g,f.modified=!0,f.length++),O=O.compound):(null!=k.cbSet&&(w=this.mrca1,null==Ul.zpp_pool?M=new Ul:(M=Ul.zpp_pool,Ul.zpp_pool=M.next,M.next=null),M.elt=k,(C=M).next=w.head,w.head=C,w.modified=!0,w.length++),k=k.compound)}},ae.prototype.__class__=ae;var se=zpp_nape.space.ZPP_SweepData=function(){this.aabb=null,this.shape=null,this.prev=null,this.next=null};se.__name__=["zpp_nape","space","ZPP_SweepData"],se.prototype.next=null,se.prototype.prev=null,se.prototype.shape=null,se.prototype.aabb=null,se.prototype.free=function(){this.prev=null,this.shape=null,this.aabb=null},se.prototype.alloc=function(){},se.prototype.gt=function(n){return this.aabb.minx>n.aabb.minx},se.prototype.__class__=se;var _e=zpp_nape.space.ZPP_SweepPhase=function(n){this.failed=null,this.list=null,ee.call(this),this.space=n,this.is_sweep=!0,this.sweep=this};_e.__name__=["zpp_nape","space","ZPP_SweepPhase"],_e.__super__=ee,_e.prototype=Object.create(ee.prototype),_e.prototype.list=null,_e.prototype.__insert=function(n){var t;null==se.zpp_pool?t=new se:(t=se.zpp_pool,se.zpp_pool=t.next,t.next=null),(n.sweep=t).shape=n,t.aabb=n.aabb,t.next=this.list,null!=this.list&&(this.list.prev=t),this.list=t},_e.prototype.__remove=function(n){var t=n.sweep;null==t.prev?this.list=t.next:t.prev.next=t.next,null!=t.next&&(t.next.prev=t.prev),n.sweep=null,t.prev=null,t.shape=null,t.aabb=null,t.next=se.zpp_pool,se.zpp_pool=t},_e.prototype.__sync=function(n){if(!this.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var t=n.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var e=t.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0;var i=e.localCOMy=0,p=e.lverts.next,l=p,r=p=p.next;for(p=p.next;null!=p;){var o=p;i+=r.x*(o.y-l.y);var a=o.y*r.x-o.x*r.y;e.localCOMx+=(r.x+o.x)*a,e.localCOMy+=(r.y+o.y)*a,l=r,r=o,p=p.next}var s=p=e.lverts.next;i+=r.x*(s.y-l.y);var _=s.y*r.x-s.x*r.y;e.localCOMx+=(r.x+s.x)*_,e.localCOMy+=(r.y+s.y)*_,l=r;var h=p=p.next;i+=s.x*(h.y-l.y);var u=h.y*s.x-h.x*s.y;e.localCOMx+=(s.x+h.x)*u,e.localCOMy+=(s.y+h.y)*u;var x=i=1/(3*i);e.localCOMx*=x,e.localCOMy*=x}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var d=t.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var y=t.radius,z=t.radius;t.aabb.minx=t.worldCOMx-y,t.aabb.miny=t.worldCOMy-z,t.aabb.maxx=t.worldCOMx+y,t.aabb.maxy=t.worldCOMy+z}else{var c=n.polygon;if(c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var v=c.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot));for(var m=c.lverts.next,f=c.gverts.next;null!=f;){var b=f,g=m,m=m.next;b.x=c.body.posx+(c.body.axisy*g.x-c.body.axisx*g.y),b.y=c.body.posy+(g.x*c.body.axisx+g.y*c.body.axisy),f=f.next}}var w=c.gverts.next;c.aabb.minx=w.x,c.aabb.miny=w.y,c.aabb.maxx=w.x,c.aabb.maxy=w.y;for(var M=c.gverts.next.next;null!=M;){var C=M;C.x<c.aabb.minx&&(c.aabb.minx=C.x),C.x>c.aabb.maxx&&(c.aabb.maxx=C.x),C.y<c.aabb.miny&&(c.aabb.miny=C.y),C.y>c.aabb.maxy&&(c.aabb.maxy=C.y),M=M.next}}},_e.prototype.sync_broadphase=function(){if(this.space.validation(),null!=this.list)for(var n=this.list.next;null!=n;){var t=n.next,e=n.prev;if(n.aabb.minx>e.aabb.minx)n=t;else{for(;null!=e.prev&&e.prev.aabb.minx>n.aabb.minx;)e=e.prev;var i=n.prev;i.next=n.next,null!=n.next&&(n.next.prev=i),null==e.prev?(n.prev=null,((this.list=n).next=e).prev=n):(n.prev=e.prev,((e.prev=n).prev.next=n).next=e),n=t}}},_e.prototype.sync_broadphase_fast=function(){for(var n=this.list.next;null!=n;){var t=n.next,e=n.prev;if(n.aabb.minx>e.aabb.minx)n=t;else{for(;null!=e.prev&&e.prev.aabb.minx>n.aabb.minx;)e=e.prev;var i=n.prev;i.next=n.next,null!=n.next&&(n.next.prev=i),null==e.prev?(n.prev=null,((this.list=n).next=e).prev=n):(n.prev=e.prev,((e.prev=n).prev.next=n).next=e),n=t}}},_e.prototype.broadphase=function(n,t){if(null!=this.list){for(var e=this.list.next;null!=e;){var i=e.next,p=e.prev;if(e.aabb.minx>p.aabb.minx)e=i;else{for(;null!=p.prev&&p.prev.aabb.minx>e.aabb.minx;)p=p.prev;var l=e.prev;l.next=e.next,null!=e.next&&(e.next.prev=l),null==p.prev?(e.prev=null,((this.list=e).next=p).prev=e):(e.prev=p.prev,((p.prev=e).prev.next=e).next=p),e=i}}for(var r=this.list;null!=r;){for(var o=r.next,a=r.shape,s=a.body,_=r.aabb.maxx;null!=o&&!(o.aabb.minx>_);){var h,u,x=o.shape,d=x.body;o=(d!=s&&(1==s.type&&1==d.type||s.component.sleeping&&d.component.sleeping||(h=a.aabb,(u=x.aabb).miny>h.maxy||h.miny>u.maxy||(t?n.narrowPhase(a,x,2!=s.type||2!=d.type,null,!1):n.continuousEvent(a,x,2!=s.type||2!=d.type,null,!1)))),o.next)}r=r.next}}},_e.prototype.clear=function(){for(;null!=this.list;)this.list.shape.removedFromSpace(),this.__remove(this.list.shape)},_e.prototype.shapesUnderPoint=function(n,t,e,i){var p;this.sync_broadphase(),null==mo.zpp_pool?p=new mo:(p=mo.zpp_pool,mo.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t;for(var l,r,o=p,a=null==i?new bn:i,s=this.list;null!=s&&s.aabb.minx>n;)s=s.next;for(;null!=s&&s.aabb.minx<=n;){s.aabb.maxx>=n&&s.aabb.miny<=t&&s.aabb.maxy>=t&&(l=s.shape,(null==e||0!=((r=l.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&r.collisionGroup))&&(0==l.type?vo.circleContains(l.circle,o)&&a.push(l.outer):vo.polyContains(l.polygon,o)&&a.push(l.outer))),s=s.next}return null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=mo.zpp_pool,mo.zpp_pool=o,a},_e.prototype.bodiesUnderPoint=function(n,t,e,i){var p;this.sync_broadphase(),null==mo.zpp_pool?p=new mo:(p=mo.zpp_pool,mo.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t;for(var l,r,o,a=p,s=null==i?new tn:i,_=this.list;null!=_&&_.aabb.minx>n;)_=_.next;for(;null!=_&&_.aabb.minx<=n;){_.aabb.maxx>=n&&_.aabb.miny<=t&&_.aabb.maxy>=t&&(r=(l=_.shape).body.outer,s.has(r)||(null==e||0!=((o=l.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&o.collisionGroup))&&(0==l.type?vo.circleContains(l.circle,a)&&s.push(r):vo.polyContains(l.polygon,a)&&s.push(r))),_=_.next}return null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=mo.zpp_pool,mo.zpp_pool=a,s},_e.prototype.shapesInAABB=function(n,t,e,i,p){this.sync_broadphase(),this.updateAABBShape(n);for(var l=this.aabbShape.zpp_inner.aabb,r=null==p?new bn:p,o=this.list;null!=o&&o.aabb.maxx<l.minx;)o=o.next;for(;null!=o&&o.aabb.minx<=l.maxx;){var a,s,_,h,u,x=o.shape;(null==i||0!=((a=x.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&a.collisionGroup))&&(t?e?vo.containTest(this.aabbShape.zpp_inner,x)&&r.push(x.outer):(s=o.aabb).minx>=l.minx&&s.miny>=l.miny&&s.maxx<=l.maxx&&s.maxy<=l.maxy?r.push(x.outer):(_=o.aabb,l.miny<=_.maxy&&_.miny<=l.maxy&&l.minx<=_.maxx&&_.minx<=l.maxx&&vo.testCollide_safe(x,this.aabbShape.zpp_inner)&&r.push(x.outer)):(e?(h=o.aabb).minx>=l.minx&&h.miny>=l.miny&&h.maxx<=l.maxx&&h.maxy<=l.maxy:(u=o.aabb,l.miny<=u.maxy&&u.miny<=l.maxy&&l.minx<=u.maxx&&u.minx<=l.maxx))&&r.push(x.outer)),o=o.next}return r},_e.prototype.failed=null,_e.prototype.bodiesInAABB=function(n,t,e,i,p){this.sync_broadphase(),this.updateAABBShape(n);var l=this.aabbShape.zpp_inner.aabb,r=null==p?new tn:p;null==this.failed&&(this.failed=new tn);for(var o=this.list;null!=o&&o.aabb.maxx<l.minx;)o=o.next;for(;null!=o&&o.aabb.minx<=l.maxx;){var a,s,_,h,u,x=o.shape,d=x.body.outer,y=o.aabb;l.miny<=y.maxy&&y.miny<=l.maxy&&l.minx<=y.maxx&&y.minx<=l.maxx&&(null==i||0!=((a=x.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&a.collisionGroup))&&(t?e?this.failed.has(d)||(s=vo.containTest(this.aabbShape.zpp_inner,x),!r.has(d)&&s?r.push(d):s||(r.remove(d),this.failed.push(d))):!r.has(d)&&vo.testCollide_safe(x,this.aabbShape.zpp_inner)&&r.push(d):e?this.failed.has(d)||(h=(_=x.aabb).minx>=l.minx&&_.miny>=l.miny&&_.maxx<=l.maxx&&_.maxy<=l.maxy,!r.has(d)&&h?r.push(d):h||(r.remove(d),this.failed.push(d))):!r.has(d)&&((u=x.aabb).minx>=l.minx&&u.miny>=l.miny&&u.maxx<=l.maxx&&u.maxy<=l.maxy)&&r.push(d)),o=o.next}return this.failed.clear(),r},_e.prototype.shapesInCircle=function(n,t,e,i,p,l){this.sync_broadphase(),this.updateCircShape(n,t,e);for(var r=this.circShape.zpp_inner.aabb,o=null==l?new bn:l,a=this.list;null!=a&&a.aabb.maxx<r.minx;)a=a.next;for(;null!=a&&a.aabb.minx<=r.maxx;){var s,_,h=a.aabb;r.miny<=h.maxy&&h.miny<=r.maxy&&r.minx<=h.maxx&&h.minx<=r.maxx&&(s=a.shape,(null==p||0!=((_=s.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&_.collisionGroup))&&(i?vo.containTest(this.circShape.zpp_inner,s)&&o.push(s.outer):vo.testCollide_safe(s,this.circShape.zpp_inner)&&o.push(s.outer))),a=a.next}return o},_e.prototype.bodiesInCircle=function(n,t,e,i,p,l){this.sync_broadphase(),this.updateCircShape(n,t,e);var r=this.circShape.zpp_inner.aabb,o=null==l?new tn:l;null==this.failed&&(this.failed=new tn);for(var a=this.list;null!=a&&a.aabb.maxx<r.minx;)a=a.next;for(;null!=a&&a.aabb.minx<=r.maxx;){var s,_,h,u,x=a.aabb;r.miny<=x.maxy&&x.miny<=r.maxy&&r.minx<=x.maxx&&x.minx<=r.maxx&&(_=(s=a.shape).body.outer,(null==p||0!=((h=s.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&h.collisionGroup))&&(i?this.failed.has(_)||(u=vo.containTest(this.circShape.zpp_inner,s),!o.has(_)&&u?o.push(_):u||(o.remove(_),this.failed.push(_))):!o.has(_)&&vo.testCollide_safe(s,this.circShape.zpp_inner)&&o.push(_))),a=a.next}return this.failed.clear(),o},_e.prototype.shapesInShape=function(n,t,e,i){this.sync_broadphase(),this.validateShape(n);for(var p=n.aabb,l=null==i?new bn:i,r=this.list;null!=r&&r.aabb.maxx<p.minx;)r=r.next;for(;null!=r&&r.aabb.minx<=p.maxx;){var o,a,s=r.aabb;p.miny<=s.maxy&&s.miny<=p.maxy&&p.minx<=s.maxx&&s.minx<=p.maxx&&(o=r.shape,(null==e||0!=((a=o.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&a.collisionGroup))&&(t?vo.containTest(n,o)&&l.push(o.outer):vo.testCollide_safe(o,n)&&l.push(o.outer))),r=r.next}return l},_e.prototype.bodiesInShape=function(n,t,e,i){this.sync_broadphase(),this.validateShape(n);var p=n.aabb,l=null==i?new tn:i;null==this.failed&&(this.failed=new tn);for(var r=this.list;null!=r&&r.aabb.maxx<p.minx;)r=r.next;for(;null!=r&&r.aabb.minx<=p.maxx;){var o,a,s,_,h=r.aabb;p.miny<=h.maxy&&h.miny<=p.maxy&&p.minx<=h.maxx&&h.minx<=p.maxx&&(a=(o=r.shape).body.outer,(null==e||0!=((s=o.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&s.collisionGroup))&&(t?this.failed.has(a)||(_=vo.containTest(n,o),!l.has(a)&&_?l.push(a):_||(l.remove(a),this.failed.push(a))):!l.has(a)&&vo.testCollide_safe(n,o)&&l.push(a))),r=r.next}return this.failed.clear(),l},_e.prototype.rayCast=function(n,t,e){this.sync_broadphase(),n.validate_dir();var i=n.rayAABB(),p=n.maxdist,l=null;if(0==n.dirx)for(var r=this.list;null!=r&&r.aabb.minx<=i.minx;){var o,a,s,_=r.aabb;!(i.miny<=_.maxy&&_.miny<=i.maxy&&i.minx<=_.maxx&&_.minx<=i.maxx&&(null==e||0!=((o=r.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&o.collisionGroup)))||0<=(a=n.aabbsect(r.aabb))&&a<p&&(null!=(s=0==r.shape.type?n.circlesect(r.shape.circle,t,p):n.polysect(r.shape.polygon,t,p))&&(p=s.zpp_inner.toiDistance,null!=l&&l.zpp_inner.free(),l=s)),r=r.next}else if(n.dirx<0){for(var h=this.list,u=null;null!=h&&h.aabb.minx<=i.maxx;)h=(u=h).next;for(h=u;null!=h;){var x,d,y,z=h.aabb;!(i.miny<=z.maxy&&z.miny<=i.maxy&&i.minx<=z.maxx&&z.minx<=i.maxx&&(null==e||0!=((x=h.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&x.collisionGroup)))||0<=(d=n.aabbsect(h.aabb))&&d<p&&(null!=(y=0==h.shape.type?n.circlesect(h.shape.circle,t,p):n.polysect(h.shape.polygon,t,p))&&(p=y.zpp_inner.toiDistance,null!=l&&l.zpp_inner.free(),l=y)),h=h.prev}}else for(var c=this.list;null!=c&&c.aabb.minx<=i.maxx&&c.aabb.minx<n.originx+n.dirx*p;){var v,m,f,b=c.aabb;!(i.miny<=b.maxy&&b.miny<=i.maxy&&i.minx<=b.maxx&&b.minx<=i.maxx&&(null==e||0!=((v=c.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&v.collisionGroup)))||0<=(m=n.aabbsect(c.aabb))&&m<p&&(null!=(f=0==c.shape.type?n.circlesect(c.shape.circle,t,p):n.polysect(c.shape.polygon,t,p))&&(p=f.zpp_inner.toiDistance,null!=l&&l.zpp_inner.free(),l=f)),c=c.next}return null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i.wrap_min=i.wrap_max=null,i._invalidate=null,i._validate=null,i.next=Al.zpp_pool,Al.zpp_pool=i,l},_e.prototype.rayMultiCast=function(n,t,e,i){this.sync_broadphase(),n.validate_dir();var p=n.rayAABB(),l=null==i?new J:i;if(0==n.dirx)for(var r=this.list;null!=r&&r.aabb.minx<=p.minx;){var o,a=r.aabb;p.miny<=a.maxy&&a.miny<=p.maxy&&p.minx<=a.maxx&&a.minx<=p.maxx&&(null==e||0!=((o=r.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&o.collisionGroup))&&0<=n.aabbsect(r.aabb)&&(0==r.shape.type?n.circlesect2(r.shape.circle,t,l):n.polysect2(r.shape.polygon,t,l)),r=r.next}else if(n.dirx<0){for(var s=this.list,_=null;null!=s&&s.aabb.minx<=p.maxx;)s=(_=s).next;for(s=_;null!=s;){var h,u=s.aabb;p.miny<=u.maxy&&u.miny<=p.maxy&&p.minx<=u.maxx&&u.minx<=p.maxx&&(null==e||0!=((h=s.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&h.collisionGroup))&&0<=n.aabbsect(s.aabb)&&(0==s.shape.type?n.circlesect2(s.shape.circle,t,l):n.polysect2(s.shape.polygon,t,l)),s=s.prev}}else for(var x=this.list;null!=x&&x.aabb.minx<=p.maxx;){var d,y=x.aabb;p.miny<=y.maxy&&y.miny<=p.maxy&&p.minx<=y.maxx&&y.minx<=p.maxx&&(null==e||0!=((d=x.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&d.collisionGroup))&&0<=n.aabbsect(x.aabb)&&(0==x.shape.type?n.circlesect2(x.shape.circle,t,l):n.polysect2(x.shape.polygon,t,l)),x=x.next}return null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=Al.zpp_pool,Al.zpp_pool=p,l},_e.prototype.__class__=_e;var he=zpp_nape.util.ZNPArray2_Float=function(n,t){this.width=0,this.list=null,this.width=n,this.list=[]};he.__name__=["zpp_nape","util","ZNPArray2_Float"],he.prototype.list=null,he.prototype.width=null,he.prototype.resize=function(n,t,e){for(var i=0,p=(this.width=n)*t;i<p;)this.list[i++]=e},he.prototype.get=function(n,t){return this.list[t*this.width+n]},he.prototype.set=function(n,t,e){return this.list[t*this.width+n]=e},he.prototype.__class__=he;var ue=zpp_nape.util.ZNPArray2_ZPP_GeomVert=function(n,t){this.width=0,this.list=null,this.width=n,this.list=[]};ue.__name__=["zpp_nape","util","ZNPArray2_ZPP_GeomVert"],ue.prototype.list=null,ue.prototype.width=null,ue.prototype.resize=function(n,t,e){for(var i=0,p=(this.width=n)*t;i<p;)this.list[i++]=e},ue.prototype.get=function(n,t){return this.list[t*this.width+n]},ue.prototype.set=function(n,t,e){return this.list[t*this.width+n]=e},ue.prototype.__class__=ue;var xe=zpp_nape.util.ZNPArray2_ZPP_MarchPair=function(n,t){this.width=0,this.list=null,this.width=n,this.list=[]};xe.__name__=["zpp_nape","util","ZNPArray2_ZPP_MarchPair"],xe.prototype.list=null,xe.prototype.width=null,xe.prototype.resize=function(n,t,e){for(var i=0,p=(this.width=n)*t;i<p;)this.list[i++]=e},xe.prototype.get=function(n,t){return this.list[t*this.width+n]},xe.prototype.set=function(n,t,e){return this.list[t*this.width+n]=e},xe.prototype.__class__=xe;var de=zpp_nape.util.Hashable2_Boolfalse=function(){this.di=0,this.id=0,this.hnext=null,this.next=null,this.value=!1};de.__name__=["zpp_nape","util","Hashable2_Boolfalse"],de.get=function(n,t,e){var i;null==de.zpp_pool?i=new de:(i=de.zpp_pool,de.zpp_pool=i.next,i.next=null),i.id=n,i.di=t;var p=i;return p.value=e,p},de.getpersist=function(n,t){var e;return null==de.zpp_pool?e=new de:(e=de.zpp_pool,de.zpp_pool=e.next,e.next=null),e.id=n,e.di=t,e},de.ordered_get=function(n,t,e){if(n<=t){var i;null==de.zpp_pool?i=new de:(i=de.zpp_pool,de.zpp_pool=i.next,i.next=null),i.id=n,i.di=t;var p=i;return p.value=e,p}var l;null==de.zpp_pool?l=new de:(l=de.zpp_pool,de.zpp_pool=l.next,l.next=null),l.id=t,l.di=n;var r=l;return r.value=e,r},de.ordered_get_persist=function(n,t){var e,i;return n<=t?(null==de.zpp_pool?e=new de:(e=de.zpp_pool,de.zpp_pool=e.next,e.next=null),e.id=n,e.di=t,e):(null==de.zpp_pool?i=new de:(i=de.zpp_pool,de.zpp_pool=i.next,i.next=null),i.id=t,i.di=n,i)},de.prototype.value=null,de.prototype.next=null,de.prototype.hnext=null,de.prototype.id=null,de.prototype.di=null,de.prototype.free=function(){},de.prototype.alloc=function(){},de.prototype.__class__=de;var ye=zpp_nape.util.FastHash2_Hashable2_Boolfalse=function(){this.cnt=0,this.table=null,this.cnt=0,this.table=[];for(var n=0;n<1048576;)++n,this.table.push(null)};ye.__name__=["zpp_nape","util","FastHash2_Hashable2_Boolfalse"],ye.prototype.table=null,ye.prototype.cnt=null,ye.prototype.empty=function(){return 0==this.cnt},ye.prototype.clear=function(){for(var n=0,t=this.table.length;n<t;){var e=n++,i=this.table[e];if(null!=i){for(;null!=i;){var p=i.hnext;i.hnext=null,i=p}this.table[e]=null}}},ye.prototype.get=function(n,t){var e=this.table[106039*n+t&1048575];if(null==e)return null;if(e.id==n&&e.di==t)return e;for(;null!=(e=e.hnext)&&(e.id!=n||e.di!=t););return e},ye.prototype.ordered_get=function(n,t){var e;t<n&&(e=n,n=t,t=e);var i=this.table[106039*n+t&1048575];if(null==i)return null;if(i.id==n&&i.di==t)return i;for(;null!=(i=i.hnext)&&(i.id!=n||i.di!=t););return i},ye.prototype.has=function(n,t){var e=this.table[106039*n+t&1048575];if(null==e)return!1;if(e.id==n&&e.di==t)return!0;for(;null!=(e=e.hnext)&&(e.id!=n||e.di!=t););return null!=e},ye.prototype.maybeAdd=function(n){var t=106039*n.id+n.di&1048575,e=this.table[t];null==e?(this.table[t]=n).hnext=null:(n.hnext=e.hnext,e.hnext=n),this.cnt++},ye.prototype.add=function(n){var t=106039*n.id+n.di&1048575,e=this.table[t];null==e?(this.table[t]=n).hnext=null:(n.hnext=e.hnext,e.hnext=n),this.cnt++},ye.prototype.remove=function(n){var t,e=106039*n.id+n.di&1048575,i=this.table[e];if(i==n)this.table[e]=i.hnext;else if(null!=i){for(;null!=(i=(t=i).hnext)&&i!=n;);t.hnext=i.hnext}n.hnext=null,this.cnt--},ye.prototype.hash=function(n,t){return 106039*n+t&1048575},ye.prototype.__class__=ye;var ze=zpp_nape.util.ZNPList_ZPP_CallbackSet=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ze.__name__=["zpp_nape","util","ZNPList_ZPP_CallbackSet"],ze.prototype.head=null,ze.prototype.begin=function(){return this.head},ze.prototype.modified=null,ze.prototype.pushmod=null,ze.prototype.length=null,ze.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ze.prototype.add=function(n){var t;null==Be.zpp_pool?t=new Be:(t=Be.zpp_pool,Be.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},ze.prototype.inlined_add=function(n){var t;null==Be.zpp_pool?t=new Be:(t=Be.zpp_pool,Be.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},ze.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},ze.prototype.insert=function(n,t){var e;null==Be.zpp_pool?e=new Be:(e=Be.zpp_pool,Be.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ze.prototype.inlined_insert=function(n,t){var e;null==Be.zpp_pool?e=new Be:(e=Be.zpp_pool,Be.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ze.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Be.zpp_pool,Be.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ze.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Be.zpp_pool,Be.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ze.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ze.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ze.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Be.zpp_pool,Be.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ze.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ze.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Be.zpp_pool,Be.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ze.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Be.zpp_pool,Be.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ze.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Be.zpp_pool,Be.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ze.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Be.zpp_pool,Be.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ze.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ze.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Be.zpp_pool,Be.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ze.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Be.zpp_pool,Be.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ze.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},ze.prototype.empty=function(){return null==this.head},ze.prototype.size=function(){return this.length},ze.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ze.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ze.prototype.front=function(){return this.head.elt},ze.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},ze.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},ze.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},ze.prototype.__class__=ze;var ce=zpp_nape.util.ZNPList_ZPP_Shape=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ce.__name__=["zpp_nape","util","ZNPList_ZPP_Shape"],ce.prototype.head=null,ce.prototype.begin=function(){return this.head},ce.prototype.modified=null,ce.prototype.pushmod=null,ce.prototype.length=null,ce.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ce.prototype.add=function(n){var t;null==Ge.zpp_pool?t=new Ge:(t=Ge.zpp_pool,Ge.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},ce.prototype.inlined_add=function(n){var t;null==Ge.zpp_pool?t=new Ge:(t=Ge.zpp_pool,Ge.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},ce.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},ce.prototype.insert=function(n,t){var e;null==Ge.zpp_pool?e=new Ge:(e=Ge.zpp_pool,Ge.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ce.prototype.inlined_insert=function(n,t){var e;null==Ge.zpp_pool?e=new Ge:(e=Ge.zpp_pool,Ge.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ce.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ge.zpp_pool,Ge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ce.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ge.zpp_pool,Ge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ce.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ce.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ce.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ge.zpp_pool,Ge.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ce.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ce.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ge.zpp_pool,Ge.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ce.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Ge.zpp_pool,Ge.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ce.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ge.zpp_pool,Ge.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ce.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ge.zpp_pool,Ge.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ce.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ce.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ge.zpp_pool,Ge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ce.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ge.zpp_pool,Ge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ce.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},ce.prototype.empty=function(){return null==this.head},ce.prototype.size=function(){return this.length},ce.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ce.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ce.prototype.front=function(){return this.head.elt},ce.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},ce.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},ce.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},ce.prototype.__class__=ce;var ve=zpp_nape.util.ZNPList_ZPP_Body=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ve.__name__=["zpp_nape","util","ZNPList_ZPP_Body"],ve.prototype.head=null,ve.prototype.begin=function(){return this.head},ve.prototype.modified=null,ve.prototype.pushmod=null,ve.prototype.length=null,ve.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ve.prototype.add=function(n){var t;null==qe.zpp_pool?t=new qe:(t=qe.zpp_pool,qe.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},ve.prototype.inlined_add=function(n){var t;null==qe.zpp_pool?t=new qe:(t=qe.zpp_pool,qe.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},ve.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},ve.prototype.insert=function(n,t){var e;null==qe.zpp_pool?e=new qe:(e=qe.zpp_pool,qe.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ve.prototype.inlined_insert=function(n,t){var e;null==qe.zpp_pool?e=new qe:(e=qe.zpp_pool,qe.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ve.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=qe.zpp_pool,qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ve.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=qe.zpp_pool,qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ve.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ve.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ve.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=qe.zpp_pool,qe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ve.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ve.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=qe.zpp_pool,qe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ve.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=qe.zpp_pool,qe.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ve.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=qe.zpp_pool,qe.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ve.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=qe.zpp_pool,qe.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ve.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ve.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=qe.zpp_pool,qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ve.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=qe.zpp_pool,qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ve.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},ve.prototype.empty=function(){return null==this.head},ve.prototype.size=function(){return this.length},ve.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ve.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ve.prototype.front=function(){return this.head.elt},ve.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},ve.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},ve.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},ve.prototype.__class__=ve;var me=zpp_nape.util.ZNPList_ZPP_Compound=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};me.__name__=["zpp_nape","util","ZNPList_ZPP_Compound"],me.prototype.head=null,me.prototype.begin=function(){return this.head},me.prototype.modified=null,me.prototype.pushmod=null,me.prototype.length=null,me.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},me.prototype.add=function(n){var t;null==Ke.zpp_pool?t=new Ke:(t=Ke.zpp_pool,Ke.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},me.prototype.inlined_add=function(n){var t;null==Ke.zpp_pool?t=new Ke:(t=Ke.zpp_pool,Ke.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},me.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},me.prototype.insert=function(n,t){var e;null==Ke.zpp_pool?e=new Ke:(e=Ke.zpp_pool,Ke.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},me.prototype.inlined_insert=function(n,t){var e;null==Ke.zpp_pool?e=new Ke:(e=Ke.zpp_pool,Ke.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},me.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ke.zpp_pool,Ke.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},me.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ke.zpp_pool,Ke.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},me.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},me.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},me.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ke.zpp_pool,Ke.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},me.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},me.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ke.zpp_pool,Ke.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},me.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Ke.zpp_pool,Ke.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},me.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ke.zpp_pool,Ke.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},me.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Ke.zpp_pool,Ke.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},me.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},me.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ke.zpp_pool,Ke.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},me.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ke.zpp_pool,Ke.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},me.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},me.prototype.empty=function(){return null==this.head},me.prototype.size=function(){return this.length},me.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},me.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},me.prototype.front=function(){return this.head.elt},me.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},me.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},me.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},me.prototype.__class__=me;var fe=zpp_nape.util.ZNPList_ZPP_Arbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};fe.__name__=["zpp_nape","util","ZNPList_ZPP_Arbiter"],fe.prototype.head=null,fe.prototype.begin=function(){return this.head},fe.prototype.modified=null,fe.prototype.pushmod=null,fe.prototype.length=null,fe.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},fe.prototype.add=function(n){var t;null==Gl.zpp_pool?t=new Gl:(t=Gl.zpp_pool,Gl.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},fe.prototype.inlined_add=function(n){var t;null==Gl.zpp_pool?t=new Gl:(t=Gl.zpp_pool,Gl.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},fe.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},fe.prototype.insert=function(n,t){var e;null==Gl.zpp_pool?e=new Gl:(e=Gl.zpp_pool,Gl.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},fe.prototype.inlined_insert=function(n,t){var e;null==Gl.zpp_pool?e=new Gl:(e=Gl.zpp_pool,Gl.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},fe.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Gl.zpp_pool,Gl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},fe.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Gl.zpp_pool,Gl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},fe.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},fe.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},fe.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Gl.zpp_pool,Gl.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},fe.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},fe.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Gl.zpp_pool,Gl.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},fe.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Gl.zpp_pool,Gl.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},fe.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Gl.zpp_pool,Gl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},fe.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Gl.zpp_pool,Gl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},fe.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},fe.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Gl.zpp_pool,Gl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},fe.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Gl.zpp_pool,Gl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},fe.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},fe.prototype.empty=function(){return null==this.head},fe.prototype.size=function(){return this.length},fe.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},fe.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},fe.prototype.front=function(){return this.head.elt},fe.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},fe.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},fe.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},fe.prototype.__class__=fe;var be=zpp_nape.util.ZNPList_ZPP_CbSetPair=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};be.__name__=["zpp_nape","util","ZNPList_ZPP_CbSetPair"],be.prototype.head=null,be.prototype.begin=function(){return this.head},be.prototype.modified=null,be.prototype.pushmod=null,be.prototype.length=null,be.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},be.prototype.add=function(n){var t;null==Je.zpp_pool?t=new Je:(t=Je.zpp_pool,Je.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},be.prototype.inlined_add=function(n){var t;null==Je.zpp_pool?t=new Je:(t=Je.zpp_pool,Je.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},be.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},be.prototype.insert=function(n,t){var e;null==Je.zpp_pool?e=new Je:(e=Je.zpp_pool,Je.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},be.prototype.inlined_insert=function(n,t){var e;null==Je.zpp_pool?e=new Je:(e=Je.zpp_pool,Je.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},be.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Je.zpp_pool,Je.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},be.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Je.zpp_pool,Je.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},be.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},be.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},be.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Je.zpp_pool,Je.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},be.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},be.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Je.zpp_pool,Je.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},be.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Je.zpp_pool,Je.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},be.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Je.zpp_pool,Je.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},be.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Je.zpp_pool,Je.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},be.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},be.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Je.zpp_pool,Je.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},be.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Je.zpp_pool,Je.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},be.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},be.prototype.empty=function(){return null==this.head},be.prototype.size=function(){return this.length},be.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},be.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},be.prototype.front=function(){return this.head.elt},be.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},be.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},be.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},be.prototype.__class__=be;var Mi=zpp_nape.util.ZNPList_ZPP_CutInt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Mi.__name__=["zpp_nape","util","ZNPList_ZPP_CutInt"],Mi.prototype.head=null,Mi.prototype.begin=function(){return this.head},Mi.prototype.modified=null,Mi.prototype.pushmod=null,Mi.prototype.length=null,Mi.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Mi.prototype.add=function(n){var t;null==He.zpp_pool?t=new He:(t=He.zpp_pool,He.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Mi.prototype.inlined_add=function(n){var t;null==He.zpp_pool?t=new He:(t=He.zpp_pool,He.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Mi.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Mi.prototype.insert=function(n,t){var e;null==He.zpp_pool?e=new He:(e=He.zpp_pool,He.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Mi.prototype.inlined_insert=function(n,t){var e;null==He.zpp_pool?e=new He:(e=He.zpp_pool,He.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Mi.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=He.zpp_pool,He.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Mi.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=He.zpp_pool,He.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Mi.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Mi.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Mi.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=He.zpp_pool,He.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Mi.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Mi.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=He.zpp_pool,He.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Mi.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=He.zpp_pool,He.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Mi.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=He.zpp_pool,He.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Mi.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=He.zpp_pool,He.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Mi.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Mi.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=He.zpp_pool,He.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Mi.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=He.zpp_pool,He.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Mi.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Mi.prototype.empty=function(){return null==this.head},Mi.prototype.size=function(){return this.length},Mi.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Mi.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Mi.prototype.front=function(){return this.head.elt},Mi.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Mi.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Mi.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Mi.prototype.__class__=Mi;var Ci=zpp_nape.util.ZNPList_ZPP_CutVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ci.__name__=["zpp_nape","util","ZNPList_ZPP_CutVert"],Ci.prototype.head=null,Ci.prototype.begin=function(){return this.head},Ci.prototype.modified=null,Ci.prototype.pushmod=null,Ci.prototype.length=null,Ci.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ci.prototype.add=function(n){var t;null==$e.zpp_pool?t=new $e:(t=$e.zpp_pool,$e.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ci.prototype.inlined_add=function(n){var t;null==$e.zpp_pool?t=new $e:(t=$e.zpp_pool,$e.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ci.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ci.prototype.insert=function(n,t){var e;null==$e.zpp_pool?e=new $e:(e=$e.zpp_pool,$e.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ci.prototype.inlined_insert=function(n,t){var e;null==$e.zpp_pool?e=new $e:(e=$e.zpp_pool,$e.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ci.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=$e.zpp_pool,$e.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ci.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=$e.zpp_pool,$e.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ci.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ci.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ci.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=$e.zpp_pool,$e.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ci.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ci.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=$e.zpp_pool,$e.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ci.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=$e.zpp_pool,$e.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ci.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=$e.zpp_pool,$e.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ci.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=$e.zpp_pool,$e.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ci.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ci.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=$e.zpp_pool,$e.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ci.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=$e.zpp_pool,$e.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ci.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ci.prototype.empty=function(){return null==this.head},Ci.prototype.size=function(){return this.length},Ci.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ci.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ci.prototype.front=function(){return this.head.elt},Ci.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ci.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ci.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Ci.prototype.__class__=Ci;var ge=zpp_nape.util.ZNPList_ZPP_PartitionVertex=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ge.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionVertex"],ge.prototype.head=null,ge.prototype.begin=function(){return this.head},ge.prototype.modified=null,ge.prototype.pushmod=null,ge.prototype.length=null,ge.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ge.prototype.add=function(n){var t;null==Qe.zpp_pool?t=new Qe:(t=Qe.zpp_pool,Qe.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},ge.prototype.inlined_add=function(n){var t;null==Qe.zpp_pool?t=new Qe:(t=Qe.zpp_pool,Qe.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},ge.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},ge.prototype.insert=function(n,t){var e;null==Qe.zpp_pool?e=new Qe:(e=Qe.zpp_pool,Qe.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ge.prototype.inlined_insert=function(n,t){var e;null==Qe.zpp_pool?e=new Qe:(e=Qe.zpp_pool,Qe.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ge.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Qe.zpp_pool,Qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ge.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Qe.zpp_pool,Qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ge.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ge.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ge.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Qe.zpp_pool,Qe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ge.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ge.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Qe.zpp_pool,Qe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ge.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Qe.zpp_pool,Qe.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ge.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Qe.zpp_pool,Qe.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ge.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Qe.zpp_pool,Qe.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ge.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ge.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Qe.zpp_pool,Qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ge.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Qe.zpp_pool,Qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ge.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},ge.prototype.empty=function(){return null==this.head},ge.prototype.size=function(){return this.length},ge.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ge.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ge.prototype.front=function(){return this.head.elt},ge.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},ge.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},ge.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},ge.prototype.__class__=ge;var we=zpp_nape.util.ZNPList_ZPP_SimplifyP=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};we.__name__=["zpp_nape","util","ZNPList_ZPP_SimplifyP"],we.prototype.head=null,we.prototype.begin=function(){return this.head},we.prototype.modified=null,we.prototype.pushmod=null,we.prototype.length=null,we.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},we.prototype.add=function(n){var t;null==ni.zpp_pool?t=new ni:(t=ni.zpp_pool,ni.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},we.prototype.inlined_add=function(n){var t;null==ni.zpp_pool?t=new ni:(t=ni.zpp_pool,ni.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},we.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},we.prototype.insert=function(n,t){var e;null==ni.zpp_pool?e=new ni:(e=ni.zpp_pool,ni.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},we.prototype.inlined_insert=function(n,t){var e;null==ni.zpp_pool?e=new ni:(e=ni.zpp_pool,ni.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},we.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ni.zpp_pool,ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},we.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ni.zpp_pool,ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},we.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},we.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},we.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ni.zpp_pool,ni.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},we.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},we.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ni.zpp_pool,ni.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},we.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ni.zpp_pool,ni.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},we.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ni.zpp_pool,ni.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},we.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ni.zpp_pool,ni.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},we.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},we.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ni.zpp_pool,ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},we.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ni.zpp_pool,ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},we.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},we.prototype.empty=function(){return null==this.head},we.prototype.size=function(){return this.length},we.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},we.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},we.prototype.front=function(){return this.head.elt},we.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},we.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},we.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},we.prototype.__class__=we;var Me=zpp_nape.util.ZNPList_ZPP_PartitionedPoly=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Me.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionedPoly"],Me.prototype.head=null,Me.prototype.begin=function(){return this.head},Me.prototype.modified=null,Me.prototype.pushmod=null,Me.prototype.length=null,Me.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Me.prototype.add=function(n){var t;null==ti.zpp_pool?t=new ti:(t=ti.zpp_pool,ti.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Me.prototype.inlined_add=function(n){var t;null==ti.zpp_pool?t=new ti:(t=ti.zpp_pool,ti.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Me.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Me.prototype.insert=function(n,t){var e;null==ti.zpp_pool?e=new ti:(e=ti.zpp_pool,ti.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Me.prototype.inlined_insert=function(n,t){var e;null==ti.zpp_pool?e=new ti:(e=ti.zpp_pool,ti.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Me.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ti.zpp_pool,ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Me.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ti.zpp_pool,ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Me.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Me.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Me.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ti.zpp_pool,ti.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Me.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Me.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ti.zpp_pool,ti.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Me.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ti.zpp_pool,ti.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Me.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ti.zpp_pool,ti.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Me.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ti.zpp_pool,ti.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Me.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Me.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ti.zpp_pool,ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Me.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ti.zpp_pool,ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Me.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Me.prototype.empty=function(){return null==this.head},Me.prototype.size=function(){return this.length},Me.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Me.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Me.prototype.front=function(){return this.head.elt},Me.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Me.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Me.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Me.prototype.__class__=Me;var Ce=zpp_nape.util.ZNPList_ZPP_GeomVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ce.__name__=["zpp_nape","util","ZNPList_ZPP_GeomVert"],Ce.prototype.head=null,Ce.prototype.begin=function(){return this.head},Ce.prototype.modified=null,Ce.prototype.pushmod=null,Ce.prototype.length=null,Ce.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ce.prototype.add=function(n){var t;null==ei.zpp_pool?t=new ei:(t=ei.zpp_pool,ei.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ce.prototype.inlined_add=function(n){var t;null==ei.zpp_pool?t=new ei:(t=ei.zpp_pool,ei.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ce.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ce.prototype.insert=function(n,t){var e;null==ei.zpp_pool?e=new ei:(e=ei.zpp_pool,ei.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ce.prototype.inlined_insert=function(n,t){var e;null==ei.zpp_pool?e=new ei:(e=ei.zpp_pool,ei.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ce.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ei.zpp_pool,ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ce.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ei.zpp_pool,ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ce.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ce.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ce.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ei.zpp_pool,ei.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ce.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ce.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ei.zpp_pool,ei.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ce.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ei.zpp_pool,ei.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ce.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ei.zpp_pool,ei.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ce.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ei.zpp_pool,ei.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ce.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ce.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ei.zpp_pool,ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ce.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ei.zpp_pool,ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ce.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ce.prototype.empty=function(){return null==this.head},Ce.prototype.size=function(){return this.length},Ce.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ce.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ce.prototype.front=function(){return this.head.elt},Ce.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ce.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ce.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Ce.prototype.__class__=Ce;var ke=zpp_nape.util.ZNPList_ZPP_SimpleVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ke.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleVert"],ke.prototype.head=null,ke.prototype.begin=function(){return this.head},ke.prototype.modified=null,ke.prototype.pushmod=null,ke.prototype.length=null,ke.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ke.prototype.add=function(n){var t;null==ii.zpp_pool?t=new ii:(t=ii.zpp_pool,ii.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},ke.prototype.inlined_add=function(n){var t;null==ii.zpp_pool?t=new ii:(t=ii.zpp_pool,ii.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},ke.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},ke.prototype.insert=function(n,t){var e;null==ii.zpp_pool?e=new ii:(e=ii.zpp_pool,ii.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ke.prototype.inlined_insert=function(n,t){var e;null==ii.zpp_pool?e=new ii:(e=ii.zpp_pool,ii.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ke.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ii.zpp_pool,ii.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ke.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ii.zpp_pool,ii.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ke.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ke.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ke.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ii.zpp_pool,ii.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ke.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ke.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ii.zpp_pool,ii.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ke.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ii.zpp_pool,ii.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ke.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ii.zpp_pool,ii.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ke.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ii.zpp_pool,ii.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ke.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ke.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ii.zpp_pool,ii.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ke.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ii.zpp_pool,ii.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ke.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},ke.prototype.empty=function(){return null==this.head},ke.prototype.size=function(){return this.length},ke.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ke.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ke.prototype.front=function(){return this.head.elt},ke.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},ke.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},ke.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},ke.prototype.__class__=ke;var Oe=zpp_nape.util.ZNPList_ZPP_SimpleEvent=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Oe.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleEvent"],Oe.prototype.head=null,Oe.prototype.begin=function(){return this.head},Oe.prototype.modified=null,Oe.prototype.pushmod=null,Oe.prototype.length=null,Oe.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Oe.prototype.add=function(n){var t;null==pi.zpp_pool?t=new pi:(t=pi.zpp_pool,pi.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Oe.prototype.inlined_add=function(n){var t;null==pi.zpp_pool?t=new pi:(t=pi.zpp_pool,pi.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Oe.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Oe.prototype.insert=function(n,t){var e;null==pi.zpp_pool?e=new pi:(e=pi.zpp_pool,pi.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Oe.prototype.inlined_insert=function(n,t){var e;null==pi.zpp_pool?e=new pi:(e=pi.zpp_pool,pi.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Oe.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=pi.zpp_pool,pi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Oe.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=pi.zpp_pool,pi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Oe.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Oe.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Oe.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=pi.zpp_pool,pi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Oe.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Oe.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=pi.zpp_pool,pi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Oe.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=pi.zpp_pool,pi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Oe.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=pi.zpp_pool,pi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Oe.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=pi.zpp_pool,pi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Oe.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Oe.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=pi.zpp_pool,pi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Oe.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=pi.zpp_pool,pi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Oe.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Oe.prototype.empty=function(){return null==this.head},Oe.prototype.size=function(){return this.length},Oe.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Oe.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Oe.prototype.front=function(){return this.head.elt},Oe.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Oe.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Oe.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Oe.prototype.__class__=Oe;var Pe=zpp_nape.util.ZNPList_ZPP_AABBPair=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Pe.__name__=["zpp_nape","util","ZNPList_ZPP_AABBPair"],Pe.prototype.head=null,Pe.prototype.begin=function(){return this.head},Pe.prototype.modified=null,Pe.prototype.pushmod=null,Pe.prototype.length=null,Pe.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Pe.prototype.add=function(n){var t;null==ip.zpp_pool?t=new ip:(t=ip.zpp_pool,ip.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Pe.prototype.inlined_add=function(n){var t;null==ip.zpp_pool?t=new ip:(t=ip.zpp_pool,ip.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Pe.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Pe.prototype.insert=function(n,t){var e;null==ip.zpp_pool?e=new ip:(e=ip.zpp_pool,ip.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Pe.prototype.inlined_insert=function(n,t){var e;null==ip.zpp_pool?e=new ip:(e=ip.zpp_pool,ip.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Pe.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ip.zpp_pool,ip.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Pe.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ip.zpp_pool,ip.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Pe.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Pe.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Pe.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ip.zpp_pool,ip.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Pe.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Pe.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ip.zpp_pool,ip.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Pe.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ip.zpp_pool,ip.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Pe.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ip.zpp_pool,ip.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Pe.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ip.zpp_pool,ip.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Pe.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Pe.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ip.zpp_pool,ip.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Pe.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ip.zpp_pool,ip.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Pe.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Pe.prototype.empty=function(){return null==this.head},Pe.prototype.size=function(){return this.length},Pe.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Pe.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Pe.prototype.front=function(){return this.head.elt},Pe.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Pe.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Pe.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Pe.prototype.__class__=Pe;var Se=zpp_nape.util.ZNPList_ZPP_Edge=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Se.__name__=["zpp_nape","util","ZNPList_ZPP_Edge"],Se.prototype.head=null,Se.prototype.begin=function(){return this.head},Se.prototype.modified=null,Se.prototype.pushmod=null,Se.prototype.length=null,Se.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Se.prototype.add=function(n){var t;null==oi.zpp_pool?t=new oi:(t=oi.zpp_pool,oi.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Se.prototype.inlined_add=function(n){var t;null==oi.zpp_pool?t=new oi:(t=oi.zpp_pool,oi.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Se.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Se.prototype.insert=function(n,t){var e;null==oi.zpp_pool?e=new oi:(e=oi.zpp_pool,oi.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Se.prototype.inlined_insert=function(n,t){var e;null==oi.zpp_pool?e=new oi:(e=oi.zpp_pool,oi.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Se.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=oi.zpp_pool,oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Se.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=oi.zpp_pool,oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Se.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Se.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Se.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=oi.zpp_pool,oi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Se.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Se.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=oi.zpp_pool,oi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Se.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=oi.zpp_pool,oi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Se.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=oi.zpp_pool,oi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Se.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=oi.zpp_pool,oi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Se.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Se.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=oi.zpp_pool,oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Se.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=oi.zpp_pool,oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Se.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Se.prototype.empty=function(){return null==this.head},Se.prototype.size=function(){return this.length},Se.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Se.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Se.prototype.front=function(){return this.head.elt},Se.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Se.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Se.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Se.prototype.__class__=Se;var Ae=zpp_nape.util.ZNPList_ZPP_AABBNode=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ae.__name__=["zpp_nape","util","ZNPList_ZPP_AABBNode"],Ae.prototype.head=null,Ae.prototype.begin=function(){return this.head},Ae.prototype.modified=null,Ae.prototype.pushmod=null,Ae.prototype.length=null,Ae.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ae.prototype.add=function(n){var t;null==ai.zpp_pool?t=new ai:(t=ai.zpp_pool,ai.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ae.prototype.inlined_add=function(n){var t;null==ai.zpp_pool?t=new ai:(t=ai.zpp_pool,ai.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ae.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ae.prototype.insert=function(n,t){var e;null==ai.zpp_pool?e=new ai:(e=ai.zpp_pool,ai.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ae.prototype.inlined_insert=function(n,t){var e;null==ai.zpp_pool?e=new ai:(e=ai.zpp_pool,ai.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ae.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ai.zpp_pool,ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ae.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ai.zpp_pool,ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ae.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ae.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ae.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ai.zpp_pool,ai.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ae.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ae.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ai.zpp_pool,ai.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ae.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ai.zpp_pool,ai.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ae.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ai.zpp_pool,ai.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ae.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ai.zpp_pool,ai.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ae.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ae.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ai.zpp_pool,ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ae.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ai.zpp_pool,ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ae.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ae.prototype.empty=function(){return null==this.head},Ae.prototype.size=function(){return this.length},Ae.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ae.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ae.prototype.front=function(){return this.head.elt},Ae.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ae.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ae.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Ae.prototype.__class__=Ae;var je=zpp_nape.util.ZNPList_ZPP_Component=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};je.__name__=["zpp_nape","util","ZNPList_ZPP_Component"],je.prototype.head=null,je.prototype.begin=function(){return this.head},je.prototype.modified=null,je.prototype.pushmod=null,je.prototype.length=null,je.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},je.prototype.add=function(n){var t;null==si.zpp_pool?t=new si:(t=si.zpp_pool,si.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},je.prototype.inlined_add=function(n){var t;null==si.zpp_pool?t=new si:(t=si.zpp_pool,si.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},je.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},je.prototype.insert=function(n,t){var e;null==si.zpp_pool?e=new si:(e=si.zpp_pool,si.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},je.prototype.inlined_insert=function(n,t){var e;null==si.zpp_pool?e=new si:(e=si.zpp_pool,si.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},je.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=si.zpp_pool,si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},je.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=si.zpp_pool,si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},je.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},je.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},je.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=si.zpp_pool,si.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},je.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},je.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=si.zpp_pool,si.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},je.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=si.zpp_pool,si.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},je.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=si.zpp_pool,si.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},je.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=si.zpp_pool,si.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},je.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},je.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=si.zpp_pool,si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},je.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=si.zpp_pool,si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},je.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},je.prototype.empty=function(){return null==this.head},je.prototype.size=function(){return this.length},je.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},je.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},je.prototype.front=function(){return this.head.elt},je.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},je.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},je.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},je.prototype.__class__=je;var Ee=zpp_nape.util.ZNPList_ZPP_FluidArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ee.__name__=["zpp_nape","util","ZNPList_ZPP_FluidArbiter"],Ee.prototype.head=null,Ee.prototype.begin=function(){return this.head},Ee.prototype.modified=null,Ee.prototype.pushmod=null,Ee.prototype.length=null,Ee.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ee.prototype.add=function(n){var t;null==Kl.zpp_pool?t=new Kl:(t=Kl.zpp_pool,Kl.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ee.prototype.inlined_add=function(n){var t;null==Kl.zpp_pool?t=new Kl:(t=Kl.zpp_pool,Kl.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ee.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ee.prototype.insert=function(n,t){var e;null==Kl.zpp_pool?e=new Kl:(e=Kl.zpp_pool,Kl.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ee.prototype.inlined_insert=function(n,t){var e;null==Kl.zpp_pool?e=new Kl:(e=Kl.zpp_pool,Kl.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ee.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Kl.zpp_pool,Kl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ee.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Kl.zpp_pool,Kl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ee.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ee.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ee.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Kl.zpp_pool,Kl.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ee.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ee.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Kl.zpp_pool,Kl.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ee.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Kl.zpp_pool,Kl.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ee.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Kl.zpp_pool,Kl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ee.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Kl.zpp_pool,Kl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ee.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ee.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Kl.zpp_pool,Kl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ee.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Kl.zpp_pool,Kl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ee.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ee.prototype.empty=function(){return null==this.head},Ee.prototype.size=function(){return this.length},Ee.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ee.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ee.prototype.front=function(){return this.head.elt},Ee.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ee.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ee.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Ee.prototype.__class__=Ee;var Ie=zpp_nape.util.ZNPList_ZPP_SensorArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ie.__name__=["zpp_nape","util","ZNPList_ZPP_SensorArbiter"],Ie.prototype.head=null,Ie.prototype.begin=function(){return this.head},Ie.prototype.modified=null,Ie.prototype.pushmod=null,Ie.prototype.length=null,Ie.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ie.prototype.add=function(n){var t;null==Wl.zpp_pool?t=new Wl:(t=Wl.zpp_pool,Wl.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ie.prototype.inlined_add=function(n){var t;null==Wl.zpp_pool?t=new Wl:(t=Wl.zpp_pool,Wl.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ie.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ie.prototype.insert=function(n,t){var e;null==Wl.zpp_pool?e=new Wl:(e=Wl.zpp_pool,Wl.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ie.prototype.inlined_insert=function(n,t){var e;null==Wl.zpp_pool?e=new Wl:(e=Wl.zpp_pool,Wl.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ie.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Wl.zpp_pool,Wl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ie.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Wl.zpp_pool,Wl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ie.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ie.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ie.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Wl.zpp_pool,Wl.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ie.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ie.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Wl.zpp_pool,Wl.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ie.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Wl.zpp_pool,Wl.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ie.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Wl.zpp_pool,Wl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ie.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Wl.zpp_pool,Wl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ie.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ie.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Wl.zpp_pool,Wl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ie.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Wl.zpp_pool,Wl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ie.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ie.prototype.empty=function(){return null==this.head},Ie.prototype.size=function(){return this.length},Ie.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ie.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ie.prototype.front=function(){return this.head.elt},Ie.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ie.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ie.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Ie.prototype.__class__=Ie;var Te=zpp_nape.util.ZNPList_ZPP_Listener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Te.__name__=["zpp_nape","util","ZNPList_ZPP_Listener"],Te.prototype.head=null,Te.prototype.begin=function(){return this.head},Te.prototype.modified=null,Te.prototype.pushmod=null,Te.prototype.length=null,Te.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Te.prototype.add=function(n){var t;null==_i.zpp_pool?t=new _i:(t=_i.zpp_pool,_i.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Te.prototype.inlined_add=function(n){var t;null==_i.zpp_pool?t=new _i:(t=_i.zpp_pool,_i.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Te.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Te.prototype.insert=function(n,t){var e;null==_i.zpp_pool?e=new _i:(e=_i.zpp_pool,_i.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Te.prototype.inlined_insert=function(n,t){var e;null==_i.zpp_pool?e=new _i:(e=_i.zpp_pool,_i.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Te.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=_i.zpp_pool,_i.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Te.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=_i.zpp_pool,_i.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Te.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Te.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Te.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=_i.zpp_pool,_i.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Te.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Te.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=_i.zpp_pool,_i.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Te.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=_i.zpp_pool,_i.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Te.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=_i.zpp_pool,_i.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Te.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=_i.zpp_pool,_i.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Te.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Te.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=_i.zpp_pool,_i.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Te.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=_i.zpp_pool,_i.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Te.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Te.prototype.empty=function(){return null==this.head},Te.prototype.size=function(){return this.length},Te.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Te.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Te.prototype.front=function(){return this.head.elt},Te.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Te.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Te.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Te.prototype.__class__=Te;var Ne=zpp_nape.util.ZNPList_ZPP_ColArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ne.__name__=["zpp_nape","util","ZNPList_ZPP_ColArbiter"],Ne.prototype.head=null,Ne.prototype.begin=function(){return this.head},Ne.prototype.modified=null,Ne.prototype.pushmod=null,Ne.prototype.length=null,Ne.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ne.prototype.add=function(n){var t;null==Yl.zpp_pool?t=new Yl:(t=Yl.zpp_pool,Yl.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ne.prototype.inlined_add=function(n){var t;null==Yl.zpp_pool?t=new Yl:(t=Yl.zpp_pool,Yl.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ne.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ne.prototype.insert=function(n,t){var e;null==Yl.zpp_pool?e=new Yl:(e=Yl.zpp_pool,Yl.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ne.prototype.inlined_insert=function(n,t){var e;null==Yl.zpp_pool?e=new Yl:(e=Yl.zpp_pool,Yl.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ne.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Yl.zpp_pool,Yl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ne.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Yl.zpp_pool,Yl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ne.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ne.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ne.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Yl.zpp_pool,Yl.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ne.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ne.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Yl.zpp_pool,Yl.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ne.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Yl.zpp_pool,Yl.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ne.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Yl.zpp_pool,Yl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ne.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=Yl.zpp_pool,Yl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ne.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ne.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Yl.zpp_pool,Yl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ne.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Yl.zpp_pool,Yl.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ne.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ne.prototype.empty=function(){return null==this.head},Ne.prototype.size=function(){return this.length},Ne.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ne.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ne.prototype.front=function(){return this.head.elt},Ne.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ne.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ne.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Ne.prototype.__class__=Ne;var Le=zpp_nape.util.ZNPList_ZPP_InteractionGroup=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Le.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionGroup"],Le.prototype.head=null,Le.prototype.begin=function(){return this.head},Le.prototype.modified=null,Le.prototype.pushmod=null,Le.prototype.length=null,Le.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Le.prototype.add=function(n){var t;null==hi.zpp_pool?t=new hi:(t=hi.zpp_pool,hi.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Le.prototype.inlined_add=function(n){var t;null==hi.zpp_pool?t=new hi:(t=hi.zpp_pool,hi.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Le.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Le.prototype.insert=function(n,t){var e;null==hi.zpp_pool?e=new hi:(e=hi.zpp_pool,hi.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Le.prototype.inlined_insert=function(n,t){var e;null==hi.zpp_pool?e=new hi:(e=hi.zpp_pool,hi.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Le.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=hi.zpp_pool,hi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Le.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=hi.zpp_pool,hi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Le.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Le.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Le.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=hi.zpp_pool,hi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Le.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Le.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=hi.zpp_pool,hi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Le.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=hi.zpp_pool,hi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Le.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=hi.zpp_pool,hi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Le.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=hi.zpp_pool,hi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Le.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Le.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=hi.zpp_pool,hi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Le.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=hi.zpp_pool,hi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Le.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Le.prototype.empty=function(){return null==this.head},Le.prototype.size=function(){return this.length},Le.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Le.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Le.prototype.front=function(){return this.head.elt},Le.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Le.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Le.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Le.prototype.__class__=Le;var Ve=zpp_nape.util.ZNPList_ZPP_ToiEvent=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ve.__name__=["zpp_nape","util","ZNPList_ZPP_ToiEvent"],Ve.prototype.head=null,Ve.prototype.begin=function(){return this.head},Ve.prototype.modified=null,Ve.prototype.pushmod=null,Ve.prototype.length=null,Ve.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ve.prototype.add=function(n){var t;null==ui.zpp_pool?t=new ui:(t=ui.zpp_pool,ui.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ve.prototype.inlined_add=function(n){var t;null==ui.zpp_pool?t=new ui:(t=ui.zpp_pool,ui.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Ve.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ve.prototype.insert=function(n,t){var e;null==ui.zpp_pool?e=new ui:(e=ui.zpp_pool,ui.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ve.prototype.inlined_insert=function(n,t){var e;null==ui.zpp_pool?e=new ui:(e=ui.zpp_pool,ui.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ve.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ui.zpp_pool,ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ve.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ui.zpp_pool,ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ve.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ve.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ve.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ui.zpp_pool,ui.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ve.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ve.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ui.zpp_pool,ui.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ve.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ui.zpp_pool,ui.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ve.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ui.zpp_pool,ui.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ve.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=ui.zpp_pool,ui.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ve.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ve.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ui.zpp_pool,ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ve.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ui.zpp_pool,ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ve.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ve.prototype.empty=function(){return null==this.head},Ve.prototype.size=function(){return this.length},Ve.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ve.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ve.prototype.front=function(){return this.head.elt},Ve.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ve.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ve.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Ve.prototype.__class__=Ve;var De=zpp_nape.util.ZNPList_ConvexResult=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};De.__name__=["zpp_nape","util","ZNPList_ConvexResult"],De.prototype.head=null,De.prototype.begin=function(){return this.head},De.prototype.modified=null,De.prototype.pushmod=null,De.prototype.length=null,De.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},De.prototype.add=function(n){var t;null==xi.zpp_pool?t=new xi:(t=xi.zpp_pool,xi.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},De.prototype.inlined_add=function(n){var t;null==xi.zpp_pool?t=new xi:(t=xi.zpp_pool,xi.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},De.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},De.prototype.insert=function(n,t){var e;null==xi.zpp_pool?e=new xi:(e=xi.zpp_pool,xi.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},De.prototype.inlined_insert=function(n,t){var e;null==xi.zpp_pool?e=new xi:(e=xi.zpp_pool,xi.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},De.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=xi.zpp_pool,xi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},De.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=xi.zpp_pool,xi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},De.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},De.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},De.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=xi.zpp_pool,xi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},De.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},De.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=xi.zpp_pool,xi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},De.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=xi.zpp_pool,xi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},De.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=xi.zpp_pool,xi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},De.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=xi.zpp_pool,xi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},De.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},De.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=xi.zpp_pool,xi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},De.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=xi.zpp_pool,xi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},De.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},De.prototype.empty=function(){return null==this.head},De.prototype.size=function(){return this.length},De.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},De.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},De.prototype.front=function(){return this.head.elt},De.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},De.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},De.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},De.prototype.__class__=De;var Fe=zpp_nape.util.ZNPList_ZPP_GeomPoly=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Fe.__name__=["zpp_nape","util","ZNPList_ZPP_GeomPoly"],Fe.prototype.head=null,Fe.prototype.begin=function(){return this.head},Fe.prototype.modified=null,Fe.prototype.pushmod=null,Fe.prototype.length=null,Fe.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Fe.prototype.add=function(n){var t;null==di.zpp_pool?t=new di:(t=di.zpp_pool,di.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Fe.prototype.inlined_add=function(n){var t;null==di.zpp_pool?t=new di:(t=di.zpp_pool,di.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Fe.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Fe.prototype.insert=function(n,t){var e;null==di.zpp_pool?e=new di:(e=di.zpp_pool,di.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Fe.prototype.inlined_insert=function(n,t){var e;null==di.zpp_pool?e=new di:(e=di.zpp_pool,di.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Fe.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=di.zpp_pool,di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Fe.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=di.zpp_pool,di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Fe.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Fe.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Fe.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=di.zpp_pool,di.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Fe.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Fe.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=di.zpp_pool,di.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Fe.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=di.zpp_pool,di.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Fe.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=di.zpp_pool,di.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Fe.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=di.zpp_pool,di.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Fe.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Fe.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=di.zpp_pool,di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Fe.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=di.zpp_pool,di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Fe.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Fe.prototype.empty=function(){return null==this.head},Fe.prototype.size=function(){return this.length},Fe.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Fe.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Fe.prototype.front=function(){return this.head.elt},Fe.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Fe.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Fe.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Fe.prototype.__class__=Fe;var Re=zpp_nape.util.ZNPList_RayResult=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Re.__name__=["zpp_nape","util","ZNPList_RayResult"],Re.prototype.head=null,Re.prototype.begin=function(){return this.head},Re.prototype.modified=null,Re.prototype.pushmod=null,Re.prototype.length=null,Re.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Re.prototype.add=function(n){var t;null==yi.zpp_pool?t=new yi:(t=yi.zpp_pool,yi.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Re.prototype.inlined_add=function(n){var t;null==yi.zpp_pool?t=new yi:(t=yi.zpp_pool,yi.zpp_pool=t.next,t.next=null),t.elt=n;var e=t;return e.next=this.head,this.head=e,this.modified=!0,this.length++,n},Re.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Re.prototype.insert=function(n,t){var e;null==yi.zpp_pool?e=new yi:(e=yi.zpp_pool,yi.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Re.prototype.inlined_insert=function(n,t){var e;null==yi.zpp_pool?e=new yi:(e=yi.zpp_pool,yi.zpp_pool=e.next,e.next=null),e.elt=t;var i=e;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Re.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Re.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Re.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Re.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Re.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=yi.zpp_pool,yi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Re.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Re.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=yi.zpp_pool,yi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Re.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=yi.zpp_pool,yi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Re.prototype.erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=yi.zpp_pool,yi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Re.prototype.inlined_erase=function(n){var t,e;null==n?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0));var i=t;return i.elt=null,i.next=yi.zpp_pool,yi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Re.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Re.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Re.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Re.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Re.prototype.empty=function(){return null==this.head},Re.prototype.size=function(){return this.length},Re.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Re.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Re.prototype.front=function(){return this.head.elt},Re.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Re.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Re.prototype.at=function(n){var t=this.iterator_at(n);return null!=t?t.elt:null},Re.prototype.__class__=Re;var Ze=zpp_nape.util.ZNPNode_ZPP_CbType=function(){this.elt=null,this.next=null};Ze.__name__=["zpp_nape","util","ZNPNode_ZPP_CbType"],Ze.prototype.next=null,Ze.prototype.alloc=function(){},Ze.prototype.free=function(){this.elt=null},Ze.prototype.elt=null,Ze.prototype.elem=function(){return this.elt},Ze.prototype.__class__=Ze;var Be=zpp_nape.util.ZNPNode_ZPP_CallbackSet=function(){this.elt=null,this.next=null};Be.__name__=["zpp_nape","util","ZNPNode_ZPP_CallbackSet"],Be.prototype.next=null,Be.prototype.alloc=function(){},Be.prototype.free=function(){this.elt=null},Be.prototype.elt=null,Be.prototype.elem=function(){return this.elt},Be.prototype.__class__=Be;var Ge=zpp_nape.util.ZNPNode_ZPP_Shape=function(){this.elt=null,this.next=null};Ge.__name__=["zpp_nape","util","ZNPNode_ZPP_Shape"],Ge.prototype.next=null,Ge.prototype.alloc=function(){},Ge.prototype.free=function(){this.elt=null},Ge.prototype.elt=null,Ge.prototype.elem=function(){return this.elt},Ge.prototype.__class__=Ge;var qe=zpp_nape.util.ZNPNode_ZPP_Body=function(){this.elt=null,this.next=null};qe.__name__=["zpp_nape","util","ZNPNode_ZPP_Body"],qe.prototype.next=null,qe.prototype.alloc=function(){},qe.prototype.free=function(){this.elt=null},qe.prototype.elt=null,qe.prototype.elem=function(){return this.elt},qe.prototype.__class__=qe;var Ue=zpp_nape.util.ZNPNode_ZPP_Constraint=function(){this.elt=null,this.next=null};Ue.__name__=["zpp_nape","util","ZNPNode_ZPP_Constraint"],Ue.prototype.next=null,Ue.prototype.alloc=function(){},Ue.prototype.free=function(){this.elt=null},Ue.prototype.elt=null,Ue.prototype.elem=function(){return this.elt},Ue.prototype.__class__=Ue;var Ke=zpp_nape.util.ZNPNode_ZPP_Compound=function(){this.elt=null,this.next=null};Ke.__name__=["zpp_nape","util","ZNPNode_ZPP_Compound"],Ke.prototype.next=null,Ke.prototype.alloc=function(){},Ke.prototype.free=function(){this.elt=null},Ke.prototype.elt=null,Ke.prototype.elem=function(){return this.elt},Ke.prototype.__class__=Ke;var Gl=zpp_nape.util.ZNPNode_ZPP_Arbiter=function(){this.elt=null,this.next=null};Gl.__name__=["zpp_nape","util","ZNPNode_ZPP_Arbiter"],Gl.prototype.next=null,Gl.prototype.alloc=function(){},Gl.prototype.free=function(){this.elt=null},Gl.prototype.elt=null,Gl.prototype.elem=function(){return this.elt},Gl.prototype.__class__=Gl;var ql=zpp_nape.util.ZNPNode_ZPP_InteractionListener=function(){this.elt=null,this.next=null};ql.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionListener"],ql.prototype.next=null,ql.prototype.alloc=function(){},ql.prototype.free=function(){this.elt=null},ql.prototype.elt=null,ql.prototype.elem=function(){return this.elt},ql.prototype.__class__=ql;var We=zpp_nape.util.ZNPNode_ZPP_CbSet=function(){this.elt=null,this.next=null};We.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSet"],We.prototype.next=null,We.prototype.alloc=function(){},We.prototype.free=function(){this.elt=null},We.prototype.elt=null,We.prototype.elem=function(){return this.elt},We.prototype.__class__=We;var Ul=zpp_nape.util.ZNPNode_ZPP_Interactor=function(){this.elt=null,this.next=null};Ul.__name__=["zpp_nape","util","ZNPNode_ZPP_Interactor"],Ul.prototype.next=null,Ul.prototype.alloc=function(){},Ul.prototype.free=function(){this.elt=null},Ul.prototype.elt=null,Ul.prototype.elem=function(){return this.elt},Ul.prototype.__class__=Ul;var Ye=zpp_nape.util.ZNPNode_ZPP_BodyListener=function(){this.elt=null,this.next=null};Ye.__name__=["zpp_nape","util","ZNPNode_ZPP_BodyListener"],Ye.prototype.next=null,Ye.prototype.alloc=function(){},Ye.prototype.free=function(){this.elt=null},Ye.prototype.elt=null,Ye.prototype.elem=function(){return this.elt},Ye.prototype.__class__=Ye;var Je=zpp_nape.util.ZNPNode_ZPP_CbSetPair=function(){this.elt=null,this.next=null};Je.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSetPair"],Je.prototype.next=null,Je.prototype.alloc=function(){},Je.prototype.free=function(){this.elt=null},Je.prototype.elt=null,Je.prototype.elem=function(){return this.elt},Je.prototype.__class__=Je;var Xe=zpp_nape.util.ZNPNode_ZPP_ConstraintListener=function(){this.elt=null,this.next=null};Xe.__name__=["zpp_nape","util","ZNPNode_ZPP_ConstraintListener"],Xe.prototype.next=null,Xe.prototype.alloc=function(){},Xe.prototype.free=function(){this.elt=null},Xe.prototype.elt=null,Xe.prototype.elem=function(){return this.elt},Xe.prototype.__class__=Xe;var He=zpp_nape.util.ZNPNode_ZPP_CutInt=function(){this.elt=null,this.next=null};He.__name__=["zpp_nape","util","ZNPNode_ZPP_CutInt"],He.prototype.next=null,He.prototype.alloc=function(){},He.prototype.free=function(){this.elt=null},He.prototype.elt=null,He.prototype.elem=function(){return this.elt},He.prototype.__class__=He;var $e=zpp_nape.util.ZNPNode_ZPP_CutVert=function(){this.elt=null,this.next=null};$e.__name__=["zpp_nape","util","ZNPNode_ZPP_CutVert"],$e.prototype.next=null,$e.prototype.alloc=function(){},$e.prototype.free=function(){this.elt=null},$e.prototype.elt=null,$e.prototype.elem=function(){return this.elt},$e.prototype.__class__=$e;var Qe=zpp_nape.util.ZNPNode_ZPP_PartitionVertex=function(){this.elt=null,this.next=null};Qe.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionVertex"],Qe.prototype.next=null,Qe.prototype.alloc=function(){},Qe.prototype.free=function(){this.elt=null},Qe.prototype.elt=null,Qe.prototype.elem=function(){return this.elt},Qe.prototype.__class__=Qe;var ni=zpp_nape.util.ZNPNode_ZPP_SimplifyP=function(){this.elt=null,this.next=null};ni.__name__=["zpp_nape","util","ZNPNode_ZPP_SimplifyP"],ni.prototype.next=null,ni.prototype.alloc=function(){},ni.prototype.free=function(){this.elt=null},ni.prototype.elt=null,ni.prototype.elem=function(){return this.elt},ni.prototype.__class__=ni;var ti=zpp_nape.util.ZNPNode_ZPP_PartitionedPoly=function(){this.elt=null,this.next=null};ti.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionedPoly"],ti.prototype.next=null,ti.prototype.alloc=function(){},ti.prototype.free=function(){this.elt=null},ti.prototype.elt=null,ti.prototype.elem=function(){return this.elt},ti.prototype.__class__=ti;var ei=zpp_nape.util.ZNPNode_ZPP_GeomVert=function(){this.elt=null,this.next=null};ei.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomVert"],ei.prototype.next=null,ei.prototype.alloc=function(){},ei.prototype.free=function(){this.elt=null},ei.prototype.elt=null,ei.prototype.elem=function(){return this.elt},ei.prototype.__class__=ei;var ii=zpp_nape.util.ZNPNode_ZPP_SimpleVert=function(){this.elt=null,this.next=null};ii.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleVert"],ii.prototype.next=null,ii.prototype.alloc=function(){},ii.prototype.free=function(){this.elt=null},ii.prototype.elt=null,ii.prototype.elem=function(){return this.elt},ii.prototype.__class__=ii;var pi=zpp_nape.util.ZNPNode_ZPP_SimpleEvent=function(){this.elt=null,this.next=null};pi.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleEvent"],pi.prototype.next=null,pi.prototype.alloc=function(){},pi.prototype.free=function(){this.elt=null},pi.prototype.elt=null,pi.prototype.elem=function(){return this.elt},pi.prototype.__class__=pi;var li=zpp_nape.util.ZNPNode_ZPP_Vec2=function(){this.elt=null,this.next=null};li.__name__=["zpp_nape","util","ZNPNode_ZPP_Vec2"],li.prototype.next=null,li.prototype.alloc=function(){},li.prototype.free=function(){this.elt=null},li.prototype.elt=null,li.prototype.elem=function(){return this.elt},li.prototype.__class__=li;var ip=zpp_nape.util.ZNPNode_ZPP_AABBPair=function(){this.elt=null,this.next=null};ip.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBPair"],ip.prototype.next=null,ip.prototype.alloc=function(){},ip.prototype.free=function(){this.elt=null},ip.prototype.elt=null,ip.prototype.elem=function(){return this.elt},ip.prototype.__class__=ip;var oi=zpp_nape.util.ZNPNode_ZPP_Edge=function(){this.elt=null,this.next=null};oi.__name__=["zpp_nape","util","ZNPNode_ZPP_Edge"],oi.prototype.next=null,oi.prototype.alloc=function(){},oi.prototype.free=function(){this.elt=null},oi.prototype.elt=null,oi.prototype.elem=function(){return this.elt},oi.prototype.__class__=oi;var ai=zpp_nape.util.ZNPNode_ZPP_AABBNode=function(){this.elt=null,this.next=null};ai.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBNode"],ai.prototype.next=null,ai.prototype.alloc=function(){},ai.prototype.free=function(){this.elt=null},ai.prototype.elt=null,ai.prototype.elem=function(){return this.elt},ai.prototype.__class__=ai;var si=zpp_nape.util.ZNPNode_ZPP_Component=function(){this.elt=null,this.next=null};si.__name__=["zpp_nape","util","ZNPNode_ZPP_Component"],si.prototype.next=null,si.prototype.alloc=function(){},si.prototype.free=function(){this.elt=null},si.prototype.elt=null,si.prototype.elem=function(){return this.elt},si.prototype.__class__=si;var Kl=zpp_nape.util.ZNPNode_ZPP_FluidArbiter=function(){this.elt=null,this.next=null};Kl.__name__=["zpp_nape","util","ZNPNode_ZPP_FluidArbiter"],Kl.prototype.next=null,Kl.prototype.alloc=function(){},Kl.prototype.free=function(){this.elt=null},Kl.prototype.elt=null,Kl.prototype.elem=function(){return this.elt},Kl.prototype.__class__=Kl;var Wl=zpp_nape.util.ZNPNode_ZPP_SensorArbiter=function(){this.elt=null,this.next=null};Wl.__name__=["zpp_nape","util","ZNPNode_ZPP_SensorArbiter"],Wl.prototype.next=null,Wl.prototype.alloc=function(){},Wl.prototype.free=function(){this.elt=null},Wl.prototype.elt=null,Wl.prototype.elem=function(){return this.elt},Wl.prototype.__class__=Wl;var _i=zpp_nape.util.ZNPNode_ZPP_Listener=function(){this.elt=null,this.next=null};_i.__name__=["zpp_nape","util","ZNPNode_ZPP_Listener"],_i.prototype.next=null,_i.prototype.alloc=function(){},_i.prototype.free=function(){this.elt=null},_i.prototype.elt=null,_i.prototype.elem=function(){return this.elt},_i.prototype.__class__=_i;var Yl=zpp_nape.util.ZNPNode_ZPP_ColArbiter=function(){this.elt=null,this.next=null};Yl.__name__=["zpp_nape","util","ZNPNode_ZPP_ColArbiter"],Yl.prototype.next=null,Yl.prototype.alloc=function(){},Yl.prototype.free=function(){this.elt=null},Yl.prototype.elt=null,Yl.prototype.elem=function(){return this.elt},Yl.prototype.__class__=Yl;var hi=zpp_nape.util.ZNPNode_ZPP_InteractionGroup=function(){this.elt=null,this.next=null};hi.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionGroup"],hi.prototype.next=null,hi.prototype.alloc=function(){},hi.prototype.free=function(){this.elt=null},hi.prototype.elt=null,hi.prototype.elem=function(){return this.elt},hi.prototype.__class__=hi;var ui=zpp_nape.util.ZNPNode_ZPP_ToiEvent=function(){this.elt=null,this.next=null};ui.__name__=["zpp_nape","util","ZNPNode_ZPP_ToiEvent"],ui.prototype.next=null,ui.prototype.alloc=function(){},ui.prototype.free=function(){this.elt=null},ui.prototype.elt=null,ui.prototype.elem=function(){return this.elt},ui.prototype.__class__=ui;var xi=zpp_nape.util.ZNPNode_ConvexResult=function(){this.elt=null,this.next=null};xi.__name__=["zpp_nape","util","ZNPNode_ConvexResult"],xi.prototype.next=null,xi.prototype.alloc=function(){},xi.prototype.free=function(){this.elt=null},xi.prototype.elt=null,xi.prototype.elem=function(){return this.elt},xi.prototype.__class__=xi;var di=zpp_nape.util.ZNPNode_ZPP_GeomPoly=function(){this.elt=null,this.next=null};di.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomPoly"],di.prototype.next=null,di.prototype.alloc=function(){},di.prototype.free=function(){this.elt=null},di.prototype.elt=null,di.prototype.elem=function(){return this.elt},di.prototype.__class__=di;var yi=zpp_nape.util.ZNPNode_RayResult=function(){this.elt=null,this.next=null};yi.__name__=["zpp_nape","util","ZNPNode_RayResult"],yi.prototype.next=null,yi.prototype.alloc=function(){},yi.prototype.free=function(){this.elt=null},yi.prototype.elt=null,yi.prototype.elem=function(){return this.elt},yi.prototype.__class__=yi;var zi=zpp_nape.util.ZPP_MixVec2List=function(){this.at_index=0,this.at_ite=null,this.zip_length=!1,this._length=0,this.inner=null,cn.call(this),this.at_ite=null,this.at_index=0,this.zip_length=!0,this._length=0};zi.__name__=["zpp_nape","util","ZPP_MixVec2List"],zi.__super__=cn,zi.prototype=Object.create(cn.prototype),zi.get=function(n,t){null==t&&(t=!1);var e=new zi;return e.inner=n,e.zpp_inner.immutable=t,e},zi.prototype.inner=null,zi.prototype._length=null,zi.prototype.zip_length=null,zi.prototype.at_ite=null,zi.prototype.at_index=null,zi.prototype.zpp_gl=function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var n=this.inner.next;null!=n;)this._length++,n=n.next;this.zip_length=!1}return this._length},zi.prototype.zpp_vm=function(){this.zpp_inner.validate(),this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},zi.prototype.at=function(n){for(this.zpp_vm(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),(n<this.at_index||null==this.at_ite)&&(this.at_index=0,this.at_ite=this.inner.next);this.at_index!=n;)this.at_index++,this.at_ite=this.at_ite.next;var t,e=this.at_ite;return null==e.outer&&(e.outer=new at,null!=(t=e.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=mo.zpp_pool,mo.zpp_pool=t,e.outer.zpp_inner=e),e.outer},zi.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?this.inner.add(n.zpp_inner):this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},zi.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),n.zpp_inner):this.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},zi.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e,i,p,l,r=null;return this.zpp_inner.reverse_flag?(null==(r=this.inner.next).outer&&(r.outer=new at,null!=(n=r.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=mo.zpp_pool,mo.zpp_pool=n,r.outer.zpp_inner=r),t=r.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.inner.pop()):(null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null),null==(r=null==(e=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2))?this.inner.next:e.next).outer&&(r.outer=new at,null!=(i=r.outer.zpp_inner).outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=mo.zpp_pool,mo.zpp_pool=i,r.outer.zpp_inner=r),p=r.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(p),this.zpp_inner.dontremove||this.inner.erase(e)),this.zpp_inner.invalidate(),null==r.outer&&(r.outer=new at,null!=(l=r.outer.zpp_inner).outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=mo.zpp_pool,mo.zpp_pool=l,r.outer.zpp_inner=r),r.outer},zi.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e,i,p,l,r=null;return this.zpp_inner.reverse_flag?(null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null),null==(r=null==(n=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2))?this.inner.next:n.next).outer&&(r.outer=new at,null!=(t=r.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=mo.zpp_pool,mo.zpp_pool=t,r.outer.zpp_inner=r),e=r.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.inner.erase(n)):(null==(r=this.inner.next).outer&&(r.outer=new at,null!=(i=r.outer.zpp_inner).outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=mo.zpp_pool,mo.zpp_pool=i,r.outer.zpp_inner=r),p=r.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(p),this.zpp_inner.dontremove||this.inner.pop()),this.zpp_inner.invalidate(),null==r.outer&&(r.outer=new at,null!=(l=r.outer.zpp_inner).outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=mo.zpp_pool,mo.zpp_pool=l,r.outer.zpp_inner=r),r.outer},zi.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_vm(),t=!1;for(var e=this.inner.next;null!=e;){if(n.zpp_inner==e){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},zi.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},zi.prototype.__class__=zi;var ci=zpp_nape.util.ZPP_ConstraintList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new In,this._invalidated=!0};ci.__name__=["zpp_nape","util","ZPP_ConstraintList"],ci.get=function(n,t){null==t&&(t=!1);var e=new w;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},ci.prototype.outer=null,ci.prototype.inner=null,ci.prototype.immutable=null,ci.prototype._invalidated=null,ci.prototype._invalidate=null,ci.prototype._validate=null,ci.prototype._modifiable=null,ci.prototype.adder=null,ci.prototype.post_adder=null,ci.prototype.subber=null,ci.prototype.dontremove=null,ci.prototype.reverse_flag=null,ci.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},ci.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},ci.prototype.modify_test=function(){},ci.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},ci.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},ci.prototype.at_index=null,ci.prototype.at_ite=null,ci.prototype.push_ite=null,ci.prototype.zip_length=null,ci.prototype.user_length=null,ci.prototype.__class__=ci;var vi=zpp_nape.util.ZPP_BodyList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ve,this._invalidated=!0};vi.__name__=["zpp_nape","util","ZPP_BodyList"],vi.get=function(n,t){null==t&&(t=!1);var e=new tn;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},vi.prototype.outer=null,vi.prototype.inner=null,vi.prototype.immutable=null,vi.prototype._invalidated=null,vi.prototype._invalidate=null,vi.prototype._validate=null,vi.prototype._modifiable=null,vi.prototype.adder=null,vi.prototype.post_adder=null,vi.prototype.subber=null,vi.prototype.dontremove=null,vi.prototype.reverse_flag=null,vi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},vi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},vi.prototype.modify_test=function(){},vi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},vi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},vi.prototype.at_index=null,vi.prototype.at_ite=null,vi.prototype.push_ite=null,vi.prototype.zip_length=null,vi.prototype.user_length=null,vi.prototype.__class__=vi;var ki=zpp_nape.util.ZPP_InteractorList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Tn,this._invalidated=!0};ki.__name__=["zpp_nape","util","ZPP_InteractorList"],ki.get=function(n,t){null==t&&(t=!1);var e=new hn;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},ki.prototype.outer=null,ki.prototype.inner=null,ki.prototype.immutable=null,ki.prototype._invalidated=null,ki.prototype._invalidate=null,ki.prototype._validate=null,ki.prototype._modifiable=null,ki.prototype.adder=null,ki.prototype.post_adder=null,ki.prototype.subber=null,ki.prototype.dontremove=null,ki.prototype.reverse_flag=null,ki.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},ki.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},ki.prototype.modify_test=function(){},ki.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},ki.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},ki.prototype.at_index=null,ki.prototype.at_ite=null,ki.prototype.push_ite=null,ki.prototype.zip_length=null,ki.prototype.user_length=null,ki.prototype.__class__=ki;var Oi=zpp_nape.util.ZPP_CompoundList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new me,this._invalidated=!0};Oi.__name__=["zpp_nape","util","ZPP_CompoundList"],Oi.get=function(n,t){null==t&&(t=!1);var e=new on;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Oi.prototype.outer=null,Oi.prototype.inner=null,Oi.prototype.immutable=null,Oi.prototype._invalidated=null,Oi.prototype._invalidate=null,Oi.prototype._validate=null,Oi.prototype._modifiable=null,Oi.prototype.adder=null,Oi.prototype.post_adder=null,Oi.prototype.subber=null,Oi.prototype.dontremove=null,Oi.prototype.reverse_flag=null,Oi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Oi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Oi.prototype.modify_test=function(){},Oi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Oi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Oi.prototype.at_index=null,Oi.prototype.at_ite=null,Oi.prototype.push_ite=null,Oi.prototype.zip_length=null,Oi.prototype.user_length=null,Oi.prototype.__class__=Oi;var Pi=zpp_nape.util.ZPP_ListenerList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Te,this._invalidated=!0};Pi.__name__=["zpp_nape","util","ZPP_ListenerList"],Pi.get=function(n,t){null==t&&(t=!1);var e=new z;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Pi.prototype.outer=null,Pi.prototype.inner=null,Pi.prototype.immutable=null,Pi.prototype._invalidated=null,Pi.prototype._invalidate=null,Pi.prototype._validate=null,Pi.prototype._modifiable=null,Pi.prototype.adder=null,Pi.prototype.post_adder=null,Pi.prototype.subber=null,Pi.prototype.dontremove=null,Pi.prototype.reverse_flag=null,Pi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Pi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Pi.prototype.modify_test=function(){},Pi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Pi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Pi.prototype.at_index=null,Pi.prototype.at_ite=null,Pi.prototype.push_ite=null,Pi.prototype.zip_length=null,Pi.prototype.user_length=null,Pi.prototype.__class__=Pi;var Si=zpp_nape.util.ZPP_CbTypeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Rn,this._invalidated=!0};Si.__name__=["zpp_nape","util","ZPP_CbTypeList"],Si.get=function(n,t){null==t&&(t=!1);var e=new _;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Si.prototype.outer=null,Si.prototype.inner=null,Si.prototype.immutable=null,Si.prototype._invalidated=null,Si.prototype._invalidate=null,Si.prototype._validate=null,Si.prototype._modifiable=null,Si.prototype.adder=null,Si.prototype.post_adder=null,Si.prototype.subber=null,Si.prototype.dontremove=null,Si.prototype.reverse_flag=null,Si.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Si.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Si.prototype.modify_test=function(){},Si.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Si.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Si.prototype.at_index=null,Si.prototype.at_ite=null,Si.prototype.push_ite=null,Si.prototype.zip_length=null,Si.prototype.user_length=null,Si.prototype.__class__=Si;var Ai=zpp_nape.util.ZPP_Vec2List=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new bt,this._invalidated=!0};Ai.__name__=["zpp_nape","util","ZPP_Vec2List"],Ai.get=function(n,t){null==t&&(t=!1);var e=new cn;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ai.prototype.outer=null,Ai.prototype.inner=null,Ai.prototype.immutable=null,Ai.prototype._invalidated=null,Ai.prototype._invalidate=null,Ai.prototype._validate=null,Ai.prototype._modifiable=null,Ai.prototype.adder=null,Ai.prototype.post_adder=null,Ai.prototype.subber=null,Ai.prototype.dontremove=null,Ai.prototype.reverse_flag=null,Ai.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ai.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ai.prototype.modify_test=function(){},Ai.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ai.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ai.prototype.at_index=null,Ai.prototype.at_ite=null,Ai.prototype.push_ite=null,Ai.prototype.zip_length=null,Ai.prototype.user_length=null,Ai.prototype.__class__=Ai;var ji=zpp_nape.util.ZPP_GeomPolyList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Fe,this._invalidated=!0};ji.__name__=["zpp_nape","util","ZPP_GeomPolyList"],ji.get=function(n,t){null==t&&(t=!1);var e=new fi;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},ji.prototype.outer=null,ji.prototype.inner=null,ji.prototype.immutable=null,ji.prototype._invalidated=null,ji.prototype._invalidate=null,ji.prototype._validate=null,ji.prototype._modifiable=null,ji.prototype.adder=null,ji.prototype.post_adder=null,ji.prototype.subber=null,ji.prototype.dontremove=null,ji.prototype.reverse_flag=null,ji.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},ji.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},ji.prototype.modify_test=function(){},ji.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},ji.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},ji.prototype.at_index=null,ji.prototype.at_ite=null,ji.prototype.push_ite=null,ji.prototype.zip_length=null,ji.prototype.user_length=null,ji.prototype.__class__=ji;var Ei=zpp_nape.util.ZPP_RayResultList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Re,this._invalidated=!0};Ei.__name__=["zpp_nape","util","ZPP_RayResultList"],Ei.get=function(n,t){null==t&&(t=!1);var e=new J;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ei.prototype.outer=null,Ei.prototype.inner=null,Ei.prototype.immutable=null,Ei.prototype._invalidated=null,Ei.prototype._invalidate=null,Ei.prototype._validate=null,Ei.prototype._modifiable=null,Ei.prototype.adder=null,Ei.prototype.post_adder=null,Ei.prototype.subber=null,Ei.prototype.dontremove=null,Ei.prototype.reverse_flag=null,Ei.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ei.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ei.prototype.modify_test=function(){},Ei.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ei.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ei.prototype.at_index=null,Ei.prototype.at_ite=null,Ei.prototype.push_ite=null,Ei.prototype.zip_length=null,Ei.prototype.user_length=null,Ei.prototype.__class__=Ei;var Ii=zpp_nape.util.ZPP_ConvexResultList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new De,this._invalidated=!0};Ii.__name__=["zpp_nape","util","ZPP_ConvexResultList"],Ii.get=function(n,t){null==t&&(t=!1);var e=new ot;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ii.prototype.outer=null,Ii.prototype.inner=null,Ii.prototype.immutable=null,Ii.prototype._invalidated=null,Ii.prototype._invalidate=null,Ii.prototype._validate=null,Ii.prototype._modifiable=null,Ii.prototype.adder=null,Ii.prototype.post_adder=null,Ii.prototype.subber=null,Ii.prototype.dontremove=null,Ii.prototype.reverse_flag=null,Ii.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ii.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ii.prototype.modify_test=function(){},Ii.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ii.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ii.prototype.at_index=null,Ii.prototype.at_ite=null,Ii.prototype.push_ite=null,Ii.prototype.zip_length=null,Ii.prototype.user_length=null,Ii.prototype.__class__=Ii;var Ti=zpp_nape.util.ZPP_EdgeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Se,this._invalidated=!0};Ti.__name__=["zpp_nape","util","ZPP_EdgeList"],Ti.get=function(n,t){null==t&&(t=!1);var e=new mn;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ti.prototype.outer=null,Ti.prototype.inner=null,Ti.prototype.immutable=null,Ti.prototype._invalidated=null,Ti.prototype._invalidate=null,Ti.prototype._validate=null,Ti.prototype._modifiable=null,Ti.prototype.adder=null,Ti.prototype.post_adder=null,Ti.prototype.subber=null,Ti.prototype.dontremove=null,Ti.prototype.reverse_flag=null,Ti.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ti.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ti.prototype.modify_test=function(){},Ti.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ti.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ti.prototype.at_index=null,Ti.prototype.at_ite=null,Ti.prototype.push_ite=null,Ti.prototype.zip_length=null,Ti.prototype.user_length=null,Ti.prototype.__class__=Ti;var Ni=zpp_nape.util.ZPP_ShapeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ce,this._invalidated=!0};Ni.__name__=["zpp_nape","util","ZPP_ShapeList"],Ni.get=function(n,t){null==t&&(t=!1);var e=new bn;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ni.prototype.outer=null,Ni.prototype.inner=null,Ni.prototype.immutable=null,Ni.prototype._invalidated=null,Ni.prototype._invalidate=null,Ni.prototype._validate=null,Ni.prototype._modifiable=null,Ni.prototype.adder=null,Ni.prototype.post_adder=null,Ni.prototype.subber=null,Ni.prototype.dontremove=null,Ni.prototype.reverse_flag=null,Ni.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ni.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ni.prototype.modify_test=function(){},Ni.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ni.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ni.prototype.at_index=null,Ni.prototype.at_ite=null,Ni.prototype.push_ite=null,Ni.prototype.zip_length=null,Ni.prototype.user_length=null,Ni.prototype.__class__=Ni;var Li=zpp_nape.util.ZPP_InteractionGroupList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Le,this._invalidated=!0};Li.__name__=["zpp_nape","util","ZPP_InteractionGroupList"],Li.get=function(n,t){null==t&&(t=!1);var e=new R;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Li.prototype.outer=null,Li.prototype.inner=null,Li.prototype.immutable=null,Li.prototype._invalidated=null,Li.prototype._invalidate=null,Li.prototype._validate=null,Li.prototype._modifiable=null,Li.prototype.adder=null,Li.prototype.post_adder=null,Li.prototype.subber=null,Li.prototype.dontremove=null,Li.prototype.reverse_flag=null,Li.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Li.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Li.prototype.modify_test=function(){},Li.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Li.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Li.prototype.at_index=null,Li.prototype.at_ite=null,Li.prototype.push_ite=null,Li.prototype.zip_length=null,Li.prototype.user_length=null,Li.prototype.__class__=Li;var Vi=zpp_nape.util.ZPP_ArbiterList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new fe,this._invalidated=!0};Vi.__name__=["zpp_nape","util","ZPP_ArbiterList"],Vi.get=function(n,t){null==t&&(t=!1);var e=new E;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Vi.prototype.outer=null,Vi.prototype.inner=null,Vi.prototype.immutable=null,Vi.prototype._invalidated=null,Vi.prototype._invalidate=null,Vi.prototype._validate=null,Vi.prototype._modifiable=null,Vi.prototype.adder=null,Vi.prototype.post_adder=null,Vi.prototype.subber=null,Vi.prototype.dontremove=null,Vi.prototype.reverse_flag=null,Vi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Vi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Vi.prototype.modify_test=function(){},Vi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Vi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Vi.prototype.at_index=null,Vi.prototype.at_ite=null,Vi.prototype.push_ite=null,Vi.prototype.zip_length=null,Vi.prototype.user_length=null,Vi.prototype.__class__=Vi;var Di=zpp_nape.util.ZPP_ContactList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Rl,this._invalidated=!0};Di.__name__=["zpp_nape","util","ZPP_ContactList"],Di.get=function(n,t){null==t&&(t=!1);var e=new L;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Di.prototype.outer=null,Di.prototype.inner=null,Di.prototype.immutable=null,Di.prototype._invalidated=null,Di.prototype._invalidate=null,Di.prototype._validate=null,Di.prototype._modifiable=null,Di.prototype.adder=null,Di.prototype.post_adder=null,Di.prototype.subber=null,Di.prototype.dontremove=null,Di.prototype.reverse_flag=null,Di.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Di.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Di.prototype.modify_test=function(){},Di.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Di.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Di.prototype.at_index=null,Di.prototype.at_ite=null,Di.prototype.push_ite=null,Di.prototype.zip_length=null,Di.prototype.user_length=null,Di.prototype.__class__=Di;var Fi=zpp_nape.util.ZPP_Math=function(){};Fi.__name__=["zpp_nape","util","ZPP_Math"],Fi.sqrt=function(n){return Math.sqrt(n)},Fi.invsqrt=function(n){return 1/Math.sqrt(n)},Fi.sqr=function(n){return n*n},Fi.clamp2=function(n,t){var e=-t;return n<e?e:t<n?t:n},Fi.clamp=function(n,t,e){return n<t?t:e<n?e:n},Fi.prototype.__class__=Fi;var Ri=zpp_nape.util.ZPP_PubPool=function(){};Ri.__name__=["zpp_nape","util","ZPP_PubPool"],Ri.prototype.__class__=Ri;var Zi=zpp_nape.util.ZPP_Set_ZPP_Body=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Zi.__name__=["zpp_nape","util","ZPP_Set_ZPP_Body"],Zi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Zi.prototype.alloc=function(){},Zi.prototype.lt=null,Zi.prototype.swapped=null,Zi.prototype.data=null,Zi.prototype.prev=null,Zi.prototype.next=null,Zi.prototype.parent=null,Zi.prototype.colour=null,Zi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Zi.prototype.empty=function(){return null==this.parent},Zi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Zi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Zi.prototype.has=function(n){return null!=this.find(n)},Zi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Zi.prototype.has_weak=function(n){return null!=this.find_weak(n)},Zi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Zi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Zi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Zi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Zi.prototype.remove=function(n){this.remove_node(this.find(n))},Zi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Zi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Zi.prototype.successor=function(n){var t=this.successor_node(this.find(n));return null==t?null:t.data},Zi.prototype.predecessor=function(n){var t=this.predecessor_node(this.find(n));return null==t?null:t.data},Zi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=Zi.zpp_pool,Zi.zpp_pool=a},Zi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;){e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Zi.zpp_pool,Zi.zpp_pool=t,n)}this.parent=null}},Zi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;){i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Zi.zpp_pool,Zi.zpp_pool=e,t)}this.parent=null}},Zi.prototype.clear_node=function(n,t){t(n.data);var e=n.parent;return null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Zi.zpp_pool,Zi.zpp_pool=n,e},Zi.prototype.__fix_neg_red=function(n){var t,e,i,p,l,r,o,a,s,_,h=n.parent,u=h.prev==n?(t=n.prev,i=(e=n.next).prev,p=e.next,t.colour=0,n.colour=h.colour=1,null!=(n.next=i)&&(i.parent=n),l=h.data,h.data=e.data,e.data=l,null!=this.swapped&&this.swapped(h.data,e.data),null!=(e.prev=p)&&(p.parent=e),e.next=h.next,null!=h.next&&(h.next.parent=e),null!=(h.next=e)&&(e.parent=h),t):(r=n.next,a=(o=n.prev).next,s=o.prev,r.colour=0,n.colour=h.colour=1,null!=(n.prev=a)&&(a.parent=n),_=h.data,h.data=o.data,o.data=_,null!=this.swapped&&this.swapped(h.data,o.data),null!=(o.next=s)&&(s.parent=o),o.prev=h.prev,null!=h.prev&&(h.prev.parent=o),null!=(h.prev=o)&&(o.parent=h),r);null!=u.prev&&0==u.prev.colour?this.__fix_dbl_red(u.prev):null!=u.next&&0==u.next.colour&&this.__fix_dbl_red(u.next)},Zi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));var _=s.parent;if(null==_?this.parent=e:_.prev==s?_.prev=e:_.next=e,null!=e&&(e.parent=_),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Zi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Zi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Zi.prototype.insert=function(n){var t;if(null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Zi.prototype.__class__=Zi;var Bi=zpp_nape.util.ZPP_Set_ZPP_CbSetPair=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Bi.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSetPair"],Bi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Bi.prototype.alloc=function(){},Bi.prototype.lt=null,Bi.prototype.swapped=null,Bi.prototype.data=null,Bi.prototype.prev=null,Bi.prototype.next=null,Bi.prototype.parent=null,Bi.prototype.colour=null,Bi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Bi.prototype.empty=function(){return null==this.parent},Bi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Bi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Bi.prototype.has=function(n){return null!=this.find(n)},Bi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Bi.prototype.has_weak=function(n){return null!=this.find_weak(n)},Bi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Bi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Bi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Bi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Bi.prototype.remove=function(n){this.remove_node(this.find(n))},Bi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Bi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Bi.prototype.successor=function(n){var t=this.successor_node(this.find(n));return null==t?null:t.data},Bi.prototype.predecessor=function(n){var t=this.predecessor_node(this.find(n));return null==t?null:t.data},Bi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=Bi.zpp_pool,Bi.zpp_pool=a},Bi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;){e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Bi.zpp_pool,Bi.zpp_pool=t,n)}this.parent=null}},Bi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;){i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Bi.zpp_pool,Bi.zpp_pool=e,t)}this.parent=null}},Bi.prototype.clear_node=function(n,t){t(n.data);var e=n.parent;return null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Bi.zpp_pool,Bi.zpp_pool=n,e},Bi.prototype.__fix_neg_red=function(n){var t,e,i,p,l,r,o,a,s,_,h=n.parent,u=h.prev==n?(t=n.prev,i=(e=n.next).prev,p=e.next,t.colour=0,n.colour=h.colour=1,null!=(n.next=i)&&(i.parent=n),l=h.data,h.data=e.data,e.data=l,null!=this.swapped&&this.swapped(h.data,e.data),null!=(e.prev=p)&&(p.parent=e),e.next=h.next,null!=h.next&&(h.next.parent=e),null!=(h.next=e)&&(e.parent=h),t):(r=n.next,a=(o=n.prev).next,s=o.prev,r.colour=0,n.colour=h.colour=1,null!=(n.prev=a)&&(a.parent=n),_=h.data,h.data=o.data,o.data=_,null!=this.swapped&&this.swapped(h.data,o.data),null!=(o.next=s)&&(s.parent=o),o.prev=h.prev,null!=h.prev&&(h.prev.parent=o),null!=(h.prev=o)&&(o.parent=h),r);null!=u.prev&&0==u.prev.colour?this.__fix_dbl_red(u.prev):null!=u.next&&0==u.next.colour&&this.__fix_dbl_red(u.next)},Bi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));var _=s.parent;if(null==_?this.parent=e:_.prev==s?_.prev=e:_.next=e,null!=e&&(e.parent=_),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Bi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Bi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Bi.prototype.insert=function(n){var t;if(null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Bi.prototype.__class__=Bi;var Gi=zpp_nape.util.ZPP_Set_ZPP_PartitionVertex=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Gi.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionVertex"],Gi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Gi.prototype.alloc=function(){},Gi.prototype.lt=null,Gi.prototype.swapped=null,Gi.prototype.data=null,Gi.prototype.prev=null,Gi.prototype.next=null,Gi.prototype.parent=null,Gi.prototype.colour=null,Gi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Gi.prototype.empty=function(){return null==this.parent},Gi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Gi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Gi.prototype.has=function(n){return null!=this.find(n)},Gi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Gi.prototype.has_weak=function(n){return null!=this.find_weak(n)},Gi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Gi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Gi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Gi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Gi.prototype.remove=function(n){this.remove_node(this.find(n))},Gi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Gi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Gi.prototype.successor=function(n){var t=this.successor_node(this.find(n));return null==t?null:t.data},Gi.prototype.predecessor=function(n){var t=this.predecessor_node(this.find(n));return null==t?null:t.data},Gi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=Gi.zpp_pool,Gi.zpp_pool=a},Gi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;){e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Gi.zpp_pool,Gi.zpp_pool=t,n)}this.parent=null}},Gi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;){i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Gi.zpp_pool,Gi.zpp_pool=e,t)}this.parent=null}},Gi.prototype.clear_node=function(n,t){t(n.data);var e=n.parent;return null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Gi.zpp_pool,Gi.zpp_pool=n,e},Gi.prototype.__fix_neg_red=function(n){var t,e,i,p,l,r,o,a,s,_,h=n.parent,u=h.prev==n?(t=n.prev,i=(e=n.next).prev,p=e.next,t.colour=0,n.colour=h.colour=1,null!=(n.next=i)&&(i.parent=n),l=h.data,h.data=e.data,e.data=l,null!=this.swapped&&this.swapped(h.data,e.data),null!=(e.prev=p)&&(p.parent=e),e.next=h.next,null!=h.next&&(h.next.parent=e),null!=(h.next=e)&&(e.parent=h),t):(r=n.next,a=(o=n.prev).next,s=o.prev,r.colour=0,n.colour=h.colour=1,null!=(n.prev=a)&&(a.parent=n),_=h.data,h.data=o.data,o.data=_,null!=this.swapped&&this.swapped(h.data,o.data),null!=(o.next=s)&&(s.parent=o),o.prev=h.prev,null!=h.prev&&(h.prev.parent=o),null!=(h.prev=o)&&(o.parent=h),r);null!=u.prev&&0==u.prev.colour?this.__fix_dbl_red(u.prev):null!=u.next&&0==u.next.colour&&this.__fix_dbl_red(u.next)},Gi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));var _=s.parent;if(null==_?this.parent=e:_.prev==s?_.prev=e:_.next=e,null!=e&&(e.parent=_),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Gi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Gi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Gi.prototype.insert=function(n){var t;if(null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Gi.prototype.__class__=Gi;var qi=zpp_nape.util.ZPP_Set_ZPP_PartitionPair=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};qi.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionPair"],qi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},qi.prototype.alloc=function(){},qi.prototype.lt=null,qi.prototype.swapped=null,qi.prototype.data=null,qi.prototype.prev=null,qi.prototype.next=null,qi.prototype.parent=null,qi.prototype.colour=null,qi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},qi.prototype.empty=function(){return null==this.parent},qi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},qi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},qi.prototype.has=function(n){return null!=this.find(n)},qi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},qi.prototype.has_weak=function(n){return null!=this.find_weak(n)},qi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},qi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},qi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},qi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},qi.prototype.remove=function(n){this.remove_node(this.find(n))},qi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},qi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},qi.prototype.successor=function(n){var t=this.successor_node(this.find(n));return null==t?null:t.data},qi.prototype.predecessor=function(n){var t=this.predecessor_node(this.find(n));return null==t?null:t.data},qi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=qi.zpp_pool,qi.zpp_pool=a},qi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;){e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=qi.zpp_pool,qi.zpp_pool=t,n)}this.parent=null}},qi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;){i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=qi.zpp_pool,qi.zpp_pool=e,t)}this.parent=null}},qi.prototype.clear_node=function(n,t){t(n.data);var e=n.parent;return null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=qi.zpp_pool,qi.zpp_pool=n,e},qi.prototype.__fix_neg_red=function(n){var t,e,i,p,l,r,o,a,s,_,h=n.parent,u=h.prev==n?(t=n.prev,i=(e=n.next).prev,p=e.next,t.colour=0,n.colour=h.colour=1,null!=(n.next=i)&&(i.parent=n),l=h.data,h.data=e.data,e.data=l,null!=this.swapped&&this.swapped(h.data,e.data),null!=(e.prev=p)&&(p.parent=e),e.next=h.next,null!=h.next&&(h.next.parent=e),null!=(h.next=e)&&(e.parent=h),t):(r=n.next,a=(o=n.prev).next,s=o.prev,r.colour=0,n.colour=h.colour=1,null!=(n.prev=a)&&(a.parent=n),_=h.data,h.data=o.data,o.data=_,null!=this.swapped&&this.swapped(h.data,o.data),null!=(o.next=s)&&(s.parent=o),o.prev=h.prev,null!=h.prev&&(h.prev.parent=o),null!=(h.prev=o)&&(o.parent=h),r);null!=u.prev&&0==u.prev.colour?this.__fix_dbl_red(u.prev):null!=u.next&&0==u.next.colour&&this.__fix_dbl_red(u.next)},qi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));var _=s.parent;if(null==_?this.parent=e:_.prev==s?_.prev=e:_.next=e,null!=e&&(e.parent=_),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},qi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},qi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},qi.prototype.insert=function(n){var t;if(null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},qi.prototype.__class__=qi;var Ui=zpp_nape.util.ZPP_Set_ZPP_SimpleVert=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Ui.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleVert"],Ui.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Ui.prototype.alloc=function(){},Ui.prototype.lt=null,Ui.prototype.swapped=null,Ui.prototype.data=null,Ui.prototype.prev=null,Ui.prototype.next=null,Ui.prototype.parent=null,Ui.prototype.colour=null,Ui.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Ui.prototype.empty=function(){return null==this.parent},Ui.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Ui.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Ui.prototype.has=function(n){return null!=this.find(n)},Ui.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Ui.prototype.has_weak=function(n){return null!=this.find_weak(n)},Ui.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Ui.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Ui.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Ui.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Ui.prototype.remove=function(n){this.remove_node(this.find(n))},Ui.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Ui.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Ui.prototype.successor=function(n){var t=this.successor_node(this.find(n));return null==t?null:t.data},Ui.prototype.predecessor=function(n){var t=this.predecessor_node(this.find(n));return null==t?null:t.data},Ui.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=Ui.zpp_pool,Ui.zpp_pool=a},Ui.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;){e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Ui.zpp_pool,Ui.zpp_pool=t,n)}this.parent=null}},Ui.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;){i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Ui.zpp_pool,Ui.zpp_pool=e,t)}this.parent=null}},Ui.prototype.clear_node=function(n,t){t(n.data);var e=n.parent;return null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Ui.zpp_pool,Ui.zpp_pool=n,e},Ui.prototype.__fix_neg_red=function(n){var t,e,i,p,l,r,o,a,s,_,h=n.parent,u=h.prev==n?(t=n.prev,i=(e=n.next).prev,p=e.next,t.colour=0,n.colour=h.colour=1,null!=(n.next=i)&&(i.parent=n),l=h.data,h.data=e.data,e.data=l,null!=this.swapped&&this.swapped(h.data,e.data),null!=(e.prev=p)&&(p.parent=e),e.next=h.next,null!=h.next&&(h.next.parent=e),null!=(h.next=e)&&(e.parent=h),t):(r=n.next,a=(o=n.prev).next,s=o.prev,r.colour=0,n.colour=h.colour=1,null!=(n.prev=a)&&(a.parent=n),_=h.data,h.data=o.data,o.data=_,null!=this.swapped&&this.swapped(h.data,o.data),null!=(o.next=s)&&(s.parent=o),o.prev=h.prev,null!=h.prev&&(h.prev.parent=o),null!=(h.prev=o)&&(o.parent=h),r);null!=u.prev&&0==u.prev.colour?this.__fix_dbl_red(u.prev):null!=u.next&&0==u.next.colour&&this.__fix_dbl_red(u.next)},Ui.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));var _=s.parent;if(null==_?this.parent=e:_.prev==s?_.prev=e:_.next=e,null!=e&&(e.parent=_),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Ui.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Ui.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Ui.prototype.insert=function(n){var t;if(null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Ui.prototype.__class__=Ui;var Ki=zpp_nape.util.ZPP_Set_ZPP_SimpleSeg=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Ki.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleSeg"],Ki.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Ki.prototype.alloc=function(){},Ki.prototype.lt=null,Ki.prototype.swapped=null,Ki.prototype.data=null,Ki.prototype.prev=null,Ki.prototype.next=null,Ki.prototype.parent=null,Ki.prototype.colour=null,Ki.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Ki.prototype.empty=function(){return null==this.parent},Ki.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Ki.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Ki.prototype.has=function(n){return null!=this.find(n)},Ki.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Ki.prototype.has_weak=function(n){return null!=this.find_weak(n)},Ki.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Ki.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Ki.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Ki.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Ki.prototype.remove=function(n){this.remove_node(this.find(n))},Ki.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Ki.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Ki.prototype.successor=function(n){var t=this.successor_node(this.find(n));return null==t?null:t.data},Ki.prototype.predecessor=function(n){var t=this.predecessor_node(this.find(n));return null==t?null:t.data},Ki.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=Ki.zpp_pool,Ki.zpp_pool=a},Ki.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;){e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Ki.zpp_pool,Ki.zpp_pool=t,n)}this.parent=null}},Ki.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;){i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Ki.zpp_pool,Ki.zpp_pool=e,t)}this.parent=null}},Ki.prototype.clear_node=function(n,t){t(n.data);var e=n.parent;return null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Ki.zpp_pool,Ki.zpp_pool=n,e},Ki.prototype.__fix_neg_red=function(n){var t,e,i,p,l,r,o,a,s,_,h=n.parent,u=h.prev==n?(t=n.prev,i=(e=n.next).prev,p=e.next,t.colour=0,n.colour=h.colour=1,null!=(n.next=i)&&(i.parent=n),l=h.data,h.data=e.data,e.data=l,null!=this.swapped&&this.swapped(h.data,e.data),null!=(e.prev=p)&&(p.parent=e),e.next=h.next,null!=h.next&&(h.next.parent=e),null!=(h.next=e)&&(e.parent=h),t):(r=n.next,a=(o=n.prev).next,s=o.prev,r.colour=0,n.colour=h.colour=1,null!=(n.prev=a)&&(a.parent=n),_=h.data,h.data=o.data,o.data=_,null!=this.swapped&&this.swapped(h.data,o.data),null!=(o.next=s)&&(s.parent=o),o.prev=h.prev,null!=h.prev&&(h.prev.parent=o),null!=(h.prev=o)&&(o.parent=h),r);null!=u.prev&&0==u.prev.colour?this.__fix_dbl_red(u.prev):null!=u.next&&0==u.next.colour&&this.__fix_dbl_red(u.next)},Ki.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));var _=s.parent;if(null==_?this.parent=e:_.prev==s?_.prev=e:_.next=e,null!=e&&(e.parent=_),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Ki.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Ki.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Ki.prototype.insert=function(n){var t;if(null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Ki.prototype.__class__=Ki;var Wi=zpp_nape.util.ZPP_Set_ZPP_SimpleEvent=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Wi.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleEvent"],Wi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Wi.prototype.alloc=function(){},Wi.prototype.lt=null,Wi.prototype.swapped=null,Wi.prototype.data=null,Wi.prototype.prev=null,Wi.prototype.next=null,Wi.prototype.parent=null,Wi.prototype.colour=null,Wi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Wi.prototype.empty=function(){return null==this.parent},Wi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Wi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Wi.prototype.has=function(n){return null!=this.find(n)},Wi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Wi.prototype.has_weak=function(n){return null!=this.find_weak(n)},Wi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Wi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Wi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Wi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Wi.prototype.remove=function(n){this.remove_node(this.find(n))},Wi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Wi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Wi.prototype.successor=function(n){var t=this.successor_node(this.find(n));return null==t?null:t.data},Wi.prototype.predecessor=function(n){var t=this.predecessor_node(this.find(n));return null==t?null:t.data},Wi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=Wi.zpp_pool,Wi.zpp_pool=a},Wi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;){e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Wi.zpp_pool,Wi.zpp_pool=t,n)}this.parent=null}},Wi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;){i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Wi.zpp_pool,Wi.zpp_pool=e,t)}this.parent=null}},Wi.prototype.clear_node=function(n,t){t(n.data);var e=n.parent;return null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Wi.zpp_pool,Wi.zpp_pool=n,e},Wi.prototype.__fix_neg_red=function(n){var t,e,i,p,l,r,o,a,s,_,h=n.parent,u=h.prev==n?(t=n.prev,i=(e=n.next).prev,p=e.next,t.colour=0,n.colour=h.colour=1,null!=(n.next=i)&&(i.parent=n),l=h.data,h.data=e.data,e.data=l,null!=this.swapped&&this.swapped(h.data,e.data),null!=(e.prev=p)&&(p.parent=e),e.next=h.next,null!=h.next&&(h.next.parent=e),null!=(h.next=e)&&(e.parent=h),t):(r=n.next,a=(o=n.prev).next,s=o.prev,r.colour=0,n.colour=h.colour=1,null!=(n.prev=a)&&(a.parent=n),_=h.data,h.data=o.data,o.data=_,null!=this.swapped&&this.swapped(h.data,o.data),null!=(o.next=s)&&(s.parent=o),o.prev=h.prev,null!=h.prev&&(h.prev.parent=o),null!=(h.prev=o)&&(o.parent=h),r);null!=u.prev&&0==u.prev.colour?this.__fix_dbl_red(u.prev):null!=u.next&&0==u.next.colour&&this.__fix_dbl_red(u.next)},Wi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));var _=s.parent;if(null==_?this.parent=e:_.prev==s?_.prev=e:_.next=e,null!=e&&(e.parent=_),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Wi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Wi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Wi.prototype.insert=function(n){var t;if(null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Wi.prototype.__class__=Wi;var Yi=zpp_nape.util.ZPP_Set_ZPP_CbSet=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Yi.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSet"],Yi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Yi.prototype.alloc=function(){},Yi.prototype.lt=null,Yi.prototype.swapped=null,Yi.prototype.data=null,Yi.prototype.prev=null,Yi.prototype.next=null,Yi.prototype.parent=null,Yi.prototype.colour=null,Yi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Yi.prototype.empty=function(){return null==this.parent},Yi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Yi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Yi.prototype.has=function(n){return null!=this.find(n)},Yi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Yi.prototype.has_weak=function(n){return null!=this.find_weak(n)},Yi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Yi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Yi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Yi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Yi.prototype.remove=function(n){this.remove_node(this.find(n))},Yi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Yi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Yi.prototype.successor=function(n){var t=this.successor_node(this.find(n));return null==t?null:t.data},Yi.prototype.predecessor=function(n){var t=this.predecessor_node(this.find(n));return null==t?null:t.data},Yi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=Yi.zpp_pool,Yi.zpp_pool=a},Yi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;){e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Yi.zpp_pool,Yi.zpp_pool=t,n)}this.parent=null}},Yi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;){i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Yi.zpp_pool,Yi.zpp_pool=e,t)}this.parent=null}},Yi.prototype.clear_node=function(n,t){t(n.data);var e=n.parent;return null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Yi.zpp_pool,Yi.zpp_pool=n,e},Yi.prototype.__fix_neg_red=function(n){var t,e,i,p,l,r,o,a,s,_,h=n.parent,u=h.prev==n?(t=n.prev,i=(e=n.next).prev,p=e.next,t.colour=0,n.colour=h.colour=1,null!=(n.next=i)&&(i.parent=n),l=h.data,h.data=e.data,e.data=l,null!=this.swapped&&this.swapped(h.data,e.data),null!=(e.prev=p)&&(p.parent=e),e.next=h.next,null!=h.next&&(h.next.parent=e),null!=(h.next=e)&&(e.parent=h),t):(r=n.next,a=(o=n.prev).next,s=o.prev,r.colour=0,n.colour=h.colour=1,null!=(n.prev=a)&&(a.parent=n),_=h.data,h.data=o.data,o.data=_,null!=this.swapped&&this.swapped(h.data,o.data),null!=(o.next=s)&&(s.parent=o),o.prev=h.prev,null!=h.prev&&(h.prev.parent=o),null!=(h.prev=o)&&(o.parent=h),r);null!=u.prev&&0==u.prev.colour?this.__fix_dbl_red(u.prev):null!=u.next&&0==u.next.colour&&this.__fix_dbl_red(u.next)},Yi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));var _=s.parent;if(null==_?this.parent=e:_.prev==s?_.prev=e:_.next=e,null!=e&&(e.parent=_),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Yi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Yi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Yi.prototype.insert=function(n){var t;if(null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Yi.prototype.__class__=Yi,String.prototype.__class__=String,String.__name__=!0,Array.__name__=!0;var Ji={__name__:["Int"]},Xi={__name__:["Dynamic"]},Hi=Number;Hi.__name__=["Float"];var $i=Boolean;$i.__ename__=["Bool"];var Qi={__name__:["Class"]},np={};zn.__toStr={}.toString,co.epsilon=1e-8,co.fluidAngularDragFriction=2.5,co.fluidAngularDrag=100,co.fluidVacuumDrag=.5,co.fluidLinearDrag=.5,co.collisionSlop=.2,co.collisionSlopCCD=.5,co.distanceThresholdCCD=.05,co.staticCCDLinearThreshold=.05,co.staticCCDAngularThreshold=.005,co.bulletCCDLinearThreshold=.125,co.bulletCCDAngularThreshold=.0125,co.dynamicSweepLinearThreshold=17,co.dynamicSweepAngularThreshold=.6,co.angularCCDSlipScale=.75,co.arbiterExpirationDelay=6,co.staticFrictionThreshold=2,co.elasticThreshold=20,co.sleepDelay=60,co.linearSleepThreshold=.2,co.angularSleepThreshold=.4,co.contactBiasCoef=.3,co.contactStaticBiasCoef=.6,co.contactContinuousBiasCoef=.4,co.contactContinuousStaticBiasCoef=.5,co.constraintLinearSlop=.1,co.constraintAngularSlop=.001,co.illConditionedThreshold=2e8,qn.zpp_pool=null,Un.zpp_pool=null,Kn.zpp_pool=null,Wn.zpp_pool=null,Yn.zpp_pool=null,Jn.zpp_pool=null,Xn.zpp_pool=null,Hn.zpp_pool=null,$n.zpp_pool=null,Qn.zpp_pool=null,nt.zpp_pool=null,tt.zpp_pool=null,et.zpp_pool=null,it.zpp_pool=null,st.zpp_pool=null,Pn.FMAX=1e100,Sn._Constraint=0,Sn._Interactor=0,Sn._CbType=0,Sn._CbSet=0,Sn._Listener=0,Sn._ZPP_SimpleVert=0,Sn._ZPP_SimpleSeg=0,Sn._Space=0,Sn._InteractionGroup=0,pt.zpp_pool=null,Tl.zpp_pool=null,Nl.zpp_pool=null,Ln.ANY_SHAPE=new s,Ln.ANY_BODY=new s,Ln.ANY_COMPOUND=new s,Ln.ANY_CONSTRAINT=new s,Ll.internal=!1,Ll.id_ImmState_ACCEPT=1,Ll.id_ImmState_IGNORE=2,Ll.id_ImmState_ALWAYS=4,Ll.id_GravMassMode_DEFAULT=0,Ll.id_GravMassMode_FIXED=1,Ll.id_GravMassMode_SCALED=2,Ll.id_InertiaMode_DEFAULT=0,Ll.id_InertiaMode_FIXED=1,Ll.id_MassMode_DEFAULT=0,Ll.id_MassMode_FIXED=1,Ll.id_BodyType_STATIC=1,Ll.id_BodyType_DYNAMIC=2,Ll.id_BodyType_KINEMATIC=3,Ll.id_ListenerType_BODY=0,Ll.id_PreFlag_ACCEPT=1,Ll.id_ListenerType_CONSTRAINT=1,Ll.id_PreFlag_IGNORE=2,Ll.id_ListenerType_INTERACTION=2,Ll.id_PreFlag_ACCEPT_ONCE=3,Ll.id_ListenerType_PRE=3,Ll.id_PreFlag_IGNORE_ONCE=4,Ll.id_CbEvent_BEGIN=0,Ll.id_InteractionType_COLLISION=1,Ll.id_CbEvent_ONGOING=6,Ll.id_InteractionType_SENSOR=2,Ll.id_CbEvent_END=1,Ll.id_InteractionType_FLUID=4,Ll.id_CbEvent_WAKE=2,Ll.id_InteractionType_ANY=7,Ll.id_CbEvent_SLEEP=3,Ll.id_CbEvent_BREAK=4,Ll.id_CbEvent_PRE=5,Ll.id_Winding_UNDEFINED=0,Ll.id_Winding_CLOCKWISE=1,Ll.id_Winding_ANTICLOCKWISE=2,Ll.id_ValidationResult_VALID=0,Ll.id_ValidationResult_DEGENERATE=1,Ll.id_ValidationResult_CONCAVE=2,Ll.id_ValidationResult_SELF_INTERSECTING=3,Ll.id_ShapeType_CIRCLE=0,Ll.id_ShapeType_POLYGON=1,Ll.id_Broadphase_DYNAMIC_AABB_TREE=0,Ll.id_Broadphase_SWEEP_AND_PRUNE=1,Ll.id_ArbiterType_COLLISION=1,Ll.id_ArbiterType_SENSOR=2,Ll.id_ArbiterType_FLUID=4,Vn.types=function(){null==Ll.ListenerType_BODY&&(Ll.internal=!0,Ll.ListenerType_BODY=new c,Ll.internal=!1);var n=Ll.ListenerType_BODY;null==Ll.ListenerType_CONSTRAINT&&(Ll.internal=!0,Ll.ListenerType_CONSTRAINT=new c,Ll.internal=!1);var t=Ll.ListenerType_CONSTRAINT;null==Ll.ListenerType_INTERACTION&&(Ll.internal=!0,Ll.ListenerType_INTERACTION=new c,Ll.internal=!1);var e=Ll.ListenerType_INTERACTION;return null==Ll.ListenerType_PRE&&(Ll.internal=!0,Ll.ListenerType_PRE=new c,Ll.internal=!1),[n,t,e,Ll.ListenerType_PRE]}(),Vn.events=function(){null==Ll.CbEvent_BEGIN&&(Ll.internal=!0,Ll.CbEvent_BEGIN=new d,Ll.internal=!1);var n=Ll.CbEvent_BEGIN;null==Ll.CbEvent_END&&(Ll.internal=!0,Ll.CbEvent_END=new d,Ll.internal=!1);var t=Ll.CbEvent_END;null==Ll.CbEvent_WAKE&&(Ll.internal=!0,Ll.CbEvent_WAKE=new d,Ll.internal=!1);var e=Ll.CbEvent_WAKE;null==Ll.CbEvent_SLEEP&&(Ll.internal=!0,Ll.CbEvent_SLEEP=new d,Ll.internal=!1);var i=Ll.CbEvent_SLEEP;null==Ll.CbEvent_BREAK&&(Ll.internal=!0,Ll.CbEvent_BREAK=new d,Ll.internal=!1);var p=Ll.CbEvent_BREAK;null==Ll.CbEvent_PRE&&(Ll.internal=!0,Ll.CbEvent_PRE=new d,Ll.internal=!1);var l=Ll.CbEvent_PRE;return null==Ll.CbEvent_ONGOING&&(Ll.internal=!0,Ll.CbEvent_ONGOING=new d,Ll.internal=!1),[n,t,e,i,p,l,Ll.CbEvent_ONGOING]}(),le.UCbSet=new Nn,le.VCbSet=new Nn,le.WCbSet=new Nn,le.UCbType=new Rn,le.VCbType=new Rn,le.WCbType=new Rn,ri.internal=!1,ri.COL=1,ri.FLUID=4,ri.SENSOR=2,ri.types=function(){null==Ll.ArbiterType_COLLISION&&(Ll.internal=!0,Ll.ArbiterType_COLLISION=new I,Ll.internal=!1);var n=Ll.ArbiterType_COLLISION;null==Ll.ArbiterType_SENSOR&&(Ll.internal=!0,Ll.ArbiterType_SENSOR=new I,Ll.internal=!1);var t=Ll.ArbiterType_SENSOR;return null==Ll.ArbiterType_FLUID&&(Ll.internal=!0,Ll.ArbiterType_FLUID=new I,Ll.internal=!1),[null,n,t,null,Ll.ArbiterType_FLUID]}(),Vl.zpp_pool=null,Dl.zpp_pool=null,Fl.FACE1=0,Fl.FACE2=1,Fl.CIRCLE=2,Fl.zpp_pool=null,Rl.internal=!1,Rl.zpp_pool=null,vt.zpp_pool=null,mt.SHAPE=1,mt.BODY=2,Al.zpp_pool=null,vo.flowpoly=new bt,vo.flowsegs=new bt,wt.convexPool=null,wt.rayPool=null,wt.internal=!1,bi.zpp_pool=null,gi.zpp_pool=null,wi.ints=null,wi.paths=null,xp.zpp_pool=null,kt.zpp_pool=null,Ot.zpp_pool=null,dp.zpp_pool=null,yp.me=new yp,yp.look_march=[-1,224,56,216,14,-1,54,214,131,99,-1,91,141,109,181,85],Pt.zpp_pool=null,At.queue=null,At.edges=null,jt.nextId=0,jt.zpp_pool=null,Et.zpp_pool=null,Tt.zpp_pool=null,Nt.zpp_pool=null,Lt.zpp_pool=null,Dt.sweep=null,Dt.inthash=null,Dt.vertices=null,Dt.queue=null,Dt.ints=null,Dt.list_vertices=null,Dt.list_queue=null,Ft.zpp_pool=null,Rt.zpp_pool=null,Zt.stack=null,qt.zpp_pool=null,Bt.zpp_pool=null,Gt.queue=null,Gt.stack=null,Gt.edgeSet=null,mo.zpp_pool=null,Yt.types=function(){null==Ll.BodyType_STATIC&&(Ll.internal=!0,Ll.BodyType_STATIC=new rn,Ll.internal=!1);var n=Ll.BodyType_STATIC;null==Ll.BodyType_DYNAMIC&&(Ll.internal=!0,Ll.BodyType_DYNAMIC=new rn,Ll.internal=!1);var t=Ll.BodyType_DYNAMIC;return null==Ll.BodyType_KINEMATIC&&(Ll.internal=!0,Ll.BodyType_KINEMATIC=new rn,Ll.internal=!1),[null,n,t,Ll.BodyType_KINEMATIC]}(),Yt.bodystack=null,Yt.bodyset=null,Yt.cur_graph_depth=0,Xt.zpp_pool=null,Ht.zpp_pool=null,Ht.WAKE=1,Ht.PROPS=2,Ht.ANGDRAG=4,Ht.ARBITERS=8,$t.types=function(){null==Ll.ShapeType_CIRCLE&&(Ll.internal=!0,Ll.ShapeType_CIRCLE=new gn,Ll.internal=!1);var n=Ll.ShapeType_CIRCLE;return null==Ll.ShapeType_POLYGON&&(Ll.internal=!0,Ll.ShapeType_POLYGON=new gn,Ll.internal=!1),[n,Ll.ShapeType_POLYGON]}(),ne.zpp_pool=null,ne.internal=!1,jl.zpp_pool=null,ep.zpp_pool=null,El.tmpaabb=new Al,ie.FATTEN=3,ie.VEL_STEPS=2,pe.zpp_pool=null,re.zpp_pool=null,Bl.zpp_pool=null,se.zpp_pool=null,de.zpp_pool=null,Ze.zpp_pool=null,Be.zpp_pool=null,Ge.zpp_pool=null,qe.zpp_pool=null,Ue.zpp_pool=null,Ke.zpp_pool=null,Gl.zpp_pool=null,ql.zpp_pool=null,We.zpp_pool=null,Ul.zpp_pool=null,Ye.zpp_pool=null,Je.zpp_pool=null,Xe.zpp_pool=null,He.zpp_pool=null,$e.zpp_pool=null,Qe.zpp_pool=null,ni.zpp_pool=null,ti.zpp_pool=null,ei.zpp_pool=null,ii.zpp_pool=null,pi.zpp_pool=null,li.zpp_pool=null,ip.zpp_pool=null,oi.zpp_pool=null,ai.zpp_pool=null,si.zpp_pool=null,Kl.zpp_pool=null,Wl.zpp_pool=null,_i.zpp_pool=null,Yl.zpp_pool=null,hi.zpp_pool=null,ui.zpp_pool=null,xi.zpp_pool=null,di.zpp_pool=null,yi.zpp_pool=null,ci.internal=!1,vi.internal=!1,ki.internal=!1,Oi.internal=!1,Pi.internal=!1,Si.internal=!1,Ai.internal=!1,ji.internal=!1,Ei.internal=!1,Ii.internal=!1,Ti.internal=!1,Ni.internal=!1,Li.internal=!1,Vi.internal=!1,Di.internal=!1,Ri.poolGeomPoly=null,Ri.poolVec2=null,Ri.poolVec3=null,Zi.zpp_pool=null,Bi.zpp_pool=null,Gi.zpp_pool=null,qi.zpp_pool=null,Ui.zpp_pool=null,Ki.zpp_pool=null,Wi.zpp_pool=null,Yi.zpp_pool=null,On.main()}();